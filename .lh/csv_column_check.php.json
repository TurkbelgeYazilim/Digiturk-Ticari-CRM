{
    "sourceFile": "csv_column_check.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754744762930,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754744762930,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * VoIP İris Rapor CSV ve Tablo Sütun Kontrolü\r\n */\r\n\r\ntry {\r\n    // Database bağlantısı\r\n    $dsn = \"mysql:host=localhost;dbname=ilekasoft_crmdb;charset=utf8mb4\";\r\n    $pdo = new PDO($dsn, 'ilekasoft_crmuser', 'KaleW356!');\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n\r\n    echo \"<h2>VoIP İris Rapor - CSV ve Tablo Sütun Kontrolü</h2>\";\r\n\r\n    // Tablo yapısını kontrol et\r\n    $checkColumns = \"DESCRIBE voip_iris_rapor\";\r\n    $stmt = $pdo->query($checkColumns);\r\n    $columns = $stmt->fetchAll();\r\n\r\n    echo \"<h3>Veritabanı Tablo Sütunları:</h3>\";\r\n    echo \"<table border='1' style='border-collapse: collapse; margin: 10px 0;'>\";\r\n    echo \"<tr><th>Sütun Adı</th><th>Tip</th><th>Null</th><th>Key</th><th>Default</th><th>Extra</th></tr>\";\r\n    \r\n    $db_columns = [];\r\n    foreach($columns as $col) {\r\n        echo \"<tr>\";\r\n        echo \"<td>{$col['Field']}</td>\";\r\n        echo \"<td>{$col['Type']}</td>\";\r\n        echo \"<td>{$col['Null']}</td>\";\r\n        echo \"<td>{$col['Key']}</td>\";\r\n        echo \"<td>{$col['Default']}</td>\";\r\n        echo \"<td>{$col['Extra']}</td>\";\r\n        echo \"</tr>\";\r\n        $db_columns[] = $col['Field'];\r\n    }\r\n    echo \"</table>\";\r\n\r\n    // CSV dosyasını oku\r\n    echo \"<h3>CSV Dosyası Başlık Sütunları:</h3>\";\r\n    $csvFile = \"Talep Raporu - Tüm Kayıtlar-09.08.2025 09_21.csv\";\r\n    \r\n    if (file_exists($csvFile)) {\r\n        $handle = fopen($csvFile, 'r');\r\n        if ($handle) {\r\n            $header = fgetcsv($handle, 0, ';');\r\n            fclose($handle);\r\n            \r\n            echo \"<table border='1' style='border-collapse: collapse; margin: 10px 0;'>\";\r\n            echo \"<tr><th>Sıra</th><th>CSV Sütun</th><th>DB'de Var mı?</th></tr>\";\r\n            \r\n            foreach($header as $index => $csvCol) {\r\n                $csvCol = trim($csvCol);\r\n                $inDb = in_array(strtolower($csvCol), array_map('strtolower', $db_columns));\r\n                echo \"<tr>\";\r\n                echo \"<td>\" . ($index + 1) . \"</td>\";\r\n                echo \"<td>{$csvCol}</td>\";\r\n                echo \"<td>\" . ($inDb ? '✓' : '❌') . \"</td>\";\r\n                echo \"</tr>\";\r\n            }\r\n            echo \"</table>\";\r\n            \r\n            echo \"<h3>Eşleşen Sütunlar:</h3>\";\r\n            $matching = [];\r\n            foreach($header as $csvCol) {\r\n                $csvCol = trim($csvCol);\r\n                foreach($db_columns as $dbCol) {\r\n                    if (strtolower($csvCol) == strtolower($dbCol)) {\r\n                        $matching[] = $csvCol;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            if(!empty($matching)) {\r\n                echo \"<p><strong>Eşleşen sütunlar:</strong> \" . implode(', ', $matching) . \"</p>\";\r\n            } else {\r\n                echo \"<p style='color: red;'><strong>Hiç eşleşen sütun yok!</strong></p>\";\r\n            }\r\n        } else {\r\n            echo \"<p style='color: red;'>CSV dosyası açılamadı</p>\";\r\n        }\r\n    } else {\r\n        echo \"<p style='color: red;'>CSV dosyası bulunamadı: $csvFile</p>\";\r\n    }\r\n\r\n} catch (PDOException $e) {\r\n    echo \"<p style='color: red;'>Veritabanı hatası: \" . $e->getMessage() . \"</p>\";\r\n}\r\n?>\r\n"
        }
    ]
}