{
    "sourceFile": "upload_diagnostic.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1755002355455,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1755002355455,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * CSV Upload Diagnostic Tool\r\n * Bu dosya upload sorunlarÄ±nÄ± teÅŸhis etmek iÃ§in kullanÄ±lÄ±r\r\n */\r\n\r\necho \"<h1>ğŸ” CSV Upload Diagnostik AracÄ±</h1>\";\r\necho \"<div style='font-family: Arial, sans-serif; margin: 20px;'>\";\r\n\r\n// PHP SÃ¼rÃ¼mÃ¼ ve temel ayarlar\r\necho \"<h2>ğŸ“‹ PHP KonfigÃ¼rasyonu</h2>\";\r\necho \"<table border='1' cellpadding='10' style='border-collapse: collapse;'>\";\r\necho \"<tr><th>Ayar</th><th>DeÄŸer</th><th>Durum</th></tr>\";\r\n\r\n$configs = [\r\n    'PHP Version' => phpversion(),\r\n    'upload_max_filesize' => ini_get('upload_max_filesize'),\r\n    'post_max_size' => ini_get('post_max_size'),\r\n    'max_execution_time' => ini_get('max_execution_time'),\r\n    'memory_limit' => ini_get('memory_limit'),\r\n    'max_input_time' => ini_get('max_input_time'),\r\n    'max_file_uploads' => ini_get('max_file_uploads'),\r\n    'file_uploads' => ini_get('file_uploads') ? 'Enabled' : 'Disabled'\r\n];\r\n\r\nforeach ($configs as $key => $value) {\r\n    $status = '';\r\n    $color = '#000';\r\n    \r\n    if ($key == 'upload_max_filesize') {\r\n        $bytes = parse_size($value);\r\n        if ($bytes < 30*1024*1024) { // 30MB\r\n            $status = 'âš ï¸ DÃ¼ÅŸÃ¼k (30MB+ Ã¶nerilir)';\r\n            $color = 'red';\r\n        } else {\r\n            $status = 'âœ… Yeterli';\r\n            $color = 'green';\r\n        }\r\n    } elseif ($key == 'post_max_size') {\r\n        $bytes = parse_size($value);\r\n        if ($bytes < 30*1024*1024) { // 30MB\r\n            $status = 'âš ï¸ DÃ¼ÅŸÃ¼k (30MB+ Ã¶nerilir)';\r\n            $color = 'red';\r\n        } else {\r\n            $status = 'âœ… Yeterli';\r\n            $color = 'green';\r\n        }\r\n    } elseif ($key == 'max_execution_time') {\r\n        if ($value < 300) { // 5 dakika\r\n            $status = 'âš ï¸ DÃ¼ÅŸÃ¼k (300+ Ã¶nerilir)';\r\n            $color = 'orange';\r\n        } else {\r\n            $status = 'âœ… Yeterli';\r\n            $color = 'green';\r\n        }\r\n    } elseif ($key == 'file_uploads') {\r\n        if ($value == 'Disabled') {\r\n            $status = 'âŒ KapalÄ±';\r\n            $color = 'red';\r\n        } else {\r\n            $status = 'âœ… AÃ§Ä±k';\r\n            $color = 'green';\r\n        }\r\n    }\r\n    \r\n    echo \"<tr>\";\r\n    echo \"<td><strong>$key</strong></td>\";\r\n    echo \"<td>$value</td>\";\r\n    echo \"<td style='color: $color;'>$status</td>\";\r\n    echo \"</tr>\";\r\n}\r\necho \"</table>\";\r\n\r\n// Upload klasÃ¶rÃ¼ kontrolÃ¼\r\necho \"<h2>ğŸ“ Upload KlasÃ¶rÃ¼ KontrolÃ¼</h2>\";\r\n$upload_dirs = [\r\n    'uploads/iris_rapor/',\r\n    'assets/uploads/',\r\n    'uploads/',\r\n    '1OrnekData/'\r\n];\r\n\r\necho \"<table border='1' cellpadding='10' style='border-collapse: collapse;'>\";\r\necho \"<tr><th>KlasÃ¶r</th><th>Durum</th><th>Yazma Ä°zni</th><th>Dosyalar</th></tr>\";\r\n\r\nforeach ($upload_dirs as $dir) {\r\n    $exists = is_dir($dir);\r\n    $writable = $exists ? is_writable($dir) : false;\r\n    $files = $exists ? count(glob($dir . \"*\")) : 0;\r\n    \r\n    echo \"<tr>\";\r\n    echo \"<td>$dir</td>\";\r\n    echo \"<td>\" . ($exists ? \"âœ… Var\" : \"âŒ Yok\") . \"</td>\";\r\n    echo \"<td>\" . ($writable ? \"âœ… YazÄ±labilir\" : \"âŒ YazÄ±lamaz\") . \"</td>\";\r\n    echo \"<td>$files dosya</td>\";\r\n    echo \"</tr>\";\r\n}\r\necho \"</table>\";\r\n\r\n// Web.config kontrolÃ¼\r\necho \"<h2>ğŸŒ Web.config (IIS) KontrolÃ¼</h2>\";\r\nif (file_exists('web.config')) {\r\n    $content = file_get_contents('web.config');\r\n    if (strpos($content, 'maxAllowedContentLength') !== false) {\r\n        preg_match('/maxAllowedContentLength=\"(\\d+)\"/', $content, $matches);\r\n        if ($matches) {\r\n            $limit = $matches[1];\r\n            $mb = round($limit / (1024*1024), 2);\r\n            echo \"<p>âœ… IIS Upload Limiti: {$mb} MB</p>\";\r\n        }\r\n    } else {\r\n        echo \"<p>âš ï¸ web.config'de upload limiti bulunamadÄ±</p>\";\r\n    }\r\n} else {\r\n    echo \"<p>âŒ web.config dosyasÄ± bulunamadÄ±</p>\";\r\n}\r\n\r\n// Test upload formu\r\necho \"<h2>ğŸ§ª Upload Test</h2>\";\r\necho \"<form method='post' enctype='multipart/form-data' style='border: 1px solid #ccc; padding: 20px; background: #f9f9f9;'>\";\r\necho \"<p>Dosya seÃ§in (test iÃ§in kÃ¼Ã§Ã¼k bir CSV dosyasÄ±):</p>\";\r\necho \"<input type='file' name='test_upload' accept='.csv'><br><br>\";\r\necho \"<input type='submit' value='Test Upload' style='padding: 10px 20px; background: #007cba; color: white; border: none; cursor: pointer;'>\";\r\necho \"</form>\";\r\n\r\nif (isset($_FILES['test_upload'])) {\r\n    echo \"<h3>ğŸ“Š Upload Test Sonucu</h3>\";\r\n    echo \"<div style='background: #f0f0f0; padding: 15px; border-radius: 5px;'>\";\r\n    \r\n    if ($_FILES['test_upload']['error'] === UPLOAD_ERR_OK) {\r\n        echo \"<p style='color: green;'>âœ… <strong>BaÅŸarÄ±lÄ±!</strong></p>\";\r\n        echo \"<p>Dosya adÄ±: \" . $_FILES['test_upload']['name'] . \"</p>\";\r\n        echo \"<p>Dosya boyutu: \" . format_bytes($_FILES['test_upload']['size']) . \"</p>\";\r\n        echo \"<p>GeÃ§ici dosya: \" . $_FILES['test_upload']['tmp_name'] . \"</p>\";\r\n        \r\n        // DosyayÄ± uploads klasÃ¶rÃ¼ne taÅŸÄ±maya Ã§alÄ±ÅŸ\r\n        $target_dir = \"uploads/iris_rapor/\";\r\n        if (!is_dir($target_dir)) {\r\n            mkdir($target_dir, 0755, true);\r\n        }\r\n        \r\n        $target_file = $target_dir . basename($_FILES['test_upload']['name']);\r\n        if (move_uploaded_file($_FILES['test_upload']['tmp_name'], $target_file)) {\r\n            echo \"<p style='color: green;'>âœ… Dosya baÅŸarÄ±yla {$target_file} konumuna taÅŸÄ±ndÄ±</p>\";\r\n        } else {\r\n            echo \"<p style='color: red;'>âŒ Dosya taÅŸÄ±namadÄ±</p>\";\r\n        }\r\n        \r\n    } else {\r\n        echo \"<p style='color: red;'>âŒ <strong>Upload HatasÄ±!</strong></p>\";\r\n        $error_messages = [\r\n            UPLOAD_ERR_INI_SIZE => 'Dosya boyutu php.ini upload_max_filesize limitini aÅŸÄ±yor',\r\n            UPLOAD_ERR_FORM_SIZE => 'Dosya boyutu HTML form MAX_FILE_SIZE limitini aÅŸÄ±yor',\r\n            UPLOAD_ERR_PARTIAL => 'Dosya kÄ±smen yÃ¼klendi',\r\n            UPLOAD_ERR_NO_FILE => 'HiÃ§bir dosya yÃ¼klenmedi',\r\n            UPLOAD_ERR_NO_TMP_DIR => 'GeÃ§ici dizin eksik',\r\n            UPLOAD_ERR_CANT_WRITE => 'Disk yazma hatasÄ±',\r\n            UPLOAD_ERR_EXTENSION => 'PHP uzantÄ±sÄ± dosya yÃ¼klemeyi durdurdu'\r\n        ];\r\n        \r\n        $error_code = $_FILES['test_upload']['error'];\r\n        $error_msg = isset($error_messages[$error_code]) ? $error_messages[$error_code] : \"Bilinmeyen hata ($error_code)\";\r\n        echo \"<p>Hata kodu: $error_code</p>\";\r\n        echo \"<p>Hata mesajÄ±: $error_msg</p>\";\r\n    }\r\n    \r\n    echo \"</div>\";\r\n}\r\n\r\n// Son yÃ¼klenen dosyalar\r\necho \"<h2>ğŸ“„ Son YÃ¼klenen CSV DosyalarÄ±</h2>\";\r\n$recent_files = [];\r\n$dirs_to_check = ['uploads/iris_rapor/', '1OrnekData/', 'uploads/'];\r\n\r\nforeach ($dirs_to_check as $dir) {\r\n    if (is_dir($dir)) {\r\n        $files = glob($dir . \"*.csv\");\r\n        foreach ($files as $file) {\r\n            $recent_files[] = [\r\n                'path' => $file,\r\n                'name' => basename($file),\r\n                'size' => filesize($file),\r\n                'date' => filemtime($file)\r\n            ];\r\n        }\r\n    }\r\n}\r\n\r\n// Son deÄŸiÅŸiklik tarihine gÃ¶re sÄ±rala\r\nusort($recent_files, function($a, $b) {\r\n    return $b['date'] - $a['date'];\r\n});\r\n\r\nif (!empty($recent_files)) {\r\n    echo \"<table border='1' cellpadding='10' style='border-collapse: collapse;'>\";\r\n    echo \"<tr><th>Dosya AdÄ±</th><th>Boyut</th><th>Tarih</th><th>Konum</th></tr>\";\r\n    \r\n    foreach (array_slice($recent_files, 0, 10) as $file) {\r\n        echo \"<tr>\";\r\n        echo \"<td>\" . htmlspecialchars($file['name']) . \"</td>\";\r\n        echo \"<td>\" . format_bytes($file['size']) . \"</td>\";\r\n        echo \"<td>\" . date('d.m.Y H:i:s', $file['date']) . \"</td>\";\r\n        echo \"<td>\" . htmlspecialchars($file['path']) . \"</td>\";\r\n        echo \"</tr>\";\r\n    }\r\n    echo \"</table>\";\r\n} else {\r\n    echo \"<p>âŒ HiÃ§ CSV dosyasÄ± bulunamadÄ±</p>\";\r\n}\r\n\r\necho \"</div>\";\r\n\r\n// YardÄ±mcÄ± fonksiyonlar\r\nfunction parse_size($size) {\r\n    $unit = preg_replace('/[^bkmgtpezy]/i', '', $size);\r\n    $size = preg_replace('/[^0-9\\.]/', '', $size);\r\n    if ($unit) {\r\n        return round($size * pow(1024, stripos('bkmgtpezy', $unit[0])));\r\n    } else {\r\n        return round($size);\r\n    }\r\n}\r\n\r\nfunction format_bytes($size, $precision = 2) {\r\n    $base = log($size, 1024);\r\n    $suffixes = array('B', 'KB', 'MB', 'GB', 'TB');\r\n    return round(pow(1024, $base - floor($base)), $precision) . ' ' . $suffixes[floor($base)];\r\n}\r\n?>\r\n"
        }
    ]
}