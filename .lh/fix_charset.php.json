{
    "sourceFile": "fix_charset.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754749583658,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754749583658,
            "name": "Commit-0",
            "content": "<?php\r\nrequire_once 'application/config/database.php';\r\n\r\n$mysqli = new mysqli($db['default']['hostname'], $db['default']['username'], $db['default']['password'], $db['default']['database']);\r\n\r\nif ($mysqli->connect_error) {\r\n    die(\"Connection failed: \" . $mysqli->connect_error);\r\n}\r\n\r\n$mysqli->set_charset(\"utf8mb4\");\r\n\r\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['fix_charset'])) {\r\n    echo \"<h3>Tablo Charset/Collation DÃ¼zeltme Ä°ÅŸlemi</h3>\";\r\n    \r\n    // Tabloyu utf8mb4_unicode_ci'ye dÃ¶nÃ¼ÅŸtÃ¼r\r\n    $sql = \"ALTER TABLE voip_iris_rapor CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci\";\r\n    \r\n    if ($mysqli->query($sql)) {\r\n        echo \"<div style='color: green;'>âœ… Tablo baÅŸarÄ±yla utf8mb4_unicode_ci'ye dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼!</div>\";\r\n    } else {\r\n        echo \"<div style='color: red;'>âŒ Hata: \" . $mysqli->error . \"</div>\";\r\n    }\r\n    \r\n    echo \"<hr>\";\r\n}\r\n\r\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['clear_table'])) {\r\n    echo \"<h3>Tablo Temizleme Ä°ÅŸlemi</h3>\";\r\n    \r\n    $sql = \"TRUNCATE TABLE voip_iris_rapor\";\r\n    \r\n    if ($mysqli->query($sql)) {\r\n        echo \"<div style='color: green;'>âœ… Tablo baÅŸarÄ±yla temizlendi!</div>\";\r\n    } else {\r\n        echo \"<div style='color: red;'>âŒ Hata: \" . $mysqli->error . \"</div>\";\r\n    }\r\n    \r\n    echo \"<hr>\";\r\n}\r\n\r\n// Mevcut durum kontrolÃ¼\r\necho \"<h3>Mevcut Tablo Durumu</h3>\";\r\n\r\n$result = $mysqli->query(\"SELECT TABLE_COLLATION FROM information_schema.TABLES WHERE TABLE_SCHEMA = '\" . $db['default']['database'] . \"' AND TABLE_NAME = 'voip_iris_rapor'\");\r\nif ($row = $result->fetch_assoc()) {\r\n    echo \"Mevcut Tablo Collation: <strong>\" . $row['TABLE_COLLATION'] . \"</strong><br>\";\r\n}\r\n\r\n$result = $mysqli->query(\"SELECT COUNT(*) as total FROM voip_iris_rapor\");\r\n$row = $result->fetch_assoc();\r\necho \"Mevcut kayÄ±t sayÄ±sÄ±: <strong>\" . number_format($row['total']) . \"</strong><br>\";\r\n\r\n// TÃ¼rkÃ§e karakterli Ã¶rnekler\r\necho \"<hr><h4>TÃ¼rkÃ§e Karakter Ã–rnekleri:</h4>\";\r\n$result = $mysqli->query(\"SELECT memo_yonlenen_bayi_adi FROM voip_iris_rapor WHERE memo_yonlenen_bayi_adi REGEXP '[Ã§ÄŸÄ±Ã¶ÅŸÃ¼Ã‡ÄIÃ–ÅÃœ]' LIMIT 5\");\r\n\r\nif ($result->num_rows > 0) {\r\n    echo \"<strong>TÃ¼rkÃ§e karakterli veriler:</strong><br>\";\r\n    while ($row = $result->fetch_assoc()) {\r\n        echo \"â€¢ \" . htmlspecialchars($row['memo_yonlenen_bayi_adi']) . \"<br>\";\r\n    }\r\n} else {\r\n    echo \"<em>TÃ¼rkÃ§e karakterli veri bulunamadÄ± veya encoding sorunu var.</em><br>\";\r\n}\r\n\r\n$mysqli->close();\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <title>Charset/Collation DÃ¼zeltme</title>\r\n    <style>\r\n        body { font-family: Arial, sans-serif; margin: 40px; }\r\n        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }\r\n        .btn-primary { background: #007bff; color: white; }\r\n        .btn-warning { background: #ffc107; color: black; }\r\n        .btn-danger { background: #dc3545; color: white; }\r\n        .warning { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 20px 0; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <h2>ğŸ”§ TÃ¼rkÃ§e Karakter Sorunu DÃ¼zeltme</h2>\r\n    \r\n    <div class=\"warning\">\r\n        <strong>âš ï¸ Bu iÅŸlemler tablo yapÄ±sÄ±nÄ± deÄŸiÅŸtirir!</strong><br>\r\n        1. Ä°lk Ã¶nce charset/collation'unu dÃ¼zeltin<br>\r\n        2. Sonra tabloyu temizleyip CSV'yi tekrar yÃ¼kleyin\r\n    </div>\r\n    \r\n    <form method=\"post\" style=\"margin-bottom: 20px;\">\r\n        <button type=\"submit\" name=\"fix_charset\" class=\"btn btn-primary\">\r\n            ğŸ”§ Tablo Charset'ini DÃ¼zelt (utf8mb4_unicode_ci)\r\n        </button>\r\n    </form>\r\n    \r\n    <form method=\"post\" style=\"margin-bottom: 20px;\">\r\n        <button type=\"submit\" name=\"clear_table\" class=\"btn btn-danger\" onclick=\"return confirm('TÃ¼m verileri silmek istediÄŸinizden emin misiniz?')\">\r\n            ğŸ—‘ï¸ Tabloyu Temizle (TÃ¼m verileri sil)\r\n        </button>\r\n    </form>\r\n    \r\n    <div style=\"margin-top: 20px;\">\r\n        <a href=\"/direct_csv_process.php\" class=\"btn btn-warning\">\r\n            ğŸ“ CSV'yi Tekrar YÃ¼kle\r\n        </a>\r\n        <a href=\"/voip/hakedis-iris-rapor\" class=\"btn btn-primary\">\r\n            ğŸ“Š Raporu GÃ¶rÃ¼ntÃ¼le\r\n        </a>\r\n    </div>\r\n</body>\r\n</html>\r\n"
        }
    ]
}