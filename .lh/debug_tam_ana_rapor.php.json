{
    "sourceFile": "debug_tam_ana_rapor.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1755275157137,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755324928493,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,165 @@\n+<?php\r\n+// Debug: Tam Ana Rapor SQL sorgusunu test et\r\n+\r\n+require_once 'application/config/database.php';\r\n+\r\n+$connection = new mysqli($db['default']['hostname'], $db['default']['username'], $db['default']['password'], $db['default']['database']);\r\n+\r\n+if ($connection->connect_error) {\r\n+    die(\"Connection failed: \" . $connection->connect_error);\r\n+}\r\n+\r\n+$query = \"\r\n+SELECT DISTINCT\r\n+    c.cari_id,\r\n+    c.cari_ad,\r\n+    c.cari_soyad,\r\n+    CASE \r\n+        WHEN c.cari_bireysel = 0 OR c.cari_soyad IS NULL OR c.cari_soyad = '' \r\n+        THEN c.cari_ad \r\n+        ELSE CONCAT(c.cari_ad, ' ', c.cari_soyad)\r\n+    END as cari_isletme,\r\n+    \r\n+    sf.satis_id as satis_sozlesme_id,\r\n+    sf.satis_vergiDahilToplam as satis_sozlesme_tutar,\r\n+    sf.satis_vergiDahilToplam as satis_sozlesme_tutar_kdv_dahil,\r\n+    NULL as satis_sozlesme_hizmeti,\r\n+    \r\n+    -- İşletme görsel sayısını hesapla (fotograf_dosya kolonundan)\r\n+    CASE \r\n+        WHEN c.fotograf_dosya IS NOT NULL AND c.fotograf_dosya != '' \r\n+        THEN (LENGTH(c.fotograf_dosya) - LENGTH(REPLACE(c.fotograf_dosya, ',', '')) + 1)\r\n+        ELSE 0\r\n+    END as isletme_gorsel_sayisi,\r\n+    \r\n+    -- Evrak sayısını hesapla  \r\n+    CASE \r\n+        WHEN c.evrak_dosya IS NOT NULL AND c.evrak_dosya != '' \r\n+        THEN (LENGTH(c.evrak_dosya) - LENGTH(REPLACE(c.evrak_dosya, ',', '')) + 1)\r\n+        ELSE 0\r\n+    END as evrak_sayisi,\r\n+    \r\n+    -- Satış görsel sayısını hesapla (satisfaturasi.satis_dosya kolonundan)\r\n+    CASE \r\n+        WHEN sf.satis_dosya IS NOT NULL AND sf.satis_dosya != '' \r\n+        THEN (LENGTH(sf.satis_dosya) - LENGTH(REPLACE(sf.satis_dosya, ',', '')) + 1)\r\n+        ELSE 0\r\n+    END as satis_gorsel_sayisi,\r\n+    \r\n+    -- Banka görsel sayısını hesapla\r\n+    COALESCE(banka_gorseller.banka_gorsel_sayisi, 0) as banka_gorsel_sayisi,\r\n+    \r\n+    -- Çek görsel sayısını hesapla\r\n+    COALESCE(cek_gorseller.cek_gorsel_sayisi, 0) as cek_gorsel_sayisi,\r\n+    \r\n+    -- Senet görsel sayısını hesapla\r\n+    COALESCE(senet_gorseller.senet_gorsel_sayisi, 0) as senet_gorsel_sayisi,\r\n+    \r\n+    -- Tahsilat tutarını carihareketleri tablosundan al (ch_alacak toplamı)\r\n+    COALESCE(ch_toplam.toplam_tahsilat, 0) as tahsilat_tutar,\r\n+    \r\n+    -- Aktivasyon durumu (aktivasyon_durum tablosundan)\r\n+    COALESCE(ad.aktivasyon_durum_adi, 'Belirtilmemiş') as aktivasyon_durum,\r\n+    COALESCE(ad.aktivasyon_durum_renk, '#999999') as aktivasyon_durum_renk,\r\n+    \r\n+    a.aktivasyon_tarihi,\r\n+    a.aktivasyon_uye_no,\r\n+    a.aktivasyon_kutu_no,\r\n+    a.aktivasyon_kart_no,\r\n+    a.aktivasyon_aciklama,\r\n+    \r\n+    CONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) as personel\r\n+    \r\n+FROM cari c\r\n+\r\n+-- Carihareketleri tablosundan tahsilat toplamını al\r\n+LEFT JOIN (\r\n+    SELECT ch_cariID, SUM(ch_alacak) as toplam_tahsilat \r\n+    FROM carihareketleri \r\n+    WHERE ch_alacak IS NOT NULL AND ch_alacak > 0\r\n+    GROUP BY ch_cariID\r\n+) ch_toplam ON c.cari_id = ch_toplam.ch_cariID\r\n+\r\n+-- Banka görselleri sayısını al\r\n+LEFT JOIN (\r\n+    SELECT \r\n+        bh_cariID,\r\n+        COUNT(CASE WHEN bh_gorsel IS NOT NULL AND bh_gorsel != '' THEN 1 END) as banka_gorsel_sayisi\r\n+    FROM bankahareketleri \r\n+    WHERE bh_cariID IS NOT NULL\r\n+    GROUP BY bh_cariID\r\n+) banka_gorseller ON c.cari_id = banka_gorseller.bh_cariID\r\n+\r\n+-- Çek görselleri sayısını al\r\n+LEFT JOIN (\r\n+    SELECT \r\n+        cek_cariID,\r\n+        COUNT(CASE WHEN cek_gorsel IS NOT NULL AND cek_gorsel != '' THEN 1 END) as cek_gorsel_sayisi\r\n+    FROM cek \r\n+    WHERE cek_cariID IS NOT NULL\r\n+    GROUP BY cek_cariID\r\n+) cek_gorseller ON c.cari_id = cek_gorseller.cek_cariID\r\n+\r\n+-- Senet görselleri sayısını al\r\n+LEFT JOIN (\r\n+    SELECT \r\n+        senet_cariID,\r\n+        COUNT(CASE WHEN senet_gorsel IS NOT NULL AND senet_gorsel != '' THEN 1 END) as senet_gorsel_sayisi\r\n+    FROM senet \r\n+    WHERE senet_cariID IS NOT NULL\r\n+    GROUP BY senet_cariID\r\n+) senet_gorseller ON c.cari_id = senet_gorseller.senet_cariID\r\n+\r\n+LEFT JOIN satisfaturasi sf ON c.cari_id = sf.satis_cariID\r\n+LEFT JOIN aktivasyon a ON c.cari_id = a.aktivasyon_cari_id\r\n+LEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id\r\n+LEFT JOIN kullanicilar k ON c.cari_olusturan = k.kullanici_id\r\n+\r\n+WHERE c.cari_durum = 1\r\n+GROUP BY c.cari_id, sf.satis_id, a.aktivasyon_id, ad.aktivasyon_durum_id\r\n+ORDER BY c.cari_ad, c.cari_soyad\r\n+LIMIT 5\r\n+\";\r\n+\r\n+echo \"<h2>SQL Sorgu Test Sonucu:</h2>\";\r\n+\r\n+$result = $connection->query($query);\r\n+\r\n+if ($result) {\r\n+    echo \"<p>Sorgu başarılı. Kayıt sayısı: \" . $result->num_rows . \"</p>\";\r\n+    \r\n+    if ($result->num_rows > 0) {\r\n+        echo \"<table border='1' style='border-collapse: collapse;'>\";\r\n+        echo \"<tr>\";\r\n+        echo \"<th>Cari ID</th>\";\r\n+        echo \"<th>İşletme</th>\";\r\n+        echo \"<th>Aktivasyon Durum</th>\";\r\n+        echo \"<th>Aktivasyon Renk</th>\";\r\n+        echo \"<th>Aktivasyon Tarihi</th>\";\r\n+        echo \"<th>Üye No</th>\";\r\n+        echo \"<th>Kutu No</th>\";\r\n+        echo \"<th>Satış Tutarı</th>\";\r\n+        echo \"<th>Tahsilat Tutarı</th>\";\r\n+        echo \"</tr>\";\r\n+        \r\n+        while($row = $result->fetch_assoc()) {\r\n+            echo \"<tr>\";\r\n+            echo \"<td>\" . $row['cari_id'] . \"</td>\";\r\n+            echo \"<td>\" . $row['cari_isletme'] . \"</td>\";\r\n+            echo \"<td style='background-color:\" . $row['aktivasyon_durum_renk'] . \"; color: white;'>\" . $row['aktivasyon_durum'] . \"</td>\";\r\n+            echo \"<td>\" . $row['aktivasyon_durum_renk'] . \"</td>\";\r\n+            echo \"<td>\" . ($row['aktivasyon_tarihi'] ? date('d.m.Y H:i', strtotime($row['aktivasyon_tarihi'])) : 'NULL') . \"</td>\";\r\n+            echo \"<td>\" . ($row['aktivasyon_uye_no'] ?? '-') . \"</td>\";\r\n+            echo \"<td>\" . ($row['aktivasyon_kutu_no'] ?? '-') . \"</td>\";\r\n+            echo \"<td>\" . number_format($row['satis_sozlesme_tutar'], 2) . \" ₺</td>\";\r\n+            echo \"<td>\" . number_format($row['tahsilat_tutar'], 2) . \" ₺</td>\";\r\n+            echo \"</tr>\";\r\n+        }\r\n+        echo \"</table>\";\r\n+    }\r\n+} else {\r\n+    echo \"<p>SQL Hatası: \" . $connection->error . \"</p>\";\r\n+}\r\n+\r\n+$connection->close();\r\n+?>\r\n"
                },
                {
                    "date": 1755325437382,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,165 @@\n+<?php\r\n+// Debug: Tam Ana Rapor SQL sorgusunu test et\r\n+\r\n+require_once 'application/config/database.php';\r\n+\r\n+$connection = new mysqli($db['default']['hostname'], $db['default']['username'], $db['default']['password'], $db['default']['database']);\r\n+\r\n+if ($connection->connect_error) {\r\n+    die(\"Connection failed: \" . $connection->connect_error);\r\n+}\r\n+\r\n+$query = \"\r\n+SELECT DISTINCT\r\n+    c.cari_id,\r\n+    c.cari_ad,\r\n+    c.cari_soyad,\r\n+    CASE \r\n+        WHEN c.cari_bireysel = 0 OR c.cari_soyad IS NULL OR c.cari_soyad = '' \r\n+        THEN c.cari_ad \r\n+        ELSE CONCAT(c.cari_ad, ' ', c.cari_soyad)\r\n+    END as cari_isletme,\r\n+    \r\n+    sf.satis_id as satis_sozlesme_id,\r\n+    sf.satis_vergiDahilToplam as satis_sozlesme_tutar,\r\n+    sf.satis_vergiDahilToplam as satis_sozlesme_tutar_kdv_dahil,\r\n+    NULL as satis_sozlesme_hizmeti,\r\n+    \r\n+    -- İşletme görsel sayısını hesapla (fotograf_dosya kolonundan)\r\n+    CASE \r\n+        WHEN c.fotograf_dosya IS NOT NULL AND c.fotograf_dosya != '' \r\n+        THEN (LENGTH(c.fotograf_dosya) - LENGTH(REPLACE(c.fotograf_dosya, ',', '')) + 1)\r\n+        ELSE 0\r\n+    END as isletme_gorsel_sayisi,\r\n+    \r\n+    -- Evrak sayısını hesapla  \r\n+    CASE \r\n+        WHEN c.evrak_dosya IS NOT NULL AND c.evrak_dosya != '' \r\n+        THEN (LENGTH(c.evrak_dosya) - LENGTH(REPLACE(c.evrak_dosya, ',', '')) + 1)\r\n+        ELSE 0\r\n+    END as evrak_sayisi,\r\n+    \r\n+    -- Satış görsel sayısını hesapla (satisfaturasi.satis_dosya kolonundan)\r\n+    CASE \r\n+        WHEN sf.satis_dosya IS NOT NULL AND sf.satis_dosya != '' \r\n+        THEN (LENGTH(sf.satis_dosya) - LENGTH(REPLACE(sf.satis_dosya, ',', '')) + 1)\r\n+        ELSE 0\r\n+    END as satis_gorsel_sayisi,\r\n+    \r\n+    -- Banka görsel sayısını hesapla\r\n+    COALESCE(banka_gorseller.banka_gorsel_sayisi, 0) as banka_gorsel_sayisi,\r\n+    \r\n+    -- Çek görsel sayısını hesapla\r\n+    COALESCE(cek_gorseller.cek_gorsel_sayisi, 0) as cek_gorsel_sayisi,\r\n+    \r\n+    -- Senet görsel sayısını hesapla\r\n+    COALESCE(senet_gorseller.senet_gorsel_sayisi, 0) as senet_gorsel_sayisi,\r\n+    \r\n+    -- Tahsilat tutarını carihareketleri tablosundan al (ch_alacak toplamı)\r\n+    COALESCE(ch_toplam.toplam_tahsilat, 0) as tahsilat_tutar,\r\n+    \r\n+    -- Aktivasyon durumu (aktivasyon_durum tablosundan - sadece aktif durumlar)\r\n+    COALESCE(ad.aktivasyon_durum_adi, 'Tanımlanmamış') as aktivasyon_durum,\r\n+    COALESCE(ad.aktivasyon_durum_renk, '#6c757d') as aktivasyon_durum_renk,\r\n+    \r\n+    a.aktivasyon_tarihi,\r\n+    a.aktivasyon_uye_no,\r\n+    a.aktivasyon_kutu_no,\r\n+    a.aktivasyon_kart_no,\r\n+    a.aktivasyon_aciklama,\r\n+    \r\n+    CONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) as personel\r\n+    \r\n+FROM cari c\r\n+\r\n+-- Carihareketleri tablosundan tahsilat toplamını al\r\n+LEFT JOIN (\r\n+    SELECT ch_cariID, SUM(ch_alacak) as toplam_tahsilat \r\n+    FROM carihareketleri \r\n+    WHERE ch_alacak IS NOT NULL AND ch_alacak > 0\r\n+    GROUP BY ch_cariID\r\n+) ch_toplam ON c.cari_id = ch_toplam.ch_cariID\r\n+\r\n+-- Banka görselleri sayısını al\r\n+LEFT JOIN (\r\n+    SELECT \r\n+        bh_cariID,\r\n+        COUNT(CASE WHEN bh_gorsel IS NOT NULL AND bh_gorsel != '' THEN 1 END) as banka_gorsel_sayisi\r\n+    FROM bankahareketleri \r\n+    WHERE bh_cariID IS NOT NULL\r\n+    GROUP BY bh_cariID\r\n+) banka_gorseller ON c.cari_id = banka_gorseller.bh_cariID\r\n+\r\n+-- Çek görselleri sayısını al\r\n+LEFT JOIN (\r\n+    SELECT \r\n+        cek_cariID,\r\n+        COUNT(CASE WHEN cek_gorsel IS NOT NULL AND cek_gorsel != '' THEN 1 END) as cek_gorsel_sayisi\r\n+    FROM cek \r\n+    WHERE cek_cariID IS NOT NULL\r\n+    GROUP BY cek_cariID\r\n+) cek_gorseller ON c.cari_id = cek_gorseller.cek_cariID\r\n+\r\n+-- Senet görselleri sayısını al\r\n+LEFT JOIN (\r\n+    SELECT \r\n+        senet_cariID,\r\n+        COUNT(CASE WHEN senet_gorsel IS NOT NULL AND senet_gorsel != '' THEN 1 END) as senet_gorsel_sayisi\r\n+    FROM senet \r\n+    WHERE senet_cariID IS NOT NULL\r\n+    GROUP BY senet_cariID\r\n+) senet_gorseller ON c.cari_id = senet_gorseller.senet_cariID\r\n+\r\n+LEFT JOIN satisfaturasi sf ON c.cari_id = sf.satis_cariID\r\n+LEFT JOIN aktivasyon a ON c.cari_id = a.aktivasyon_cari_id\r\n+LEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id AND ad.durum = 1\r\n+LEFT JOIN kullanicilar k ON c.cari_olusturan = k.kullanici_id\r\n+\r\n+WHERE c.cari_durum = 1\r\n+GROUP BY c.cari_id, sf.satis_id, a.aktivasyon_id, ad.aktivasyon_durum_id\r\n+ORDER BY c.cari_ad, c.cari_soyad\r\n+LIMIT 5\r\n+\";\r\n+\r\n+echo \"<h2>SQL Sorgu Test Sonucu:</h2>\";\r\n+\r\n+$result = $connection->query($query);\r\n+\r\n+if ($result) {\r\n+    echo \"<p>Sorgu başarılı. Kayıt sayısı: \" . $result->num_rows . \"</p>\";\r\n+    \r\n+    if ($result->num_rows > 0) {\r\n+        echo \"<table border='1' style='border-collapse: collapse;'>\";\r\n+        echo \"<tr>\";\r\n+        echo \"<th>Cari ID</th>\";\r\n+        echo \"<th>İşletme</th>\";\r\n+        echo \"<th>Aktivasyon Durum</th>\";\r\n+        echo \"<th>Aktivasyon Renk</th>\";\r\n+        echo \"<th>Aktivasyon Tarihi</th>\";\r\n+        echo \"<th>Üye No</th>\";\r\n+        echo \"<th>Kutu No</th>\";\r\n+        echo \"<th>Satış Tutarı</th>\";\r\n+        echo \"<th>Tahsilat Tutarı</th>\";\r\n+        echo \"</tr>\";\r\n+        \r\n+        while($row = $result->fetch_assoc()) {\r\n+            echo \"<tr>\";\r\n+            echo \"<td>\" . $row['cari_id'] . \"</td>\";\r\n+            echo \"<td>\" . $row['cari_isletme'] . \"</td>\";\r\n+            echo \"<td style='background-color:\" . $row['aktivasyon_durum_renk'] . \"; color: white;'>\" . $row['aktivasyon_durum'] . \"</td>\";\r\n+            echo \"<td>\" . $row['aktivasyon_durum_renk'] . \"</td>\";\r\n+            echo \"<td>\" . ($row['aktivasyon_tarihi'] ? date('d.m.Y H:i', strtotime($row['aktivasyon_tarihi'])) : 'NULL') . \"</td>\";\r\n+            echo \"<td>\" . ($row['aktivasyon_uye_no'] ?? '-') . \"</td>\";\r\n+            echo \"<td>\" . ($row['aktivasyon_kutu_no'] ?? '-') . \"</td>\";\r\n+            echo \"<td>\" . number_format($row['satis_sozlesme_tutar'], 2) . \" ₺</td>\";\r\n+            echo \"<td>\" . number_format($row['tahsilat_tutar'], 2) . \" ₺</td>\";\r\n+            echo \"</tr>\";\r\n+        }\r\n+        echo \"</table>\";\r\n+    }\r\n+} else {\r\n+    echo \"<p>SQL Hatası: \" . $connection->error . \"</p>\";\r\n+}\r\n+\r\n+$connection->close();\r\n+?>\r\n"
                }
            ],
            "date": 1755275157137,
            "name": "Commit-0",
            "content": "<?php\r\n// Debug: Tam Ana Rapor SQL sorgusunu test et\r\n\r\nrequire_once 'application/config/database.php';\r\n\r\n$connection = new mysqli($db['default']['hostname'], $db['default']['username'], $db['default']['password'], $db['default']['database']);\r\n\r\nif ($connection->connect_error) {\r\n    die(\"Connection failed: \" . $connection->connect_error);\r\n}\r\n\r\n$query = \"\r\nSELECT DISTINCT\r\n    c.cari_id,\r\n    c.cari_ad,\r\n    c.cari_soyad,\r\n    CASE \r\n        WHEN c.cari_bireysel = 0 OR c.cari_soyad IS NULL OR c.cari_soyad = '' \r\n        THEN c.cari_ad \r\n        ELSE CONCAT(c.cari_ad, ' ', c.cari_soyad)\r\n    END as cari_isletme,\r\n    \r\n    sf.satis_id as satis_sozlesme_id,\r\n    sf.satis_vergiDahilToplam as satis_sozlesme_tutar,\r\n    sf.satis_vergiDahilToplam as satis_sozlesme_tutar_kdv_dahil,\r\n    NULL as satis_sozlesme_hizmeti,\r\n    \r\n    -- İşletme görsel sayısını hesapla (fotograf_dosya kolonundan)\r\n    CASE \r\n        WHEN c.fotograf_dosya IS NOT NULL AND c.fotograf_dosya != '' \r\n        THEN (LENGTH(c.fotograf_dosya) - LENGTH(REPLACE(c.fotograf_dosya, ',', '')) + 1)\r\n        ELSE 0\r\n    END as isletme_gorsel_sayisi,\r\n    \r\n    -- Evrak sayısını hesapla  \r\n    CASE \r\n        WHEN c.evrak_dosya IS NOT NULL AND c.evrak_dosya != '' \r\n        THEN (LENGTH(c.evrak_dosya) - LENGTH(REPLACE(c.evrak_dosya, ',', '')) + 1)\r\n        ELSE 0\r\n    END as evrak_sayisi,\r\n    \r\n    -- Satış görsel sayısını hesapla (satisfaturasi.satis_dosya kolonundan)\r\n    CASE \r\n        WHEN sf.satis_dosya IS NOT NULL AND sf.satis_dosya != '' \r\n        THEN (LENGTH(sf.satis_dosya) - LENGTH(REPLACE(sf.satis_dosya, ',', '')) + 1)\r\n        ELSE 0\r\n    END as satis_gorsel_sayisi,\r\n    \r\n    -- Banka görsel sayısını hesapla\r\n    COALESCE(banka_gorseller.banka_gorsel_sayisi, 0) as banka_gorsel_sayisi,\r\n    \r\n    -- Çek görsel sayısını hesapla\r\n    COALESCE(cek_gorseller.cek_gorsel_sayisi, 0) as cek_gorsel_sayisi,\r\n    \r\n    -- Senet görsel sayısını hesapla\r\n    COALESCE(senet_gorseller.senet_gorsel_sayisi, 0) as senet_gorsel_sayisi,\r\n    \r\n    -- Tahsilat tutarını carihareketleri tablosundan al (ch_alacak toplamı)\r\n    COALESCE(ch_toplam.toplam_tahsilat, 0) as tahsilat_tutar,\r\n    \r\n    -- Aktivasyon durumu (aktivasyon_durum tablosundan)\r\n    COALESCE(ad.aktivasyon_durum_adi, 'Belirtilmemiş') as aktivasyon_durum,\r\n    COALESCE(ad.aktivasyon_durum_renk, '#999999') as aktivasyon_durum_renk,\r\n    \r\n    a.aktivasyon_tarihi,\r\n    \r\n    CONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) as personel\r\n    \r\nFROM cari c\r\n\r\n-- Carihareketleri tablosundan tahsilat toplamını al\r\nLEFT JOIN (\r\n    SELECT ch_cariID, SUM(ch_alacak) as toplam_tahsilat \r\n    FROM carihareketleri \r\n    WHERE ch_alacak IS NOT NULL AND ch_alacak > 0\r\n    GROUP BY ch_cariID\r\n) ch_toplam ON c.cari_id = ch_toplam.ch_cariID\r\n\r\n-- Banka görselleri sayısını al\r\nLEFT JOIN (\r\n    SELECT \r\n        bh_cariID,\r\n        COUNT(CASE WHEN bh_gorsel IS NOT NULL AND bh_gorsel != '' THEN 1 END) as banka_gorsel_sayisi\r\n    FROM bankahareketleri \r\n    WHERE bh_cariID IS NOT NULL\r\n    GROUP BY bh_cariID\r\n) banka_gorseller ON c.cari_id = banka_gorseller.bh_cariID\r\n\r\n-- Çek görselleri sayısını al\r\nLEFT JOIN (\r\n    SELECT \r\n        cek_cariID,\r\n        COUNT(CASE WHEN cek_gorsel IS NOT NULL AND cek_gorsel != '' THEN 1 END) as cek_gorsel_sayisi\r\n    FROM cek \r\n    WHERE cek_cariID IS NOT NULL\r\n    GROUP BY cek_cariID\r\n) cek_gorseller ON c.cari_id = cek_gorseller.cek_cariID\r\n\r\n-- Senet görselleri sayısını al\r\nLEFT JOIN (\r\n    SELECT \r\n        senet_cariID,\r\n        COUNT(CASE WHEN senet_gorsel IS NOT NULL AND senet_gorsel != '' THEN 1 END) as senet_gorsel_sayisi\r\n    FROM senet \r\n    WHERE senet_cariID IS NOT NULL\r\n    GROUP BY senet_cariID\r\n) senet_gorseller ON c.cari_id = senet_gorseller.senet_cariID\r\n\r\nLEFT JOIN satisfaturasi sf ON c.cari_id = sf.satis_cariID\r\nLEFT JOIN aktivasyon a ON c.cari_id = a.aktivasyon_cari_id\r\nLEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id\r\nLEFT JOIN kullanicilar k ON c.cari_olusturan = k.kullanici_id\r\n\r\nWHERE c.cari_durum = 1\r\nGROUP BY c.cari_id, sf.satis_id, a.aktivasyon_id, ad.aktivasyon_durum_id\r\nORDER BY c.cari_ad, c.cari_soyad\r\nLIMIT 5\r\n\";\r\n\r\necho \"<h2>SQL Sorgu Test Sonucu:</h2>\";\r\n\r\n$result = $connection->query($query);\r\n\r\nif ($result) {\r\n    echo \"<p>Sorgu başarılı. Kayıt sayısı: \" . $result->num_rows . \"</p>\";\r\n    \r\n    if ($result->num_rows > 0) {\r\n        echo \"<table border='1' style='border-collapse: collapse;'>\";\r\n        echo \"<tr>\";\r\n        echo \"<th>Cari ID</th>\";\r\n        echo \"<th>İşletme</th>\";\r\n        echo \"<th>Aktivasyon Durum</th>\";\r\n        echo \"<th>Aktivasyon Renk</th>\";\r\n        echo \"<th>Aktivasyon Tarihi</th>\";\r\n        echo \"<th>Satış Tutarı</th>\";\r\n        echo \"<th>Tahsilat Tutarı</th>\";\r\n        echo \"</tr>\";\r\n        \r\n        while($row = $result->fetch_assoc()) {\r\n            echo \"<tr>\";\r\n            echo \"<td>\" . $row['cari_id'] . \"</td>\";\r\n            echo \"<td>\" . $row['cari_isletme'] . \"</td>\";\r\n            echo \"<td style='background-color:\" . $row['aktivasyon_durum_renk'] . \"; color: white;'>\" . $row['aktivasyon_durum'] . \"</td>\";\r\n            echo \"<td>\" . $row['aktivasyon_durum_renk'] . \"</td>\";\r\n            echo \"<td>\" . $row['aktivasyon_tarihi'] . \"</td>\";\r\n            echo \"<td>\" . number_format($row['satis_sozlesme_tutar'], 2) . \" ₺</td>\";\r\n            echo \"<td>\" . number_format($row['tahsilat_tutar'], 2) . \" ₺</td>\";\r\n            echo \"</tr>\";\r\n        }\r\n        echo \"</table>\";\r\n    }\r\n} else {\r\n    echo \"<p>SQL Hatası: \" . $connection->error . \"</p>\";\r\n}\r\n\r\n$connection->close();\r\n?>\r\n"
        }
    ]
}