{
    "sourceFile": "digiturk_adet_test_query.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1755697881285,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1755697881285,
            "name": "Commit-0",
            "content": "-- Test query to verify DIGITURK quantity count\r\n-- This query should match the logic used in the updated controller\r\n\r\nSELECT \r\n  COALESCE(i.il, '(Bilinmiyor)') AS Il,\r\n  COUNT(CASE \r\n    WHEN st.stok_stokGrupKoduID = 1\r\n    THEN 1 \r\n    ELSE NULL \r\n  END) AS Digiturk_Adet,\r\n  COALESCE(SUM(CASE \r\n    WHEN st.stok_stokGrupKoduID = 1\r\n    THEN f.satis_genelToplam \r\n    ELSE 0 \r\n  END), 0) AS Digiturk_Ciro\r\nFROM satisFaturasiStok s\r\nJOIN stok st ON st.stok_id = s.satisStok_stokID\r\nJOIN satisFaturasi f ON f.satis_id = s.satisStok_satisFaturasiID\r\nLEFT JOIN cari c ON c.cari_id = f.satis_cariID\r\nLEFT JOIN iller i ON i.id = c.cari_il\r\nWHERE f.satis_olusturmaTarihi BETWEEN '2024-01-01' AND '2024-12-31'\r\nAND st.stok_stokGrupKoduID = 1  -- TURKIYE_TICARI\r\nGROUP BY COALESCE(i.id, 0), COALESCE(i.il, '(Bilinmiyor)')\r\nORDER BY Digiturk_Adet DESC;\r\n\r\n-- Original reference query provided by user:\r\n-- SELECT\r\n--   COALESCE(i.il, '(Bilinmiyor)') AS Il,\r\n--   COUNT(*) AS Adet\r\n-- FROM satisfaturasistok s\r\n-- JOIN stok st           ON st.stok_id = s.satisStok_stokID\r\n-- JOIN satisfaturasi f   ON f.satis_id = s.satisStok_satisFaturasiID\r\n-- LEFT JOIN cari c       ON c.cari_id = f.satis_cariID\r\n-- LEFT JOIN iller i      ON i.id = c.cari_il\r\n-- WHERE st.stok_stokGrupKoduID = 1  -- TURKIYE_TICARI\r\n-- GROUP BY COALESCE(i.id, 0), COALESCE(i.il, '(Bilinmiyor)')\r\n-- ORDER BY Adet DESC;\r\n"
        }
    ]
}