{
    "sourceFile": "debug_csv_mapping.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754746292704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754746292704,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * CSV ve Tablo Sütun Eşleştirme Analizi\r\n */\r\n\r\ntry {\r\n    // Database bağlantısı\r\n    $dsn = \"mysql:host=localhost;dbname=ilekasoft_crmdb;charset=utf8mb4\";\r\n    $pdo = new PDO($dsn, 'ilekasoft_crmuser', 'KaleW356!');\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n\r\n    echo \"<h2>CSV ve Veritabanı Sütun Eşleştirme Analizi</h2>\";\r\n\r\n    // Tablo yapısını al\r\n    $checkColumns = \"DESCRIBE voip_iris_rapor\";\r\n    $stmt = $pdo->query($checkColumns);\r\n    $dbColumns = $stmt->fetchAll();\r\n\r\n    echo \"<h3>Veritabanı Sütunları:</h3>\";\r\n    $db_fields = [];\r\n    foreach($dbColumns as $col) {\r\n        if($col['Field'] != 'id' && $col['Field'] != 'kayit_tarihi' && $col['Field'] != 'guncelleme_tarihi') {\r\n            $db_fields[] = $col['Field'];\r\n        }\r\n    }\r\n    echo \"<p>\" . implode(', ', $db_fields) . \"</p>\";\r\n\r\n    // CSV dosyasını oku\r\n    $csvFile = \"1OrnekData/Talep Raporu - Tüm Kayıtlar-09.08.2025 09_21.csv\";\r\n    \r\n    if (file_exists($csvFile)) {\r\n        $handle = fopen($csvFile, 'r');\r\n        if ($handle) {\r\n            $header = fgetcsv($handle, 0, ';');\r\n            fclose($handle);\r\n            \r\n            echo \"<h3>CSV Başlık Sütunları:</h3>\";\r\n            echo \"<p>\" . implode(', ', $header) . \"</p>\";\r\n            \r\n            echo \"<h3>Eşleştirme Tablosu:</h3>\";\r\n            echo \"<table border='1' style='border-collapse: collapse; margin: 10px 0; width: 100%;'>\";\r\n            echo \"<tr><th>Veritabanı Sütunu</th><th>CSV Sütunu</th><th>Durum</th></tr>\";\r\n            \r\n            // Controller'da kullanılan eşleştirmeler\r\n            $mapping = [\r\n                'talep_id' => 'TALEP_ID',\r\n                'talep_turu' => 'TALEP_TURU', \r\n                'uydu_basvuru_potansiyel_no' => 'UYDU_BASVURU_POTANSIYEL_NO',\r\n                'uydu_basvuru_uye_no' => 'UYDU_BASVURU_UYE_NO',\r\n                'dt_musteri_no' => 'DT_MUSTERI_NO',\r\n                'memo_id' => 'MEMO_ID',\r\n                'memo_kayit_tipi' => 'MEMO_KAYIT_TIPI',\r\n                'memo_id_tip' => 'MEMO_ID_TIP',\r\n                'memo_kodu' => 'MEMO_KODU',\r\n                'memo_kapanis_tarihi' => 'MEMO_KAPANIS_TARIHI',\r\n                'memo_yonlenen_bayi_kodu' => 'MEMO_YONLENEN_BAYI_KODU',\r\n                'memo_yonlenen_bayi_adi' => 'MEMO_YONLENEN_BAYI_ADI',\r\n                'satis_durumu' => 'SATIS_DURUMU',\r\n                'talep_giris_tarihi' => 'TALEP_GIRIS_TARIHI',\r\n                'randevu_tarihi' => 'RANDEVU_TARIHI',\r\n                'memo_son_durum' => 'MEMO_SON_DURUM'\r\n            ];\r\n            \r\n            foreach($mapping as $dbCol => $csvCol) {\r\n                $csvExists = in_array($csvCol, $header);\r\n                $dbExists = in_array($dbCol, $db_fields);\r\n                \r\n                echo \"<tr>\";\r\n                echo \"<td>$dbCol</td>\";\r\n                echo \"<td>$csvCol</td>\";\r\n                if($csvExists && $dbExists) {\r\n                    echo \"<td style='color: green;'>✓ Eşleşiyor</td>\";\r\n                } elseif(!$csvExists) {\r\n                    echo \"<td style='color: red;'>❌ CSV'de yok</td>\";\r\n                } elseif(!$dbExists) {\r\n                    echo \"<td style='color: red;'>❌ DB'de yok</td>\";\r\n                } else {\r\n                    echo \"<td style='color: orange;'>⚠ Diğer sorun</td>\";\r\n                }\r\n                echo \"</tr>\";\r\n            }\r\n            echo \"</table>\";\r\n            \r\n            echo \"<h3>CSV'de Olup Kullanılmayan Sütunlar:</h3>\";\r\n            $unused = [];\r\n            foreach($header as $csvCol) {\r\n                if(!in_array($csvCol, array_values($mapping))) {\r\n                    $unused[] = $csvCol;\r\n                }\r\n            }\r\n            echo \"<p><small>\" . implode(', ', $unused) . \"</small></p>\";\r\n            \r\n        } else {\r\n            echo \"<p style='color: red;'>CSV dosyası açılamadı</p>\";\r\n        }\r\n    } else {\r\n        echo \"<p style='color: red;'>CSV dosyası bulunamadı: $csvFile</p>\";\r\n    }\r\n\r\n} catch (PDOException $e) {\r\n    echo \"<p style='color: red;'>Veritabanı hatası: \" . $e->getMessage() . \"</p>\";\r\n}\r\n?>\r\n"
        }
    ]
}