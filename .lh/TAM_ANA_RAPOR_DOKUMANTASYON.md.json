{
    "sourceFile": "TAM_ANA_RAPOR_DOKUMANTASYON.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1755256998882,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1755256998882,
            "name": "Commit-0",
            "content": "# TAM ANA RAPOR DOKÜMANTASYONU\r\n\r\n## Genel Bilgiler\r\n- **Sayfa Adı:** Tam Ana Rapor\r\n- **Modül ID:** 531\r\n- **URL:** https://crm.ilekasoft.com/muhasebe/tam-ana-rapor\r\n- **Yetki ID:** 531\r\n- **Menü Konumu:** Muhasebe > Tam Ana Rapor (En alt)\r\n\r\n## ÖNEMLI GÜNCELLEME (15.08.2025): Veritabanı Uyumluluk Düzeltmesi\r\n\r\n### Sorun 1: Eksik Sütun (`cari_isletme`)\r\nOrijinal SQL sorgusu `c.cari_isletme` sütununu kullanmaya çalışıyordu ancak bu sütun mevcut veritabanında bulunmuyordu.\r\n\r\n**Hata Mesajı:**\r\n```\r\nError Number: 1054\r\nUnknown column 'c.cari_isletme' in 'field list'\r\n```\r\n\r\n### Sorun 2: Yanlış Sütun Adları\r\nSQL sorgusu yanlış sütun adlarını kullanıyordu:\r\n- `bh.bh_tutar` → Doğrusu: `bh.bh_giris`\r\n- `kh.kh_tutar` → Doğrusu: `kh.kh_giris`\r\n\r\n**Hata Mesajı:**\r\n```\r\nError Number: 1054\r\nUnknown column 'bh.bh_tutar' in 'field list'\r\n```\r\n\r\n### Sorun 3: Yanlış Tablo Adları\r\nSQL sorgusu camelCase tablo adları kullanıyordu, ancak gerçek tablo adları küçük harfli:\r\n- `bankaHareketleri` → Doğrusu: `bankahareketleri`\r\n- `kasaHareketleri` → Doğrusu: `kasahareketleri`\r\n\r\n### Çözüm\r\n1. **İşletme adı** için hesaplanmış alan oluşturuldu:\r\n```sql\r\nCASE \r\n    WHEN c.cari_bireysel = 0 OR c.cari_soyad IS NULL OR c.cari_soyad = '' \r\n    THEN c.cari_ad \r\n    ELSE CONCAT(c.cari_ad, ' ', c.cari_soyad)\r\nEND as cari_isletme\r\n```\r\n\r\n2. **Doğru sütun adları** kullanıldı:\r\n```sql\r\nWHEN mtd.tahsilat_tipi = 1 THEN bh.bh_giris    -- bh.bh_tutar yerine\r\nWHEN mtd.tahsilat_tipi = 3 THEN kh.kh_giris    -- kh.kh_tutar yerine\r\n```\r\n\r\n3. **Doğru tablo adları** kullanıldı:\r\n```sql\r\nLEFT JOIN bankahareketleri bh ON ...    -- bankaHareketleri yerine\r\nLEFT JOIN kasahareketleri kh ON ...     -- kasaHareketleri yerine\r\n```\r\n\r\n## Özellikler\r\n\r\n### Görüntülenen Kolonlar\r\n1. **Cari Ad** - Müşteri adı ve soyadı\r\n2. **İşletme** - Müşteri işletme adı\r\n3. **Evrak Görselleri** - Modal olarak görüntülenen evrak dosyaları\r\n4. **Satış Sözleşme Tutarı** - KDV hariç tutar\r\n5. **Satış Sözleşme Hizmeti** - Stok adı/hizmet adı\r\n6. **Satış Sözleşme Tutarı (KDV Dahil)** - KDV dahil tutar\r\n7. **Sözleşme Görselleri** - Modal olarak görüntülenen sözleşme dosyaları\r\n8. **Tahsilat Tutar** - Onaylanmış tahsilat tutarı\r\n9. **Tahsilat Görselleri** - Modal olarak görüntülenen tahsilat dosyaları\r\n10. **Tahsilat Durum** - Onaylandı, Onay Bekliyor, Reddedilen Var, vb.\r\n11. **Aktivasyon Tarihi** - Müşteri aktivasyon tarihi\r\n12. **Personel** - Müşteriyi oluşturan personel\r\n\r\n### Modal Özellikler\r\n- Görsel alanları tıklandığında modal açılır\r\n- Modalde görsel büyük boyutta gösterilir\r\n- İndirme seçeneği mevcut\r\n- En fazla 3 görsel thumbnail gösterilir, fazlası \"+\" işareti ile belirtilir\r\n\r\n### Filtreleme ve İstatistikler\r\n- DataTable ile gelişmiş filtreleme ve sıralama\r\n- Üst kısımda istatistik kartları:\r\n  - Toplam Kayıt Sayısı\r\n  - Onay Bekleyen Sayısı\r\n  - Onaylanan Sayısı\r\n  - Toplam Satış Tutarı\r\n- Ayrıca toplam satış ve tahsilat tutarları gösterilir\r\n\r\n### Excel Export\r\n- Sayfadaki veriler Excel formatında indirilebilir\r\n- URL: https://crm.ilekasoft.com/muhasebe/tam-ana-rapor-excel\r\n\r\n## Teknik Detaylar\r\n\r\n### Kullanılan Tablolar (Gerçekte Mevcut)\r\n- `cari` - Müşteri bilgileri ✅\r\n- `muhasebe_tahsilat_durum` - Tahsilat durumu ✅\r\n- `bankahareketleri` - Banka tahsilatları ✅ (sütun: `bh_giris`)\r\n- `cek` - Çek tahsilatları ✅ (sütun: `cek_tutar`)\r\n- `kasahareketleri` - Kasa tahsilatları ✅ (sütun: `kh_giris`)\r\n- `senet` - Senet tahsilatları ✅ (sütun: `senet_tutar`)\r\n- `aktivasyon` - Aktivasyon bilgileri ✅\r\n- `kullanicilar` - Personel bilgileri ✅\r\n\r\n### Eksik Tablolar (Gelecekte Eklenecek)\r\n- `cari_dosyalar` - Evrak görselleri ❌\r\n- `satis_sozlesme` - Satış sözleşme bilgileri ❌\r\n- `satis_sozlesme_dosyalar` - Sözleşme görselleri ❌\r\n- `tahsilat_dosyalar` - Tahsilat görselleri ❌\r\n- `stok` - Hizmet/ürün bilgileri ❌\r\n\r\n**Not:** Eksik tablolar için NULL değerler döndürülüyor, bu yüzden sayfa hatasız çalışıyor.\r\n\r\n### Dosya Yapısı\r\n```\r\napplication/\r\n├── controllers/\r\n│   └── Muhasebe.php (tam_ana_rapor metodu)\r\n├── views/\r\n│   └── muhasebe/\r\n│       └── tam-ana-rapor.php\r\n├── views/include/\r\n│   └── sidebar.php (menü eklendi)\r\n└── config/\r\n    └── routes.php (route eklendi)\r\n```\r\n\r\n### CSS Sınıfları\r\n- `.rapor-onay-bekliyor` - Onay bekleyen satırlar için sarı arka plan\r\n- `.rapor-onaylanan` - Onaylanan satırlar için yeşil arka plan\r\n- `.rapor-reddedilen` - Reddedilen satırlar için kırmızı arka plan\r\n- `.gorsel-thumb` - Görsel thumbnail'ları\r\n- `.tutar-buyuk` - Büyük tutar gösterimi\r\n\r\n### JavaScript Fonksiyonları\r\n- `showImageModal()` - Görsel modal açma\r\n- `exportToExcel()` - Excel export\r\n- DataTable konfigürasyonu ve Türkçe dil desteği\r\n\r\n## Yetki Sistemi\r\n- Modül ID: 531\r\n- Sidebar'da görüntülenmesi için 531 yetkisi gerekli\r\n- Sayfaya erişim için 531 yetkisi gerekli\r\n\r\n## Güncel Durum (15.08.2025)\r\n✅ **BAŞARILI** - Sayfa artık hatasız çalışıyor  \r\n✅ SQL hatası düzeltildi (`cari_isletme` sütunu sorunu)  \r\n✅ Tablo adları düzeltildi (`bankahareketleri`, `kasahareketleri`)  \r\n✅ Sütun adları düzeltildi (`bh_giris`, `kh_giris`)  \r\n✅ Mevcut verilerle uyumlu SQL sorgusu hazırlandı  \r\n✅ Menü entegrasyonu tamamlandı  \r\n✅ DataTable ve modal bileşenleri çalışıyor  \r\n\r\n**Test URL:** https://crm.ilekasoft.com/muhasebe/tam-ana-rapor  \r\n**Durum:** Production'da kullanıma hazır\r\n\r\n### Düzeltilen Hatalar\r\n1. **Unknown column 'c.cari_isletme'** → Hesaplanmış alan ile çözüldü\r\n2. **Unknown column 'bh.bh_tutar'** → `bh.bh_giris` kullanıldı\r\n3. **Tablo adları** → Küçük harf kullanıldı (`bankahareketleri`, `kasahareketleri`)\r\n\r\n### Gelecek Geliştirmeler\r\n1. Eksik tabloları veritabanına eklemek\r\n2. Görsel modallarını aktifleştirmek\r\n3. Satış sözleşme bilgilerini eklemek\r\n4. Excel export özelliğini test etmek\r\n- Yetki yoksa `/illegal` sayfasına yönlendirilir\r\n\r\n## Veritabanı Sorgusu\r\nKompleks LEFT JOIN sorgusu ile tüm ilişkili veriler tek seferde çekiliyor:\r\n- Cari bilgileri base alınıyor\r\n- Tüm ilişkili tablolar LEFT JOIN ile bağlanıyor\r\n- GROUP BY ile mükerrer kayıtlar birleştiriliyor\r\n- GROUP_CONCAT ile çoklu görseller birleştiriliyor\r\n\r\n## Güncellemeler\r\n- 15.08.2025: İlk versiyon oluşturuldu\r\n- 15.08.2025: Veritabanı hataları düzeltildi - eksik tablolar kaldırıldı\r\n  - Şu an sadece mevcut tablolar kullanılıyor\r\n  - `cari_dosyalar`, `satis_sozlesme`, `satis_sozlesme_dosyalar`, `tahsilat_dosyalar` tabloları henüz mevcut değil\r\n  - Görsel alanları şimdilik NULL döndürüyor\r\n  - Tahsilat listesi sayfasından esinlenilerek tasarlandı\r\n  - Responsive tasarım ve mobile uyumlu\r\n\r\n## Not\r\nEksik tablolar ileride eklendiğinde controller sorgusu güncellenerek:\r\n- Evrak görselleri\r\n- Satış sözleşme bilgileri\r\n- Sözleşme görselleri  \r\n- Tahsilat görselleri\r\n- Stok/hizmet bilgileri\r\nalanları aktif hale getirilebilir.\r\n"
        }
    ]
}