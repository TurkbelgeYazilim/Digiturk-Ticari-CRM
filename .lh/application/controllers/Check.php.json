{
    "sourceFile": "application/controllers/Check.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1755001255391,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755001277909,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -50,8 +50,9 @@\n \r\n \t\tif($query1){\r\n \r\n \t\t\t$kullaniciSorumluMudur = $query1->kullanici_sorumluMudur;\r\n+\t\t\t$kullaniciAnaHesapID = $query1->kullanici_anaHesapID;\r\n \r\n \r\n \r\n \t\t\t$status = $query1->kullanici_durum;\r\n@@ -104,9 +105,8 @@\n \r\n \t\t\t\t\t\t$faturaGirisSorgula = $this->db->query($faturaGirisSorgulaQ)->row();\r\n \r\n \t\t\t\t\t\t// $auth = auth($faturaGirisSorgula->ma_efaturaUsername, $faturaGirisSorgula->ma_efaturaSifre);\r\n-\t\t\t\t\t\t$auth = \"\"; // E-fatura kullanılmadığı için boş değer\r\n \r\n \t\t\t\t\t\t\r\n \r\n \t\t\t\t\t\tsession(\"w\", \"auth\", $auth);\r\n@@ -158,10 +158,9 @@\n \t\t\t\t\t\t$faturaGirisSorgula = $this->db->query($faturaGirisSorgulaQ)->row();\r\n \r\n \r\n \r\n-\t\t\t\t\t\t// $auth = authizi($faturaGirisSorgula->ma_eirsaliyeUsername, $faturaGirisSorgula->ma_eirsaliyeSifre);\r\n-\t\t\t\t\t\t$auth = \"\"; // E-irsaliye kullanılmadığı için boş değer\r\n+\t\t\t\t\t\t$auth = authizi($faturaGirisSorgula->ma_eirsaliyeUsername, $faturaGirisSorgula->ma_eirsaliyeSifre);\r\n \r\n \r\n \r\n \t\t\t\t\t\tsession(\"w\", \"auth\", $auth);\r\n"
                },
                {
                    "date": 1755001298351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -105,8 +105,9 @@\n \r\n \t\t\t\t\t\t$faturaGirisSorgula = $this->db->query($faturaGirisSorgulaQ)->row();\r\n \r\n \t\t\t\t\t\t// $auth = auth($faturaGirisSorgula->ma_efaturaUsername, $faturaGirisSorgula->ma_efaturaSifre);\r\n+\t\t\t\t\t\t$auth = \"\"; // E-fatura kullanılmadığı için boş değer\r\n \r\n \t\t\t\t\t\t\r\n \r\n \t\t\t\t\t\tsession(\"w\", \"auth\", $auth);\r\n@@ -158,9 +159,10 @@\n \t\t\t\t\t\t$faturaGirisSorgula = $this->db->query($faturaGirisSorgulaQ)->row();\r\n \r\n \r\n \r\n-\t\t\t\t\t\t$auth = authizi($faturaGirisSorgula->ma_eirsaliyeUsername, $faturaGirisSorgula->ma_eirsaliyeSifre);\r\n+\t\t\t\t\t\t// $auth = authizi($faturaGirisSorgula->ma_eirsaliyeUsername, $faturaGirisSorgula->ma_eirsaliyeSifre);\r\n+\t\t\t\t\t\t$auth = \"\"; // E-irsaliye kullanılmadığı için boş değer\r\n \r\n \r\n \r\n \t\t\t\t\t\tsession(\"w\", \"auth\", $auth);\r\n"
                }
            ],
            "date": 1755001255391,
            "name": "Commit-0",
            "content": "<?php\r\n\r\ndefined('BASEPATH') OR exit('No direct script access allowed');\r\n\r\n\r\n\r\nclass Check extends CI_Controller {\r\n\r\n\t\r\n\r\n\tpublic function __construct(){\r\n\r\n\t\tparent::__construct();\r\n\r\n\t\t$this->load->model('vt');\r\n\r\n\r\n\r\n\t\t$control = session(\"r\",\"login\");\r\n\r\n\r\n\r\n\t\tif($control){\r\n\r\n\t\t\tredirect(\"\");\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function index(){\r\n\r\n\t\t$this->load->view('giris');\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\tpublic function login(){\r\n\r\n\t\t$email = postval('u_email');\r\n\r\n\t\t$password = postval('u_password');\r\n\r\n\r\n\r\n\t\t$query1 = $this->vt->single(\"kullanicilar\",array('kullanici_eposta'=>$email,'kullanici_sifre'=>md5($password)));\r\n\r\n\t\tif($query1){\r\n\r\n\t\t\t$kullaniciSorumluMudur = $query1->kullanici_sorumluMudur;\r\n\r\n\r\n\r\n\t\t\t$status = $query1->kullanici_durum;\r\n\r\n\t\t\t$kullanici_demo = $query1->kullanici_demo;\r\n\r\n\r\n\r\n\t\t\tif($kullanici_demo == 1){\r\n\r\n\t\t\t\t$today = strtotime(date('Y-m-d H:i:s'));\r\n\r\n\t\t\t\t$demoSonTarih = strtotime($query1->kullanici_demoSonTarihi);\r\n\r\n\r\n\r\n\t\t\t\tif($today >= $demoSonTarih){//demo süresi bitti ödeme sayfasına yönlendir\r\n\r\n\t\t\t\t\t$this->session->set_flashdata('anaHesap',$kullaniciAnaHesapID);\r\n\r\n\t\t\t\t\tredirect('satin-al');\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\tif($status == 1){\r\n\r\n\t\t\t\t$kullaniciID = $query1->kullanici_id;\r\n\r\n\r\n\r\n\t\t\t\t$kullaniciSession = $query1->kullanici_belgeSessionID;\r\n\r\n\t\t\t\t$modulQ = \"SELECT * FROM firmaModulleri WHERE firmaModul_firmaID = '$kullaniciAnaHesapID'\";\r\n\r\n\t\t\t\t$modulExe = $this->db->query($modulQ)->result();\r\n\r\n\r\n\r\n\t\t\t\tforeach($modulExe as $modExe){\r\n\r\n\t\t\t\t\tif($modExe->firmaModul_moduleID==1){//true ise ana hesabın efatura modülü aktif durumdadır, bu yüzden servisten session id alip öyle giriş yapmalıyız.\r\n\r\n\t\t\t\t\t\techo \"1\";\r\n\r\n\t\t\t\t\t\t$faturaGirisSorgulaQ = \"SELECT * FROM modulAyarlari WHERE ma_olusturanAnaHesap = '$kullaniciAnaHesapID' AND ma_modulID = 1\";\r\n\r\n\t\t\t\t\t\t$faturaGirisSorgula = $this->db->query($faturaGirisSorgulaQ)->row();\r\n\r\n\t\t\t\t\t\t// $auth = auth($faturaGirisSorgula->ma_efaturaUsername, $faturaGirisSorgula->ma_efaturaSifre);\r\n\t\t\t\t\t\t$auth = \"\"; // E-fatura kullanılmadığı için boş değer\r\n\r\n\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\tsession(\"w\", \"auth\", $auth);\r\n\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t$ses = session(\"r\",\"auth\");\r\n\r\n\t\t\t\t\t\t$datak[\"kullanici_belgeSessionID\"] = $ses;\r\n\r\n\t\t\t\t\t\tif($ses != $kullaniciSession){\r\n\r\n\t\t\t\t\t\t\t$this->vt->update('kullanicilar', array('kullanici_id'=>$kullaniciID), $datak);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t}//efatura modulu\r\n\r\n\t\t\t\t\tif($modExe->firmaModul_moduleID==2){\r\n\r\n\t\t\t\t\t\techo \"2\";\r\n\r\n\t\t\t\t\t\t$faturaGirisSorgulaQ = \"SELECT * FROM modulAyarlari WHERE ma_olusturanAnaHesap = '$kullaniciAnaHesapID' AND ma_modulID = 2 and ma_gibUsername is not null and ma_gibSifre is not null\";\r\n\r\n\t\t\t\t\t\t$faturaGirisSorgula = $this->db->query($faturaGirisSorgulaQ)->row();\r\n\r\n\r\n\r\n\t\t\t\t\t\tif($faturaGirisSorgula)\r\n\r\n\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t$datak[\"kullanici_belgeSessionID\"] = 1;\r\n\r\n\t\t\t\t\t\t\t$this->vt->update('kullanicilar', array('kullanici_id'=>$kullaniciID), $datak);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}//gib modülü\r\n\r\n\t\t\t\t\tif($modExe->firmaModul_moduleID==5){\r\n\r\n\t\t\t\t\t\techo \"5\";\r\n\r\n\t\t\t\t\t\t$faturaGirisSorgulaQ = \"SELECT * FROM modulAyarlari WHERE ma_olusturanAnaHesap = '$kullaniciAnaHesapID' AND ma_modulID = 5\";\r\n\r\n\t\t\t\t\t\t$faturaGirisSorgula = $this->db->query($faturaGirisSorgulaQ)->row();\r\n\r\n\r\n\r\n\t\t\t\t\t\t// $auth = authizi($faturaGirisSorgula->ma_eirsaliyeUsername, $faturaGirisSorgula->ma_eirsaliyeSifre);\r\n\t\t\t\t\t\t$auth = \"\"; // E-irsaliye kullanılmadığı için boş değer\r\n\r\n\r\n\r\n\t\t\t\t\t\tsession(\"w\", \"auth\", $auth);\r\n\r\n\t\t\t\t\t\t$ses = session(\"r\",\"auth\");\r\n\r\n\t\t\t\t\t\t$datak[\"kullanici_belgeSessionIDizi\"] = $ses;\r\n\r\n\r\n\r\n\t\t\t\t\t\tif($ses != $kullaniciSession){\r\n\r\n\t\t\t\t\t\t\t$this->vt->update('kullanicilar', array('kullanici_id'=>$kullaniciID), $datak);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}//eirsaliye\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\tsession(\"w\",\"login\",true);\r\n\r\n\t\t\t\tsession(\"w\",\"login_info\",$query1);\r\n\r\n\t\t\t\tlogekle(54,5);\r\n\r\n\t\t\t\t$uniqID=uniqid();\r\n\r\n\t\t\t\t$_SESSION[\"kullanici_oturumDurum\"]=$uniqID;\r\n\r\n\t\t\t\t$dataOturum[\"kullanici_oturumDurum\"] = $uniqID;\r\n\r\n\t\t\t\t$this->vt->update('kullanicilar', array('kullanici_id'=>$kullaniciID), $dataOturum);\r\n\r\n\t\t\t\t\r\n\r\n\t\t\t\t\r\n\r\n\t\r\n\r\n\t\t\t\t\r\n\r\n\t\t\t\t\r\n\r\n\t\t\t\tredirect('');\r\n\r\n\t\t\t}else{\r\n\r\n\t\t\t\t$this->session->set_flashdata('login_fail_inactive','ok');\r\n\r\n\t\t\t\tredirect('check');\r\n\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\r\n\t\t\t$this->session->set_flashdata('login_fail','ok');\r\n\r\n\t\t\tredirect('check');\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function basarili(){\r\n\r\n\t\t$this->load->view('basarili');\r\n\r\n\t}\r\n\r\n}\r\n\r\n"
        }
    ]
}