{
    "sourceFile": "application/controllers/Raporlar.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 14,
            "patches": [
                {
                    "date": 1755008783240,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755008893910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1518,9 +1518,8 @@\n \t\t\t\t\tc.cari_ad,\r\n \t\t\t\t\ti.il_adi AS il_adi,\r\n \t\t\t\t\tilc.ilce_adi AS ilce_adi,\r\n \t\t\t\t\tc.cari_firmaTelefon,\r\n-\t\t\t\t\tCOUNT(sf.satis_id) AS satis_adedi,\r\n \t\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_tutar\r\n \t\t\t\tFROM satisFaturasi sf\r\n \t\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n \t\t\t\tLEFT JOIN iller i ON c.cari_il = i.il_id\r\n"
                },
                {
                    "date": 1755009112298,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1515,19 +1515,20 @@\n \t\ttry {\r\n \t\t\t// Şehirdeki satış yapan müşterilerin detaylarını getir\r\n \t\t\t$sql = \"SELECT \r\n \t\t\t\t\tc.cari_ad,\r\n-\t\t\t\t\ti.il_adi AS il_adi,\r\n-\t\t\t\t\tilc.ilce_adi AS ilce_adi,\r\n+\t\t\t\t\ti.il AS il_adi,\r\n+\t\t\t\t\tilc.ilce AS ilce_adi,\r\n \t\t\t\t\tc.cari_firmaTelefon,\r\n+\t\t\t\t\tCOUNT(sf.satis_id) AS satis_adedi,\r\n \t\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_tutar\r\n \t\t\t\tFROM satisFaturasi sf\r\n \t\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n-\t\t\t\tLEFT JOIN iller i ON c.cari_il = i.il_id\r\n-\t\t\t\tLEFT JOIN ilceler ilc ON c.cari_ilce = ilc.ilce_id\r\n+\t\t\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n+\t\t\t\tLEFT JOIN ilceler ilc ON c.cari_ilce = ilc.id\r\n \t\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n \t\t\t\tAND c.cari_il = ?\r\n-\t\t\t\tGROUP BY c.cari_id, c.cari_ad, i.il_adi, ilc.ilce_adi, c.cari_firmaTelefon\r\n+\t\t\t\tGROUP BY c.cari_id, c.cari_ad, i.il, ilc.ilce, c.cari_firmaTelefon\r\n \t\t\t\tORDER BY toplam_tutar DESC\";\r\n \r\n \t\t\t$result = $this->db->query($sql, array($baslangic_tarihi, $bitis_tarihi, $sehir_id));\r\n \t\t\t\r\n@@ -1540,8 +1541,11 @@\n \r\n \t\t\techo json_encode(['success' => true, 'data' => $data, 'count' => count($data)]);\r\n \t\t\t\r\n \t\t} catch (Exception $e) {\r\n+\t\t\techo json_encode(['success' => true, 'data' => $data, 'count' => count($data)]);\r\n+\t\t\t\r\n+\t\t} catch (Exception $e) {\r\n \t\t\techo json_encode(['error' => 'Exception: ' . $e->getMessage()]);\r\n \t\t}\r\n \t}\r\n \r\n"
                },
                {
                    "date": 1755009223192,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1518,17 +1518,18 @@\n \t\t\t\t\tc.cari_ad,\r\n \t\t\t\t\ti.il AS il_adi,\r\n \t\t\t\t\tilc.ilce AS ilce_adi,\r\n \t\t\t\t\tc.cari_firmaTelefon,\r\n-\t\t\t\t\tCOUNT(sf.satis_id) AS satis_adedi,\r\n+\t\t\t\t\tCONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) AS personel_adsoyad,\r\n \t\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_tutar\r\n \t\t\t\tFROM satisFaturasi sf\r\n \t\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n \t\t\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n \t\t\t\tLEFT JOIN ilceler ilc ON c.cari_ilce = ilc.id\r\n+\t\t\t\tLEFT JOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\r\n \t\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n \t\t\t\tAND c.cari_il = ?\r\n-\t\t\t\tGROUP BY c.cari_id, c.cari_ad, i.il, ilc.ilce, c.cari_firmaTelefon\r\n+\t\t\t\tGROUP BY c.cari_id, c.cari_ad, i.il, ilc.ilce, c.cari_firmaTelefon, k.kullanici_id, k.kullanici_ad, k.kullanici_soyad\r\n \t\t\t\tORDER BY toplam_tutar DESC\";\r\n \r\n \t\t\t$result = $this->db->query($sql, array($baslangic_tarihi, $bitis_tarihi, $sehir_id));\r\n \t\t\t\r\n"
                },
                {
                    "date": 1755189770627,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1433,9 +1433,9 @@\n \t\t$data['sehir_listesi'] = $this->db->query($sehir_query)->result();\r\n \r\n \t\t\r\n \r\n-\t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Aktivasyon olmadan)\r\n+\t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Digiturk ve S Sport ayrı ayrı)\r\n \r\n \t\t$sql = \"SELECT \r\n \r\n \t\t\t\ti.il AS sehir_adi,\r\n@@ -1443,10 +1443,38 @@\n \t\t\t\tCOUNT(sf.satis_id) AS toplam_satis_adedi,\r\n \r\n \t\t\t\tSUM(sf.satis_genelToplam) AS toplam_ciro,\r\n \r\n-\t\t\t\tc.cari_il\r\n+\t\t\t\tc.cari_il,\r\n \r\n+\t\t\t\t-- Digiturk satış adedi (S Sport içermeyen)\r\n+\r\n+\t\t\t\tSUM(CASE \r\n+\r\n+\t\t\t\t\tWHEN (c.cari_ad NOT LIKE '%S SPORT%' \r\n+\r\n+\t\t\t\t\t\t  AND c.cari_ad NOT LIKE '%SSPORT%')\r\n+\r\n+\t\t\t\t\tTHEN 1 \r\n+\r\n+\t\t\t\t\tELSE 0 \r\n+\r\n+\t\t\t\tEND) AS digiturk_satis_adedi,\r\n+\r\n+\t\t\t\t-- S Sport satış adedi\r\n+\r\n+\t\t\t\tSUM(CASE \r\n+\r\n+\t\t\t\t\tWHEN (c.cari_ad LIKE '%S SPORT%' \r\n+\r\n+\t\t\t\t\t\t  OR c.cari_ad LIKE '%SSPORT%')\r\n+\r\n+\t\t\t\t\tTHEN 1 \r\n+\r\n+\t\t\t\t\tELSE 0 \r\n+\r\n+\t\t\t\tEND) AS ssport_satis_adedi\r\n+\r\n \t\t\tFROM satisFaturasi sf\r\n \r\n \t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n \r\n"
                },
                {
                    "date": 1755619458019,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1439,48 +1439,68 @@\n \t\t$sql = \"SELECT \r\n \r\n \t\t\t\ti.il AS sehir_adi,\r\n \r\n-\t\t\t\tCOUNT(sf.satis_id) AS toplam_satis_adedi,\r\n+\t\t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n \r\n-\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_ciro,\r\n+\t\t\t\tCOUNT(DISTINCT CASE \r\n \r\n-\t\t\t\tc.cari_il,\r\n+\t\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n \r\n-\t\t\t\t-- Digiturk satış adedi (S Sport içermeyen)\r\n+\t\t\t\t\tTHEN sf.satis_id \r\n \r\n+\t\t\t\t\tELSE NULL \r\n+\r\n+\t\t\t\tEND) AS toplam_satis_adedi,\r\n+\r\n+\t\t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n+\r\n \t\t\t\tSUM(CASE \r\n \r\n-\t\t\t\t\tWHEN (c.cari_ad NOT LIKE '%S SPORT%' \r\n+\t\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n \r\n-\t\t\t\t\t\t  AND c.cari_ad NOT LIKE '%SSPORT%')\r\n+\t\t\t\t\tTHEN sf.satis_genelToplam \r\n \r\n-\t\t\t\t\tTHEN 1 \r\n-\r\n \t\t\t\t\tELSE 0 \r\n \r\n+\t\t\t\tEND) AS toplam_ciro,\r\n+\r\n+\t\t\t\tc.cari_il,\r\n+\r\n+\t\t\t\t-- Digiturk satış adedi (stok_stokGrupKoduID = 1)\r\n+\r\n+\t\t\t\tCOUNT(DISTINCT CASE \r\n+\r\n+\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 1\r\n+\r\n+\t\t\t\t\tTHEN sf.satis_id \r\n+\r\n+\t\t\t\t\tELSE NULL \r\n+\r\n \t\t\t\tEND) AS digiturk_satis_adedi,\r\n \r\n-\t\t\t\t-- S Sport satış adedi\r\n+\t\t\t\t-- S Sport satış adedi (stok_stokGrupKoduID = 279)\r\n \r\n-\t\t\t\tSUM(CASE \r\n+\t\t\t\tCOUNT(DISTINCT CASE \r\n \r\n-\t\t\t\t\tWHEN (c.cari_ad LIKE '%S SPORT%' \r\n+\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 279\r\n \r\n-\t\t\t\t\t\t  OR c.cari_ad LIKE '%SSPORT%')\r\n+\t\t\t\t\tTHEN sf.satis_id \r\n \r\n-\t\t\t\t\tTHEN 1 \r\n+\t\t\t\t\tELSE NULL \r\n \r\n-\t\t\t\t\tELSE 0 \r\n-\r\n \t\t\t\tEND) AS ssport_satis_adedi\r\n \r\n \t\t\tFROM satisFaturasi sf\r\n \r\n \t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n \r\n \t\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n \r\n+\t\t\tLEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n+\r\n+\t\t\tLEFT JOIN stok s ON sfs.satisStok_stokID = s.stok_id\r\n+\r\n \t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n \r\n \t\t\tAND c.cari_il IS NOT NULL AND c.cari_il != 0\";\r\n \r\n"
                },
                {
                    "date": 1755677006582,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1437,70 +1437,124 @@\n \t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Digiturk ve S Sport ayrı ayrı)\r\n \r\n \t\t$sql = \"SELECT \r\n \r\n-\t\t\t\ti.il AS sehir_adi,\r\n+\t\t\ti.il AS sehir_adi,\r\n \r\n-\t\t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n+\t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n \r\n-\t\t\t\tCOUNT(DISTINCT CASE \r\n+\t\t\tCOUNT(DISTINCT CASE \r\n \r\n-\t\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n+\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n \r\n-\t\t\t\t\tTHEN sf.satis_id \r\n+\t\t\t\tTHEN sf.satis_id \r\n \r\n-\t\t\t\t\tELSE NULL \r\n+\t\t\t\tELSE NULL \r\n \r\n-\t\t\t\tEND) AS toplam_satis_adedi,\r\n+\t\t\tEND) AS toplam_satis_adedi,\r\n \r\n-\t\t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n+\t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n \r\n-\t\t\t\tSUM(CASE \r\n+\t\t\tSUM(CASE \r\n \r\n-\t\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n+\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n \r\n-\t\t\t\t\tTHEN sf.satis_genelToplam \r\n+\t\t\t\tTHEN sf.satis_genelToplam \r\n \r\n-\t\t\t\t\tELSE 0 \r\n+\t\t\t\tELSE 0 \r\n \r\n-\t\t\t\tEND) AS toplam_ciro,\r\n+\t\t\tEND) AS toplam_ciro,\r\n \r\n-\t\t\t\tc.cari_il,\r\n+\t\t\tc.cari_il,\r\n \r\n-\t\t\t\t-- Digiturk satış adedi (stok_stokGrupKoduID = 1)\r\n+\t\t\t-- Digiturk satış adedi (stok_stokGrupKoduID = 1)\r\n \r\n-\t\t\t\tCOUNT(DISTINCT CASE \r\n+\t\t\tCOUNT(DISTINCT CASE \r\n \r\n-\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 1\r\n+\t\t\t\tWHEN s.stok_stokGrupKoduID = 1\r\n \r\n-\t\t\t\t\tTHEN sf.satis_id \r\n+\t\t\t\tTHEN sf.satis_id \r\n \r\n-\t\t\t\t\tELSE NULL \r\n+\t\t\t\tELSE NULL \r\n \r\n-\t\t\t\tEND) AS digiturk_satis_adedi,\r\n+\t\t\tEND) AS digiturk_satis_adedi,\r\n \r\n-\t\t\t\t-- S Sport satış adedi (stok_stokGrupKoduID = 279)\r\n+\t\t\t-- Digiturk ciro (stok_stokGrupKoduID = 1)\r\n \r\n-\t\t\t\tCOUNT(DISTINCT CASE \r\n+\t\t\tSUM(CASE \r\n \r\n-\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 279\r\n+\t\t\t\tWHEN s.stok_stokGrupKoduID = 1\r\n \r\n-\t\t\t\t\tTHEN sf.satis_id \r\n+\t\t\t\tTHEN sf.satis_genelToplam \r\n \r\n-\t\t\t\t\tELSE NULL \r\n+\t\t\t\tELSE 0 \r\n \r\n-\t\t\t\tEND) AS ssport_satis_adedi\r\n+\t\t\tEND) AS digiturk_ciro,\r\n \r\n-\t\t\tFROM satisFaturasi sf\r\n+\t\t\t-- S Sport satış adedi (stok_stokGrupKoduID = 279)\r\n \r\n-\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n+\t\t\tCOUNT(DISTINCT CASE \r\n \r\n-\t\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n+\t\t\t\tWHEN s.stok_stokGrupKoduID = 279\r\n \r\n-\t\t\tLEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n+\t\t\t\tTHEN sf.satis_id \r\n \r\n-\t\t\tLEFT JOIN stok s ON sfs.satisStok_stokID = s.stok_id\r\n+\t\t\t\tELSE NULL \r\n \r\n+\t\t\tEND) AS ssport_satis_adedi,\r\n+\r\n+\t\t\t-- S Sport ciro (stok_stokGrupKoduID = 279)\r\n+\r\n+\t\t\tSUM(CASE \r\n+\r\n+\t\t\t\tWHEN s.stok_stokGrupKoduID = 279\r\n+\r\n+\t\t\t\tTHEN sf.satis_genelToplam \r\n+\r\n+\t\t\t\tELSE 0 \r\n+\r\n+\t\t\tEND) AS ssport_ciro,\r\n+\r\n+\t\t\t-- Ortak satış adedi (hem Digiturk hem S Sport olan müşteriler)\r\n+\r\n+\t\t\tCOUNT(DISTINCT CASE \r\n+\r\n+\t\t\t\tWHEN EXISTS (\r\n+\r\n+\t\t\t\t\tSELECT 1 FROM satisFaturasiStok sfs2 \r\n+\r\n+\t\t\t\t\tJOIN stok s2 ON sfs2.satisStok_stokID = s2.stok_id \r\n+\r\n+\t\t\t\t\tWHERE sfs2.satisStok_satisFaturasiID = sf.satis_id \r\n+\r\n+\t\t\t\t\tAND s2.stok_stokGrupKoduID = 1\r\n+\r\n+\t\t\t\t) AND EXISTS (\r\n+\r\n+\t\t\t\t\tSELECT 1 FROM satisFaturasiStok sfs3 \r\n+\r\n+\t\t\t\t\tJOIN stok s3 ON sfs3.satisStok_stokID = s3.stok_id \r\n+\r\n+\t\t\t\t\tWHERE sfs3.satisStok_satisFaturasiID = sf.satis_id \r\n+\r\n+\t\t\t\t\tAND s3.stok_stokGrupKoduID = 279\r\n+\r\n+\t\t\t\t)\r\n+\r\n+\t\t\t\tTHEN sf.satis_id \r\n+\r\n+\t\t\t\tELSE NULL \r\n+\r\n+\t\t\tEND) AS ortak_satis_adedi\r\n+\r\n+\t\tFROM satisFaturasi sf\r\n+\r\n+\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n+\r\n+\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n+\r\n+\t\tLEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisFaturasiID\t\t\tLEFT JOIN stok s ON sfs.satisStok_stokID = s.stok_id\r\n+\r\n \t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n \r\n \t\t\tAND c.cari_il IS NOT NULL AND c.cari_il != 0\";\r\n \r\n"
                },
                {
                    "date": 1755695954208,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1607,32 +1607,64 @@\n \r\n \t\t$sehir_id = $this->input->post('sehir_id');\r\n \t\t$baslangic_tarihi = $this->input->post('baslangic_tarihi');\r\n \t\t$bitis_tarihi = $this->input->post('bitis_tarihi');\r\n+\t\t$product_type = $this->input->post('product_type'); // Yeni parametre\r\n \r\n \t\tif (!$sehir_id || !$baslangic_tarihi || !$bitis_tarihi) {\r\n \t\t\techo json_encode(['error' => 'Eksik parametre - sehir_id: ' . $sehir_id . ', baslangic: ' . $baslangic_tarihi . ', bitis: ' . $bitis_tarihi]);\r\n \t\t\treturn;\r\n \t\t}\r\n \r\n \t\ttry {\r\n-\t\t\t// Şehirdeki satış yapan müşterilerin detaylarını getir\r\n+\t\t\t// Base SQL query\r\n \t\t\t$sql = \"SELECT \r\n \t\t\t\t\tc.cari_ad,\r\n \t\t\t\t\ti.il AS il_adi,\r\n \t\t\t\t\tilc.ilce AS ilce_adi,\r\n \t\t\t\t\tc.cari_firmaTelefon,\r\n \t\t\t\t\tCONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) AS personel_adsoyad,\r\n-\t\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_tutar\r\n-\t\t\t\tFROM satisFaturasi sf\r\n+\t\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_tutar\";\r\n+\t\t\t\r\n+\t\t\t// Product type parametresi varsa ekstra bilgi ekle\r\n+\t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n+\t\t\t\t$sql .= \",\r\n+\t\t\t\t\t\tCASE \r\n+\t\t\t\t\t\t\tWHEN s.stok_ad LIKE '%DIGITURK%' THEN 'Digiturk'\r\n+\t\t\t\t\t\t\tWHEN s.stok_ad LIKE '%S SPORT%' THEN 'S Sport'\r\n+\t\t\t\t\t\t\tELSE 'Diğer'\r\n+\t\t\t\t\t\tEND as urun_tipi\";\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t$sql .= \" FROM satisFaturasi sf\r\n \t\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n \t\t\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n \t\t\t\tLEFT JOIN ilceler ilc ON c.cari_ilce = ilc.id\r\n-\t\t\t\tLEFT JOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\r\n-\t\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n-\t\t\t\tAND c.cari_il = ?\r\n-\t\t\t\tGROUP BY c.cari_id, c.cari_ad, i.il, ilc.ilce, c.cari_firmaTelefon, k.kullanici_id, k.kullanici_ad, k.kullanici_soyad\r\n-\t\t\t\tORDER BY toplam_tutar DESC\";\r\n+\t\t\t\tLEFT JOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\";\r\n+\t\t\t\r\n+\t\t\t// Product type filtrelemesi için stok tablosunu da join et\r\n+\t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n+\t\t\t\t$sql .= \" LEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisID\r\n+\t\t\t\t\t\t  LEFT JOIN stok s ON sfs.satisStok_stokID = s.stok_id\";\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t$sql .= \" WHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n+\t\t\t\tAND c.cari_il = ?\";\r\n+\t\t\t\r\n+\t\t\t// Product type filtrelemesi ekle\r\n+\t\t\tif ($product_type == 'digiturk') {\r\n+\t\t\t\t$sql .= \" AND s.stok_ad LIKE '%DIGITURK%'\";\r\n+\t\t\t} elseif ($product_type == 'ssport') {\r\n+\t\t\t\t$sql .= \" AND s.stok_ad LIKE '%S SPORT%'\";\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t$sql .= \" GROUP BY c.cari_id, c.cari_ad, i.il, ilc.ilce, c.cari_firmaTelefon, k.kullanici_id, k.kullanici_ad, k.kullanici_soyad\";\r\n+\t\t\t\r\n+\t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n+\t\t\t\t$sql .= \", urun_tipi\";\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t$sql .= \" ORDER BY toplam_tutar DESC\";\r\n \r\n \t\t\t$result = $this->db->query($sql, array($baslangic_tarihi, $bitis_tarihi, $sehir_id));\r\n \t\t\t\r\n \t\t\tif (!$result) {\r\n@@ -1641,14 +1673,11 @@\n \t\t\t}\r\n \t\t\t\r\n \t\t\t$data = $result->result();\r\n \r\n-\t\t\techo json_encode(['success' => true, 'data' => $data, 'count' => count($data)]);\r\n+\t\t\techo json_encode(['success' => true, 'data' => $data, 'count' => count($data), 'product_type' => $product_type]);\r\n \t\t\t\r\n \t\t} catch (Exception $e) {\r\n-\t\t\techo json_encode(['success' => true, 'data' => $data, 'count' => count($data)]);\r\n-\t\t\t\r\n-\t\t} catch (Exception $e) {\r\n \t\t\techo json_encode(['error' => 'Exception: ' . $e->getMessage()]);\r\n \t\t}\r\n \t}\r\n \r\n"
                },
                {
                    "date": 1755697881298,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1433,152 +1433,73 @@\n \t\t$data['sehir_listesi'] = $this->db->query($sehir_query)->result();\r\n \r\n \t\t\r\n \r\n-\t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Digiturk ve S Sport ayrı ayrı)\r\n+\t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Digiturk ve S Sport ayrı ayrı) - DÜZELTME\r\n \r\n \t\t$sql = \"SELECT \r\n-\r\n-\t\t\ti.il AS sehir_adi,\r\n-\r\n-\t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n-\r\n-\t\t\tCOUNT(DISTINCT CASE \r\n-\r\n-\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n-\r\n-\t\t\t\tTHEN sf.satis_id \r\n-\r\n-\t\t\t\tELSE NULL \r\n-\r\n-\t\t\tEND) AS toplam_satis_adedi,\r\n-\r\n-\t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n-\r\n-\t\t\tSUM(CASE \r\n-\r\n-\t\t\t\tWHEN s.stok_stokGrupKoduID IN (1, 279)\r\n-\r\n-\t\t\t\tTHEN sf.satis_genelToplam \r\n-\r\n-\t\t\t\tELSE 0 \r\n-\r\n-\t\t\tEND) AS toplam_ciro,\r\n-\r\n+\t\t\tCOALESCE(i.il, '(Bilinmiyor)') AS sehir_adi,\r\n \t\t\tc.cari_il,\r\n-\r\n-\t\t\t-- Digiturk satış adedi (stok_stokGrupKoduID = 1)\r\n-\r\n-\t\t\tCOUNT(DISTINCT CASE \r\n-\r\n-\t\t\t\tWHEN s.stok_stokGrupKoduID = 1\r\n-\r\n-\t\t\t\tTHEN sf.satis_id \r\n-\r\n+\t\t\t-- Digiturk satış adedi (stok_stokGrupKoduID = 1) - DÜZELTME: COUNT(*) kullan\r\n+\t\t\tCOUNT(CASE \r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID = 1\r\n+\t\t\t\tTHEN 1 \r\n \t\t\t\tELSE NULL \r\n-\r\n \t\t\tEND) AS digiturk_satis_adedi,\r\n-\r\n \t\t\t-- Digiturk ciro (stok_stokGrupKoduID = 1)\r\n-\r\n-\t\t\tSUM(CASE \r\n-\r\n-\t\t\t\tWHEN s.stok_stokGrupKoduID = 1\r\n-\r\n-\t\t\t\tTHEN sf.satis_genelToplam \r\n-\r\n+\t\t\tCOALESCE(SUM(CASE \r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID = 1\r\n+\t\t\t\tTHEN f.satis_genelToplam \r\n \t\t\t\tELSE 0 \r\n-\r\n-\t\t\tEND) AS digiturk_ciro,\r\n-\r\n+\t\t\tEND), 0) AS digiturk_ciro,\r\n \t\t\t-- S Sport satış adedi (stok_stokGrupKoduID = 279)\r\n-\r\n-\t\t\tCOUNT(DISTINCT CASE \r\n-\r\n-\t\t\t\tWHEN s.stok_stokGrupKoduID = 279\r\n-\r\n-\t\t\t\tTHEN sf.satis_id \r\n-\r\n+\t\t\tCOUNT(CASE \r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID = 279\r\n+\t\t\t\tTHEN 1 \r\n \t\t\t\tELSE NULL \r\n-\r\n \t\t\tEND) AS ssport_satis_adedi,\r\n-\r\n \t\t\t-- S Sport ciro (stok_stokGrupKoduID = 279)\r\n-\r\n-\t\t\tSUM(CASE \r\n-\r\n-\t\t\t\tWHEN s.stok_stokGrupKoduID = 279\r\n-\r\n-\t\t\t\tTHEN sf.satis_genelToplam \r\n-\r\n+\t\t\tCOALESCE(SUM(CASE \r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID = 279\r\n+\t\t\t\tTHEN f.satis_genelToplam \r\n \t\t\t\tELSE 0 \r\n-\r\n-\t\t\tEND) AS ssport_ciro,\r\n-\r\n-\t\t\t-- Ortak satış adedi (hem Digiturk hem S Sport olan müşteriler)\r\n-\r\n-\t\t\tCOUNT(DISTINCT CASE \r\n-\r\n-\t\t\t\tWHEN EXISTS (\r\n-\r\n-\t\t\t\t\tSELECT 1 FROM satisFaturasiStok sfs2 \r\n-\r\n-\t\t\t\t\tJOIN stok s2 ON sfs2.satisStok_stokID = s2.stok_id \r\n-\r\n-\t\t\t\t\tWHERE sfs2.satisStok_satisFaturasiID = sf.satis_id \r\n-\r\n-\t\t\t\t\tAND s2.stok_stokGrupKoduID = 1\r\n-\r\n-\t\t\t\t) AND EXISTS (\r\n-\r\n-\t\t\t\t\tSELECT 1 FROM satisFaturasiStok sfs3 \r\n-\r\n-\t\t\t\t\tJOIN stok s3 ON sfs3.satisStok_stokID = s3.stok_id \r\n-\r\n-\t\t\t\t\tWHERE sfs3.satisStok_satisFaturasiID = sf.satis_id \r\n-\r\n-\t\t\t\t\tAND s3.stok_stokGrupKoduID = 279\r\n-\r\n-\t\t\t\t)\r\n-\r\n-\t\t\t\tTHEN sf.satis_id \r\n-\r\n+\t\t\tEND), 0) AS ssport_ciro,\r\n+\t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n+\t\t\tCOUNT(CASE \r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID IN (1, 279)\r\n+\t\t\t\tTHEN 1 \r\n \t\t\t\tELSE NULL \r\n+\t\t\tEND) AS toplam_satis_adedi,\r\n+\t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n+\t\t\tCOALESCE(SUM(CASE \r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID IN (1, 279)\r\n+\t\t\t\tTHEN f.satis_genelToplam \r\n+\t\t\t\tELSE 0 \r\n+\t\t\tEND), 0) AS toplam_ciro,\r\n+\t\t\t-- Ortak satış adedi - hesaplanacak\r\n+\t\t\t0 AS ortak_satis_adedi\r\n+\t\tFROM satisFaturasiStok s\r\n+\t\tJOIN stok st ON st.stok_id = s.satisStok_stokID\r\n+\t\tJOIN satisFaturasi f ON f.satis_id = s.satisStok_satisFaturasiID\r\n+\t\tLEFT JOIN cari c ON c.cari_id = f.satis_cariID\r\n+\t\tLEFT JOIN iller i ON i.id = c.cari_il\r\n+\t\tWHERE f.satis_olusturmaTarihi BETWEEN ? AND ?\r\n+\t\tAND st.stok_stokGrupKoduID IN (1, 279)\";\r\n \r\n-\t\t\tEND) AS ortak_satis_adedi\r\n-\r\n-\t\tFROM satisFaturasi sf\r\n-\r\n-\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n-\r\n-\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n-\r\n-\t\tLEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisFaturasiID\t\t\tLEFT JOIN stok s ON sfs.satisStok_stokID = s.stok_id\r\n-\r\n-\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n-\r\n-\t\t\tAND c.cari_il IS NOT NULL AND c.cari_il != 0\";\r\n-\r\n \t\t\r\n \r\n \t\t$params = array($baslangic_tarihi, $bitis_tarihi);\r\n \r\n \t\t\r\n \r\n \t\tif (!empty($sehir_id)) {\r\n-\r\n \t\t\t$sql .= \" AND c.cari_il = ?\";\r\n-\r\n \t\t\t$params[] = $sehir_id;\r\n-\r\n \t\t}\r\n \r\n-\t\t\r\n+\t\t$sql .= \" GROUP BY COALESCE(i.id, 0), COALESCE(i.il, '(Bilinmiyor)')\r\n+\t\t\t\t  ORDER BY digiturk_satis_adedi DESC\";\r\n \r\n-\t\t$sql .= \" GROUP BY i.il, c.cari_il\r\n-\r\n-\t\t\t\t  ORDER BY toplam_ciro DESC\";\r\n-\r\n \t\t\r\n \r\n \t\t$rapor_verileri = $this->db->query($sql, $params)->result();\r\n \r\n"
                },
                {
                    "date": 1755698530496,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1530,10 +1530,10 @@\n \t\t$baslangic_tarihi = $this->input->post('baslangic_tarihi');\r\n \t\t$bitis_tarihi = $this->input->post('bitis_tarihi');\r\n \t\t$product_type = $this->input->post('product_type'); // Yeni parametre\r\n \r\n-\t\tif (!$sehir_id || !$baslangic_tarihi || !$bitis_tarihi) {\r\n-\t\t\techo json_encode(['error' => 'Eksik parametre - sehir_id: ' . $sehir_id . ', baslangic: ' . $baslangic_tarihi . ', bitis: ' . $bitis_tarihi]);\r\n+\t\tif (!$baslangic_tarihi || !$bitis_tarihi) {\r\n+\t\t\techo json_encode(['error' => 'Eksik parametre - baslangic: ' . $baslangic_tarihi . ', bitis: ' . $bitis_tarihi]);\r\n \t\t\treturn;\r\n \t\t}\r\n \r\n \t\ttry {\r\n@@ -1549,10 +1549,10 @@\n \t\t\t// Product type parametresi varsa ekstra bilgi ekle\r\n \t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n \t\t\t\t$sql .= \",\r\n \t\t\t\t\t\tCASE \r\n-\t\t\t\t\t\t\tWHEN s.stok_ad LIKE '%DIGITURK%' THEN 'Digiturk'\r\n-\t\t\t\t\t\t\tWHEN s.stok_ad LIKE '%S SPORT%' THEN 'S Sport'\r\n+\t\t\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 1 THEN 'Digiturk'\r\n+\t\t\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 279 THEN 'S Sport'\r\n \t\t\t\t\t\t\tELSE 'Diğer'\r\n \t\t\t\t\t\tEND as urun_tipi\";\r\n \t\t\t}\r\n \t\t\t\r\n@@ -1563,20 +1563,27 @@\n \t\t\t\tLEFT JOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\";\r\n \t\t\t\r\n \t\t\t// Product type filtrelemesi için stok tablosunu da join et\r\n \t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n-\t\t\t\t$sql .= \" LEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisID\r\n+\t\t\t\t$sql .= \" LEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n \t\t\t\t\t\t  LEFT JOIN stok s ON sfs.satisStok_stokID = s.stok_id\";\r\n \t\t\t}\r\n \t\t\t\r\n-\t\t\t$sql .= \" WHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n-\t\t\t\tAND c.cari_il = ?\";\r\n+\t\t\t$sql .= \" WHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\";\r\n \t\t\t\r\n+\t\t\t$params = array($baslangic_tarihi, $bitis_tarihi);\r\n+\t\t\t\r\n+\t\t\t// Şehir filtresi varsa ekle\r\n+\t\t\tif (!empty($sehir_id)) {\r\n+\t\t\t\t$sql .= \" AND c.cari_il = ?\";\r\n+\t\t\t\t$params[] = $sehir_id;\r\n+\t\t\t}\r\n+\t\t\t\r\n \t\t\t// Product type filtrelemesi ekle\r\n \t\t\tif ($product_type == 'digiturk') {\r\n-\t\t\t\t$sql .= \" AND s.stok_ad LIKE '%DIGITURK%'\";\r\n+\t\t\t\t$sql .= \" AND s.stok_stokGrupKoduID = 1\";\r\n \t\t\t} elseif ($product_type == 'ssport') {\r\n-\t\t\t\t$sql .= \" AND s.stok_ad LIKE '%S SPORT%'\";\r\n+\t\t\t\t$sql .= \" AND s.stok_stokGrupKoduID = 279\";\r\n \t\t\t}\r\n \t\t\t\r\n \t\t\t$sql .= \" GROUP BY c.cari_id, c.cari_ad, i.il, ilc.ilce, c.cari_firmaTelefon, k.kullanici_id, k.kullanici_ad, k.kullanici_soyad\";\r\n \t\t\t\r\n@@ -1585,9 +1592,9 @@\n \t\t\t}\r\n \t\t\t\r\n \t\t\t$sql .= \" ORDER BY toplam_tutar DESC\";\r\n \r\n-\t\t\t$result = $this->db->query($sql, array($baslangic_tarihi, $bitis_tarihi, $sehir_id));\r\n+\t\t\t$result = $this->db->query($sql, $params);\r\n \t\t\t\r\n \t\t\tif (!$result) {\r\n \t\t\t\techo json_encode(['error' => 'Veritabanı hatası: ' . $this->db->error()['message']]);\r\n \t\t\t\treturn;\r\n"
                },
                {
                    "date": 1756390660399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1536,63 +1536,53 @@\n \t\t\treturn;\r\n \t\t}\r\n \r\n \t\ttry {\r\n-\t\t\t// Base SQL query\r\n+\t\t\t// Eskişehir örneğine göre düzeltilmiş SQL query\r\n \t\t\t$sql = \"SELECT \r\n \t\t\t\t\tc.cari_ad,\r\n+\t\t\t\t\tCASE \r\n+\t\t\t\t\t\tWHEN LENGTH(c.cari_firmaTelefon) >= 10 THEN\r\n+\t\t\t\t\t\t\tCONCAT(\r\n+\t\t\t\t\t\t\t\tSUBSTRING(c.cari_firmaTelefon, 1, 3), ' ',\r\n+\t\t\t\t\t\t\t\tSUBSTRING(c.cari_firmaTelefon, 4, 3), ' ',\r\n+\t\t\t\t\t\t\t\tSUBSTRING(c.cari_firmaTelefon, 7, 2), ' ',\r\n+\t\t\t\t\t\t\t\tSUBSTRING(c.cari_firmaTelefon, 9, 2)\r\n+\t\t\t\t\t\t\t)\r\n+\t\t\t\t\t\tELSE c.cari_firmaTelefon\r\n+\t\t\t\t\tEND AS cari_firmaTelefon,\r\n \t\t\t\t\ti.il AS il_adi,\r\n-\t\t\t\t\tilc.ilce AS ilce_adi,\r\n-\t\t\t\t\tc.cari_firmaTelefon,\r\n+\t\t\t\t\tic.ilce AS ilce_adi,\r\n+\t\t\t\t\tst.stok_ad AS urun_tipi,\r\n \t\t\t\t\tCONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) AS personel_adsoyad,\r\n-\t\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_tutar\";\r\n+\t\t\t\t\tsfs.satisStok_birimFiyat AS toplam_tutar\r\n+\t\t\t\tFROM satisfaturasistok sfs\r\n+\t\t\t\tJOIN satisfaturasi sf ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n+\t\t\t\tJOIN stok st ON st.stok_id = sfs.satisStok_stokID\r\n+\t\t\t\tJOIN cari c ON c.cari_id = sf.satis_cariID\r\n+\t\t\t\tJOIN iller i ON i.id = c.cari_il\r\n+\t\t\t\tJOIN ilceler ic ON ic.id = c.cari_ilce\r\n+\t\t\t\tLEFT JOIN kullanicilar k ON k.kullanici_id = c.cari_olusturan\r\n+\t\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\";\r\n \t\t\t\r\n-\t\t\t// Product type parametresi varsa ekstra bilgi ekle\r\n-\t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n-\t\t\t\t$sql .= \",\r\n-\t\t\t\t\t\tCASE \r\n-\t\t\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 1 THEN 'Digiturk'\r\n-\t\t\t\t\t\t\tWHEN s.stok_stokGrupKoduID = 279 THEN 'S Sport'\r\n-\t\t\t\t\t\t\tELSE 'Diğer'\r\n-\t\t\t\t\t\tEND as urun_tipi\";\r\n-\t\t\t}\r\n-\t\t\t\r\n-\t\t\t$sql .= \" FROM satisFaturasi sf\r\n-\t\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n-\t\t\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n-\t\t\t\tLEFT JOIN ilceler ilc ON c.cari_ilce = ilc.id\r\n-\t\t\t\tLEFT JOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\";\r\n-\t\t\t\r\n-\t\t\t// Product type filtrelemesi için stok tablosunu da join et\r\n-\t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n-\t\t\t\t$sql .= \" LEFT JOIN satisFaturasiStok sfs ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n-\t\t\t\t\t\t  LEFT JOIN stok s ON sfs.satisStok_stokID = s.stok_id\";\r\n-\t\t\t}\r\n-\t\t\t\r\n-\t\t\t$sql .= \" WHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\";\r\n-\t\t\t\r\n \t\t\t$params = array($baslangic_tarihi, $bitis_tarihi);\r\n \t\t\t\r\n \t\t\t// Şehir filtresi varsa ekle\r\n \t\t\tif (!empty($sehir_id)) {\r\n-\t\t\t\t$sql .= \" AND c.cari_il = ?\";\r\n+\t\t\t\t$sql .= \" AND i.id = ?\";\r\n \t\t\t\t$params[] = $sehir_id;\r\n \t\t\t}\r\n \t\t\t\r\n \t\t\t// Product type filtrelemesi ekle\r\n \t\t\tif ($product_type == 'digiturk') {\r\n-\t\t\t\t$sql .= \" AND s.stok_stokGrupKoduID = 1\";\r\n+\t\t\t\t$sql .= \" AND st.stok_stokGrupKoduID = 1\";\r\n \t\t\t} elseif ($product_type == 'ssport') {\r\n-\t\t\t\t$sql .= \" AND s.stok_stokGrupKoduID = 279\";\r\n+\t\t\t\t$sql .= \" AND st.stok_stokGrupKoduID = 279\";\r\n+\t\t\t} elseif ($product_type == 'all') {\r\n+\t\t\t\t$sql .= \" AND st.stok_stokGrupKoduID IN (1, 279)\";\r\n \t\t\t}\r\n \t\t\t\r\n-\t\t\t$sql .= \" GROUP BY c.cari_id, c.cari_ad, i.il, ilc.ilce, c.cari_firmaTelefon, k.kullanici_id, k.kullanici_ad, k.kullanici_soyad\";\r\n-\t\t\t\r\n-\t\t\tif ($product_type && ($product_type == 'digiturk' || $product_type == 'ssport')) {\r\n-\t\t\t\t$sql .= \", urun_tipi\";\r\n-\t\t\t}\r\n-\t\t\t\r\n-\t\t\t$sql .= \" ORDER BY toplam_tutar DESC\";\r\n+\t\t\t$sql .= \" ORDER BY sfs.satisStok_birimFiyat DESC\";\r\n \r\n \t\t\t$result = $this->db->query($sql, $params);\r\n \t\t\t\r\n \t\t\tif (!$result) {\r\n"
                },
                {
                    "date": 1756393012886,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1437,9 +1437,9 @@\n \t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Digiturk ve S Sport ayrı ayrı) - DÜZELTME\r\n \r\n \t\t$sql = \"SELECT \r\n \t\t\tCOALESCE(i.il, '(Bilinmiyor)') AS sehir_adi,\r\n-\t\t\tc.cari_il,\r\n+\t\t\ti.id AS cari_il,\r\n \t\t\t-- Digiturk satış adedi (stok_stokGrupKoduID = 1) - DÜZELTME: COUNT(*) kullan\r\n \t\t\tCOUNT(CASE \r\n \t\t\t\tWHEN st.stok_stokGrupKoduID = 1\r\n \t\t\t\tTHEN 1 \r\n@@ -1447,9 +1447,9 @@\n \t\t\tEND) AS digiturk_satis_adedi,\r\n \t\t\t-- Digiturk ciro (stok_stokGrupKoduID = 1)\r\n \t\t\tCOALESCE(SUM(CASE \r\n \t\t\t\tWHEN st.stok_stokGrupKoduID = 1\r\n-\t\t\t\tTHEN f.satis_genelToplam \r\n+\t\t\t\tTHEN sfs.satisStok_birimFiyat \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS digiturk_ciro,\r\n \t\t\t-- S Sport satış adedi (stok_stokGrupKoduID = 279)\r\n \t\t\tCOUNT(CASE \r\n@@ -1459,9 +1459,9 @@\n \t\t\tEND) AS ssport_satis_adedi,\r\n \t\t\t-- S Sport ciro (stok_stokGrupKoduID = 279)\r\n \t\t\tCOALESCE(SUM(CASE \r\n \t\t\t\tWHEN st.stok_stokGrupKoduID = 279\r\n-\t\t\t\tTHEN f.satis_genelToplam \r\n+\t\t\t\tTHEN sfs.satisStok_birimFiyat \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS ssport_ciro,\r\n \t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n \t\t\tCOUNT(CASE \r\n@@ -1471,19 +1471,19 @@\n \t\t\tEND) AS toplam_satis_adedi,\r\n \t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n \t\t\tCOALESCE(SUM(CASE \r\n \t\t\t\tWHEN st.stok_stokGrupKoduID IN (1, 279)\r\n-\t\t\t\tTHEN f.satis_genelToplam \r\n+\t\t\t\tTHEN sfs.satisStok_birimFiyat \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS toplam_ciro,\r\n \t\t\t-- Ortak satış adedi - hesaplanacak\r\n \t\t\t0 AS ortak_satis_adedi\r\n-\t\tFROM satisFaturasiStok s\r\n-\t\tJOIN stok st ON st.stok_id = s.satisStok_stokID\r\n-\t\tJOIN satisFaturasi f ON f.satis_id = s.satisStok_satisFaturasiID\r\n-\t\tLEFT JOIN cari c ON c.cari_id = f.satis_cariID\r\n+\t\tFROM satisfaturasistok sfs\r\n+\t\tJOIN stok st ON st.stok_id = sfs.satisStok_stokID\r\n+\t\tJOIN satisfaturasi sf ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n+\t\tJOIN cari c ON c.cari_id = sf.satis_cariID\r\n \t\tLEFT JOIN iller i ON i.id = c.cari_il\r\n-\t\tWHERE f.satis_olusturmaTarihi BETWEEN ? AND ?\r\n+\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n \t\tAND st.stok_stokGrupKoduID IN (1, 279)\";\r\n \r\n \t\t\r\n \r\n@@ -1491,14 +1491,14 @@\n \r\n \t\t\r\n \r\n \t\tif (!empty($sehir_id)) {\r\n-\t\t\t$sql .= \" AND c.cari_il = ?\";\r\n+\t\t\t$sql .= \" AND i.id = ?\";\r\n \t\t\t$params[] = $sehir_id;\r\n \t\t}\r\n \r\n \t\t$sql .= \" GROUP BY COALESCE(i.id, 0), COALESCE(i.il, '(Bilinmiyor)')\r\n-\t\t\t\t  ORDER BY digiturk_satis_adedi DESC\";\r\n+\t\t\t\t  ORDER BY toplam_ciro DESC, sehir_adi\";\r\n \r\n \t\t\r\n \r\n \t\t$rapor_verileri = $this->db->query($sql, $params)->result();\r\n"
                },
                {
                    "date": 1756561535614,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1447,9 +1447,9 @@\n \t\t\tEND) AS digiturk_satis_adedi,\r\n \t\t\t-- Digiturk ciro (stok_stokGrupKoduID = 1)\r\n \t\t\tCOALESCE(SUM(CASE \r\n \t\t\t\tWHEN st.stok_stokGrupKoduID = 1\r\n-\t\t\t\tTHEN sfs.satisStok_birimFiyat \r\n+\t\t\t\tTHEN sfs.satisStok_fiyatMiktar \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS digiturk_ciro,\r\n \t\t\t-- S Sport satış adedi (stok_stokGrupKoduID = 279)\r\n \t\t\tCOUNT(CASE \r\n@@ -1459,9 +1459,9 @@\n \t\t\tEND) AS ssport_satis_adedi,\r\n \t\t\t-- S Sport ciro (stok_stokGrupKoduID = 279)\r\n \t\t\tCOALESCE(SUM(CASE \r\n \t\t\t\tWHEN st.stok_stokGrupKoduID = 279\r\n-\t\t\t\tTHEN sfs.satisStok_birimFiyat \r\n+\t\t\t\tTHEN sfs.satisStok_fiyatMiktar \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS ssport_ciro,\r\n \t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n \t\t\tCOUNT(CASE \r\n@@ -1471,9 +1471,9 @@\n \t\t\tEND) AS toplam_satis_adedi,\r\n \t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n \t\t\tCOALESCE(SUM(CASE \r\n \t\t\t\tWHEN st.stok_stokGrupKoduID IN (1, 279)\r\n-\t\t\t\tTHEN sfs.satisStok_birimFiyat \r\n+\t\t\t\tTHEN sfs.satisStok_fiyatMiktar \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS toplam_ciro,\r\n \t\t\t-- Ortak satış adedi - hesaplanacak\r\n \t\t\t0 AS ortak_satis_adedi\r\n@@ -1553,9 +1553,9 @@\n \t\t\t\t\ti.il AS il_adi,\r\n \t\t\t\t\tic.ilce AS ilce_adi,\r\n \t\t\t\t\tst.stok_ad AS urun_tipi,\r\n \t\t\t\t\tCONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) AS personel_adsoyad,\r\n-\t\t\t\t\tsfs.satisStok_birimFiyat AS toplam_tutar\r\n+\t\t\t\t\tsfs.satisStok_fiyatMiktar AS toplam_tutar\r\n \t\t\t\tFROM satisfaturasistok sfs\r\n \t\t\t\tJOIN satisfaturasi sf ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n \t\t\t\tJOIN stok st ON st.stok_id = sfs.satisStok_stokID\r\n \t\t\t\tJOIN cari c ON c.cari_id = sf.satis_cariID\r\n@@ -1580,9 +1580,9 @@\n \t\t\t} elseif ($product_type == 'all') {\r\n \t\t\t\t$sql .= \" AND st.stok_stokGrupKoduID IN (1, 279)\";\r\n \t\t\t}\r\n \t\t\t\r\n-\t\t\t$sql .= \" ORDER BY sfs.satisStok_birimFiyat DESC\";\r\n+\t\t\t$sql .= \" ORDER BY sfs.satisStok_fiyatMiktar DESC\";\r\n \r\n \t\t\t$result = $this->db->query($sql, $params);\r\n \t\t\t\r\n \t\t\tif (!$result) {\r\n"
                },
                {
                    "date": 1757432844839,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1433,9 +1433,9 @@\n \t\t$data['sehir_listesi'] = $this->db->query($sehir_query)->result();\r\n \r\n \t\t\r\n \r\n-\t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Digiturk ve S Sport ayrı ayrı) - DÜZELTME\r\n+\t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Digiturk, S Sport ve TABII ayrı ayrı) - DÜZELTME\r\n \r\n \t\t$sql = \"SELECT \r\n \t\t\tCOALESCE(i.il, '(Bilinmiyor)') AS sehir_adi,\r\n \t\t\ti.id AS cari_il,\r\n@@ -1450,29 +1450,41 @@\n \t\t\t\tWHEN st.stok_stokGrupKoduID = 1\r\n \t\t\t\tTHEN sfs.satisStok_fiyatMiktar \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS digiturk_ciro,\r\n-\t\t\t-- S Sport satış adedi (stok_stokGrupKoduID = 279)\r\n+\t\t\t-- S Sport satış adedi (stok_id = 16)\r\n \t\t\tCOUNT(CASE \r\n-\t\t\t\tWHEN st.stok_stokGrupKoduID = 279\r\n+\t\t\t\tWHEN st.stok_id = 16\r\n \t\t\t\tTHEN 1 \r\n \t\t\t\tELSE NULL \r\n \t\t\tEND) AS ssport_satis_adedi,\r\n-\t\t\t-- S Sport ciro (stok_stokGrupKoduID = 279)\r\n+\t\t\t-- S Sport ciro (stok_id = 16)\r\n \t\t\tCOALESCE(SUM(CASE \r\n-\t\t\t\tWHEN st.stok_stokGrupKoduID = 279\r\n+\t\t\t\tWHEN st.stok_id = 16\r\n \t\t\t\tTHEN sfs.satisStok_fiyatMiktar \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS ssport_ciro,\r\n-\t\t\t-- Toplam satış adedi (Digiturk + S Sport)\r\n+\t\t\t-- TABII satış adedi (stok_id = 13)\r\n \t\t\tCOUNT(CASE \r\n-\t\t\t\tWHEN st.stok_stokGrupKoduID IN (1, 279)\r\n+\t\t\t\tWHEN st.stok_id = 13\r\n \t\t\t\tTHEN 1 \r\n \t\t\t\tELSE NULL \r\n+\t\t\tEND) AS tabii_satis_adedi,\r\n+\t\t\t-- TABII ciro (stok_id = 13)\r\n+\t\t\tCOALESCE(SUM(CASE \r\n+\t\t\t\tWHEN st.stok_id = 13\r\n+\t\t\t\tTHEN sfs.satisStok_fiyatMiktar \r\n+\t\t\t\tELSE 0 \r\n+\t\t\tEND), 0) AS tabii_ciro,\r\n+\t\t\t-- Toplam satış adedi (Digiturk + S Sport + TABII)\r\n+\t\t\tCOUNT(CASE \r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID = 1 OR st.stok_id IN (16, 13)\r\n+\t\t\t\tTHEN 1 \r\n+\t\t\t\tELSE NULL \r\n \t\t\tEND) AS toplam_satis_adedi,\r\n-\t\t\t-- Toplam ciro (Digiturk + S Sport)\r\n+\t\t\t-- Toplam ciro (Digiturk + S Sport + TABII)\r\n \t\t\tCOALESCE(SUM(CASE \r\n-\t\t\t\tWHEN st.stok_stokGrupKoduID IN (1, 279)\r\n+\t\t\t\tWHEN st.stok_stokGrupKoduID = 1 OR st.stok_id IN (16, 13)\r\n \t\t\t\tTHEN sfs.satisStok_fiyatMiktar \r\n \t\t\t\tELSE 0 \r\n \t\t\tEND), 0) AS toplam_ciro,\r\n \t\t\t-- Ortak satış adedi - hesaplanacak\r\n@@ -1482,9 +1494,9 @@\n \t\tJOIN satisfaturasi sf ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n \t\tJOIN cari c ON c.cari_id = sf.satis_cariID\r\n \t\tLEFT JOIN iller i ON i.id = c.cari_il\r\n \t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n-\t\tAND st.stok_stokGrupKoduID IN (1, 279)\";\r\n+\t\tAND (st.stok_stokGrupKoduID = 1 OR st.stok_id IN (16, 13))\";\r\n \r\n \t\t\r\n \r\n \t\t$params = array($baslangic_tarihi, $bitis_tarihi);\r\n@@ -1575,11 +1587,13 @@\n \t\t\t// Product type filtrelemesi ekle\r\n \t\t\tif ($product_type == 'digiturk') {\r\n \t\t\t\t$sql .= \" AND st.stok_stokGrupKoduID = 1\";\r\n \t\t\t} elseif ($product_type == 'ssport') {\r\n-\t\t\t\t$sql .= \" AND st.stok_stokGrupKoduID = 279\";\r\n+\t\t\t\t$sql .= \" AND st.stok_id = 16\";\r\n+\t\t\t} elseif ($product_type == 'tabii') {\r\n+\t\t\t\t$sql .= \" AND st.stok_id = 13\";\r\n \t\t\t} elseif ($product_type == 'all') {\r\n-\t\t\t\t$sql .= \" AND st.stok_stokGrupKoduID IN (1, 279)\";\r\n+\t\t\t\t$sql .= \" AND (st.stok_stokGrupKoduID = 1 OR st.stok_id IN (16, 13))\";\r\n \t\t\t}\r\n \t\t\t\r\n \t\t\t$sql .= \" ORDER BY sfs.satisStok_fiyatMiktar DESC\";\r\n \r\n"
                },
                {
                    "date": 1758030807277,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1565,9 +1565,10 @@\n \t\t\t\t\ti.il AS il_adi,\r\n \t\t\t\t\tic.ilce AS ilce_adi,\r\n \t\t\t\t\tst.stok_ad AS urun_tipi,\r\n \t\t\t\t\tCONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) AS personel_adsoyad,\r\n-\t\t\t\t\tsfs.satisStok_fiyatMiktar AS toplam_tutar\r\n+\t\t\t\t\tsfs.satisStok_fiyatMiktar AS toplam_tutar,\r\n+\t\t\t\t\tsf.satis_faturaTarihi AS fatura_tarihi\r\n \t\t\t\tFROM satisfaturasistok sfs\r\n \t\t\t\tJOIN satisfaturasi sf ON sf.satis_id = sfs.satisStok_satisFaturasiID\r\n \t\t\t\tJOIN stok st ON st.stok_id = sfs.satisStok_stokID\r\n \t\t\t\tJOIN cari c ON c.cari_id = sf.satis_cariID\r\n@@ -1594,9 +1595,9 @@\n \t\t\t} elseif ($product_type == 'all') {\r\n \t\t\t\t$sql .= \" AND (st.stok_stokGrupKoduID = 1 OR st.stok_id IN (16, 13))\";\r\n \t\t\t}\r\n \t\t\t\r\n-\t\t\t$sql .= \" ORDER BY sfs.satisStok_fiyatMiktar DESC\";\r\n+\t\t\t$sql .= \" ORDER BY sf.satis_faturaTarihi DESC, sfs.satisStok_fiyatMiktar DESC\";\r\n \r\n \t\t\t$result = $this->db->query($sql, $params);\r\n \t\t\t\r\n \t\t\tif (!$result) {\r\n"
                }
            ],
            "date": 1755008783240,
            "name": "Commit-0",
            "content": "<?php\r\n\r\ndefined('BASEPATH') OR exit('No direct script access allowed');\r\n\r\n\r\n\r\nclass Raporlar extends CI_Controller {\r\n\r\n\r\n\r\n  public function __construct(){\r\n\r\n\t\tparent::__construct();\r\n\r\n\t\terror_reporting(E_ALL ^ (E_NOTICE | E_WARNING));\r\n\r\n\t\t$this->load->model('vt');\r\n\r\n\t\t\r\n\r\n\t\t$control = session(\"r\", \"login\");\r\n\r\n\r\n\r\n\r\n\r\n\t  if(gibYetki()==1)\r\n\r\n\t\t  redirect(\"home/hata\");\r\n\r\n\r\n\r\n\t  if(!$control){\r\n\r\n\t\t\tredirect(\"check\");\r\n\r\n\t\t}\r\n\r\n\t  //sessionKontrolHelper();\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function index(){\r\n\r\n\t\t$data[\"baslik\"] = \"Raporlar\";\r\n\r\n\t\t$this->load->view(\"raporlar/raporlar\",$data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function raporlar(){\r\n\r\n\t\t$data[\"baslik\"] = \"Raporlar\";\r\n\r\n\t\t$this->load->view(\"raporlar/raporlar\",$data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function stokRaporlari(){\r\n\r\n\t\t$data[\"baslik\"] = \"Raporlar / Stok Raporları\";\r\n\r\n\t\t$anaHesap = anaHesapBilgisi();\r\n\r\n\r\n\r\n\t\t$stokKodu = $this->input->get('stokKodu');\r\n\r\n\t\t$stokAdi = $this->input->get('stokAdi');\r\n\r\n\t\t$stokGrubu = $this->input->get('stokGrubu');\r\n\r\n\r\n\r\n\t\t$tarihGet = $this->input->get('tarihAraligi');\r\n\r\n\r\n\r\n\t\t$tarihAraligi = explode(' - ', $tarihGet);\r\n\r\n\r\n\r\n\t\t$tarih1 = date('Y-m-d', strtotime($tarihAraligi[0])); //küçük tarih\r\n\r\n\t\t$tarih2 = date('Y-m-d', strtotime($tarihAraligi[1])); //büyük tarih\r\n\r\n\r\n\r\n\t\t$urim = $this->uri->segment(2);\r\n\r\n\r\n\r\n\t\t$segment = 2;\r\n\r\n\t\t$sayfa = $this->input->get(\"sayfa\");\r\n\r\n\r\n\r\n\t\t$page = $sayfa ? $sayfa : 0;\r\n\r\n\t\t$limit = 20;\r\n\r\n\r\n\r\n\t\tif($sayfa){$pagem = ($page-1)*$limit;}\r\n\r\n\t\telse{$pagem = 0;/*logekle(6,1);*/}\r\n\r\n\r\n\r\n\r\n\r\n\t\tif((isset($stokKodu) && !empty($stokKodu)) || (isset($stokAdi) && !empty($stokAdi)) || (isset($stokGrubu) && !empty($stokGrubu)) || (isset($tarihGet) && !empty($tarihGet))){\r\n\r\n\r\n\r\n\t\t\tif(!empty($stokGrubu)){$sorgu1 = \"AND stok_stokGrupKoduID = '$stokGrubu'\";}\r\n\r\n\t\t\telse{$sorgu1 = \"\";}\r\n\r\n\r\n\r\n\t\t\tif(!empty($tarihGet)){$sorgu2 = \"AND stok_olusturmaTarihi BETWEEN '$tarih1' AND '$tarih2'\";}\r\n\r\n\t\t\telse{$sorgu2 = \"\";}\r\n\r\n\r\n\r\n\t\t\t$countq = \"SELECT COUNT(*) as total FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap' AND stok_kodu LIKE '%$stokKodu%' AND stok_ad LIKE '%$stokAdi%' \".$sorgu1.\" \".$sorgu2.\" \";\r\n\r\n\t\t\t$countexe = $this->db->query($countq)->row();\r\n\r\n\t\t\t$count = $countexe->total;\r\n\r\n\r\n\r\n\t\t\t$sorgu = \"SELECT * FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap' AND stok_kodu LIKE '%$stokKodu%' AND stok_ad LIKE '%$stokAdi%' \".$sorgu1.\" \".$sorgu2.\" ORDER BY stok_id DESC LIMIT $pagem,$limit\";\r\n\r\n\t\t}else{\r\n\r\n\t\t\t$countq = \"SELECT COUNT(*) as total FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap'\";\r\n\r\n\t\t\t$countexe = $this->db->query($countq)->row();\r\n\r\n\t\t\t$count = $countexe->total;\r\n\r\n\t\t\t$sorgu = \"SELECT * FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap' ORDER BY stok_id DESC LIMIT $pagem,$limit\";\r\n\r\n\t\t}\r\n\r\n\t\t$data[\"count_of_list\"] = $count;\r\n\r\n\r\n\r\n\t\t$this->load->library(\"pagination\");\r\n\r\n\r\n\r\n\t\t$config = array();\r\n\r\n\t\t$config[\"base_url\"] = base_url() . \"/raporlar/$urim\";\r\n\r\n\t\t$config[\"total_rows\"] = $count;\r\n\r\n\t\t$config[\"per_page\"] = $limit;\r\n\r\n\t\t$config[\"uri_segment\"] = $segment;\r\n\r\n\t\t$config['use_page_numbers'] = TRUE;\r\n\r\n\t\t$config['enable_query_strings'] = TRUE;\r\n\r\n\t\t$config['page_query_string'] = TRUE;\r\n\r\n\t\t$config['reuse_query_string'] = TRUE;\r\n\r\n\t\t$config['query_string_segment'] = 'sayfa';\r\n\r\n\t\t$config['num_links'] = 9;\r\n\r\n\r\n\r\n\t\t$config['full_tag_open'] = '<div class=\"d-flex justify-content-center\"><ul class=\"pagination\">';\r\n\r\n\t\t$config['full_tag_close'] = '</ul></div>';\r\n\r\n\r\n\r\n\t\t$config['num_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['num_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['cur_tag_open'] = '<span class=\"page-link\"><li class=\"page-item active\">';\r\n\r\n\t\t$config['cur_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['first_link'] = '&laquo;&laquo;';\r\n\r\n\t\t$config['first_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['first_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['last_link'] = '&raquo;&raquo;';\r\n\r\n\t\t$config['last_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['last_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['prev_link'] = '&laquo;';\r\n\r\n\t\t$config['prev_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['prev_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['next_link'] = '&raquo;';\r\n\r\n\t\t$config['next_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['next_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$this->pagination->initialize($config);\r\n\r\n\r\n\r\n\t\t$data[\"links\"] = $this->pagination->create_links();\r\n\r\n\t\t$data[\"stok\"] = $this->db->query($sorgu)->result();\r\n\r\n\r\n\r\n\t\t$this->load->view('raporlar/stok-raporlari',$data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function kasaRaporlari(){\r\n\r\n\t\t$data[\"baslik\"] = \"Raporlar / Kasa Raporları\";\r\n\r\n\t\t$anaHesap = anaHesapBilgisi();\r\n\r\n\r\n\r\n        $kasaKodu = $this->input->get('kasaKodu');\r\n\r\n        $kasaAdi = $this->input->get('kasaAdi');\r\n\r\n        //$cariAdi = $this->input->get('cariAdi');\r\n\r\n\r\n\r\n        $urim = $this->uri->segment(2);\r\n\r\n        \r\n\r\n        $segment = 2;\r\n\r\n        $sayfa = $this->input->get(\"sayfa\");\r\n\r\n\r\n\r\n        $page = $sayfa ? $sayfa : 0;\r\n\r\n        $limit = 20;\r\n\r\n\r\n\r\n        if($sayfa){$pagem = ($page-1)*$limit;}\r\n\r\n        else{$pagem = 0;}\r\n\r\n\r\n\r\n        if((isset($kasaKodu) && !empty($kasaKodu)) || (isset($kasaAdi) && !empty($kasaAdi))){\r\n\r\n\r\n\r\n            /*if(!empty($cariGrubu)){$sorgu1 = \"AND cari_cariGrupKoduID = '$cariGrubu'\";}\r\n\r\n            else{$sorgu1 = \"\";}*/\r\n\r\n\r\n\r\n            $countq = \"SELECT COUNT(*) as total FROM kasa WHERE kasa_olusturanAnaHesap = '$anaHesap' AND kasa_kodu LIKE '%$kasaKodu%' AND kasa_adi LIKE '%$kasaAdi%'\";\r\n\r\n            $countexe = $this->db->query($countq)->row();\r\n\r\n            $count = $countexe->total;\r\n\r\n\r\n\r\n            $sorgu = \"SELECT * FROM kasa WHERE kasa_olusturanAnaHesap = '$anaHesap' AND kasa_kodu LIKE '%$kasaKodu%' AND kasa_adi LIKE '%$kasaAdi%' ORDER BY kasa_id DESC LIMIT $pagem,$limit\";\r\n\r\n        }else{\r\n\r\n            $countq = \"SELECT COUNT(*) as total FROM kasa WHERE kasa_olusturanAnaHesap = '$anaHesap'\";\r\n\r\n            $countexe = $this->db->query($countq)->row();\r\n\r\n            $count = $countexe->total;\r\n\r\n            $sorgu = \"SELECT * FROM kasa WHERE kasa_olusturanAnaHesap = '$anaHesap' ORDER BY kasa_id DESC LIMIT $pagem,$limit\";\r\n\r\n        }\r\n\r\n        $data[\"count_of_list\"] = $count;\r\n\r\n\r\n\r\n        $this->load->library(\"pagination\");\r\n\r\n\r\n\r\n        $config = array();\r\n\r\n        $config[\"base_url\"] = base_url() . \"/raporlar/$urim\";\r\n\r\n        $config[\"total_rows\"] = $count;\r\n\r\n        $config[\"per_page\"] = $limit;\r\n\r\n        $config[\"uri_segment\"] = $segment;\r\n\r\n        $config['use_page_numbers'] = TRUE;\r\n\r\n        $config['enable_query_strings'] = TRUE;\r\n\r\n        $config['page_query_string'] = TRUE;\r\n\r\n        $config['reuse_query_string'] = TRUE;\r\n\r\n        $config['query_string_segment'] = 'sayfa';\r\n\r\n        $config['num_links'] = 9;\r\n\r\n\r\n\r\n        $config['full_tag_open'] = '<div class=\"d-flex justify-content-center\"><ul class=\"pagination\">';\r\n\r\n        $config['full_tag_close'] = '</ul></div>';\r\n\r\n\r\n\r\n        $config['num_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n        $config['num_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n        $config['cur_tag_open'] = '<span class=\"page-link\"><li class=\"page-item active\">';\r\n\r\n        $config['cur_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n        $config['first_link'] = '&laquo;&laquo;';\r\n\r\n        $config['first_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n        $config['first_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n        $config['last_link'] = '&raquo;&raquo;';\r\n\r\n        $config['last_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n        $config['last_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n        $config['prev_link'] = '&laquo;';\r\n\r\n        $config['prev_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n        $config['prev_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n        $config['next_link'] = '&raquo;';\r\n\r\n        $config['next_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n        $config['next_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n        $this->pagination->initialize($config);\r\n\r\n\r\n\r\n        $data[\"links\"] = $this->pagination->create_links();\r\n\r\n        $data[\"kasa\"] = $this->db->query($sorgu)->result();\r\n\r\n\r\n\r\n        $this->load->view(\"raporlar/kasa-raporlari\", $data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function cariStokHareketRaporlari(){\r\n\r\n\t\t$data[\"baslik\"] = \"Raporlar / Cari Stok Hareket Raporları\";\r\n\r\n\t\t$anaHesap = anaHesapBilgisi();\r\n\r\n\r\n\r\n\t\t$cariBilgisi = $this->input->get('cari');\r\n\r\n\r\n\r\n\t    $tarihGet = $this->input->get('tarihAraligi');\r\n\r\n\r\n\r\n\t\t$tarihAraligi = explode(' - ', $tarihGet);\r\n\r\n\r\n\r\n\t\t$tarih1 = date('Y-m-d', strtotime($tarihAraligi[0])); //küçük tarih\r\n\r\n\t\t$tarih2 = date('Y-m-d', strtotime($tarihAraligi[1])); //büyük tarih\r\n\r\n\r\n\r\n\t    $urim = $this->uri->segment(2);\r\n\r\n\t    \r\n\r\n\t    $segment = 2;\r\n\r\n\t    $sayfa = $this->input->get(\"sayfa\");\r\n\r\n\r\n\r\n\t    $page = $sayfa ? $sayfa : 0;\r\n\r\n\t    $limit = 20;\r\n\r\n\r\n\r\n\t    if($sayfa){$pagem = ($page-1)*$limit;}\r\n\r\n\t    else{$pagem = 0;}\r\n\r\n\r\n\r\n\t    if((isset($tarihGet) && !empty($tarihGet))){\r\n\r\n\r\n\r\n\t        if(!empty($cariBilgisi) && $cariBilgisi != \"tumu\"){\r\n\r\n\t    \t\t$kasaQuery = \"AND sh_cariID = '$cariBilgisi'\";\r\n\r\n\t    \t}\r\n\r\n\r\n\r\n\t    \tif(!empty($tarihGet)){$sorgu1 = \"AND sh_tarih BETWEEN '$tarih1' AND '$tarih2'\";}\r\n\r\n\t\t\telse{$sorgu1 = \"\";}\r\n\r\n\r\n\r\n\t        $countq = \"SELECT COUNT(*) as total FROM stokHareketleri WHERE sh_olusturanAnaHesap = '$anaHesap' \".$kasaQuery.\"  \".$sorgu1.\" \";\r\n\r\n\t        $countexe = $this->db->query($countq)->row();\r\n\r\n\t        $count = $countexe->total;\r\n\r\n\r\n\r\n\t        $sorgu = \"SELECT * FROM stokHareketleri WHERE sh_olusturanAnaHesap = '$anaHesap' \".$kasaQuery.\" \".$sorgu1.\" ORDER BY sh_id DESC LIMIT $pagem,$limit\";\r\n\r\n\t    }else{\r\n\r\n\r\n\r\n\t    \tif(!empty($cariBilgisi) && $cariBilgisi != \"tumu\"){\r\n\r\n\t    \t\t$kasaQuery = \"AND sh_cariID = '$cariBilgisi'\";\r\n\r\n\t    \t} \r\n\r\n\r\n\r\n\t        $countq = \"SELECT COUNT(*) as total FROM stokHareketleri WHERE sh_olusturanAnaHesap = '$anaHesap' \".$kasaQuery.\"\";\r\n\r\n\t        $countexe = $this->db->query($countq)->row();\r\n\r\n\t        $count = $countexe->total;\r\n\r\n\t        $sorgu = \"SELECT * FROM stokHareketleri WHERE sh_olusturanAnaHesap = '$anaHesap' \".$kasaQuery.\" ORDER BY sh_id DESC LIMIT $pagem,$limit\";\r\n\r\n\t    }\r\n\r\n\r\n\r\n\t    $data[\"count_of_list\"] = $count;\r\n\r\n\r\n\r\n\t    $this->load->library(\"pagination\");\r\n\r\n\r\n\r\n\t    $config = array();\r\n\r\n\t    $config[\"base_url\"] = base_url() . \"/raporlar/$urim\";\r\n\r\n\t    $config[\"total_rows\"] = $count;\r\n\r\n\t    $config[\"per_page\"] = $limit;\r\n\r\n\t    $config[\"uri_segment\"] = $segment;\r\n\r\n\t    $config['use_page_numbers'] = TRUE;\r\n\r\n\t    $config['enable_query_strings'] = TRUE;\r\n\r\n\t    $config['page_query_string'] = TRUE;\r\n\r\n\t    $config['reuse_query_string'] = TRUE;\r\n\r\n\t    $config['query_string_segment'] = 'sayfa';\r\n\r\n\t    $config['num_links'] = 9;\r\n\r\n\r\n\r\n\t    $config['full_tag_open'] = '<div class=\"d-flex justify-content-center\"><ul class=\"pagination\">';\r\n\r\n\t    $config['full_tag_close'] = '</ul></div>';\r\n\r\n\r\n\r\n\t    $config['num_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t    $config['num_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t    $config['cur_tag_open'] = '<span class=\"page-link\"><li class=\"page-item active\">';\r\n\r\n\t    $config['cur_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t    $config['first_link'] = '&laquo;&laquo;';\r\n\r\n\t    $config['first_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t    $config['first_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t    $config['last_link'] = '&raquo;&raquo;';\r\n\r\n\t    $config['last_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t    $config['last_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t    $config['prev_link'] = '&laquo;';\r\n\r\n\t    $config['prev_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t    $config['prev_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t    $config['next_link'] = '&raquo;';\r\n\r\n\t    $config['next_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t    $config['next_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t    $this->pagination->initialize($config);\r\n\r\n\r\n\r\n\t    $data[\"links\"] = $this->pagination->create_links();\r\n\r\n\t    $data[\"cariStokHareketleri\"] = $this->db->query($sorgu)->result();\r\n\r\n\t    $data[\"toplamHareket\"] = $count;\r\n\r\n\r\n\r\n\t    $cariQ = \"SELECT * FROM cari WHERE cari_id = '$cariBilgisi'\";\r\n\r\n\t    $cariExe = $this->db->query($cariQ)->row();\r\n\r\n\t    $cariOlusturanAnaHesap = $cariExe->cari_olusturanAnaHesap;\r\n\r\n\r\n\r\n\t\t\tif($cariExe){\r\n\r\n\t\t    if($anaHesap == $cariOlusturanAnaHesap){\r\n\r\n\t\t$this->load->view(\"raporlar/cari-stok-hareket-raporlari\",$data);\r\n\r\n\t\t}else{\r\n\r\n\t\t    \tredirect('hata');\r\n\r\n\t\t    }\r\n\r\n\t  \t}else{\r\n\r\n\t  \t\t\t$this->load->view(\"cari/cari-hareketleri\", $data);\r\n\r\n\t  \t}\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function giderRaporlari(){\r\n\r\n\t\t$data[\"baslik\"] = \"Raporlar / Gider Raporları\";\r\n\r\n\t\t$anaHesap = anaHesapBilgisi();\r\n\r\n\r\n\r\n\t\t$giderTuru = $this->input->get(\"giderTuru\");\r\n\r\n\t\t\r\n\r\n\t\t$giderKategorileriQ = \"SELECT * FROM giderKategorileri WHERE gk_olusturanAnaHesap = '$anaHesap' AND gk_mainID IS NULL\";\r\n\r\n\t\t$data[\"giderKategorileri\"] = $this->db->query($giderKategorileriQ)->result();\r\n\r\n\r\n\r\n\t\t//$olusturanHesapKim = $data[\"giderKategorileri\"]->gk_olusturanAnaHesap;\r\n\r\n\r\n\r\n\t\t$giderTuruQ = \"SELECT * FROM giderKategorileri WHERE gk_id = '$giderTuru' AND gk_olusturanAnaHesap = '$anaHesap' \";\r\n\r\n\t\t$data[\"giderKat\"] = $this->db->query($giderTuruQ)->row();\r\n\r\n\r\n\r\n\t\t$olusturanHesapKim = $data[\"giderKat\"]->gk_olusturanAnaHesap;\r\n\r\n\r\n\r\n\t\tif($giderTuru){\r\n\r\n\t\t\tif($anaHesap == $olusturanHesapKim){\r\n\r\n\t\t\t\t$this->load->view(\"raporlar/gider-raporlari\",$data);\r\n\r\n\t\t\t}else{\r\n\r\n\t\t\t\tredirect('hata');\r\n\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\r\n\t\t\t$this->load->view(\"raporlar/gider-raporlari\",$data);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function kritikStokRaporu(){\r\n\r\n\t\t$data[\"baslik\"] = \"Azalan Ürünler (Kritik Stok)\";\r\n\r\n\r\n\r\n\t\t$anaHesap = anaHesapBilgisi();\r\n\r\n\r\n\r\n\t\t$urim = $this->uri->segment(2);\r\n\r\n\r\n\r\n\t\t$segment = 2;\r\n\r\n\t\t$sayfa = $this->input->get(\"sayfa\");\r\n\r\n\r\n\r\n\t\t$page = $sayfa ? $sayfa : 0;\r\n\r\n\t\t$limit = 20;\r\n\r\n\r\n\r\n\t\tif($sayfa){$pagem = ($page-1)*$limit;}\r\n\r\n\t\telse{$pagem = 0;/*logekle(6,1);*/}\r\n\r\n\r\n\r\n\t\t$countq = \"SELECT COUNT(*) as total FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap' AND stok_kritikSeviyesi IS NOT NULL\";\r\n\r\n\t\t$countexe = $this->db->query($countq)->row();\r\n\r\n\t\t$count = $countexe->total;\r\n\r\n\t\t$sorgu = \"SELECT * FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap' AND stok_kritikSeviyesi IS NOT NULL ORDER BY stok_id DESC LIMIT $pagem,$limit\";\r\n\r\n\t\r\n\r\n\t\t$data[\"count_of_list\"] = $count;\r\n\r\n\r\n\r\n\t\t$this->load->library(\"pagination\");\r\n\r\n\r\n\r\n\t\t$config = array();\r\n\r\n\t\t$config[\"base_url\"] = base_url() . \"/raporlar/$urim\";\r\n\r\n\t\t$config[\"total_rows\"] = $count;\r\n\r\n\t\t$config[\"per_page\"] = $limit;\r\n\r\n\t\t$config[\"uri_segment\"] = $segment;\r\n\r\n\t\t$config['use_page_numbers'] = TRUE;\r\n\r\n\t\t$config['enable_query_strings'] = TRUE;\r\n\r\n\t\t$config['page_query_string'] = TRUE;\r\n\r\n\t\t$config['reuse_query_string'] = TRUE;\r\n\r\n\t\t$config['query_string_segment'] = 'sayfa';\r\n\r\n\t\t$config['num_links'] = 9;\r\n\r\n\r\n\r\n\t\t$config['full_tag_open'] = '<div class=\"d-flex justify-content-center\"><ul class=\"pagination\">';\r\n\r\n\t\t$config['full_tag_close'] = '</ul></div>';\r\n\r\n\r\n\r\n\t\t$config['num_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['num_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['cur_tag_open'] = '<span class=\"page-link\"><li class=\"page-item active\">';\r\n\r\n\t\t$config['cur_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['first_link'] = '&laquo;&laquo;';\r\n\r\n\t\t$config['first_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['first_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['last_link'] = '&raquo;&raquo;';\r\n\r\n\t\t$config['last_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['last_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['prev_link'] = '&laquo;';\r\n\r\n\t\t$config['prev_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['prev_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['next_link'] = '&raquo;';\r\n\r\n\t\t$config['next_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['next_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$this->pagination->initialize($config);\r\n\r\n\r\n\r\n\t\t$data[\"links\"] = $this->pagination->create_links();\r\n\r\n\t\t$data[\"stok\"] = $this->db->query($sorgu)->result();\r\n\r\n\r\n\r\n\t\t$this->load->view(\"raporlar/kritik-stok-raporu\",$data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function bitenStoklarRaporu(){\r\n\r\n\t\t$data[\"baslik\"] = \"Biten Stoklar\";\r\n\r\n\r\n\r\n\t\t$anaHesap = anaHesapBilgisi();\r\n\r\n\r\n\r\n\t\t$urim = $this->uri->segment(2);\r\n\r\n\r\n\r\n\t\t$segment = 2;\r\n\r\n\t\t$sayfa = $this->input->get(\"sayfa\");\r\n\r\n\r\n\r\n\t\t$page = $sayfa ? $sayfa : 0;\r\n\r\n\t\t$limit = 20;\r\n\r\n\r\n\r\n\t\tif($sayfa){$pagem = ($page-1)*$limit;}\r\n\r\n\t\telse{$pagem = 0;/*logekle(6,1);*/}\r\n\r\n\r\n\r\n\t\t$countq = \"SELECT COUNT(*) as total FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap'\";\r\n\r\n\t\t$countexe = $this->db->query($countq)->row();\r\n\r\n\t\t$count = $countexe->total;\r\n\r\n\t\t$sorgu = \"SELECT * FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap' ORDER BY stok_id DESC LIMIT $pagem,$limit\";\r\n\r\n\t\r\n\r\n\t\t$data[\"count_of_list\"] = $count;\r\n\r\n\r\n\r\n\t\t$this->load->library(\"pagination\");\r\n\r\n\r\n\r\n\t\t$config = array();\r\n\r\n\t\t$config[\"base_url\"] = base_url() . \"/raporlar/$urim\";\r\n\r\n\t\t$config[\"total_rows\"] = $count;\r\n\r\n\t\t$config[\"per_page\"] = $limit;\r\n\r\n\t\t$config[\"uri_segment\"] = $segment;\r\n\r\n\t\t$config['use_page_numbers'] = TRUE;\r\n\r\n\t\t$config['enable_query_strings'] = TRUE;\r\n\r\n\t\t$config['page_query_string'] = TRUE;\r\n\r\n\t\t$config['reuse_query_string'] = TRUE;\r\n\r\n\t\t$config['query_string_segment'] = 'sayfa';\r\n\r\n\t\t$config['num_links'] = 9;\r\n\r\n\r\n\r\n\t\t$config['full_tag_open'] = '<div class=\"d-flex justify-content-center\"><ul class=\"pagination\">';\r\n\r\n\t\t$config['full_tag_close'] = '</ul></div>';\r\n\r\n\r\n\r\n\t\t$config['num_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['num_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['cur_tag_open'] = '<span class=\"page-link\"><li class=\"page-item active\">';\r\n\r\n\t\t$config['cur_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['first_link'] = '&laquo;&laquo;';\r\n\r\n\t\t$config['first_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['first_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['last_link'] = '&raquo;&raquo;';\r\n\r\n\t\t$config['last_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['last_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['prev_link'] = '&laquo;';\r\n\r\n\t\t$config['prev_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['prev_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['next_link'] = '&raquo;';\r\n\r\n\t\t$config['next_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['next_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$this->pagination->initialize($config);\r\n\r\n\r\n\r\n\t\t$data[\"links\"] = $this->pagination->create_links();\r\n\r\n\t\t$data[\"stok\"] = $this->db->query($sorgu)->result();\r\n\r\n\r\n\r\n\t\t$this->load->view(\"raporlar/biten-stoklar-raporu\",$data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function enCokSatanlarRaporu(){\r\n\r\n\t\t$data[\"baslik\"] = \"En Çok Satanlar\";\r\n\r\n\r\n\r\n\t\t$anaHesap = anaHesapBilgisi();\r\n\r\n\r\n\r\n\t\t$urim = $this->uri->segment(2);\r\n\r\n\r\n\r\n\t\t$segment = 2;\r\n\r\n\t\t$sayfa = $this->input->get(\"sayfa\");\r\n\r\n\r\n\r\n\t\t$page = $sayfa ? $sayfa : 0;\r\n\r\n\t\t$limit = 20;\r\n\r\n\r\n\r\n\t\tif($sayfa){$pagem = ($page-1)*$limit;}\r\n\r\n\t\telse{$pagem = 0;/*logekle(6,1);*/}\r\n\r\n\r\n\r\n\t\t$countq = \"SELECT COUNT(*) as total FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap'\";\r\n\r\n\t\t$countexe = $this->db->query($countq)->row();\r\n\r\n\t\t$count = $countexe->total;\r\n\r\n\t\t$sorgu = \"SELECT * FROM stok WHERE stok_olusturanAnaHesap = '$anaHesap' ORDER BY stok_id DESC LIMIT $pagem,$limit\";\r\n\r\n\t\r\n\r\n\t\t$data[\"count_of_list\"] = $count;\r\n\r\n\r\n\r\n\t\t$this->load->library(\"pagination\");\r\n\r\n\r\n\r\n\t\t$config = array();\r\n\r\n\t\t$config[\"base_url\"] = base_url() . \"/raporlar/$urim\";\r\n\r\n\t\t$config[\"total_rows\"] = $count;\r\n\r\n\t\t$config[\"per_page\"] = $limit;\r\n\r\n\t\t$config[\"uri_segment\"] = $segment;\r\n\r\n\t\t$config['use_page_numbers'] = TRUE;\r\n\r\n\t\t$config['enable_query_strings'] = TRUE;\r\n\r\n\t\t$config['page_query_string'] = TRUE;\r\n\r\n\t\t$config['reuse_query_string'] = TRUE;\r\n\r\n\t\t$config['query_string_segment'] = 'sayfa';\r\n\r\n\t\t$config['num_links'] = 9;\r\n\r\n\r\n\r\n\t\t$config['full_tag_open'] = '<div class=\"d-flex justify-content-center\"><ul class=\"pagination\">';\r\n\r\n\t\t$config['full_tag_close'] = '</ul></div>';\r\n\r\n\r\n\r\n\t\t$config['num_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['num_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['cur_tag_open'] = '<span class=\"page-link\"><li class=\"page-item active\">';\r\n\r\n\t\t$config['cur_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['first_link'] = '&laquo;&laquo;';\r\n\r\n\t\t$config['first_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['first_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['last_link'] = '&raquo;&raquo;';\r\n\r\n\t\t$config['last_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['last_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['prev_link'] = '&laquo;';\r\n\r\n\t\t$config['prev_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['prev_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$config['next_link'] = '&raquo;';\r\n\r\n\t\t$config['next_tag_open'] = '<span class=\"page-link\"><li class=\"page-item\">';\r\n\r\n\t\t$config['next_tag_close'] = '</li></span>';\r\n\r\n\r\n\r\n\t\t$this->pagination->initialize($config);\r\n\r\n\r\n\r\n\t\t$data[\"links\"] = $this->pagination->create_links();\r\n\r\n\t\t$data[\"stok\"] = $this->db->query($sorgu)->result();\r\n\r\n\r\n\r\n\t\t$this->load->view(\"raporlar/en-cok-satanlar-raporu\",$data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function digiturk_personel_ciro_adet(){\r\n\r\n\t\t// Yetki kontrolü\r\n\r\n\t\tif(!grup_modul_yetkisi_var(1401)){\r\n\r\n\t\t\tredirect(\"home/hata\");\r\n\r\n\t\t}\r\n\r\n\r\n\r\n\t\t$data[\"baslik\"] = \"Digiturk Personel Ciro/Adet Raporu\";\r\n\r\n\t\t\r\n\r\n\t\t// Tarih filtreleri - Daha geniş varsayılan tarih aralığı\r\n\r\n\t\t$baslangic_tarihi = $this->input->get('baslangic_tarihi') ? $this->input->get('baslangic_tarihi') : date('Y-01-01'); // Yılbaşından itibaren\r\n\r\n\t\t$bitis_tarihi = $this->input->get('bitis_tarihi') ? $this->input->get('bitis_tarihi') : date('Y-m-d');\r\n\r\n\t\t$personel_id = $this->input->get('personel_id') ? $this->input->get('personel_id') : '';\r\n\r\n\t\t\r\n\r\n\t\t$data['baslangic_tarihi'] = $baslangic_tarihi;\r\n\r\n\t\t$data['bitis_tarihi'] = $bitis_tarihi;\r\n\r\n\t\t$data['personel_id'] = $personel_id;\r\n\r\n\t\t\r\n\r\n\t\t// Personel listesi\r\n\r\n\t\t$personel_query = \"SELECT kullanici_id, CONCAT(kullanici_ad, ' ', kullanici_soyad) AS personel_adi \r\n\r\n\t\t\t\t\t\t   FROM kullanicilar \r\n\r\n\t\t\t\t\t\t   WHERE kullanici_durum = 1 \r\n\r\n\t\t\t\t\t\t   ORDER BY kullanici_ad\";\r\n\r\n\t\t$data['personel_listesi'] = $this->db->query($personel_query)->result();\r\n\r\n\t\t\r\n\r\n\t\t// Ana rapor sorgusu - Aktivasyon tablosu olmadan\r\n\r\n\t\t$sql = \"SELECT \r\n\r\n\t\t\t\tkg.kg_adi AS kullanici_grubu,\r\n\r\n\t\t\t\tCONCAT(k.kullanici_ad, ' ', k.kullanici_soyad) AS personel_adi,\r\n\r\n\t\t\t\tCOUNT(sf.satis_id) AS toplam_satis_adedi,\r\n\r\n\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_ciro\r\n\r\n\t\t\tFROM satisFaturasi sf\r\n\r\n\t\t\tJOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\r\n\r\n\t\t\tLEFT JOIN kullanici_grubu kg ON k.grup_id = kg.kg_id\r\n\r\n\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\";\r\n\r\n\t\t\r\n\r\n\t\t$params = array($baslangic_tarihi, $bitis_tarihi);\r\n\r\n\t\t\r\n\r\n\t\tif (!empty($personel_id)) {\r\n\r\n\t\t\t$sql .= \" AND k.kullanici_id = ?\";\r\n\r\n\t\t\t$params[] = $personel_id;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t$sql .= \" GROUP BY kg.kg_adi, k.kullanici_ad, k.kullanici_soyad\r\n\r\n\t\t\t\t  ORDER BY toplam_ciro DESC\";\r\n\r\n\t\t\r\n\r\n\t\t$rapor_verileri = $this->db->query($sql, $params)->result();\r\n\r\n\t\t\r\n\r\n\t\t$data['rapor_verileri'] = $rapor_verileri;\r\n\r\n\t\t\r\n\r\n\t\t$this->load->view(\"raporlar/digiturk-personel-ciro-adet\", $data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function digiturk_bolge_muduru_ciro_adet(){\r\n\r\n\t\t// Yetki kontrolü\r\n\r\n\t\tif(!grup_modul_yetkisi_var(1402)){\r\n\r\n\t\t\tredirect(\"home/hata\");\r\n\r\n\t\t}\r\n\r\n\r\n\r\n\t\t$data[\"baslik\"] = \"Digiturk Bölge Müdürü ve Personel Ciro/Adet Raporu\";\r\n\r\n\t\t\r\n\r\n\t\t// Tarih filtreleri\r\n\r\n\t\t$baslangic_tarihi = $this->input->get('baslangic_tarihi') ? $this->input->get('baslangic_tarihi') : date('Y-m-01');\r\n\r\n\t\t$bitis_tarihi = $this->input->get('bitis_tarihi') ? $this->input->get('bitis_tarihi') : date('Y-m-d');\r\n\r\n\t\t$personel_id = $this->input->get('personel_id') ? $this->input->get('personel_id') : '';\r\n\r\n\t\t\r\n\r\n\t\t$data['baslangic_tarihi'] = $baslangic_tarihi;\r\n\r\n\t\t$data['bitis_tarihi'] = $bitis_tarihi;\r\n\r\n\t\t$data['personel_id'] = $personel_id;\r\n\r\n\t\t\r\n\r\n\t\t// Personel listesi - sadece grup_id = 6 olanlar (Bölge müdürleri)\r\n\r\n\t\t$personel_query = \"SELECT kullanici_id, CONCAT(kullanici_ad, ' ', kullanici_soyad) AS personel_adi \r\n\r\n\t\t\t\t\t\t   FROM kullanicilar \r\n\r\n\t\t\t\t\t\t   WHERE kullanici_durum = 1 AND grup_id = 6\r\n\r\n\t\t\t\t\t\t   ORDER BY kullanici_ad\";\r\n\r\n\t\t$data['personel_listesi'] = $this->db->query($personel_query)->result();\r\n\r\n\t\t\r\n\r\n\t\t// Ana rapor sorgusu - Sadece Bölge müdürleri, kendi + bağlı personellerin toplamı\r\n\r\n\t\t$sql = \"SELECT \r\n\r\n\t\t\t\tbm.kullanici_id,\r\n\r\n\t\t\t\tkg.kg_adi AS kullanici_grubu,\r\n\r\n\t\t\t\tCONCAT(bm.kullanici_ad, ' ', bm.kullanici_soyad) AS personel_adi,\r\n\r\n\t\t\t\t-- Bölge müdürünün kendi satışları\r\n\r\n\t\t\t\tCOALESCE(bm_sales.kendi_satis_adedi, 0) AS kendi_satis_adedi,\r\n\r\n\t\t\t\tCOALESCE(bm_sales.kendi_ciro, 0) AS kendi_ciro,\r\n\r\n\t\t\t\t-- Bağlı personellerin satışları\r\n\r\n\t\t\t\tCOALESCE(team_sales.personel_satis_adedi, 0) AS personel_satis_adedi,\r\n\r\n\t\t\t\tCOALESCE(team_sales.personel_ciro, 0) AS personel_ciro,\r\n\r\n\t\t\t\t-- Toplam (kendi + personeller)\r\n\r\n\t\t\t\t(COALESCE(bm_sales.kendi_satis_adedi, 0) + COALESCE(team_sales.personel_satis_adedi, 0)) AS toplam_satis_adedi,\r\n\r\n\t\t\t\t(COALESCE(bm_sales.kendi_ciro, 0) + COALESCE(team_sales.personel_ciro, 0)) AS toplam_ciro\r\n\r\n\t\t\tFROM kullanicilar bm\r\n\r\n\t\t\tLEFT JOIN kullanici_grubu kg ON bm.grup_id = kg.kg_id\r\n\r\n\t\t\t-- Bölge müdürünün kendi satışları\r\n\r\n\t\t\tLEFT JOIN (\r\n\r\n\t\t\t\tSELECT \r\n\r\n\t\t\t\t\tk.kullanici_id,\r\n\r\n\t\t\t\t\tCOUNT(sf.satis_id) AS kendi_satis_adedi,\r\n\r\n\t\t\t\t\tSUM(sf.satis_genelToplam) AS kendi_ciro\r\n\r\n\t\t\t\tFROM aktivasyon a\r\n\r\n\t\t\t\tJOIN satisFaturasi sf ON a.aktivasyon_cari_id = sf.satis_cariID\r\n\r\n\t\t\t\tJOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\r\n\r\n\t\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n\r\n\t\t\t\tAND k.grup_id = 6\r\n\r\n\t\t\t\tGROUP BY k.kullanici_id\r\n\r\n\t\t\t) bm_sales ON bm.kullanici_id = bm_sales.kullanici_id\r\n\r\n\t\t\t-- Bağlı personellerin satışları\r\n\r\n\t\t\tLEFT JOIN (\r\n\r\n\t\t\t\tSELECT \r\n\r\n\t\t\t\t\tk.kullanici_sorumluMudur,\r\n\r\n\t\t\t\t\tCOUNT(sf.satis_id) AS personel_satis_adedi,\r\n\r\n\t\t\t\t\tSUM(sf.satis_genelToplam) AS personel_ciro\r\n\r\n\t\t\t\tFROM aktivasyon a\r\n\r\n\t\t\t\tJOIN satisFaturasi sf ON a.aktivasyon_cari_id = sf.satis_cariID\r\n\r\n\t\t\t\tJOIN kullanicilar k ON sf.satis_olusturan = k.kullanici_id\r\n\r\n\t\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n\r\n\t\t\t\tAND k.kullanici_sorumluMudur IS NOT NULL\r\n\r\n\t\t\t\tAND k.kullanici_sorumluMudur IN (SELECT kullanici_id FROM kullanicilar WHERE grup_id = 6)\r\n\r\n\t\t\t\tGROUP BY k.kullanici_sorumluMudur\r\n\r\n\t\t\t) team_sales ON bm.kullanici_id = team_sales.kullanici_sorumluMudur\r\n\r\n\t\t\tWHERE bm.grup_id = 6 AND bm.kullanici_durum = 1\";\r\n\r\n\t\t\r\n\r\n\t\t$params = array($baslangic_tarihi, $bitis_tarihi, $baslangic_tarihi, $bitis_tarihi);\r\n\r\n\t\t\r\n\r\n\t\tif (!empty($personel_id)) {\r\n\r\n\t\t\t$sql .= \" AND bm.kullanici_id = ?\";\r\n\r\n\t\t\t$params[] = $personel_id;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t$sql .= \" ORDER BY toplam_ciro DESC\";\r\n\r\n\t\t\r\n\r\n\t\t$data['rapor_verileri'] = $this->db->query($sql, $params)->result();\r\n\r\n\t\t\r\n\r\n\t\t$this->load->view(\"raporlar/digiturk-bolge-muduru-ciro-adet\", $data);\r\n\r\n\t}\r\n\r\n\r\n\r\n\tpublic function digiturk_sehir_ciro_adet(){\r\n\r\n\t\t// Yetki kontrolü\r\n\r\n\t\tif(!grup_modul_yetkisi_var(1403)){\r\n\r\n\t\t\tredirect(\"home/hata\");\r\n\r\n\t\t}\r\n\r\n\r\n\r\n\t\t$data[\"baslik\"] = \"Digiturk Şehir Ciro/Adet Raporu\";\r\n\r\n\t\t\r\n\r\n\t\t// Tarih filtreleri - Daha geniş varsayılan tarih aralığı\r\n\r\n\t\t$baslangic_tarihi = $this->input->get('baslangic_tarihi') ? $this->input->get('baslangic_tarihi') : date('Y-01-01'); // Yılbaşından itibaren\r\n\r\n\t\t$bitis_tarihi = $this->input->get('bitis_tarihi') ? $this->input->get('bitis_tarihi') : date('Y-m-d');\r\n\r\n\t\t$sehir_id = $this->input->get('sehir_id') ? $this->input->get('sehir_id') : '';\r\n\r\n\t\t\r\n\r\n\t\t$data['baslangic_tarihi'] = $baslangic_tarihi;\r\n\r\n\t\t$data['bitis_tarihi'] = $bitis_tarihi;\r\n\r\n\t\t$data['sehir_id'] = $sehir_id;\r\n\r\n\t\t\r\n\r\n\t\t// Şehir listesi\r\n\r\n\t\t$sehir_query = \"SELECT id, il AS sehir_adi \r\n\r\n\t\t\t\t\t\tFROM iller \r\n\r\n\t\t\t\t\t\tORDER BY il\";\r\n\r\n\t\t$data['sehir_listesi'] = $this->db->query($sehir_query)->result();\r\n\r\n\t\t\r\n\r\n\t\t// Ana rapor sorgusu - Şehirlere göre satış raporu (Aktivasyon olmadan)\r\n\r\n\t\t$sql = \"SELECT \r\n\r\n\t\t\t\ti.il AS sehir_adi,\r\n\r\n\t\t\t\tCOUNT(sf.satis_id) AS toplam_satis_adedi,\r\n\r\n\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_ciro,\r\n\r\n\t\t\t\tc.cari_il\r\n\r\n\t\t\tFROM satisFaturasi sf\r\n\r\n\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n\r\n\t\t\tLEFT JOIN iller i ON c.cari_il = i.id\r\n\r\n\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n\r\n\t\t\tAND c.cari_il IS NOT NULL AND c.cari_il != 0\";\r\n\r\n\t\t\r\n\r\n\t\t$params = array($baslangic_tarihi, $bitis_tarihi);\r\n\r\n\t\t\r\n\r\n\t\tif (!empty($sehir_id)) {\r\n\r\n\t\t\t$sql .= \" AND c.cari_il = ?\";\r\n\r\n\t\t\t$params[] = $sehir_id;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t$sql .= \" GROUP BY i.il, c.cari_il\r\n\r\n\t\t\t\t  ORDER BY toplam_ciro DESC\";\r\n\r\n\t\t\r\n\r\n\t\t$rapor_verileri = $this->db->query($sql, $params)->result();\r\n\r\n\t\t\r\n\r\n\t\t$data['rapor_verileri'] = $rapor_verileri;\r\n\r\n\t\t\r\n\r\n\t\t$this->load->view(\"raporlar/digiturk-sehir-ciro-adet\", $data);\r\n\r\n\t}\r\n\r\n\tpublic function digiturk_sehir_cari_detay(){\r\n\t\t// AJAX isteği kontrolü - CodeIgniter 3'te $_SERVER kullanılır\r\n\t\tif (!isset($_SERVER['HTTP_X_REQUESTED_WITH']) || \r\n\t\t\tstrtolower($_SERVER['HTTP_X_REQUESTED_WITH']) != 'xmlhttprequest') {\r\n\t\t\tshow_404();\r\n\t\t}\r\n\r\n\t\t// Yetki kontrolü\r\n\t\tif(!grup_modul_yetkisi_var(1403)){\r\n\t\t\techo json_encode(['error' => 'Yetkiniz yok']);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$sehir_id = $this->input->post('sehir_id');\r\n\t\t$baslangic_tarihi = $this->input->post('baslangic_tarihi');\r\n\t\t$bitis_tarihi = $this->input->post('bitis_tarihi');\r\n\r\n\t\tif (!$sehir_id || !$baslangic_tarihi || !$bitis_tarihi) {\r\n\t\t\techo json_encode(['error' => 'Eksik parametre - sehir_id: ' . $sehir_id . ', baslangic: ' . $baslangic_tarihi . ', bitis: ' . $bitis_tarihi]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\t// Şehirdeki satış yapan müşterilerin detaylarını getir\r\n\t\t\t$sql = \"SELECT \r\n\t\t\t\t\tc.cari_ad,\r\n\t\t\t\t\ti.il_adi AS il_adi,\r\n\t\t\t\t\tilc.ilce_adi AS ilce_adi,\r\n\t\t\t\t\tc.cari_firmaTelefon,\r\n\t\t\t\t\tCOUNT(sf.satis_id) AS satis_adedi,\r\n\t\t\t\t\tSUM(sf.satis_genelToplam) AS toplam_tutar\r\n\t\t\t\tFROM satisFaturasi sf\r\n\t\t\t\tJOIN cari c ON sf.satis_cariID = c.cari_id\r\n\t\t\t\tLEFT JOIN iller i ON c.cari_il = i.il_id\r\n\t\t\t\tLEFT JOIN ilceler ilc ON c.cari_ilce = ilc.ilce_id\r\n\t\t\t\tWHERE sf.satis_olusturmaTarihi BETWEEN ? AND ?\r\n\t\t\t\tAND c.cari_il = ?\r\n\t\t\t\tGROUP BY c.cari_id, c.cari_ad, i.il_adi, ilc.ilce_adi, c.cari_firmaTelefon\r\n\t\t\t\tORDER BY toplam_tutar DESC\";\r\n\r\n\t\t\t$result = $this->db->query($sql, array($baslangic_tarihi, $bitis_tarihi, $sehir_id));\r\n\t\t\t\r\n\t\t\tif (!$result) {\r\n\t\t\t\techo json_encode(['error' => 'Veritabanı hatası: ' . $this->db->error()['message']]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$data = $result->result();\r\n\r\n\t\t\techo json_encode(['success' => true, 'data' => $data, 'count' => count($data)]);\r\n\t\t\t\r\n\t\t} catch (Exception $e) {\r\n\t\t\techo json_encode(['error' => 'Exception: ' . $e->getMessage()]);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n"
        }
    ]
}