{
    "sourceFile": "application/helpers/changelog_helper.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759504817712,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759504817712,
            "name": "Commit-0",
            "content": "<?php\r\n\r\ndefined('BASEPATH') OR exit('No direct script access allowed');\r\n\r\n/**\r\n * Changelog Helper\r\n * \r\n * Bu helper dosyası proje versiyonlarını ve değişiklikleri otomatik olarak takip eder.\r\n */\r\n\r\nif (!function_exists('updateChangelog')) {\r\n    /**\r\n     * Changelog'u güncelle\r\n     * \r\n     * @param string $version Yeni versiyon numarası\r\n     * @param string $title Versiyon başlığı\r\n     * @param array $changes Değişiklikler listesi\r\n     * @param array $files_modified Değiştirilen dosyalar\r\n     * @param bool $db_changes Veritabanı değişikliği var mı?\r\n     * @return bool\r\n     */\r\n    function updateChangelog($version, $title, $changes = [], $files_modified = [], $db_changes = false) {\r\n        $changelog_path = APPPATH . 'config/changelog.json';\r\n        \r\n        try {\r\n            // Mevcut changelog'u oku\r\n            $changelog_data = [];\r\n            if (file_exists($changelog_path)) {\r\n                $changelog_content = file_get_contents($changelog_path);\r\n                $changelog_data = json_decode($changelog_content, true);\r\n                if (json_last_error() !== JSON_ERROR_NONE) {\r\n                    $changelog_data = [];\r\n                }\r\n            }\r\n            \r\n            // Varsayılan yapı oluştur\r\n            if (empty($changelog_data)) {\r\n                $changelog_data = [\r\n                    'app_version' => $version,\r\n                    'last_updated' => date('Y-m-d'),\r\n                    'versions' => [],\r\n                    'change_types' => [\r\n                        'feature' => [\r\n                            'label' => 'Yeni Özellik',\r\n                            'icon' => 'fa-plus-circle',\r\n                            'color' => 'success'\r\n                        ],\r\n                        'bugfix' => [\r\n                            'label' => 'Hata Düzeltme',\r\n                            'icon' => 'fa-bug',\r\n                            'color' => 'warning'\r\n                        ],\r\n                        'improvement' => [\r\n                            'label' => 'İyileştirme',\r\n                            'icon' => 'fa-arrow-up',\r\n                            'color' => 'info'\r\n                        ],\r\n                        'ui' => [\r\n                            'label' => 'Arayüz',\r\n                            'icon' => 'fa-paint-brush',\r\n                            'color' => 'primary'\r\n                        ],\r\n                        'backend' => [\r\n                            'label' => 'Altyapı',\r\n                            'icon' => 'fa-cogs',\r\n                            'color' => 'secondary'\r\n                        ],\r\n                        'security' => [\r\n                            'label' => 'Güvenlik',\r\n                            'icon' => 'fa-shield-alt',\r\n                            'color' => 'danger'\r\n                        ]\r\n                    ]\r\n                ];\r\n            }\r\n            \r\n            // App versiyonunu güncelle\r\n            $changelog_data['app_version'] = $version;\r\n            $changelog_data['last_updated'] = date('Y-m-d');\r\n            \r\n            // Yeni versiyon ekle\r\n            $new_version = [\r\n                'version' => $version,\r\n                'date' => date('Y-m-d'),\r\n                'title' => $title,\r\n                'changes' => $changes,\r\n                'files_modified' => $files_modified,\r\n                'db_changes' => $db_changes\r\n            ];\r\n            \r\n            // Eğer aynı versiyon varsa güncelle, yoksa başa ekle\r\n            $version_found = false;\r\n            foreach ($changelog_data['versions'] as $index => $existing_version) {\r\n                if ($existing_version['version'] === $version) {\r\n                    $changelog_data['versions'][$index] = $new_version;\r\n                    $version_found = true;\r\n                    break;\r\n                }\r\n            }\r\n            \r\n            if (!$version_found) {\r\n                array_unshift($changelog_data['versions'], $new_version);\r\n            }\r\n            \r\n            // JSON dosyasına yaz\r\n            $json_content = json_encode($changelog_data, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);\r\n            $result = file_put_contents($changelog_path, $json_content);\r\n            \r\n            return $result !== false;\r\n            \r\n        } catch (Exception $e) {\r\n            log_message('error', 'Changelog güncellenirken hata oluştu: ' . $e->getMessage());\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\nif (!function_exists('addChangelogEntry')) {\r\n    /**\r\n     * Mevcut versiyona yeni bir değişiklik ekle\r\n     * \r\n     * @param string $type Değişiklik tipi (feature, bugfix, improvement, ui, backend, security)\r\n     * @param string $description Değişiklik açıklaması\r\n     * @param string $details Detaylı açıklama (opsiyonel)\r\n     * @param array $files_modified Değiştirilen dosyalar (opsiyonel)\r\n     * @return bool\r\n     */\r\n    function addChangelogEntry($type, $description, $details = '', $files_modified = []) {\r\n        $changelog_path = APPPATH . 'config/changelog.json';\r\n        \r\n        try {\r\n            if (!file_exists($changelog_path)) {\r\n                return false;\r\n            }\r\n            \r\n            $changelog_content = file_get_contents($changelog_path);\r\n            $changelog_data = json_decode($changelog_content, true);\r\n            \r\n            if (json_last_error() !== JSON_ERROR_NONE || empty($changelog_data['versions'])) {\r\n                return false;\r\n            }\r\n            \r\n            // En son versiyona değişiklik ekle\r\n            $latest_version_index = 0;\r\n            $new_change = [\r\n                'type' => $type,\r\n                'description' => $description\r\n            ];\r\n            \r\n            if (!empty($details)) {\r\n                $new_change['details'] = $details;\r\n            }\r\n            \r\n            // Değişikliği ekle\r\n            $changelog_data['versions'][$latest_version_index]['changes'][] = $new_change;\r\n            \r\n            // Dosya listesini güncelle\r\n            if (!empty($files_modified)) {\r\n                $existing_files = $changelog_data['versions'][$latest_version_index]['files_modified'];\r\n                $merged_files = array_unique(array_merge($existing_files, $files_modified));\r\n                $changelog_data['versions'][$latest_version_index]['files_modified'] = $merged_files;\r\n            }\r\n            \r\n            // Son güncelleme tarihini güncelle\r\n            $changelog_data['last_updated'] = date('Y-m-d');\r\n            \r\n            // JSON dosyasına yaz\r\n            $json_content = json_encode($changelog_data, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);\r\n            $result = file_put_contents($changelog_path, $json_content);\r\n            \r\n            return $result !== false;\r\n            \r\n        } catch (Exception $e) {\r\n            log_message('error', 'Changelog entry eklenirken hata oluştu: ' . $e->getMessage());\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\nif (!function_exists('getCurrentVersion')) {\r\n    /**\r\n     * Mevcut app versiyonunu getir\r\n     * \r\n     * @return string\r\n     */\r\n    function getCurrentVersion() {\r\n        $changelog_path = APPPATH . 'config/changelog.json';\r\n        \r\n        if (!file_exists($changelog_path)) {\r\n            return '1.0.0';\r\n        }\r\n        \r\n        $changelog_content = file_get_contents($changelog_path);\r\n        $changelog_data = json_decode($changelog_content, true);\r\n        \r\n        if (json_last_error() !== JSON_ERROR_NONE || !isset($changelog_data['app_version'])) {\r\n            return '1.0.0';\r\n        }\r\n        \r\n        return $changelog_data['app_version'];\r\n    }\r\n}\r\n\r\nif (!function_exists('incrementVersion')) {\r\n    /**\r\n     * Versiyon numarasını artır\r\n     * \r\n     * @param string $current_version Mevcut versiyon\r\n     * @param string $type major, minor, patch\r\n     * @return string\r\n     */\r\n    function incrementVersion($current_version, $type = 'patch') {\r\n        $version_parts = explode('.', $current_version);\r\n        \r\n        // Eksik kısımları tamamla\r\n        while (count($version_parts) < 3) {\r\n            $version_parts[] = '0';\r\n        }\r\n        \r\n        $major = intval($version_parts[0]);\r\n        $minor = intval($version_parts[1]);\r\n        $patch = intval($version_parts[2]);\r\n        \r\n        switch ($type) {\r\n            case 'major':\r\n                $major++;\r\n                $minor = 0;\r\n                $patch = 0;\r\n                break;\r\n            case 'minor':\r\n                $minor++;\r\n                $patch = 0;\r\n                break;\r\n            case 'patch':\r\n            default:\r\n                $patch++;\r\n                break;\r\n        }\r\n        \r\n        return \"$major.$minor.$patch\";\r\n    }\r\n}\r\n\r\nif (!function_exists('autoUpdateChangelog')) {\r\n    /**\r\n     * Otomatik changelog güncelleyici\r\n     * Bu fonksiyon her dosya değişikliğinde çağrılabilir\r\n     * \r\n     * @param array $changes Yapılan değişiklikler\r\n     * @param array $files Değiştirilen dosyalar\r\n     * @return bool\r\n     */\r\n    function autoUpdateChangelog($changes = [], $files = []) {\r\n        if (empty($changes)) {\r\n            return false;\r\n        }\r\n        \r\n        $current_version = getCurrentVersion();\r\n        $new_version = incrementVersion($current_version, 'patch');\r\n        \r\n        // Başlık otomatik oluştur\r\n        $title = 'Otomatik Güncelleme';\r\n        if (count($changes) === 1) {\r\n            $title = $changes[0]['description'];\r\n        } elseif (count($changes) > 1) {\r\n            $title = count($changes) . ' Değişiklik';\r\n        }\r\n        \r\n        return updateChangelog($new_version, $title, $changes, $files, false);\r\n    }\r\n}\r\n\r\n/* End of file changelog_helper.php */\r\n/* Location: ./application/helpers/changelog_helper.php */"
        }
    ]
}