{
    "sourceFile": "application/views/cari/evrak-goster.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1755511978268,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1755511978268,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n\r\n<html lang=\"tr\">\r\n\r\n<head>\r\n\r\n    <meta charset=\"UTF-8\">\r\n\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n\r\n    <title>Evraklar - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?></title>\r\n\r\n    <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/css/bootstrap.min.css\">\r\n\r\n    <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/plugins/fontawesome/css/fontawesome.min.css\">\r\n\r\n    <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/plugins/fontawesome/css/all.min.css\">\r\n\r\n    <style>\r\n\r\n        body {\r\n\r\n            background-color: #f8f9fa;\r\n\r\n            font-family: Arial, sans-serif;\r\n\r\n        }\r\n\r\n        .header {\r\n\r\n            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\r\n\r\n            color: white;\r\n\r\n            padding: 20px 0;\r\n\r\n            margin-bottom: 20px;\r\n\r\n        }\r\n\r\n        .document-container {\r\n\r\n            background: white;\r\n\r\n            border-radius: 10px;\r\n\r\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\r\n\r\n            margin-bottom: 20px;\r\n\r\n            overflow: hidden;\r\n\r\n        }\r\n\r\n        .document-item {\r\n\r\n            position: relative;\r\n\r\n            border-bottom: 1px solid #eee;\r\n\r\n        }\r\n\r\n        .document-item:last-child {\r\n\r\n            border-bottom: none;\r\n\r\n        }\r\n\r\n        .document-preview {\r\n\r\n            padding: 30px;\r\n\r\n            text-align: center;\r\n\r\n            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\r\n\r\n            min-height: 200px;\r\n\r\n            display: flex;\r\n\r\n            align-items: center;\r\n\r\n            justify-content: center;\r\n\r\n            flex-direction: column;\r\n\r\n        }\r\n\r\n        .document-icon {\r\n\r\n            font-size: 64px;\r\n\r\n            margin-bottom: 15px;\r\n\r\n            opacity: 0.8;\r\n\r\n        }\r\n\r\n        .document-type {\r\n\r\n            font-size: 18px;\r\n\r\n            font-weight: 600;\r\n\r\n            margin-bottom: 5px;\r\n\r\n            text-transform: uppercase;\r\n\r\n        }\r\n\r\n        .document-info {\r\n\r\n            padding: 15px;\r\n\r\n            background: white;\r\n\r\n        }\r\n\r\n        .document-name {\r\n\r\n            font-weight: 600;\r\n\r\n            color: #333;\r\n\r\n            margin-bottom: 5px;\r\n\r\n            word-break: break-all;\r\n\r\n        }\r\n\r\n        .document-actions {\r\n\r\n            margin-top: 10px;\r\n\r\n        }\r\n\r\n        .btn-delete {\r\n\r\n            background: #dc3545;\r\n\r\n            border: none;\r\n\r\n            color: white;\r\n\r\n            padding: 5px 15px;\r\n\r\n            border-radius: 5px;\r\n\r\n            font-size: 12px;\r\n\r\n        }\r\n\r\n        .btn-delete:hover {\r\n\r\n            background: #c82333;\r\n\r\n            color: white;\r\n\r\n        }\r\n\r\n        .no-documents {\r\n\r\n            text-align: center;\r\n\r\n            padding: 60px 20px;\r\n\r\n            color: #666;\r\n\r\n        }\r\n\r\n        .no-documents i {\r\n\r\n            font-size: 48px;\r\n\r\n            margin-bottom: 15px;\r\n\r\n            color: #ccc;\r\n\r\n        }\r\n\r\n        .pdf-icon { color: #dc3545; }\r\n\r\n        .word-icon { color: #007bff; }\r\n\r\n        .excel-icon { color: #28a745; }\r\n\r\n        .powerpoint-icon { color: #fd7e14; }\r\n\r\n        .image-icon { color: #20c997; }\r\n\r\n        .archive-icon { color: #6f42c1; }\r\n\r\n        .text-icon { color: #6c757d; }\r\n\r\n        .default-icon { color: #6c757d; }\r\n        \r\n        /* Görsel önizleme stilleri */\r\n        .image-preview {\r\n            background: white;\r\n            border-radius: 8px;\r\n            overflow: hidden;\r\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n        }\r\n        \r\n        .image-thumbnail {\r\n            width: 100%;\r\n            height: 200px;\r\n            object-fit: cover;\r\n            cursor: pointer;\r\n            transition: transform 0.3s ease;\r\n        }\r\n        \r\n        .image-thumbnail:hover {\r\n            transform: scale(1.05);\r\n        }\r\n        \r\n        .image-overlay {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: linear-gradient(45deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));\r\n            opacity: 0;\r\n            transition: opacity 0.3s ease;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            color: white;\r\n            font-size: 24px;\r\n        }\r\n        \r\n        .image-preview:hover .image-overlay {\r\n            opacity: 1;\r\n        }\r\n        \r\n        /* Modal stilleri */\r\n        .modal-img {\r\n            max-width: 100%;\r\n            max-height: 80vh;\r\n            margin: 0 auto;\r\n            display: block;\r\n        }\r\n\r\n    </style>\r\n\r\n</head>\r\n\r\n<body>\r\n\r\n    <div class=\"header\">\r\n\r\n        <div class=\"container\">\r\n\r\n            <h4 class=\"mb-0\">\r\n\r\n                <i class=\"fa fa-file mr-2\"></i>\r\n\r\n                Evraklar - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?>\r\n\r\n            </h4>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n\r\n\r\n    <div class=\"container\">\r\n\r\n        <?php if (!empty($cari->evrak_dosya)): ?>\r\n\r\n            <?php \r\n\r\n            $evraklar = explode(',', $cari->evrak_dosya);\r\n\r\n            foreach ($evraklar as $index => $evrak): \r\n\r\n                $trimmed_evrak = trim($evrak);\r\n\r\n                if (empty($trimmed_evrak)) continue;\r\n\r\n                \r\n\r\n                $file_name = pathinfo($trimmed_evrak, PATHINFO_BASENAME);\r\n\r\n                $clean_name = preg_replace('/^[^_]*_/', '', $file_name); // Prefix'i kaldır\r\n\r\n                $file_extension = strtolower(pathinfo($clean_name, PATHINFO_EXTENSION));\r\n\r\n                $document_url = base_url('assets/uploads/' . $trimmed_evrak);\r\n\r\n                \r\n\r\n                // Dosya tipine göre ikon, renk ve açıklama belirle\r\n\r\n                $icon = 'fa-file';\r\n\r\n                $icon_class = 'default-icon';\r\n\r\n                $type_name = 'Dosya';\r\n\r\n                \r\n\r\n                if (in_array($file_extension, ['pdf'])) {\r\n\r\n                    $icon = 'fa-file-pdf';\r\n\r\n                    $icon_class = 'pdf-icon';\r\n\r\n                    $type_name = 'PDF Belgesi';\r\n\r\n                } elseif (in_array($file_extension, ['doc', 'docx'])) {\r\n\r\n                    $icon = 'fa-file-word';\r\n\r\n                    $icon_class = 'word-icon';\r\n\r\n                    $type_name = 'Word Belgesi';\r\n\r\n                } elseif (in_array($file_extension, ['xls', 'xlsx'])) {\r\n\r\n                    $icon = 'fa-file-excel';\r\n\r\n                    $icon_class = 'excel-icon';\r\n\r\n                    $type_name = 'Excel Belgesi';\r\n\r\n                } elseif (in_array($file_extension, ['ppt', 'pptx'])) {\r\n\r\n                    $icon = 'fa-file-powerpoint';\r\n\r\n                    $icon_class = 'powerpoint-icon';\r\n\r\n                    $type_name = 'PowerPoint Belgesi';\r\n\r\n                } elseif (in_array($file_extension, ['jpg', 'jpeg', 'png', 'gif', 'bmp'])) {\r\n\r\n                    $icon = 'fa-file-image';\r\n\r\n                    $icon_class = 'image-icon';\r\n\r\n                    $type_name = 'Görsel Dosyası';\r\n\r\n                } elseif (in_array($file_extension, ['zip', 'rar', '7z'])) {\r\n\r\n                    $icon = 'fa-file-archive';\r\n\r\n                    $icon_class = 'archive-icon';\r\n\r\n                    $type_name = 'Arşiv Dosyası';\r\n\r\n                } elseif (in_array($file_extension, ['txt'])) {\r\n\r\n                    $icon = 'fa-file-alt';\r\n\r\n                    $icon_class = 'text-icon';\r\n\r\n                    $type_name = 'Metin Dosyası';\r\n\r\n                }\r\n\r\n            ?>\r\n\r\n                <div class=\"document-container\">\r\n\r\n                    <div class=\"document-item\">\r\n\r\n                        <div class=\"document-preview\">\r\n                            <?php if (in_array($file_extension, ['jpg', 'jpeg', 'png', 'gif', 'bmp'])): ?>\r\n                                <!-- Görsel dosyalar için thumbnail önizleme -->\r\n                                <div class=\"image-preview\" style=\"position: relative; width: 100%; height: 200px;\">\r\n                                    <img src=\"<?= $document_url ?>\" \r\n                                         alt=\"<?= $clean_name ?>\" \r\n                                         class=\"image-thumbnail\"\r\n                                         onclick=\"showImageModal('<?= $document_url ?>', '<?= htmlspecialchars($clean_name) ?>')\"\r\n                                         onerror=\"this.style.display='none'; this.nextElementSibling.style.display='flex';\">\r\n                                    <div class=\"image-overlay\">\r\n                                        <i class=\"fa fa-search-plus\"></i>\r\n                                    </div>\r\n                                    <!-- Fallback icon if image fails to load -->\r\n                                    <div style=\"display: none; width: 100%; height: 200px; align-items: center; justify-content: center; flex-direction: column;\">\r\n                                        <div class=\"document-icon <?= $icon_class ?>\">\r\n                                            <i class=\"fa <?= $icon ?>\"></i>\r\n                                        </div>\r\n                                        <div class=\"document-type <?= $icon_class ?>\"><?= $type_name ?></div>\r\n                                    </div>\r\n                                </div>\r\n                            <?php else: ?>\r\n                                <!-- Diğer dosya türleri için eski görünüm -->\r\n                                <div class=\"document-icon <?= $icon_class ?>\">\r\n\r\n                                    <i class=\"fa <?= $icon ?>\"></i>\r\n\r\n                                </div>\r\n\r\n                                <div class=\"document-type <?= $icon_class ?>\"><?= $type_name ?></div>\r\n                            <?php endif; ?>\r\n\r\n                        </div>\r\n\r\n                        <div class=\"document-info\">\r\n\r\n                            <div class=\"document-name\"><?= $clean_name ?></div>\r\n\r\n                            <div class=\"document-actions\">\r\n\r\n                                <a href=\"<?= $document_url ?>\" target=\"_blank\" class=\"btn btn-primary btn-sm\">\r\n\r\n                                    <i class=\"fa fa-external-link-alt\"></i> Aç\r\n\r\n                                </a>\r\n\r\n                                <a href=\"<?= $document_url ?>\" download class=\"btn btn-success btn-sm ml-2\">\r\n\r\n                                    <i class=\"fa fa-download\"></i> İndir\r\n\r\n                                </a>\r\n\r\n                                <?php if ($is_admin): ?>\r\n\r\n                                    <button type=\"button\" class=\"btn btn-delete btn-sm ml-2\" \r\n\r\n                                            onclick=\"silEvrak('<?= $cari_id ?>', '<?= $trimmed_evrak ?>', this)\">\r\n\r\n                                        <i class=\"fa fa-trash\"></i> Sil\r\n\r\n                                    </button>\r\n\r\n                                <?php endif; ?>\r\n\r\n                            </div>\r\n\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                </div>\r\n\r\n            <?php endforeach; ?>\r\n\r\n        <?php else: ?>\r\n\r\n            <div class=\"document-container\">\r\n\r\n                <div class=\"no-documents\">\r\n\r\n                    <i class=\"fa fa-file\"></i>\r\n\r\n                    <h5>Evrak Bulunamadı</h5>\r\n\r\n                    <p class=\"text-muted\">Bu cari için henüz evrak yüklenmemiş.</p>\r\n\r\n                </div>\r\n\r\n            </div>\r\n\r\n        <?php endif; ?>\r\n\r\n    </div>\r\n\r\n    <!-- Görsel Modal -->\r\n    <div class=\"modal fade\" id=\"imageModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"imageModalLabel\" aria-hidden=\"true\">\r\n        <div class=\"modal-dialog modal-lg\" role=\"document\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <h5 class=\"modal-title\" id=\"imageModalLabel\">Görsel Önizleme</h5>\r\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                        <span aria-hidden=\"true\">&times;</span>\r\n                    </button>\r\n                </div>\r\n                <div class=\"modal-body text-center\">\r\n                    <img id=\"modalImage\" src=\"\" alt=\"Görsel\" class=\"modal-img\">\r\n                </div>\r\n                <div class=\"modal-footer\">\r\n                    <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Kapat</button>\r\n                    <a id=\"downloadLink\" href=\"\" class=\"btn btn-primary\" target=\"_blank\" download>\r\n                        <i class=\"fa fa-download\"></i> İndir\r\n                    </a>\r\n                    <a id=\"openLink\" href=\"\" class=\"btn btn-success\" target=\"_blank\">\r\n                        <i class=\"fa fa-external-link-alt\"></i> Yeni Sekmede Aç\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n\r\n    <script src=\"<?= base_url(); ?>assets/js/jquery-3.2.1.min.js\"></script>\r\n\r\n    <script src=\"<?= base_url(); ?>assets/js/bootstrap.bundle.min.js\"></script>\r\n\r\n    <script src=\"<?= base_url(); ?>assets/plugins/sweetalert/sweetalert.min.js\"></script>\r\n\r\n    \r\n\r\n    <script>\r\n\r\n    var baseUrl = '<?= base_url(); ?>';\r\n\r\n    \r\n\r\n    // Görsel modal fonksiyonu\r\n    function showImageModal(imageSrc, title) {\r\n        $('#imageModalLabel').text(title);\r\n        $('#modalImage').attr('src', imageSrc);\r\n        $('#downloadLink').attr('href', imageSrc);\r\n        $('#openLink').attr('href', imageSrc);\r\n        $('#imageModal').modal('show');\r\n    }\r\n\r\n    \r\n\r\n    function silEvrak(cariId, dosyaAdi, button) {\r\n\r\n        if (confirm('Bu evrakı silmek istediğinizden emin misiniz?\\n\\nDosya: ' + dosyaAdi.split('/').pop())) {\r\n\r\n            // Butonu devre dışı bırak\r\n\r\n            $(button).prop('disabled', true).html('<i class=\"fa fa-spinner fa-spin\"></i> Siliniyor...');\r\n\r\n            \r\n\r\n            $.ajax({\r\n\r\n                url: baseUrl + 'cari/evrakSil',\r\n\r\n                type: 'POST',\r\n\r\n                data: {\r\n\r\n                    cari_id: cariId,\r\n\r\n                    dosya_adi: dosyaAdi\r\n\r\n                },\r\n\r\n                success: function(response) {\r\n\r\n                    try {\r\n\r\n                        var result = JSON.parse(response);\r\n\r\n                        if (result.success) {\r\n\r\n                            // Evrakı sayfadan kaldır\r\n\r\n                            $(button).closest('.document-item').fadeOut(300, function() {\r\n\r\n                                $(this).remove();\r\n\r\n                                \r\n\r\n                                // Eğer hiç evrak kalmadıysa sayfayı yenile\r\n\r\n                                if ($('.document-item').length === 0) {\r\n\r\n                                    location.reload();\r\n\r\n                                }\r\n\r\n                            });\r\n\r\n                            \r\n\r\n                            swal({\r\n\r\n                                title: \"Başarılı\",\r\n\r\n                                text: \"Evrak başarıyla silindi.\",\r\n\r\n                                type: \"success\",\r\n\r\n                                timer: 2000,\r\n\r\n                                showConfirmButton: false\r\n\r\n                            });\r\n\r\n                        } else {\r\n\r\n                            alert('Hata: ' + (result.message || 'Evrak silinemedi'));\r\n\r\n                            $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n\r\n                        }\r\n\r\n                    } catch (e) {\r\n\r\n                        alert('Beklenmeyen bir hata oluştu');\r\n\r\n                        $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n\r\n                    }\r\n\r\n                },\r\n\r\n                error: function() {\r\n\r\n                    alert('Sunucu hatası oluştu');\r\n\r\n                    $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n\r\n                }\r\n\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n    </script>\r\n\r\n</body>\r\n\r\n</html>\r\n\r\n"
        }
    ]
}