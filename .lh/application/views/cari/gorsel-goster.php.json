{
    "sourceFile": "application/views/cari/gorsel-goster.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1755268348301,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755274331089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,17 @@\n     <meta charset=\"UTF-8\">\r\n \r\n     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n \r\n-    <title>Görseller - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?></title>\r\n+    <title><?php \r\n+        switch($tip) {\r\n+            case 'satis': echo 'Satış Görselleri'; break;\r\n+            case 'banka': echo 'Banka Hareketi Görselleri'; break;\r\n+            case 'cek': echo 'Çek Görselleri'; break;\r\n+            case 'senet': echo 'Senet Görselleri'; break;\r\n+            default: echo 'İşletme Görselleri'; break;\r\n+        }\r\n+    ?> - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?></title>\r\n \r\n     <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/css/bootstrap.min.css\">\r\n \r\n     <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/plugins/fontawesome/css/fontawesome.min.css\">\r\n@@ -159,13 +167,27 @@\n             <h4 class=\"mb-0\">\r\n \r\n                 <i class=\"fa fa-images mr-2\"></i>\r\n \r\n-                <?php if (isset($tip) && $tip == 'satis'): ?>\r\n-                    Satış Görselleri - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?>\r\n-                <?php else: ?>\r\n-                    İşletme Görselleri - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?>\r\n-                <?php endif; ?>\r\n+                <?php \r\n+                switch($tip ?? 'cari') {\r\n+                    case 'satis': \r\n+                        echo 'Satış Görselleri'; \r\n+                        break;\r\n+                    case 'banka': \r\n+                        echo 'Banka Hareketi Görselleri'; \r\n+                        break;\r\n+                    case 'cek': \r\n+                        echo 'Çek Görselleri'; \r\n+                        break;\r\n+                    case 'senet': \r\n+                        echo 'Senet Görselleri'; \r\n+                        break;\r\n+                    default: \r\n+                        echo 'İşletme Görselleri'; \r\n+                        break;\r\n+                }\r\n+                ?> - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?>\r\n \r\n             </h4>\r\n \r\n         </div>\r\n"
                },
                {
                    "date": 1755274570054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -219,9 +219,26 @@\n                 $file_name = pathinfo($trimmed_fotograf, PATHINFO_BASENAME);\r\n \r\n                 $clean_name = preg_replace('/^[^_]*_/', '', $file_name); // Prefix'i kaldır\r\n \r\n-                $image_url = base_url('assets/uploads/' . $trimmed_fotograf);\r\n+                // Tip için doğru klasör yolunu belirle\r\n+                $folder_path = 'assets/uploads/';\r\n+                switch($tip ?? 'cari') {\r\n+                    case 'senet':\r\n+                        $folder_path = 'assets/uploads/senetler/';\r\n+                        break;\r\n+                    case 'banka':\r\n+                        $folder_path = 'assets/uploads/dekontlar/';\r\n+                        break;\r\n+                    case 'cek':\r\n+                        $folder_path = 'assets/uploads/cekler/';\r\n+                        break;\r\n+                    default:\r\n+                        $folder_path = 'assets/uploads/';\r\n+                        break;\r\n+                }\r\n+                \r\n+                $image_url = base_url($folder_path . $trimmed_fotograf);\r\n \r\n             ?>\r\n \r\n                 <div class=\"image-container\">\r\n"
                },
                {
                    "date": 1755274767384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,13 +146,34 @@\n \r\n         .no-images i {\r\n \r\n             font-size: 48px;\r\n+        }\r\n+        \r\n+        .pdf-preview {\r\n+            text-align: center;\r\n+            padding: 40px 20px;\r\n+            background: #f8f9fa;\r\n+            border: 2px dashed #dee2e6;\r\n+            border-radius: 8px;\r\n+            min-height: 200px;\r\n+            display: flex;\r\n+            flex-direction: column;\r\n+            justify-content: center;\r\n+            align-items: center;\r\n+        }\r\n+        \r\n+        .pdf-preview p {\r\n+            margin: 0;\r\n+            color: #666;\r\n+            font-size: 14px;\r\n+        }\r\n \r\n+        \r\n+        .pdf-preview i {\r\n+            font-size: 48px;\r\n             margin-bottom: 15px;\r\n-\r\n             color: #ccc;\r\n-\r\n         }\r\n \r\n     </style>\r\n \r\n@@ -237,17 +258,30 @@\n                         break;\r\n                 }\r\n                 \r\n                 $image_url = base_url($folder_path . $trimmed_fotograf);\r\n+                \r\n+                // Dosya uzantısını kontrol et\r\n+                $file_extension = strtolower(pathinfo($trimmed_fotograf, PATHINFO_EXTENSION));\r\n+                $is_pdf = ($file_extension === 'pdf');\r\n \r\n             ?>\r\n \r\n                 <div class=\"image-container\">\r\n \r\n                     <div class=\"image-item\">\r\n+                        \r\n+                        <?php if ($is_pdf): ?>\r\n+                            <!-- PDF dosyaları için özel gösterim -->\r\n+                            <div class=\"pdf-preview\">\r\n+                                <i class=\"fa fa-file-pdf-o\" style=\"font-size: 4rem; color: #dc3545;\"></i>\r\n+                                <p class=\"mt-2\"><strong>PDF Dosyası</strong></p>\r\n+                            </div>\r\n+                        <?php else: ?>\r\n+                            <!-- Normal görsel dosyaları için önizleme -->\r\n+                            <img src=\"<?= $image_url ?>\" alt=\"Görsel <?= $index + 1 ?>\" class=\"image-preview\">\r\n+                        <?php endif; ?>\r\n \r\n-                        <img src=\"<?= $image_url ?>\" alt=\"Görsel <?= $index + 1 ?>\" class=\"image-preview\">\r\n-\r\n                         <div class=\"image-info\">\r\n \r\n                             <div class=\"image-name\"><?= $clean_name ?></div>\r\n \r\n"
                },
                {
                    "date": 1756915659136,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -240,27 +240,36 @@\n                 $file_name = pathinfo($trimmed_fotograf, PATHINFO_BASENAME);\r\n \r\n                 $clean_name = preg_replace('/^[^_]*_/', '', $file_name); // Prefix'i kaldır\r\n \r\n-                // Tip için doğru klasör yolunu belirle\r\n-                $folder_path = 'assets/uploads/';\r\n-                switch($tip ?? 'cari') {\r\n-                    case 'senet':\r\n-                        $folder_path = 'assets/uploads/senetler/';\r\n-                        break;\r\n-                    case 'banka':\r\n-                        $folder_path = 'assets/uploads/dekontlar/';\r\n-                        break;\r\n-                    case 'cek':\r\n-                        $folder_path = 'assets/uploads/cekler/';\r\n-                        break;\r\n-                    default:\r\n-                        $folder_path = 'assets/uploads/';\r\n-                        break;\r\n+                // Dosya yolu kontrolü - eğer klasör yolu zaten varsa kullan, yoksa tip'e göre ekle\r\n+                if (strpos($trimmed_fotograf, '/') !== false) {\r\n+                    // Dosya yolu zaten klasör içeriyor (örn: faturalar/dosya.jpg)\r\n+                    $image_url = base_url('assets/uploads/' . $trimmed_fotograf);\r\n+                } else {\r\n+                    // Tip için doğru klasör yolunu belirle (eski format)\r\n+                    $folder_path = 'assets/uploads/';\r\n+                    switch($tip ?? 'cari') {\r\n+                        case 'satis':\r\n+                            $folder_path = 'assets/uploads/faturalar/';\r\n+                            break;\r\n+                        case 'senet':\r\n+                            $folder_path = 'assets/uploads/senetler/';\r\n+                            break;\r\n+                        case 'banka':\r\n+                            $folder_path = 'assets/uploads/dekontlar/';\r\n+                            break;\r\n+                        case 'cek':\r\n+                            $folder_path = 'assets/uploads/cekler/';\r\n+                            break;\r\n+                        default:\r\n+                            $folder_path = 'assets/uploads/';\r\n+                            break;\r\n+                    }\r\n+                    \r\n+                    $image_url = base_url($folder_path . $trimmed_fotograf);\r\n                 }\r\n                 \r\n-                $image_url = base_url($folder_path . $trimmed_fotograf);\r\n-                \r\n                 // Dosya uzantısını kontrol et\r\n                 $file_extension = strtolower(pathinfo($trimmed_fotograf, PATHINFO_EXTENSION));\r\n                 $is_pdf = ($file_extension === 'pdf');\r\n \r\n@@ -330,128 +339,290 @@\n                     <i class=\"fa fa-images\"></i>\r\n \r\n                     <h5>Görsel Bulunamadı</h5>\r\n \r\n-                    <p class=\"text-muted\">Bu cari için henüz görsel yüklenmemiş.</p>\r\n+                    <p class=\"text-muted\">Bu <?php \r\n+                        switch($tip ?? 'cari') {\r\n+                            case 'satis': echo 'satış'; break;\r\n+                            case 'banka': echo 'banka hareketi'; break;\r\n+                            case 'cek': echo 'çek'; break;\r\n+                            case 'senet': echo 'senet'; break;\r\n+                            default: echo 'cari'; break;\r\n+                        }\r\n+                    ?> için henüz görsel yüklenmemiş.</p>\r\n \r\n                 </div>\r\n \r\n             </div>\r\n \r\n         <?php endif; ?>\r\n \r\n+        <!-- Dosya Yükleme Alanı -->\r\n+        <?php if ($is_admin): ?>\r\n+            <div class=\"image-container mt-4\">\r\n+                <div class=\"p-4\">\r\n+                    <h5><i class=\"fa fa-cloud-upload-alt mr-2\"></i>Yeni Görsel Yükle</h5>\r\n+                    <form id=\"uploadForm\" enctype=\"multipart/form-data\" class=\"mt-3\">\r\n+                        <input type=\"hidden\" name=\"cari_id\" value=\"<?= $cari_id ?>\">\r\n+                        <input type=\"hidden\" name=\"tip\" value=\"<?= $tip ?? 'cari' ?>\">\r\n+                        <?php if (isset($satis_id)): ?>\r\n+                            <input type=\"hidden\" name=\"satis_id\" value=\"<?= $satis_id ?>\">\r\n+                        <?php endif; ?>\r\n+                        \r\n+                        <div class=\"form-group\">\r\n+                            <label>Dosya Seçin <small class=\"text-muted\">(JPG, JPEG, PNG, PDF - Max: 10MB)</small></label>\r\n+                            <input type=\"file\" class=\"form-control-file\" name=\"gorsel_dosyalar[]\" id=\"gorselDosyalar\" \r\n+                                   multiple accept=\".jpg,.jpeg,.png,.pdf\">\r\n+                            <small class=\"form-text text-muted\">\r\n+                                <i class=\"fa fa-info-circle\"></i> Birden fazla dosya seçebilirsiniz.\r\n+                            </small>\r\n+                            <div id=\"selectedFiles\" class=\"mt-2\"></div>\r\n+                        </div>\r\n+                        \r\n+                        <button type=\"submit\" class=\"btn btn-primary\" id=\"uploadBtn\">\r\n+                            <i class=\"fa fa-upload\"></i> Yükle\r\n+                        </button>\r\n+                        <div id=\"uploadProgress\" class=\"mt-2\" style=\"display: none;\">\r\n+                            <div class=\"progress\">\r\n+                                <div class=\"progress-bar progress-bar-striped progress-bar-animated\" \r\n+                                     role=\"progressbar\" style=\"width: 0%\"></div>\r\n+                            </div>\r\n+                        </div>\r\n+                    </form>\r\n+                </div>\r\n+            </div>\r\n+        <?php endif; ?>\r\n+\r\n     </div>\r\n \r\n \r\n \r\n-    <script src=\"<?= base_url(); ?>assets/js/jquery-3.2.1.min.js\"></script>\r\n+    <script src=\"<?= base_url(); ?>assets/js/jquery-3.5.1.min.js\"></script>\r\n \r\n     <script src=\"<?= base_url(); ?>assets/js/bootstrap.bundle.min.js\"></script>\r\n \r\n-    <script src=\"<?= base_url(); ?>assets/plugins/sweetalert/sweetalert.min.js\"></script>\r\n-\r\n     \r\n \r\n     <script>\r\n \r\n     var baseUrl = '<?= base_url(); ?>';\r\n \r\n     \r\n \r\n-    function silGorsel(cariId, dosyaAdi, button) {\r\n+    // jQuery yüklü mü kontrol et\r\n+    if (typeof $ !== 'undefined') {\r\n+        $(document).ready(function() {\r\n+            console.log('jQuery loaded successfully');\r\n+            \r\n+            // Dosya seçimi event'i\r\n+            $('#gorselDosyalar').on('change', function() {\r\n+                showSelectedFiles();\r\n+            });\r\n \r\n-        if (confirm('Bu görseli silmek istediğinizden emin misiniz?\\n\\nDosya: ' + dosyaAdi.split('/').pop())) {\r\n+            // Form submit event'i\r\n+            $('#uploadForm').on('submit', function(e) {\r\n+                e.preventDefault();\r\n+                uploadFiles();\r\n+            });\r\n+        });\r\n+    } else {\r\n+        // jQuery yoksa vanilla JavaScript ile event'leri ekle\r\n+        document.addEventListener('DOMContentLoaded', function() {\r\n+            console.log('Using vanilla JavaScript events');\r\n+            \r\n+            var fileInput = document.getElementById('gorselDosyalar');\r\n+            var form = document.getElementById('uploadForm');\r\n+            \r\n+            if (fileInput) {\r\n+                fileInput.addEventListener('change', showSelectedFiles);\r\n+            }\r\n+            \r\n+            if (form) {\r\n+                form.addEventListener('submit', function(e) {\r\n+                    e.preventDefault();\r\n+                    uploadFiles();\r\n+                });\r\n+            }\r\n+        });\r\n+    }\r\n \r\n-            // Butonu devre dışı bırak\r\n-\r\n-            $(button).prop('disabled', true).html('<i class=\"fa fa-spinner fa-spin\"></i> Siliniyor...');\r\n-\r\n+    // Seçilen dosyaları göster\r\n+    function showSelectedFiles() {\r\n+        const fileInput = document.getElementById('gorselDosyalar');\r\n+        const selectedFilesDiv = document.getElementById('selectedFiles');\r\n+        \r\n+        if (fileInput.files.length === 0) {\r\n+            selectedFilesDiv.innerHTML = '';\r\n+            return;\r\n+        }\r\n+        \r\n+        let html = '<div class=\"selected-files-list\">';\r\n+        html += '<strong>Seçilen Dosyalar:</strong>';\r\n+        html += '<div class=\"list-group mt-2\">';\r\n+        \r\n+        for (let i = 0; i < fileInput.files.length; i++) {\r\n+            const file = fileInput.files[i];\r\n+            const fileSize = (file.size / 1024 / 1024).toFixed(2); // MB\r\n+            const fileIcon = getFileIcon(file.name);\r\n             \r\n+            html += `<div class=\"list-group-item d-flex justify-content-between align-items-center\">\r\n+                <div>\r\n+                    <i class=\"fa ${fileIcon} mr-2\"></i>\r\n+                    <strong>${file.name}</strong>\r\n+                    <small class=\"text-muted\"> (${fileSize} MB)</small>\r\n+                </div>\r\n+                <button type=\"button\" class=\"btn btn-sm btn-outline-danger\" onclick=\"removeFile(${i})\">\r\n+                    <i class=\"fa fa-trash\"></i>\r\n+                </button>\r\n+            </div>`;\r\n+        }\r\n+        \r\n+        html += '</div></div>';\r\n+        selectedFilesDiv.innerHTML = html;\r\n+    }\r\n \r\n-            $.ajax({\r\n+    // Dosya ikonu belirleme\r\n+    function getFileIcon(fileName) {\r\n+        const extension = fileName.split('.').pop().toLowerCase();\r\n+        \r\n+        switch (extension) {\r\n+            case 'pdf': return 'fa-file-pdf text-danger';\r\n+            case 'jpg':\r\n+            case 'jpeg':\r\n+            case 'png': return 'fa-file-image text-success';\r\n+            default: return 'fa-file text-secondary';\r\n+        }\r\n+    }\r\n \r\n-                url: baseUrl + 'cari/gorselSil',\r\n+    // Dosya silme (listeden)\r\n+    function removeFile(index) {\r\n+        const fileInput = document.getElementById('gorselDosyalar');\r\n+        const dt = new DataTransfer();\r\n+        \r\n+        for (let i = 0; i < fileInput.files.length; i++) {\r\n+            if (i !== index) {\r\n+                dt.items.add(fileInput.files[i]);\r\n+            }\r\n+        }\r\n+        \r\n+        fileInput.files = dt.files;\r\n+        showSelectedFiles();\r\n+    }\r\n \r\n-                type: 'POST',\r\n+    // Dosya yükleme\r\n+    function uploadFiles() {\r\n+        const fileInput = document.getElementById('gorselDosyalar');\r\n+        const uploadBtn = document.getElementById('uploadBtn');\r\n+        const progressDiv = document.getElementById('uploadProgress');\r\n+        const progressBar = progressDiv.querySelector('.progress-bar');\r\n \r\n-                data: {\r\n+        if (fileInput.files.length === 0) {\r\n+            alert('Lütfen en az bir dosya seçin.');\r\n+            return;\r\n+        }\r\n \r\n-                    cari_id: cariId,\r\n+        const formData = new FormData(document.getElementById('uploadForm'));\r\n \r\n-                    dosya_adi: dosyaAdi\r\n+        // UI'yi güncelle\r\n+        uploadBtn.disabled = true;\r\n+        uploadBtn.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Yükleniyor...';\r\n+        progressDiv.style.display = 'block';\r\n \r\n-                },\r\n+        // jQuery kullanmadan vanilla JavaScript ile Ajax\r\n+        var xhr = new XMLHttpRequest();\r\n+        \r\n+        xhr.upload.addEventListener('progress', function(e) {\r\n+            if (e.lengthComputable) {\r\n+                const percentComplete = (e.loaded / e.total) * 100;\r\n+                progressBar.style.width = percentComplete + '%';\r\n+            }\r\n+        });\r\n \r\n-                success: function(response) {\r\n+        xhr.onreadystatechange = function() {\r\n+            if (xhr.readyState === 4) {\r\n+                // UI'yi resetle\r\n+                uploadBtn.disabled = false;\r\n+                uploadBtn.innerHTML = '<i class=\"fa fa-upload\"></i> Yükle';\r\n+                progressDiv.style.display = 'none';\r\n+                progressBar.style.width = '0%';\r\n \r\n+                if (xhr.status === 200) {\r\n                     try {\r\n-\r\n-                        var result = JSON.parse(response);\r\n-\r\n+                        const result = JSON.parse(xhr.responseText);\r\n                         if (result.success) {\r\n-\r\n-                            // Görseli sayfadan kaldır\r\n-\r\n-                            $(button).closest('.image-container').fadeOut(300, function() {\r\n-\r\n-                                $(this).remove();\r\n-\r\n-                                \r\n-\r\n-                                // Eğer hiç görsel kalmadıysa sayfayı yenile\r\n-\r\n-                                if ($('.image-container').length === 0) {\r\n-\r\n-                                    location.reload();\r\n-\r\n-                                }\r\n-\r\n-                            });\r\n-\r\n-                            \r\n-\r\n-                            swal({\r\n-\r\n-                                title: \"Başarılı\",\r\n-\r\n-                                text: \"Görsel başarıyla silindi.\",\r\n-\r\n-                                type: \"success\",\r\n-\r\n-                                timer: 2000,\r\n-\r\n-                                showConfirmButton: false\r\n-\r\n-                            });\r\n-\r\n+                            alert(\"Başarılı: \" + (result.message || \"Dosyalar başarıyla yüklendi.\"));\r\n+                            setTimeout(function() {\r\n+                                location.reload(); // Sayfayı yenile\r\n+                            }, 1000);\r\n                         } else {\r\n-\r\n-                            alert('Hata: ' + (result.message || 'Görsel silinemedi'));\r\n-\r\n-                            $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n-\r\n+                            alert('Hata: ' + (result.message || 'Dosyalar yüklenemedi'));\r\n                         }\r\n-\r\n                     } catch (e) {\r\n-\r\n                         alert('Beklenmeyen bir hata oluştu');\r\n-\r\n-                        $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n-\r\n+                        console.error('JSON Parse Error:', e);\r\n                     }\r\n+                } else {\r\n+                    alert('Sunucu hatası oluştu (Status: ' + xhr.status + ')');\r\n+                }\r\n+            }\r\n+        };\r\n \r\n-                },\r\n+        xhr.open('POST', baseUrl + 'cari/gorselYukle');\r\n+        xhr.send(formData);\r\n+    }\r\n+    \r\n+    function silGorsel(cariId, dosyaAdi, button) {\r\n \r\n-                error: function() {\r\n+        if (confirm('Bu görseli silmek istediğinizden emin misiniz?\\n\\nDosya: ' + dosyaAdi.split('/').pop())) {\r\n \r\n-                    alert('Sunucu hatası oluştu');\r\n+            // Butonu devre dışı bırak\r\n+            button.disabled = true;\r\n+            button.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Siliniyor...';\r\n \r\n-                    $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n+            // Vanilla JavaScript Ajax\r\n+            var xhr = new XMLHttpRequest();\r\n+            xhr.onreadystatechange = function() {\r\n+                if (xhr.readyState === 4) {\r\n+                    if (xhr.status === 200) {\r\n+                        try {\r\n+                            var result = JSON.parse(xhr.responseText);\r\n+                            if (result.success) {\r\n+                                // Görseli sayfadan kaldır\r\n+                                var container = button.closest('.image-container');\r\n+                                container.style.transition = 'opacity 0.3s';\r\n+                                container.style.opacity = '0';\r\n+                                \r\n+                                setTimeout(function() {\r\n+                                    container.remove();\r\n+                                    \r\n+                                    // Eğer hiç görsel kalmadıysa sayfayı yenile\r\n+                                    if (document.querySelectorAll('.image-container').length === 0) {\r\n+                                        location.reload();\r\n+                                    }\r\n+                                }, 300);\r\n \r\n+                                alert(\"Başarılı: Görsel başarıyla silindi.\");\r\n+                            } else {\r\n+                                alert('Hata: ' + (result.message || 'Görsel silinemedi'));\r\n+                                button.disabled = false;\r\n+                                button.innerHTML = '<i class=\"fa fa-trash\"></i> Sil';\r\n+                            }\r\n+                        } catch (e) {\r\n+                            alert('Beklenmeyen bir hata oluştu');\r\n+                            button.disabled = false;\r\n+                            button.innerHTML = '<i class=\"fa fa-trash\"></i> Sil';\r\n+                        }\r\n+                    } else {\r\n+                        alert('Sunucu hatası oluştu (Status: ' + xhr.status + ')');\r\n+                        button.disabled = false;\r\n+                        button.innerHTML = '<i class=\"fa fa-trash\"></i> Sil';\r\n+                    }\r\n                 }\r\n+            };\r\n \r\n-            });\r\n-\r\n+            xhr.open('POST', baseUrl + 'cari/gorselSil');\r\n+            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n+            xhr.send('cari_id=' + encodeURIComponent(cariId) + '&dosya_adi=' + encodeURIComponent(dosyaAdi));\r\n         }\r\n \r\n     }\r\n \r\n"
                },
                {
                    "date": 1758013383911,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -307,9 +307,9 @@\n                                     <i class=\"fa fa-download\"></i> İndir\r\n \r\n                                 </a>\r\n \r\n-                                <?php if ($is_admin): ?>\r\n+                                <?php if ($is_admin && ($tip ?? 'cari') !== 'banka'): ?>\r\n \r\n                                     <button type=\"button\" class=\"btn btn-delete btn-sm ml-2\" \r\n \r\n                                             onclick=\"silGorsel('<?= $cari_id ?>', '<?= $trimmed_fotograf ?>', this)\">\r\n@@ -356,9 +356,9 @@\n \r\n         <?php endif; ?>\r\n \r\n         <!-- Dosya Yükleme Alanı -->\r\n-        <?php if ($is_admin): ?>\r\n+        <?php if ($is_admin && ($tip ?? 'cari') !== 'banka'): ?>\r\n             <div class=\"image-container mt-4\">\r\n                 <div class=\"p-4\">\r\n                     <h5><i class=\"fa fa-cloud-upload-alt mr-2\"></i>Yeni Görsel Yükle</h5>\r\n                     <form id=\"uploadForm\" enctype=\"multipart/form-data\" class=\"mt-3\">\r\n"
                }
            ],
            "date": 1755268348301,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n\r\n<html lang=\"tr\">\r\n\r\n<head>\r\n\r\n    <meta charset=\"UTF-8\">\r\n\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n\r\n    <title>Görseller - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?></title>\r\n\r\n    <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/css/bootstrap.min.css\">\r\n\r\n    <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/plugins/fontawesome/css/fontawesome.min.css\">\r\n\r\n    <link rel=\"stylesheet\" href=\"<?= base_url(); ?>assets/plugins/fontawesome/css/all.min.css\">\r\n\r\n    <style>\r\n\r\n        body {\r\n\r\n            background-color: #f8f9fa;\r\n\r\n            font-family: Arial, sans-serif;\r\n\r\n        }\r\n\r\n        .header {\r\n\r\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\r\n            color: white;\r\n\r\n            padding: 20px 0;\r\n\r\n            margin-bottom: 20px;\r\n\r\n        }\r\n\r\n        .image-container {\r\n\r\n            background: white;\r\n\r\n            border-radius: 10px;\r\n\r\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\r\n\r\n            margin-bottom: 20px;\r\n\r\n            overflow: hidden;\r\n\r\n        }\r\n\r\n        .image-item {\r\n\r\n            position: relative;\r\n\r\n            border-bottom: 1px solid #eee;\r\n\r\n        }\r\n\r\n        .image-item:last-child {\r\n\r\n            border-bottom: none;\r\n\r\n        }\r\n\r\n        .image-preview {\r\n\r\n            width: 100%;\r\n\r\n            max-height: 400px;\r\n\r\n            object-fit: contain;\r\n\r\n            background: #f8f9fa;\r\n\r\n        }\r\n\r\n        .image-info {\r\n\r\n            padding: 15px;\r\n\r\n            background: white;\r\n\r\n        }\r\n\r\n        .image-name {\r\n\r\n            font-weight: 600;\r\n\r\n            color: #333;\r\n\r\n            margin-bottom: 5px;\r\n\r\n        }\r\n\r\n        .image-actions {\r\n\r\n            margin-top: 10px;\r\n\r\n        }\r\n\r\n        .btn-delete {\r\n\r\n            background: #dc3545;\r\n\r\n            border: none;\r\n\r\n            color: white;\r\n\r\n            padding: 5px 15px;\r\n\r\n            border-radius: 5px;\r\n\r\n            font-size: 12px;\r\n\r\n        }\r\n\r\n        .btn-delete:hover {\r\n\r\n            background: #c82333;\r\n\r\n            color: white;\r\n\r\n        }\r\n\r\n        .no-images {\r\n\r\n            text-align: center;\r\n\r\n            padding: 60px 20px;\r\n\r\n            color: #666;\r\n\r\n        }\r\n\r\n        .no-images i {\r\n\r\n            font-size: 48px;\r\n\r\n            margin-bottom: 15px;\r\n\r\n            color: #ccc;\r\n\r\n        }\r\n\r\n    </style>\r\n\r\n</head>\r\n\r\n<body>\r\n\r\n    <div class=\"header\">\r\n\r\n        <div class=\"container\">\r\n\r\n            <h4 class=\"mb-0\">\r\n\r\n                <i class=\"fa fa-images mr-2\"></i>\r\n\r\n                <?php if (isset($tip) && $tip == 'satis'): ?>\r\n                    Satış Görselleri - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?>\r\n                <?php else: ?>\r\n                    İşletme Görselleri - <?= $cari->cari_ad ?> <?= $cari->cari_soyad ?>\r\n                <?php endif; ?>\r\n\r\n            </h4>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n\r\n\r\n    <div class=\"container\">\r\n\r\n        <?php \r\n        // Hangi dosya alanını kullanacağımızı belirle\r\n        $foto_dosyalar = isset($dosya_field) ? $dosya_field : $cari->fotograf_dosya;\r\n        \r\n        if (!empty($foto_dosyalar)): ?>\r\n\r\n            <?php \r\n\r\n            $fotograflar = explode(',', $foto_dosyalar);\r\n\r\n            foreach ($fotograflar as $index => $fotograf): \r\n\r\n                $trimmed_fotograf = trim($fotograf);\r\n\r\n                if (empty($trimmed_fotograf)) continue;\r\n\r\n                \r\n\r\n                $file_name = pathinfo($trimmed_fotograf, PATHINFO_BASENAME);\r\n\r\n                $clean_name = preg_replace('/^[^_]*_/', '', $file_name); // Prefix'i kaldır\r\n\r\n                $image_url = base_url('assets/uploads/' . $trimmed_fotograf);\r\n\r\n            ?>\r\n\r\n                <div class=\"image-container\">\r\n\r\n                    <div class=\"image-item\">\r\n\r\n                        <img src=\"<?= $image_url ?>\" alt=\"Görsel <?= $index + 1 ?>\" class=\"image-preview\">\r\n\r\n                        <div class=\"image-info\">\r\n\r\n                            <div class=\"image-name\"><?= $clean_name ?></div>\r\n\r\n                            <div class=\"image-actions\">\r\n\r\n                                <a href=\"<?= $image_url ?>\" target=\"_blank\" class=\"btn btn-primary btn-sm\">\r\n\r\n                                    <i class=\"fa fa-external-link-alt\"></i> Yeni Sekmede Aç\r\n\r\n                                </a>\r\n\r\n                                <a href=\"<?= $image_url ?>\" download class=\"btn btn-success btn-sm ml-2\">\r\n\r\n                                    <i class=\"fa fa-download\"></i> İndir\r\n\r\n                                </a>\r\n\r\n                                <?php if ($is_admin): ?>\r\n\r\n                                    <button type=\"button\" class=\"btn btn-delete btn-sm ml-2\" \r\n\r\n                                            onclick=\"silGorsel('<?= $cari_id ?>', '<?= $trimmed_fotograf ?>', this)\">\r\n\r\n                                        <i class=\"fa fa-trash\"></i> Sil\r\n\r\n                                    </button>\r\n\r\n                                <?php endif; ?>\r\n\r\n                            </div>\r\n\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                </div>\r\n\r\n            <?php endforeach; ?>\r\n\r\n        <?php else: ?>\r\n\r\n            <div class=\"image-container\">\r\n\r\n                <div class=\"no-images\">\r\n\r\n                    <i class=\"fa fa-images\"></i>\r\n\r\n                    <h5>Görsel Bulunamadı</h5>\r\n\r\n                    <p class=\"text-muted\">Bu cari için henüz görsel yüklenmemiş.</p>\r\n\r\n                </div>\r\n\r\n            </div>\r\n\r\n        <?php endif; ?>\r\n\r\n    </div>\r\n\r\n\r\n\r\n    <script src=\"<?= base_url(); ?>assets/js/jquery-3.2.1.min.js\"></script>\r\n\r\n    <script src=\"<?= base_url(); ?>assets/js/bootstrap.bundle.min.js\"></script>\r\n\r\n    <script src=\"<?= base_url(); ?>assets/plugins/sweetalert/sweetalert.min.js\"></script>\r\n\r\n    \r\n\r\n    <script>\r\n\r\n    var baseUrl = '<?= base_url(); ?>';\r\n\r\n    \r\n\r\n    function silGorsel(cariId, dosyaAdi, button) {\r\n\r\n        if (confirm('Bu görseli silmek istediğinizden emin misiniz?\\n\\nDosya: ' + dosyaAdi.split('/').pop())) {\r\n\r\n            // Butonu devre dışı bırak\r\n\r\n            $(button).prop('disabled', true).html('<i class=\"fa fa-spinner fa-spin\"></i> Siliniyor...');\r\n\r\n            \r\n\r\n            $.ajax({\r\n\r\n                url: baseUrl + 'cari/gorselSil',\r\n\r\n                type: 'POST',\r\n\r\n                data: {\r\n\r\n                    cari_id: cariId,\r\n\r\n                    dosya_adi: dosyaAdi\r\n\r\n                },\r\n\r\n                success: function(response) {\r\n\r\n                    try {\r\n\r\n                        var result = JSON.parse(response);\r\n\r\n                        if (result.success) {\r\n\r\n                            // Görseli sayfadan kaldır\r\n\r\n                            $(button).closest('.image-container').fadeOut(300, function() {\r\n\r\n                                $(this).remove();\r\n\r\n                                \r\n\r\n                                // Eğer hiç görsel kalmadıysa sayfayı yenile\r\n\r\n                                if ($('.image-container').length === 0) {\r\n\r\n                                    location.reload();\r\n\r\n                                }\r\n\r\n                            });\r\n\r\n                            \r\n\r\n                            swal({\r\n\r\n                                title: \"Başarılı\",\r\n\r\n                                text: \"Görsel başarıyla silindi.\",\r\n\r\n                                type: \"success\",\r\n\r\n                                timer: 2000,\r\n\r\n                                showConfirmButton: false\r\n\r\n                            });\r\n\r\n                        } else {\r\n\r\n                            alert('Hata: ' + (result.message || 'Görsel silinemedi'));\r\n\r\n                            $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n\r\n                        }\r\n\r\n                    } catch (e) {\r\n\r\n                        alert('Beklenmeyen bir hata oluştu');\r\n\r\n                        $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n\r\n                    }\r\n\r\n                },\r\n\r\n                error: function() {\r\n\r\n                    alert('Sunucu hatası oluştu');\r\n\r\n                    $(button).prop('disabled', false).html('<i class=\"fa fa-trash\"></i> Sil');\r\n\r\n                }\r\n\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n    </script>\r\n\r\n</body>\r\n\r\n</html>\r\n\r\n"
        }
    ]
}