{
    "sourceFile": "application/views/illegal/illegal_hazirla.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1759151024054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1759151024054,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n\r\n<html lang=\"tr\">\r\n\r\n<head>\r\n\r\n    <title>İllegal Hazırla | İlekaSoft CRM</title>\r\n\r\n    <link rel=\"icon\" type=\"image/png\" href=\"/assets/favicon.png\">\t<?php $this->load->view(\"include/head-tags\"); ?>\r\n\r\n\t<title>İllegal Hazırla | İlekaSoft CRM</title>\r\n\r\n\t<link rel=\"icon\" type=\"image/x-icon\" href=\"<?= base_url('assets/favicon.ico'); ?>\" />\r\n\r\n\t<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/ui-lightness/jquery-ui.css\" integrity=\"sha512-UVksC7mwMZ0W9Ow+r7grrHVfIzB9a7a1Vz3r9OPjCGWOYSdTt6EsWWLnJYhxO8ld7aLdyNQXcZ3hHKe2ksE5A==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\r\n\r\n\t<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css\"\r\n\r\n\t\t  integrity=\"sha512-vKMx8UnXk60zUwyUnUPM3HbQo8QfmNx7+ltw8Pm5zLusl1XIfwcxo8DbWCqMGKaWeNxWA8yrx5v3SaVpMvR3CA==\"\r\n\r\n\t\t  crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"/>\r\n\r\n\t<link href=\"<?= base_url('assets/select2.min.css') ?>\" rel=\"stylesheet\" />\r\n\r\n\t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/css/dataTables.bootstrap4.min.css\"/>\r\n\r\n\r\n\r\n\t<style>\r\n\r\n\t\t.ui-autocomplete {\r\n\r\n\t\t\tz-index: 999999;\r\n\r\n\t\t\tmax-height: 200px;\r\n\r\n\t\t\toverflow-y: auto;\r\n\r\n\t\t\t/* prevent horizontal scrollbar */\r\n\r\n\t\t\toverflow-x: hidden;\r\n\r\n\t\t\t/* add padding to account for vertical scrollbar */\r\n\r\n\t\t\tpadding-right: 20px;\r\n\r\n\t\t}\r\n\r\n\t\t.btn-mor {\r\n\r\n    background-color: #7c3aed;\r\n\r\n    color: #fff;\r\n\r\n    border-color: #7c3aed;\r\n\r\n}\r\n\r\n.btn-mor:hover, .btn-mor:focus {\r\n\r\n    background-color: #5b21b6;\r\n\r\n    border-color: #5b21b6;\r\n\r\n    color: #fff;\r\n\r\n}\r\n\r\n.btn-mor.btn-lg {\r\n\r\n    font-size: 1.25rem;\r\n\r\n    padding: 0.75rem 2rem;\r\n\r\n    border-radius: 0.5rem;\r\n\r\n}\r\n\r\n.btn-outline-success.potansiyel-cari-duzenle, .btn-outline-success.potansiyel-cari-duzenle:focus, .btn-outline-success.potansiyel-cari-duzenle:hover {\r\n\r\n    color: #fff;\r\n\r\n    background-color: #7c3aed;\r\n\r\n    border-color: #7c3aed;\r\n\r\n}\r\n\r\n.btn-outline-success.potansiyel-cari-duzenle:hover, \r\n\r\n.btn-outline-success.potansiyel-cari-duzenle:focus {\r\n\r\n    color: #fff;\r\n\r\n    background-color: #7c3aed;\r\n\r\n    border-color: #7c3aed;\r\n\r\n}\r\n\r\n@media (max-width: 991.98px) {\r\n\r\n    .custom-table th.hide-mobile, .custom-table td.hide-mobile {\r\n\r\n        display: none !important;\r\n\r\n    }\r\n\r\n}\r\n\r\n\t</style>\r\n\r\n</head>\r\n\r\n<body>\r\n\r\n<?php\r\n\r\n$firmaID = getirFirma();\r\n\r\n$firma_ID = $firmaID->ayarlar_id;\r\n\r\n$modulSorgula = modulSorgula($firma_ID, 1);\r\n\r\n\r\n\r\n$sezonlar = $this->db->get('sezonlar')->result();\r\n\r\n$cariGruplar = $this->db->select('potansiyel_cari_grup')->distinct()->from('potansiyel_cari')->where('potansiyel_cari_grup IS NOT NULL')->get()->result();\r\n\r\n$sektorler = $this->db->get('sektorler')->result();\r\n\r\n$iller = $this->db->get('iller')->result();\r\n\r\n$ilceler = $this->db->get('ilceler')->result();\r\n\r\n$potansiyelDurumlar = $this->db->get('potansiyel_durumlar')->result();\r\n\r\n\r\n\r\n// İller listesi - artık yetki filtresi olmadan\r\n\r\n$iller = $this->db->get('iller')->result();\r\n\r\n?>\r\n\r\n<div class=\"main-wrapper\">\r\n\r\n\t<?php $this->load->view(\"include/header\"); ?>\r\n\r\n\t<?php $this->load->view(\"include/sidebar\"); ?>\r\n\r\n\t<div class=\"page-wrapper\">\r\n\r\n\t\t<div class=\"content container-fluid\">\r\n\r\n\t\t\t<!-- Page Header -->\r\n\r\n\t\t\t<div class=\"page-header\">\r\n\r\n\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t<div class=\"col-sm-10\">\r\n\r\n\t\t\t\t\t\t<h3 class=\"page-title\">İllegal</h3>\r\n\r\n\t\t\t\t\t\t<ul class=\"breadcrumb\">\r\n\r\n\t\t\t\t\t\t\t<li class=\"breadcrumb-item\"><a href=\"<?= base_url(); ?>\">Anasayfa</a></li>\r\n\r\n\t\t\t\t\t\t\t<li class=\"breadcrumb-item\">İllegal</li>\r\n\r\n\t\t\t\t\t\t\t<li class=\"breadcrumb-item active\">İllegal Hazırla</li>\r\n\r\n\t\t\t\t\t\t</ul>\r\n\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"d-flex justify-content-end text-align-center col-sm-2\">\r\n\r\n\t\t\t\t\t\t<a class=\"btn btn-outline-light\" href=\"javascript:history.back()\"><i class=\"fa fa-history\"></i> <br>Önceki Sayfa</a>\r\n\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t</div>\t\t\t</div>\t\t\t<!-- /Page Header -->\r\n\r\n\r\n\r\n\t\t\t<!-- Ürün/Hizmet Tablosu -->\r\n\r\n\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t<div class=\"col-xl-12 col-md-12\">\r\n\r\n\t\t\t\t\t<div class=\"card card-table\">\r\n\r\n\t\t\t\t\t\t<div class=\"card-header\">\r\n\r\n\t\t\t\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t\t\t\t<div class=\"col\">\r\n\r\n\t\t\t\t\t\t\t\t\t<form class=\"form-inline\" id=\"potansiyelCariFiltreForm\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-row align-items-end\">\r\n\r\n    <div class=\"form-group mr-2 mb-2\">\r\n\r\n        <label for=\"il\" class=\"mr-2\">İl</label>\r\n\r\n        <select class=\"form-control\" id=\"il\" name=\"il\">\r\n\r\n            <option value=\"\">Tümü</option>\r\n\r\n            <?php foreach($iller as $il): ?>\r\n\r\n                <option value=\"<?= $il->id ?>\"><?= $il->il ?></option>\r\n\r\n            <?php endforeach; ?>\r\n\r\n        </select>\r\n\r\n    </div>\r\n\r\n    <div class=\"form-group mr-2 mb-2\">\r\n\r\n        <label for=\"ilce\" class=\"mr-2\">İlçe</label>\r\n\r\n        <select class=\"form-control\" id=\"ilce\" name=\"ilce\" disabled>\r\n\r\n            <option value=\"\">Önce il seçiniz</option>\r\n\r\n        </select>\r\n\r\n    </div>\r\n\r\n    <div class=\"form-group mr-2 mb-2\">\r\n\r\n        <label for=\"mahalle\" class=\"mr-2\">Mahalle</label>\r\n\r\n        <select class=\"form-control\" id=\"mahalle\" name=\"mahalle\" disabled>\r\n\r\n            <option value=\"\">Önce ilçe seçiniz</option>\r\n\r\n        </select>\r\n\r\n    </div>\r\n\r\n    <div class=\"form-group mr-2 mb-2\">\r\n\r\n        <label for=\"potansiyel_cari_firmaTelefon\" class=\"mr-2\">Telefon</label>\r\n\r\n        <select class=\"form-control\" id=\"potansiyel_cari_firmaTelefon\" name=\"potansiyel_cari_firmaTelefon\" style=\"width:200px;\" data-live-search=\"true\">\r\n\r\n            <option value=\"\">Tümü</option>\r\n\r\n        </select>\r\n\r\n    </div>\r\n\r\n    <div class=\"form-group mr-2 mb-2\">\r\n\r\n        <label for=\"sezon\" class=\"mr-2\">Sezon</label>\r\n\r\n        <select class=\"form-control\" id=\"sezon\" name=\"sezon\">\r\n\r\n            <option value=\"\">Tümü</option>\r\n\r\n            <?php foreach($sezonlar as $s): ?>\r\n\r\n                <option value=\"<?= $s->sezon_id ?>\"><?= $s->sezon_adi ?></option>\r\n\r\n            <?php endforeach; ?>\r\n\r\n        </select>\r\n\r\n    </div>\r\n\r\n    <!-- <div class=\"form-group mr-2 mb-2\"> ... Cari Grup ... </div> -->\r\n\r\n    <div class=\"form-group mr-2 mb-2\">\r\n\r\n        <label for=\"sektor\" class=\"mr-2\">Sektör</label>\r\n\r\n        <select class=\"form-control\" id=\"sektor\" name=\"sektor\">\r\n\r\n            <option value=\"\">Tümü</option>\r\n\r\n            <?php foreach($sektorler as $sk): ?>\r\n\r\n                <option value=\"<?= $sk->sektor_id ?>\"><?= $sk->sektor_adi ?></option>\r\n\r\n            <?php endforeach; ?>\r\n\r\n        </select>\r\n\r\n    </div>\r\n\r\n    <div class=\"ml-auto d-flex align-items-end\">\r\n\r\n        <button type=\"submit\" class=\"btn btn-primary mb-2 mr-2\">Filtrele</button>\r\n\r\n    </div>\r\n\r\n</div>\r\n\r\n\t\t\t\t\t\t\t\t\t</form>\r\n\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"card-body\">\r\n\r\n\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\r\n\t\t\t\t\t\t\t\t<table class=\"table table-striped custom-table mb-0\">\t\t\t\t\t\t\t\t\t<thead>\r\n\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"hide-mobile no-sort\" style=\"width:32px;\"><input type=\"checkbox\" id=\"tumunuSec\"></th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"hide-mobile\">Sezon</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"hide-mobile\">Potansiyel Üye No</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th>Telefon</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th>Cari Adı</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Tarihi</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"hide-mobile\">Cari Grup</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"hide-mobile\">Sektör</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th>İl</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th>İlçe</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th>Mahalle</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th>Adres</th>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<th class=\"text-right no-sort\">İşlem</th>\r\n\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\r\n\t\t\t\t\t\t\t\t\t</thead>\r\n\r\n\t\t\t\t\t\t\t\t\t<tbody id=\"potansiyelCariTableBody\">\r\n\r\n\t\t\t\t\t\t\t\t\t<!-- Potansiyel cari kayıtları buraya eklenecek -->\r\n\r\n\t\t\t\t\t\t\t\t\t</tbody>\r\n\r\n\t\t\t\t\t\t\t\t</table>\r\n\r\n\t\t\t\t\t\t\t\t<hr>\r\n\r\n\t\t\t\t\t\t\t\t<span style=\"margin-left:15px;\">Toplam kayıt sayısı: <b>0</b></span>\r\n\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\t\t</div>\r\n\r\n\t</div>\r\n\r\n</div>\r\n\r\n\r\n\r\n<!-- İllegal Seçim Modal -->\r\n\r\n<div class=\"modal fade\" id=\"illegalSecimModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"illegalSecimModalLabel\" aria-hidden=\"true\">\r\n\r\n  <div class=\"modal-dialog\" role=\"document\">\r\n\r\n    <div class=\"modal-content\">\r\n\r\n      <div class=\"modal-header\">\r\n\r\n        <!-- Geçici olarak iptal edildi: <h5 class=\"modal-title\" id=\"illegalSecimModalLabel\">İllegal İşlemleri</h5> -->\r\n        <h5 class=\"modal-title\">İllegal İşlemleri</h5>\r\n\r\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n\r\n          <span aria-hidden=\"true\">&times;</span>\r\n\r\n        </button>\r\n\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n\r\n        <div class=\"text-center\">\r\n\r\n          <h6 class=\"mb-3\" id=\"seciliMusteriAdi\">Müşteri: </h6>\r\n\r\n          <div class=\"row\">\r\n\r\n            <div class=\"col-6\">\r\n\r\n              <button type=\"button\" class=\"btn btn-primary btn-lg btn-block illegal-olustur-btn\">\r\n\r\n                <i class=\"fa fa-plus\"></i><br>\r\n\r\n                İllegal Oluştur\r\n\r\n              </button>\r\n\r\n            </div>\r\n\r\n            <div class=\"col-6\">\r\n\r\n              <button type=\"button\" class=\"btn btn-info btn-lg btn-block illegalleri-gor-btn\">\r\n\r\n                <i class=\"fa fa-list\"></i><br>\r\n\r\n                İllegalleri Gör\r\n\r\n              </button>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <div class=\"modal-footer\">\r\n\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">İptal</button>\r\n\r\n      </div>\r\n\r\n    </div>\r\n\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n\r\n<!-- Potansiyel Satış Ekle Modal -->\r\n\r\n<div class=\"modal fade\" id=\"potansiyelSatisEkleModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"potansiyelSatisEkleModalLabel\" aria-hidden=\"true\">\r\n\r\n  <div class=\"modal-dialog\" role=\"document\">\r\n\r\n    <div class=\"modal-content\">\r\n\r\n      <form method=\"post\" action=\"<?= base_url('illegal/potansiyel_satis_ekle') ?>\">\r\n\r\n        <div class=\"modal-header\">\r\n\r\n          <h5 class=\"modal-title\" id=\"potansiyelSatisEkleModalLabel\">Yeni Potansiyel Satış Ekle</h5>\r\n\r\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n\r\n            <span aria-hidden=\"true\">&times;</span>\r\n\r\n          </button>\r\n\r\n        </div>\r\n\r\n        <div class=\"modal-body\">\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Müşteri</label>\r\n\r\n            <input type=\"text\" id=\"cari_autocomplete\" class=\"form-control\" placeholder=\"Seçili müşteri burada görünecek...\" readonly>\r\n\r\n            <input type=\"hidden\" name=\"potansiyel_cari_id\" id=\"selected_cari_id\" required>\r\n\r\n          </div>          <div class=\"form-group\">\r\n\r\n            <label>Durum</label>\r\n\r\n            <select name=\"durum_id\" id=\"durum_id\" class=\"form-control\" required>\r\n\r\n              <option value=\"\">Durum Seçiniz</option>\r\n\r\n              <?php foreach($potansiyelDurumlar as $durum): ?>\r\n\r\n                <option value=\"<?= $durum->id ?>\"><?= $durum->Durum_Adi ?></option>\r\n\r\n              <?php endforeach; ?>\r\n\r\n            </select>\r\n\r\n          </div>          <div class=\"form-group fiyat-alani\" id=\"fiyat1-group\">\r\n\r\n            <label>Bizim teklifimiz</label>\r\n\r\n            <div class=\"input-group\">\r\n\r\n              <input type=\"text\" name=\"fiyat1\" class=\"form-control fiyat-input\" placeholder=\"0,00\">\r\n\r\n              <div class=\"input-group-append\">\r\n\r\n                <span class=\"input-group-text\">₺</span>\r\n\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n          <div class=\"form-group fiyat-alani\" id=\"fiyat2-group\">\r\n\r\n            <label>Müşteri beklentisi</label>\r\n\r\n            <div class=\"input-group\">\r\n\r\n              <input type=\"text\" name=\"fiyat2\" class=\"form-control fiyat-input\" placeholder=\"0,00\">\r\n\r\n              <div class=\"input-group-append\">\r\n\r\n                <span class=\"input-group-text\">₺</span>\r\n\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n          <div class=\"form-group fiyat-alani\" id=\"fiyat3-group\">\r\n\r\n            <label>Olabilir teklif</label>\r\n\r\n            <div class=\"input-group\">\r\n\r\n              <input type=\"text\" name=\"fiyat3\" class=\"form-control fiyat-input\" placeholder=\"0,00\">\r\n\r\n              <div class=\"input-group-append\">\r\n\r\n                <span class=\"input-group-text\">₺</span>\r\n\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n          <div class=\"form-group\">\r\n\r\n            <label>Açıklama</label>\r\n\r\n            <textarea name=\"aciklama\" class=\"form-control\"></textarea>\r\n\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <div class=\"modal-footer\">\r\n\r\n          <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Kapat</button>\r\n\r\n          <button type=\"submit\" class=\"btn btn-primary\">Kaydet</button>\r\n\r\n        </div>\r\n\r\n      </form>\r\n\r\n    </div>\r\n\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n\r\n<!-- İllegalleri Gör Modal -->\r\n\r\n<div class=\"modal fade\" id=\"illegallerGorModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"illegallerGorModalLabel\" aria-hidden=\"true\">\r\n\r\n  <div class=\"modal-dialog modal-lg\" role=\"document\">\r\n\r\n    <div class=\"modal-content\">\r\n\r\n      <div class=\"modal-header\">\r\n\r\n        <h5 class=\"modal-title\" id=\"illegallerGorModalLabel\">Müşteri İllegalleri</h5>\r\n\r\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n\r\n          <span aria-hidden=\"true\">&times;</span>\r\n\r\n        </button>\r\n\r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n\r\n        <div id=\"illegallerListesi\">\r\n\r\n          <!-- İllegaller buraya yüklenecek -->\r\n\r\n          <div class=\"text-center\">\r\n\r\n            <i class=\"fa fa-spinner fa-spin\"></i> Yükleniyor...\r\n\r\n          </div>\r\n\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <div class=\"modal-footer\">\r\n\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Kapat</button>\r\n\r\n      </div>\r\n\r\n    </div>\r\n\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n\r\n<?php $this->load->view(\"include/footer-js\"); ?>\r\n\r\n\r\n\r\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js\" \r\n\r\n\t\tintegrity=\"sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==\" \r\n\r\n\t\tcrossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\r\n\r\n<script src=\"<?= base_url('assets/select2.min.js') ?>\"></script>\r\n\r\n<script src=\"https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js\"></script>\r\n\r\n<script src=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/js/dataTables.bootstrap4.min.js\"></script>\r\n\r\n\r\n\r\n<script>\r\n\r\n$(document).ready(function() {\r\n\r\n    $('#il').on('change', function() {\r\n\r\n        var il_id = $(this).val();\r\n\r\n        if(il_id) {\r\n\r\n            $('#ilce').prop('disabled', false);\r\n\r\n            $('#ilce').html('<option>Yükleniyor...</option>');\r\n\r\n            $.ajax({\r\n\r\n                url: '<?= base_url(\"home/get_ilceler\") ?>',\r\n\r\n                type: 'POST',\r\n\r\n                data: {il_id: il_id},\r\n\r\n                dataType: 'json',\r\n\r\n                success: function(result) {\r\n\r\n                    if(result && result.status !== 'error') {\r\n\r\n                        var options = '<option value=\"\">Tümü</option>';\r\n\r\n                        $.each(result.data, function(i, ilce) {\r\n\r\n                            options += '<option value=\"'+ilce.id+'\">'+ilce.ilce+'</option>';\r\n\r\n                        });\r\n\r\n                        $('#ilce').html(options);\r\n\r\n                    } else {\r\n\r\n                        $('#ilce').html('<option value=\"\">İlçe bulunamadı</option>');\r\n\r\n                    }\r\n\r\n                },\r\n\r\n                error: function() {\r\n\r\n                    $('#ilce').html('<option value=\"\">Hata oluştu</option>');\r\n\r\n                }\r\n\r\n            });\r\n\r\n        } else {\r\n\r\n            $('#ilce').prop('disabled', true).html('<option value=\"\">Önce il seçiniz</option>');\r\n\r\n        }\r\n\r\n    });\r\n\r\n\r\n\r\n    $('#ilce').on('change', function() {\r\n\r\n        var il_id = $('#il').val();\r\n\r\n        var ilce_id = $(this).val();\r\n\r\n        if(ilce_id) {\r\n\r\n            $('#mahalle').prop('disabled', false);\r\n\r\n            $('#mahalle').html('<option>Yükleniyor...</option>');\r\n\r\n            $.ajax({\r\n\r\n                url: '<?= base_url(\"illegal/get_potansiyel_mahalleler\") ?>',\r\n\r\n                type: 'POST',\r\n\r\n                data: {il_id: il_id, ilce_id: ilce_id},\r\n\r\n                dataType: 'json',\r\n\r\n                success: function(result) {\r\n\r\n                    if(result && result.status === 'success') {\r\n\r\n                        var options = '<option value=\"\">Tümü</option>';\r\n\r\n                        $.each(result.data, function(i, mahalle) {\r\n\r\n                            options += '<option value=\"'+mahalle+'\">'+mahalle+'</option>';\r\n\r\n                        });\r\n\r\n                        $('#mahalle').html(options);\r\n\r\n                    } else {\r\n\r\n                        $('#mahalle').html('<option value=\"\">Mahalle bulunamadı</option>');\r\n\r\n                    }\r\n\r\n                },\r\n\r\n                error: function() {\r\n\r\n                    $('#mahalle').html('<option value=\"\">Hata oluştu</option>');\r\n\r\n                }\r\n\r\n            });\r\n\r\n        } else {\r\n\r\n            $('#mahalle').prop('disabled', true).html('<option value=\"\">Önce ilçe seçiniz</option>');\r\n\r\n        }\r\n\r\n    });\r\n\r\n\r\n\r\n    // Telefon search dropdown (select2 veya benzeri ile)\r\n\r\n    $('#potansiyel_cari_firmaTelefon').select2({\r\n\r\n        placeholder: 'Telefon ara...',\r\n\r\n        allowClear: true,\r\n\r\n        minimumInputLength: 2,\r\n\r\n        ajax: {\r\n\r\n            url: '<?= base_url(\"illegal/telefon_search\") ?>',\r\n\r\n            type: 'POST',\r\n\r\n            dataType: 'json',\r\n\r\n            delay: 250,\r\n\r\n            data: function(params) {\r\n\r\n                return {q: params.term};\r\n\r\n            },\r\n\r\n            processResults: function(data) {\r\n\r\n                return {\r\n\r\n                    results: $.map(data, function(item) {\r\n\r\n                        return {id: item, text: item};\r\n\r\n                    })\r\n\r\n                };\r\n\r\n            },\r\n\r\n            cache: true\r\n\r\n        }\r\n\r\n    });\r\n\r\n\r\n\r\n    // DataTable ile sıralama aktif et\r\n\r\n    var table = $('.custom-table').DataTable({\r\n\r\n        paging: false,\r\n\r\n        info: false,\r\n\r\n        searching: false,\r\n\r\n        ordering: true,\r\n\r\n        order: [],\r\n\r\n        language: {\r\n\r\n            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/tr.json'\r\n\r\n        },\r\n\r\n        columnDefs: [\r\n\r\n            { targets: 'hide-mobile', visible: window.innerWidth > 991 },\r\n\r\n            { targets: 'no-sort', orderable: false }\r\n\r\n        ]\r\n\r\n    });\r\n\r\n    // Mobilde kolon gizleme için responsive ayar\r\n\r\n    $(window).on('resize', function() {\r\n\r\n        var isMobile = window.innerWidth <= 991;\r\n\r\n        table.columns('.hide-mobile').visible(!isMobile);\r\n\r\n    });\r\n\r\n\r\n\r\n    // Filtrele butonuna basınca tabloyu doldur\r\n\r\n    $('#potansiyelCariFiltreForm').on('submit', function(e) {\r\n\r\n        e.preventDefault();\r\n\r\n        $('#potansiyelCariTableBody').html('<tr><td colspan=\"14\" class=\"text-center\">Yükleniyor...</td></tr>');\r\n\r\n        $.ajax({\r\n\r\n            url: '<?= base_url(\"illegal/potansiyel-cari-filtrele\") ?>', // Controller'da bu endpoint olmalı\r\n\r\n            type: 'POST',\r\n\r\n            data: $(this).serialize(),\r\n\r\n            dataType: 'json',\r\n\r\n            success: function(result) {\r\n\r\n                if(result && result.status === 'success' && result.data.length > 0) {\r\n\r\n                    // DataTables ile tabloyu güncelle\r\n\r\n                    var table = $('.custom-table').DataTable();\r\n\r\n                    table.clear();\r\n\r\n                    var rows = [];                    $.each(result.data, function(i, item) {\r\n\r\n                        rows.push([\r\n\r\n                            '<input type=\"checkbox\" class=\"potansiyel-cari-sec\" value=\"' + (item.id || '') + '\">',\r\n\r\n                            (item.sezon_adi || ''),\r\n\r\n                            (item.potansiyel_uye_no || ''),\r\n\r\n                            (item.potansiyel_cari_firmaTelefon || ''),\r\n\r\n                            (item.potansiyel_cari_ad || ''),\r\n\r\n                            (item.potansiyel_aktivasyon_tarihi || ''),\r\n\r\n                            (item.potansiyel_cari_grup || ''),\r\n\r\n                            (item.sektor_adi || ''),\r\n\r\n                            (item.il_adi || ''),\r\n\r\n                            (item.ilce_adi || ''),\r\n\r\n                            (item.potansiyel_mahalle || ''),\r\n\r\n                            (item.potansiyel_cari_adres || ''),                            '<button class=\"btn btn-sm btn-outline-success potansiyel-cari-duzenle\" data-id=\"'+(item.id||'')+'\" data-ad=\"'+(item.potansiyel_cari_ad||'')+'\" data-tel=\"'+(item.potansiyel_cari_firmaTelefon||'')+'\"><i class=\"fa fa-edit\"></i></button> ' +\r\n\r\n                            '<button class=\"btn btn-sm btn-outline-primary potansiyel-cari-illegal\" data-id=\"'+(item.id||'')+'\" data-ad=\"'+(item.potansiyel_cari_ad||'')+'\" data-tel=\"'+(item.potansiyel_cari_firmaTelefon||'')+'\"><i class=\"fa fa-file-text\"></i> İ</button>'\r\n\r\n                        ]);\r\n\r\n                    });\r\n\r\n                    table.rows.add(rows).draw();\r\n\r\n                    // Toplam kayıt sayısını güncelle\r\n\r\n                    $(\"span:contains('Toplam kayıt sayısı') b\").text(result.data.length);\r\n\r\n                } else {\r\n\r\n                    var table = $('.custom-table').DataTable();\r\n\r\n                    table.clear().draw();\r\n\r\n                    $('#potansiyelCariTableBody').html('<tr><td colspan=\"14\" class=\"text-center\">Kayıt bulunamadı.</td></tr>');\r\n\r\n                    $(\"span:contains('Toplam kayıt sayısı') b\").text('0');\r\n\r\n                }\r\n\r\n            },\r\n\r\n            error: function() {\r\n\r\n                var table = $('.custom-table').DataTable();\r\n\r\n                table.clear().draw();\r\n\r\n                $('#potansiyelCariTableBody').html('<tr><td colspan=\"14\" class=\"text-center\">Hata oluştu.</td></tr>');\r\n\r\n            }\r\n\r\n        });\r\n\r\n    });\r\n\r\n    // Sayfa ilk açıldığında tabloyu boş bırak\r\n\r\n    $('#potansiyelCariTableBody').html('');\r\n\r\n\r\n\r\n    // Tümünü seç kutusu\r\n\r\n    $('#tumunuSec').on('change', function() {\r\n\r\n        var checked = $(this).is(':checked');\r\n\r\n        $('.potansiyel-cari-sec').prop('checked', checked);\r\n\r\n    });    // Satır düzenleme işlemi (prompt ile örnek)\r\n\r\n    $(document).on('click', '.potansiyel-cari-duzenle', function() {\r\n\r\n        var id = $(this).data('id');\r\n\r\n        var eskiAd = $(this).data('ad');\r\n\r\n        var eskiTel = $(this).data('tel');\r\n\r\n        var yeniAd = prompt('Yeni Cari Adı:', eskiAd);\r\n\r\n        if(yeniAd !== null && yeniAd !== eskiAd) {\r\n\r\n            $.post('illegal/potansiyel-cari-guncelle', {id: id, potansiyel_cari_ad: yeniAd}, function(resp) {\r\n\r\n                toastr.success('Cari adı güncellendi');\r\n\r\n                $('#potansiyelCariFiltreForm').submit();\r\n\r\n            });\r\n\r\n        }\r\n\r\n        // Benzer şekilde diğer alanlar için de prompt ekleyebilirsiniz\r\n\r\n    });    // İllegal hazırlama işlemi - İ butonuna tıklayınca seçim modalı aç\r\n\r\n    $(document).on('click', '.potansiyel-cari-illegal', function() {\r\n\r\n        var id = $(this).data('id');\r\n\r\n        var ad = $(this).data('ad');\r\n\r\n        var tel = $(this).data('tel');\r\n\r\n        \r\n\r\n        // Seçili müşteri bilgilerini sakla\r\n\r\n        $('#illegalSecimModal').data('cari-id', id);\r\n\r\n        $('#illegalSecimModal').data('cari-ad', ad);\r\n\r\n        $('#illegalSecimModal').data('cari-tel', tel);\r\n\r\n        \r\n\r\n        // Modal başlığını güncelle\r\n\r\n        $('#seciliMusteriAdi').text('Müşteri: ' + ad);\r\n\r\n        \r\n\r\n        // Seçim modalını aç\r\n\r\n        $('#illegalSecimModal').modal('show');\r\n\r\n    });\r\n\r\n\r\n\r\n    // İllegal Oluştur butonuna tıklayınca\r\n\r\n    $(document).on('click', '.illegal-olustur-btn', function() {\r\n\r\n        var modal = $('#illegalSecimModal');\r\n\r\n        var id = modal.data('cari-id');\r\n\r\n        var ad = modal.data('cari-ad');\r\n\r\n        var tel = modal.data('cari-tel');\r\n\r\n        \r\n\r\n        // Seçim modalını kapat\r\n\r\n        $('#illegalSecimModal').modal('hide');\r\n\r\n        \r\n\r\n        // Biraz bekle ve illegal oluştur modalını aç\r\n\r\n        setTimeout(function() {\r\n\r\n            $('#selected_cari_id').val(id);\r\n\r\n            $('#cari_autocomplete').val(ad + ' (' + tel + ')');\r\n\r\n            $('#potansiyelSatisEkleModal').modal('show');\r\n\r\n        }, 300);\r\n\r\n    });\r\n\r\n\r\n\r\n    // İllegalleri Gör butonuna tıklayınça\r\n\r\n    $(document).on('click', '.illegalleri-gor-btn', function() {\r\n\r\n        var modal = $('#illegalSecimModal');\r\n\r\n        var id = modal.data('cari-id');\r\n\r\n        var ad = modal.data('cari-ad');\r\n\r\n        \r\n\r\n        // Seçim modalını kapat\r\n\r\n        $('#illegalSecimModal').modal('hide');\r\n\r\n        \r\n\r\n        // Biraz bekle ve illegaller modalını aç\r\n\r\n        setTimeout(function() {\r\n\r\n            // Modal başlığını güncelle\r\n\r\n            $('#illegallerGorModalLabel').text(ad + ' - İllegaller');\r\n\r\n            \r\n\r\n            // Modal aç ve illegalleri yükle\r\n\r\n            $('#illegallerGorModal').modal('show');\r\n\r\n            \r\n\r\n            // İllegalleri AJAX ile yükle\r\n\r\n            $('#illegallerListesi').html('<div class=\"text-center\"><i class=\"fa fa-spinner fa-spin\"></i> Yükleniyor...</div>');\r\n\r\n            \r\n\r\n            $.ajax({\r\n\r\n                url: '<?= base_url(\"illegal/get_cari_illegaller\") ?>',\r\n\r\n                type: 'POST',\r\n\r\n                data: {cari_id: id},\r\n\r\n                dataType: 'json',\r\n\r\n                success: function(result) {\r\n\r\n                    if(result && result.status === 'success' && result.data.length > 0) {\r\n\r\n                        var html = '<div class=\"table-responsive\">' +\r\n\r\n                                  '<table class=\"table table-striped table-sm\">' +\r\n\r\n                                  '<thead>' +\r\n\r\n                                  '<tr>' +                                  '<th>#</th>' +\r\n\r\n                                  '<th>Durum</th>' +\r\n\r\n                                  '<th>Bizim teklifimiz</th>' +\r\n\r\n                                  '<th>Müşteri beklentisi</th>' +\r\n\r\n                                  '<th>Olabilir teklif</th>' +\r\n\r\n                                  '<th>Açıklama</th>' +\r\n\r\n                                  '<th>Tarih</th>' +\r\n\r\n                                  '</tr>' +\r\n\r\n                                  '</thead>' +\r\n\r\n                                  '<tbody>';\r\n\r\n                        \r\n\r\n                        $.each(result.data, function(i, item) {\r\n\r\n                            html += '<tr>' +\r\n\r\n                                   '<td>' + (item.id || '') + '</td>' +\r\n\r\n                                   '<td>' + (item.durum_adi || '') + '</td>' +\r\n\r\n                                   '<td>' + (item.fiyat1 || '') + '</td>' +\r\n\r\n                                   '<td>' + (item.fiyat2 || '') + '</td>' +\r\n\r\n                                   '<td>' + (item.fiyat3 || '') + '</td>' +\r\n\r\n                                   '<td>' + (item.aciklama || '') + '</td>' +\r\n\r\n                                   '<td>' + (item.islem_tarihi || '') + '</td>' +\r\n\r\n                                   '</tr>';\r\n\r\n                        });\r\n\r\n                        \r\n\r\n                        html += '</tbody></table></div>';\r\n\r\n                        $('#illegallerListesi').html(html);\r\n\r\n                    } else {\r\n\r\n                        $('#illegallerListesi').html('<div class=\"text-center text-muted\">Bu müşteri için henüz illegal bulunamadı.</div>');\r\n\r\n                    }\r\n\r\n                },\r\n\r\n                error: function() {\r\n\r\n                    $('#illegallerListesi').html('<div class=\"text-center text-danger\">İllegaller yüklenirken hata oluştu.</div>');\r\n\r\n                }\r\n\r\n            });\r\n\r\n        }, 300);\r\n\r\n    });\r\n\r\n\r\n\r\n    // Modal kapandığında formu temizle\r\n\r\n    $('#potansiyelSatisEkleModal').on('hidden.bs.modal', function() {\r\n\r\n        $(\"#cari_autocomplete\").val('');\r\n\r\n        $(\"#selected_cari_id\").val('');\r\n\r\n        $(this).find('form')[0].reset();\r\n\r\n    });    // İllegaller modal kapandığında içeriği temizle\r\n\r\n    $('#illegallerGorModal').on('hidden.bs.modal', function() {\r\n\r\n        $('#illegallerListesi').html('');\r\n\r\n    });    // Durum seçimi değiştiğinde fiyat alanlarını gizle/göster\r\n\r\n    $('#durum_id').on('change', function() {\r\n\r\n        var selectedDurum = $(this).val();\r\n\r\n        var fiyatAlanlari = $('.fiyat-alani');\r\n\r\n        var fiyat1 = $('#fiyat1-group');\r\n\r\n        var fiyat2 = $('#fiyat2-group');\r\n\r\n        var fiyat3 = $('#fiyat3-group');\r\n\r\n          // ID'si 1, 2 veya 3 olan durumlar seçildiğinde tüm fiyat alanlarını gizle\r\n\r\n        if (selectedDurum == '1' || selectedDurum == '2' || selectedDurum == '3') {\r\n\r\n            fiyatAlanlari.hide();\r\n\r\n            // Fiyat alanlarındaki değerleri temizle\r\n\r\n            fiyatAlanlari.find('input').val('');\r\n\r\n        } \r\n\r\n        // ID'si 5 olan durum seçildiğinde sadece Fiyat 1 göster, Fiyat 2 ve 3'ü gizle\r\n\r\n        else if (selectedDurum == '5') {\r\n\r\n            fiyat1.show();\r\n\r\n            fiyat2.hide();\r\n\r\n            fiyat3.hide();\r\n\r\n            // Gizlenen fiyat alanlarındaki değerleri temizle\r\n\r\n            fiyat2.find('input').val('');\r\n\r\n            fiyat3.find('input').val('');\r\n\r\n        }\r\n\r\n        // Diğer durumlar için tüm fiyat alanlarını göster\r\n\r\n        else {\r\n\r\n            fiyatAlanlari.show();\r\n\r\n        }\r\n\r\n    });    // Modal açıldığında fiyat alanlarını göster (başlangıç durumu)\r\n\r\n    $('#potansiyelSatisEkleModal').on('shown.bs.modal', function() {\r\n\r\n        $('.fiyat-alani').show();\r\n\r\n        $('#durum_id').val(''); // Durum seçimini sıfırla\r\n\r\n    });\r\n\r\n\r\n\r\n    // Fiyat alanları için Türk Lirası formatı\r\n\r\n    function formatTurkishCurrency(value) {\r\n\r\n        // Sayıyı string'e çevir ve sadece rakamları al\r\n\r\n        let numStr = value.toString().replace(/[^\\d]/g, '');\r\n\r\n        \r\n\r\n        if (numStr === '') return '';\r\n\r\n        \r\n\r\n        // Sayıyı integer'a çevir\r\n\r\n        let num = parseInt(numStr);\r\n\r\n        \r\n\r\n        // Kuruş için son 2 basamağı ayır\r\n\r\n        let kurus = num % 100;\r\n\r\n        let lira = Math.floor(num / 100);\r\n\r\n        \r\n\r\n        // Binlik ayırıcıları ekle\r\n\r\n        let liraStr = lira.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\r\n\r\n        \r\n\r\n        // Kuruşu 2 basamaklı yap\r\n\r\n        let kurusStr = kurus.toString().padStart(2, '0');\r\n\r\n        \r\n\r\n        return liraStr + ',' + kurusStr;\r\n\r\n    }\r\n\r\n\r\n\r\n    function parseTurkishCurrency(value) {\r\n\r\n        // Nokta ve virgülü kaldır, sadece rakamları al\r\n\r\n        let numStr = value.replace(/[^\\d]/g, '');\r\n\r\n        if (numStr === '') return 0;\r\n\r\n        return parseInt(numStr) / 100;\r\n\r\n    }\r\n\r\n\r\n\r\n    // Fiyat input alanlarına format uygula\r\n\r\n    $(document).on('input', '.fiyat-input', function() {\r\n\r\n        let cursorPos = this.selectionStart;\r\n\r\n        let oldValue = $(this).val();\r\n\r\n        let newValue = formatTurkishCurrency(oldValue);\r\n\r\n        \r\n\r\n        $(this).val(newValue);\r\n\r\n        \r\n\r\n        // Cursor pozisyonunu ayarla\r\n\r\n        let newCursorPos = cursorPos + (newValue.length - oldValue.length);\r\n\r\n        this.setSelectionRange(newCursorPos, newCursorPos);\r\n\r\n    });\r\n\r\n\r\n\r\n    // Form submit edilirken fiyatları doğru formata çevir\r\n\r\n    $('#potansiyelSatisEkleModal form').on('submit', function() {\r\n\r\n        $('.fiyat-input').each(function() {\r\n\r\n            let turkishValue = $(this).val();\r\n\r\n            let numericValue = parseTurkishCurrency(turkishValue);\r\n\r\n            $(this).val(numericValue);\r\n\r\n        });\r\n\r\n    });\r\n\r\n\r\n\r\n    // Autocomplete for Cari selection\r\n\r\n    $(\"#cari_autocomplete\").autocomplete({\r\n\r\n        source: function(request, response) {\r\n\r\n            console.log(\"Autocomplete source called with term:\", request.term);\r\n\r\n            $.ajax({\r\n\r\n                url: \"<?= base_url('illegal/potansiyel_cari_autocomplete') ?>\",\r\n\r\n                data: {\r\n\r\n                    term: request.term\r\n\r\n                },\r\n\r\n                dataType: \"json\",\r\n\r\n                success: function(data) {\r\n\r\n                    console.log(\"Autocomplete response:\", data);\r\n\r\n                    response(data);\r\n\r\n                },\r\n\r\n                error: function(xhr, status, error) {\r\n\r\n                    console.error(\"Autocomplete error:\", error);\r\n\r\n                    console.error(\"Response:\", xhr.responseText);\r\n\r\n                    response([]);\r\n\r\n                }\r\n\r\n            });\r\n\r\n        },\r\n\r\n        minLength: 4,\r\n\r\n        select: function(event, ui) {\r\n\r\n            event.preventDefault();\r\n\r\n            console.log(\"Selected item:\", ui.item);\r\n\r\n            $(\"#selected_cari_id\").val(ui.item.id);\r\n\r\n            $(\"#cari_autocomplete\").val(ui.item.value);\r\n\r\n            \r\n\r\n            // Show success message\r\n\r\n            toastr.success(ui.item.cari_ad + \" müşterisi seçildi.\");\r\n\r\n        },\r\n\r\n        focus: function(event, ui) {\r\n\r\n            event.preventDefault();\r\n\r\n            $(\"#cari_autocomplete\").val(ui.item.value);\r\n\r\n        }\r\n\r\n    });\r\n\r\n});\r\n\r\n</script>\r\n\r\n\r\n\r\n<script>\r\n\r\n\t// İllegal hazırlama sayfası için JavaScript kodları buraya eklenebilir\r\n\r\n</script>\r\n\r\n</body>\r\n\r\n</html>"
        }
    ]
}