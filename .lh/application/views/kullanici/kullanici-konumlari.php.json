{
    "sourceFile": "application/views/kullanici/kullanici-konumlari.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1756311206821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1756311206821,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"tr\">\r\n<head>\r\n\t<?php $this->load->view(\"include/head-tags\"); ?>\r\n\t<title>Kullanıcı Konumları | İlekaSoft CRM</title>\r\n\t<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" />\r\n\t<style>\r\n\t\t#map { \r\n\t\t\theight: 500px; \r\n\t\t\twidth: 100%;\r\n\t\t\tmargin-bottom: 20px;\r\n\t\t}\r\n\t\t.user-card {\r\n\t\t\tborder-left: 4px solid #007bff;\r\n\t\t\ttransition: all 0.3s ease;\r\n\t\t}\r\n\t\t.user-card:hover {\r\n\t\t\ttransform: translateY(-2px);\r\n\t\t\tbox-shadow: 0 4px 8px rgba(0,0,0,0.1);\r\n\t\t}\r\n\t\t.user-online { border-left-color: #28a745; }\r\n\t\t.user-offline { border-left-color: #6c757d; }\r\n\t\t.user-recent { border-left-color: #ffc107; }\r\n\t\t\r\n\t\t.status-online { color: #28a745; }\r\n\t\t.status-offline { color: #6c757d; }\r\n\t\t.status-recent { color: #ffc107; }\r\n\t\t\r\n\t\t.leaflet-popup-content {\r\n\t\t\tmargin: 8px 12px;\r\n\t\t\tline-height: 1.4;\r\n\t\t}\r\n\t</style>\r\n</head>\r\n<body>\r\n\t<!-- Main Wrapper -->\r\n\t<div class=\"main-wrapper\">\r\n\t\t<!-- Header -->\r\n\t\t<?php $this->load->view(\"include/header\"); ?>\r\n\t\t<!-- /Header -->\r\n\t\t\r\n\t\t<!-- Sidebar -->\r\n\t\t<?php $this->load->view(\"include/sidebar\"); ?>\r\n\t\t<!-- /Sidebar -->\r\n\t\t\r\n\t\t<!-- Page Wrapper -->\r\n\t\t<div class=\"page-wrapper\">\r\n\t\t\t<div class=\"content container-fluid\">\r\n\t\t\t\t<!-- Page Header -->\r\n\t\t\t\t<div class=\"page-header\">\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"col-sm-10\">\r\n\t\t\t\t\t\t\t<h3 class=\"page-title\">Kullanıcı Konumları</h3>\r\n\t\t\t\t\t\t\t<ul class=\"breadcrumb\">\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item\"><a href=\"<?= base_url(); ?>\">Anasayfa</a></li>\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item\">Yönetici</li>\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item active\">Kullanıcı Konumları</li>\r\n\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"d-flex justify-content-end text-align-center col-sm-2\">\r\n\t\t\t\t\t\t\t<a class=\"btn btn-outline-light\" href=\"javascript:history.back()\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-history\"></i><br>Önceki Sayfa\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- /Page Header -->\r\n\r\n\t\t\t\t<!-- İstatistikler -->\r\n\t\t\t\t<div class=\"row mb-4\">\r\n\t\t\t\t\t<?php \r\n\t\t\t\t\t\t$online_count = 0;\r\n\t\t\t\t\t\t$total_count = count($kullanici_konumlari);\r\n\t\t\t\t\t\t$recent_count = 0;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tforeach ($kullanici_konumlari as $user) {\r\n\t\t\t\t\t\t\tif ($user->is_online) $online_count++;\r\n\t\t\t\t\t\t\t$time_diff = time() - strtotime($user->last_update);\r\n\t\t\t\t\t\t\tif ($time_diff < 1800) $recent_count++; // 30 dakika\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t?>\r\n\t\t\t\t\t<div class=\"col-md-3\">\r\n\t\t\t\t\t\t<div class=\"card bg-primary text-white\">\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h3 class=\"mb-0\"><?= $total_count ?></h3>\r\n\t\t\t\t\t\t\t\t\t\t<p class=\"mb-0\">Toplam Kullanıcı</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-users fa-2x\"></i>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-md-3\">\r\n\t\t\t\t\t\t<div class=\"card bg-success text-white\">\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h3 class=\"mb-0\"><?= $online_count ?></h3>\r\n\t\t\t\t\t\t\t\t\t\t<p class=\"mb-0\">Online</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-circle fa-2x\"></i>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-md-3\">\r\n\t\t\t\t\t\t<div class=\"card bg-warning text-white\">\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h3 class=\"mb-0\"><?= $recent_count ?></h3>\r\n\t\t\t\t\t\t\t\t\t\t<p class=\"mb-0\">Son 30 dk</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-clock-o fa-2x\"></i>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-md-3\">\r\n\t\t\t\t\t\t<div class=\"card bg-info text-white\">\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h3 class=\"mb-0\"><?= $total_count - $online_count ?></h3>\r\n\t\t\t\t\t\t\t\t\t\t<p class=\"mb-0\">Offline</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-circle-o fa-2x\"></i>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<div class=\"col-md-12\">\r\n\t\t\t\t\t\t<!-- Harita -->\r\n\t\t\t\t\t\t<div class=\"card\">\r\n\t\t\t\t\t\t\t<div class=\"card-header\">\r\n\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"col\">\r\n\t\t\t\t\t\t\t\t\t\t<h5 class=\"card-title\">\r\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-map\"></i> Tüm Kullanıcılar Haritası\r\n\t\t\t\t\t\t\t\t\t\t</h5>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-auto\">\r\n\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-primary\" onclick=\"location.reload()\">\r\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-refresh\"></i> Yenile\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<div id=\"map\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<!-- Kullanıcı Listesi -->\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<?php if (empty($kullanici_konumlari)): ?>\r\n\t\t\t\t\t\t<div class=\"col-md-12\">\r\n\t\t\t\t\t\t\t<div class=\"card\">\r\n\t\t\t\t\t\t\t\t<div class=\"card-body text-center py-5\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-map-marker fa-3x text-muted mb-3\"></i>\r\n\t\t\t\t\t\t\t\t\t<h5 class=\"text-muted\">Henüz kullanıcı konum verisi bulunmamaktadır</h5>\r\n\t\t\t\t\t\t\t\t\t<p class=\"text-muted\">Kullanıcılar login oldukça konum bilgileri burada görünecektir.</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t<?php foreach ($kullanici_konumlari as $user): ?>\r\n\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t$time_diff = time() - strtotime($user->last_update);\r\n\t\t\t\t\t\t\t\t$status_class = '';\r\n\t\t\t\t\t\t\t\t$status_text = '';\r\n\t\t\t\t\t\t\t\t$status_icon = '';\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif ($user->is_online) {\r\n\t\t\t\t\t\t\t\t\t$status_class = 'user-online';\r\n\t\t\t\t\t\t\t\t\t$status_text = 'Online';\r\n\t\t\t\t\t\t\t\t\t$status_icon = 'fa-circle status-online';\r\n\t\t\t\t\t\t\t\t} elseif ($time_diff < 1800) { // 30 dakika\r\n\t\t\t\t\t\t\t\t\t$status_class = 'user-recent';\r\n\t\t\t\t\t\t\t\t\t$status_text = 'Son aktif';\r\n\t\t\t\t\t\t\t\t\t$status_icon = 'fa-clock-o status-recent';\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$status_class = 'user-offline';\r\n\t\t\t\t\t\t\t\t\t$status_text = 'Offline';\r\n\t\t\t\t\t\t\t\t\t$status_icon = 'fa-circle-o status-offline';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// Zaman hesaplama\r\n\t\t\t\t\t\t\t\tif ($time_diff < 60) $time_text = $time_diff . ' saniye önce';\r\n\t\t\t\t\t\t\t\telseif ($time_diff < 3600) $time_text = floor($time_diff/60) . ' dakika önce';\r\n\t\t\t\t\t\t\t\telseif ($time_diff < 86400) $time_text = floor($time_diff/3600) . ' saat önce';\r\n\t\t\t\t\t\t\t\telse $time_text = floor($time_diff/86400) . ' gün önce';\r\n\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t<div class=\"col-md-6 mb-3\">\r\n\t\t\t\t\t\t\t\t<div class=\"card user-card <?= $status_class ?>\" \r\n\t\t\t\t\t\t\t\t\t onclick=\"showUserOnMap(<?= $user->latitude ?>, <?= $user->longitude ?>, '<?= addslashes($user->kullanici_ad . ' ' . $user->kullanici_soyad) ?>')\"\r\n\t\t\t\t\t\t\t\t\t style=\"cursor: pointer;\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"row align-items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-8\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"d-flex align-items-center mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"avatar avatar-sm mr-3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"avatar-title bg-primary rounded-circle\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= strtoupper(substr($user->kullanici_ad, 0, 1) . substr($user->kullanici_soyad, 0, 1)) ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h6 class=\"mb-0\"><?= $user->kullanici_ad . ' ' . $user->kullanici_soyad ?></h6>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\"><?= $user->kullanici_eposta ?></small>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"mb-1 small\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-map-marker text-primary\"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $user->address ?: $user->latitude . ', ' . $user->longitude ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-clock-o\"></i> \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tSon güncelleme: <?= $time_text ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4 text-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa <?= $status_icon ?>\"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"ml-1\"><?= $status_text ?></small>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($user->accuracy): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-<?= $user->accuracy <= 50 ? 'success' : ($user->accuracy <= 200 ? 'warning' : 'danger') ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= round($user->accuracy) ?>m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= base_url('kullanici/konum_gecmisi?kullanici_id=' . $user->kullanici_id) ?>\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   class=\"btn btn-sm btn-outline-primary\" onclick=\"event.stopPropagation();\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-history\"></i> Geçmiş\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<!-- /Page Wrapper -->\r\n\t</div>\r\n\t<!-- /Main Wrapper -->\r\n\r\n\t<?php $this->load->view(\"include/footer-js\"); ?>\r\n\t<script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"></script>\r\n\t\r\n\t<script>\r\n\t\t// Harita başlat\r\n\t\tvar map = L.map('map').setView([39.9334, 32.8597], 6); // Ankara merkez\r\n\r\n\t\tL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n\t\t\tattribution: '© OpenStreetMap contributors'\r\n\t\t}).addTo(map);\r\n\r\n\t\tvar markers = [];\r\n\t\tvar kullanicilar = <?= json_encode($kullanici_konumlari) ?>;\r\n\r\n\t\t// Kullanıcı ikonları\r\n\t\tvar onlineIcon = L.divIcon({\r\n\t\t\thtml: '<div style=\"background-color: #28a745; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);\"></div>',\r\n\t\t\ticonSize: [20, 20],\r\n\t\t\ticonAnchor: [10, 10]\r\n\t\t});\r\n\r\n\t\tvar recentIcon = L.divIcon({\r\n\t\t\thtml: '<div style=\"background-color: #ffc107; width: 18px; height: 18px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 8px rgba(0,0,0,0.3);\"></div>',\r\n\t\t\ticonSize: [18, 18],\r\n\t\t\ticonAnchor: [9, 9]\r\n\t\t});\r\n\r\n\t\tvar offlineIcon = L.divIcon({\r\n\t\t\thtml: '<div style=\"background-color: #6c757d; width: 15px; height: 15px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3);\"></div>',\r\n\t\t\ticonSize: [15, 15],\r\n\t\t\ticonAnchor: [7, 7]\r\n\t\t});\r\n\r\n\t\tif (kullanicilar.length > 0) {\r\n\t\t\tkullanicilar.forEach(function(user, index) {\r\n\t\t\t\tvar timeDiff = Math.floor((Date.now() - new Date(user.last_update).getTime()) / 1000);\r\n\t\t\t\tvar icon = offlineIcon;\r\n\t\t\t\tvar statusText = 'Offline';\r\n\t\t\t\t\r\n\t\t\t\tif (user.is_online == 1) {\r\n\t\t\t\t\ticon = onlineIcon;\r\n\t\t\t\t\tstatusText = 'Online';\r\n\t\t\t\t} else if (timeDiff < 1800) {\r\n\t\t\t\t\ticon = recentIcon;\r\n\t\t\t\t\tstatusText = 'Son aktif';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar marker = L.marker([user.latitude, user.longitude], { icon: icon })\r\n\t\t\t\t\t.bindPopup(`\r\n\t\t\t\t\t\t<div style=\"min-width: 250px;\">\r\n\t\t\t\t\t\t\t<div class=\"d-flex align-items-center mb-2\">\r\n\t\t\t\t\t\t\t\t<strong class=\"mr-2\">${user.kullanici_ad} ${user.kullanici_soyad}</strong>\r\n\t\t\t\t\t\t\t\t<span class=\"badge badge-${user.is_online ? 'success' : (timeDiff < 1800 ? 'warning' : 'secondary')}\">${statusText}</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<small class=\"text-muted d-block\">${user.kullanici_eposta}</small>\r\n\t\t\t\t\t\t\t<hr class=\"my-2\">\r\n\t\t\t\t\t\t\t<div class=\"small\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-map-marker text-primary\"></i> \r\n\t\t\t\t\t\t\t\t${user.address || user.latitude + ', ' + user.longitude}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"small mt-1\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-clock-o text-muted\"></i> \r\n\t\t\t\t\t\t\t\t${user.last_update}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t${user.accuracy ? `<div class=\"small mt-1\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-crosshairs text-info\"></i> \r\n\t\t\t\t\t\t\t\tDoğruluk: ${Math.round(user.accuracy)}m\r\n\t\t\t\t\t\t\t</div>` : ''}\r\n\t\t\t\t\t\t\t<div class=\"mt-2\">\r\n\t\t\t\t\t\t\t\t<a href=\"<?= base_url('kullanici/konum_gecmisi?kullanici_id=') ?>${user.kullanici_id}\" \r\n\t\t\t\t\t\t\t\t   class=\"btn btn-sm btn-primary\" style=\"font-size: 11px;\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-history\"></i> Geçmişi Görüntüle\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t`);\r\n\t\t\t\t\r\n\t\t\t\tmarkers.push(marker);\r\n\t\t\t\tmarker.addTo(map);\r\n\t\t\t});\r\n\r\n\t\t\t// Haritayı tüm kullanıcıları içerecek şekilde ayarla\r\n\t\t\tvar group = new L.featureGroup(markers);\r\n\t\t\tmap.fitBounds(group.getBounds().pad(0.1));\r\n\t\t}\r\n\r\n\t\t// Kullanıcıyı haritada göster\r\n\t\tfunction showUserOnMap(lat, lng, name) {\r\n\t\t\tmap.setView([lat, lng], 15);\r\n\t\t\t\r\n\t\t\t// İlgili marker'ı bul ve popup aç\r\n\t\t\tmarkers.forEach(function(marker) {\r\n\t\t\t\tif (Math.abs(marker.getLatLng().lat - lat) < 0.00001 && \r\n\t\t\t\t\tMath.abs(marker.getLatLng().lng - lng) < 0.00001) {\r\n\t\t\t\t\tmarker.openPopup();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Otomatik yenileme (5 dakikada bir)\r\n\t\tsetInterval(function() {\r\n\t\t\tlocation.reload();\r\n\t\t}, 300000); // 5 dakika\r\n\r\n\t\tconsole.log('Kullanıcı Konumları sayfası yüklendi. Toplam kullanıcı:', kullanicilar.length);\r\n\t</script>\r\n</body>\r\n</html>\r\n"
        }
    ]
}