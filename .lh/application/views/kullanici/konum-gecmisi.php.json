{
    "sourceFile": "application/views/kullanici/konum-gecmisi.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1756311206821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1756311206821,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"tr\">\r\n<head>\r\n\t<?php $this->load->view(\"include/head-tags\"); ?>\r\n\t<title>Konum Geçmişi | İlekaSoft CRM</title>\r\n\t<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\" />\r\n\t<style>\r\n\t\t#map { \r\n\t\t\theight: 400px; \r\n\t\t\twidth: 100%;\r\n\t\t\tmargin-bottom: 20px;\r\n\t\t}\r\n\t\t.konum-item {\r\n\t\t\tborder-left: 4px solid #007bff;\r\n\t\t\tbackground-color: #f8f9fa;\r\n\t\t}\r\n\t\t.konum-item:hover {\r\n\t\t\tbackground-color: #e9ecef;\r\n\t\t}\r\n\t\t.accuracy-good { border-left-color: #28a745; }\r\n\t\t.accuracy-medium { border-left-color: #ffc107; }\r\n\t\t.accuracy-poor { border-left-color: #dc3545; }\r\n\t</style>\r\n</head>\r\n<body>\r\n\t<!-- Main Wrapper -->\r\n\t<div class=\"main-wrapper\">\r\n\t\t<!-- Header -->\r\n\t\t<?php $this->load->view(\"include/header\"); ?>\r\n\t\t<!-- /Header -->\r\n\t\t\r\n\t\t<!-- Sidebar -->\r\n\t\t<?php $this->load->view(\"include/sidebar\"); ?>\r\n\t\t<!-- /Sidebar -->\r\n\t\t\r\n\t\t<!-- Page Wrapper -->\r\n\t\t<div class=\"page-wrapper\">\r\n\t\t\t<div class=\"content container-fluid\">\r\n\t\t\t\t<!-- Page Header -->\r\n\t\t\t\t<div class=\"page-header\">\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<div class=\"col-sm-10\">\r\n\t\t\t\t\t\t\t<h3 class=\"page-title\">Konum Geçmişi</h3>\r\n\t\t\t\t\t\t\t<ul class=\"breadcrumb\">\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item\"><a href=\"<?= base_url(); ?>\">Anasayfa</a></li>\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item\">Kullanıcı</li>\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item active\">Konum Geçmişi</li>\r\n\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"d-flex justify-content-end text-align-center col-sm-2\">\r\n\t\t\t\t\t\t\t<a class=\"btn btn-outline-light\" href=\"javascript:history.back()\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-history\"></i><br>Önceki Sayfa\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<!-- /Page Header -->\r\n\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<div class=\"col-md-12\">\r\n\t\t\t\t\t\t<!-- Harita -->\r\n\t\t\t\t\t\t<div class=\"card\">\r\n\t\t\t\t\t\t\t<div class=\"card-header\">\r\n\t\t\t\t\t\t\t\t<h5 class=\"card-title\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-map-marker\"></i> Konum Haritası\r\n\t\t\t\t\t\t\t\t</h5>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<div id=\"map\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<!-- Konum Listesi -->\r\n\t\t\t\t\t\t<div class=\"card\">\r\n\t\t\t\t\t\t\t<div class=\"card-header\">\r\n\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"col\">\r\n\t\t\t\t\t\t\t\t\t\t<h5 class=\"card-title\">\r\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-list\"></i> Konum Geçmişi \r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-primary\"><?= count($konum_gecmisi) ?></span>\r\n\t\t\t\t\t\t\t\t\t\t</h5>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-auto\">\r\n\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-primary\" onclick=\"konumTakibi.updateLocation()\">\r\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-refresh\"></i> Konumu Güncelle\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<?php if (empty($konum_gecmisi)): ?>\r\n\t\t\t\t\t\t\t\t\t<div class=\"text-center py-5\">\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-map-marker fa-3x text-muted mb-3\"></i>\r\n\t\t\t\t\t\t\t\t\t\t<h5 class=\"text-muted\">Henüz konum kaydı bulunmamaktadır</h5>\r\n\t\t\t\t\t\t\t\t\t\t<p class=\"text-muted\">Konum takibi otomatik olarak başlayacaktır.</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t<div class=\"timeline\">\r\n\t\t\t\t\t\t\t\t\t\t<?php foreach ($konum_gecmisi as $index => $konum): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t\t$accuracy_class = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ($konum->accuracy <= 50) $accuracy_class = 'accuracy-good';\r\n\t\t\t\t\t\t\t\t\t\t\t\telseif ($konum->accuracy <= 200) $accuracy_class = 'accuracy-medium';\r\n\t\t\t\t\t\t\t\t\t\t\t\telse $accuracy_class = 'accuracy-poor';\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t$time_ago = time() - strtotime($konum->created_at);\r\n\t\t\t\t\t\t\t\t\t\t\t\t$time_text = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ($time_ago < 60) $time_text = $time_ago . ' saniye önce';\r\n\t\t\t\t\t\t\t\t\t\t\t\telseif ($time_ago < 3600) $time_text = floor($time_ago/60) . ' dakika önce';\r\n\t\t\t\t\t\t\t\t\t\t\t\telseif ($time_ago < 86400) $time_text = floor($time_ago/3600) . ' saat önce';\r\n\t\t\t\t\t\t\t\t\t\t\t\telse $time_text = floor($time_ago/86400) . ' gün önce';\r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"card mb-3 konum-item <?= $accuracy_class ?>\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t onclick=\"showOnMap(<?= $konum->latitude ?>, <?= $konum->longitude ?>, '<?= addslashes($konum->address) ?>')\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"row align-items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-8\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h6 class=\"mb-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-clock-o text-primary\"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= date('d.m.Y H:i:s', strtotime($konum->created_at)) ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted ml-2\">(<?= $time_text ?>)</small>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</h6>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"mb-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-map-marker text-success\"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $konum->address ?: $konum->latitude . ', ' . $konum->longitude ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($konum->device_info): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-mobile\"></i> <?= $konum->device_info ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4 text-right\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted d-block\">Koordinat</small>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong class=\"small\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= round($konum->latitude, 6) ?>,<br>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= round($konum->longitude, 6) ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</strong>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted d-block\">Doğruluk</small>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-<?= $konum->accuracy <= 50 ? 'success' : ($konum->accuracy <= 200 ? 'warning' : 'danger') ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= round($konum->accuracy) ?>m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<!-- /Page Wrapper -->\r\n\t</div>\r\n\t<!-- /Main Wrapper -->\r\n\r\n\t<?php $this->load->view(\"include/footer-js\"); ?>\r\n\t<script src=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\"></script>\r\n\t<script src=\"<?= base_url('assets/js/konum-takibi.js') ?>\"></script>\r\n\t\r\n\t<script>\r\n\t\t// Harita başlat\r\n\t\tvar map = L.map('map').setView([39.9334, 32.8597], 6); // Ankara merkez\r\n\r\n\t\tL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n\t\t\tattribution: '© OpenStreetMap contributors'\r\n\t\t}).addTo(map);\r\n\r\n\t\tvar markers = [];\r\n\t\tvar konumlar = <?= json_encode($konum_gecmisi) ?>;\r\n\r\n\t\tif (konumlar.length > 0) {\r\n\t\t\t// Tüm konumları haritaya ekle\r\n\t\t\tkonumlar.forEach(function(konum, index) {\r\n\t\t\t\tvar marker = L.marker([konum.latitude, konum.longitude])\r\n\t\t\t\t\t.bindPopup(`\r\n\t\t\t\t\t\t<div style=\"min-width: 200px;\">\r\n\t\t\t\t\t\t\t<strong>${konum.address || konum.latitude + ', ' + konum.longitude}</strong><br>\r\n\t\t\t\t\t\t\t<small class=\"text-muted\">${konum.created_at}</small><br>\r\n\t\t\t\t\t\t\t<small>Doğruluk: ${Math.round(konum.accuracy)}m</small>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t`);\r\n\t\t\t\t\r\n\t\t\t\tmarkers.push(marker);\r\n\t\t\t\tmarker.addTo(map);\r\n\t\t\t});\r\n\r\n\t\t\t// Haritayı tüm konumları içerecek şekilde ayarla\r\n\t\t\tvar group = new L.featureGroup(markers);\r\n\t\t\tmap.fitBounds(group.getBounds().pad(0.1));\r\n\t\t}\r\n\r\n\t\t// Haritada konumu göster\r\n\t\tfunction showOnMap(lat, lng, address) {\r\n\t\t\tmap.setView([lat, lng], 15);\r\n\t\t\t\r\n\t\t\t// Popup aç\r\n\t\t\tmarkers.forEach(function(marker) {\r\n\t\t\t\tif (marker.getLatLng().lat === lat && marker.getLatLng().lng === lng) {\r\n\t\t\t\t\tmarker.openPopup();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Sayfa yüklendiğinde en son konum takibi durumunu göster\r\n\t\tdocument.addEventListener('DOMContentLoaded', function() {\r\n\t\t\tconsole.log('Konum Geçmişi sayfası yüklendi');\r\n\t\t});\r\n\t</script>\r\n</body>\r\n</html>\r\n"
        }
    ]
}