{
    "sourceFile": "application/views/tahsilat/tahsilat-olustur.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754924666051,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754924666051,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n\r\n<html lang=\"tr\">\r\n\r\n<head>\r\n\r\n<?php $this->load->view(\"include/head-tags\"); ?>\r\n\r\n<style>\r\n\r\n\t.ui-autocomplete {\r\n\r\n\t\tz-index: 999999;\r\n\r\n\t\tmax-height: 200px;\r\n\r\n\t\toverflow-y: auto;\r\n\r\n\t\t/* prevent horizontal scrollbar */\r\n\r\n\t\toverflow-x: hidden;\r\n\r\n\t\t/* add padding to account for vertical scrollbar */\r\n\r\n\t\tpadding-right: 20px;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t/* Senet detay kartları için özel stiller */\r\n\r\n\t.senet-card {\r\n\r\n\t\ttransition: transform 0.2s ease, box-shadow 0.2s ease;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-card:hover {\r\n\r\n\t\ttransform: translateY(-2px);\r\n\r\n\t\tbox-shadow: 0 4px 8px rgba(0,0,0,0.1);\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-card .card-header {\r\n\r\n\t\tfont-weight: 600;\r\n\r\n\t\tborder-bottom: 2px solid rgba(255,255,255,0.2);\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t/* Kontrol alanları için grid layout */\r\n\r\n\t.senet-kontrol-alanlari {\r\n\r\n\t\tbackground: #f8f9fa;\r\n\r\n\t\tborder-radius: 8px;\r\n\r\n\t\tpadding: 20px;\r\n\r\n\t\tmargin-bottom: 20px;\r\n\r\n\t\tborder: 1px solid #e9ecef;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-kontrol-alanlari .form-group label {\r\n\r\n\t\tfont-weight: 600;\r\n\r\n\t\tcolor: #495057;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t/* Senet detayları için animasyon */\r\n\r\n\t#senet_detaylari {\r\n\r\n\t\tanimation: fadeInUp 0.3s ease;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t/* Senet dosya upload alanları */\r\n\r\n\t.senet-dosya-alani {\r\n\r\n\t\tbackground: #f8f9fa;\r\n\r\n\t\tborder-radius: 6px;\r\n\r\n\t\tpadding: 15px;\r\n\r\n\t\tborder: 1px dashed #dee2e6;\r\n\r\n\t\tmargin-top: 10px;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-dosya-alani:hover {\r\n\r\n\t\tborder-color: #007bff;\r\n\r\n\t\tbackground: #e7f1ff;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-dosya-alani label {\r\n\r\n\t\tmargin-bottom: 8px;\r\n\r\n\t\tfont-weight: 500;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-dosya-alani .form-control {\r\n\r\n\t\tborder: none;\r\n\r\n\t\tbackground: transparent;\r\n\r\n\t\tpadding: 8px 0;\r\n\r\n\t}\r\n\r\n\t\t.senet-dosya-alani small.text-muted {\r\n\r\n\t\tfont-size: 0.75rem;\r\n\r\n\t\tmargin-top: 5px;\r\n\r\n\t\tdisplay: block;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-dosya-alani.has-error {\r\n\r\n\t\tborder-color: #dc3545;\r\n\r\n\t\tbackground-color: #f8d7da;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-dosya-alani .file-error {\r\n\r\n\t\tcolor: #721c24 !important;\r\n\r\n\t\tfont-weight: 500;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t.senet-dosya-alani .file-success {\r\n\r\n\t\tcolor: #155724 !important;\r\n\r\n\t\tfont-weight: 500;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t@keyframes fadeInUp {\r\n\r\n\t\tfrom {\r\n\r\n\t\t\topacity: 0;\r\n\r\n\t\t\ttransform: translateY(20px);\r\n\r\n\t\t}\r\n\r\n\t\tto {\r\n\r\n\t\t\topacity: 1;\r\n\r\n\t\t\ttransform: translateY(0);\r\n\r\n\t\t}\t}\r\n\r\n</style>\r\n\r\n</head>\r\n\r\n<body>\r\n\r\n\t\r\n\r\n\t<!-- Main Wrapper -->\r\n\r\n\t<div class=\"main-wrapper\">\r\n\r\n\t\t<!-- Header -->\r\n\r\n\t\t<?php $this->load->view(\"include/header\"); ?>\r\n\r\n\t\t<!-- /Header -->\r\n\r\n\t\t\r\n\r\n\t\t<!-- Sidebar -->\r\n\r\n\t\t<?php $this->load->view(\"include/sidebar\"); ?>\r\n\r\n\t\t<!-- /Sidebar -->\r\n\r\n\t\t\r\n\r\n\t\t<!-- Page Wrapper -->\r\n\r\n\t\t<div class=\"page-wrapper\">\r\n\r\n\t\t\t<div class=\"content container-fluid\">\r\n\r\n\t\t\t\r\n\r\n\t\t\t\t<!-- Page Header -->\r\n\r\n\t\t\t\t<div class=\"page-header\">\r\n\r\n\t\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t\t<div class=\"col-sm-10\">\r\n\r\n\t\t\t\t\t\t\t<h3 class=\"page-title\">Tahsilat</h3>\r\n\r\n\t\t\t\t\t\t\t<ul class=\"breadcrumb\">\r\n\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item\"><a href=\"<?= base_url();?>\">Anasayfa</a></li>\r\n\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item\">Tahsilat</li>\r\n\r\n\t\t\t\t\t\t\t\t<li class=\"breadcrumb-item active\">Tahsilat Oluştur</li>\r\n\r\n\t\t\t\t\t\t\t</ul>\r\n\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"d-flex justify-content-end text-align-center col-sm-2\">\r\n\r\n\t\t\t\t\t\t\t<a class=\"btn btn-outline-light\" href=\"javascript:history.back()\"><i class=\"fa fa-history\"></i> <br>Önceki Sayfa</a>\r\n\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<!-- /Page Header -->\r\n\r\n\t\t\t\t\r\n\r\n\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t<div class=\"col-md-12\">\r\n\r\n\t\t\t\t\t\t<div class=\"card\">\r\n\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\t\t\t\t\t\t\t\t<h4 class=\"card-title\">Cari Bilgileri</h4>\r\n\r\n\t\t\t\t\t\t\t\t<form id=\"tahsilatForm\" action=\"<?= base_url(\"tahsilat/tahsilat_kaydet\"); ?>\" method=\"POST\" enctype=\"multipart/form-data\">\r\n\r\n\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"cari_id\" id=\"cari_id\">\r\n\r\n\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"tahsilat_cariKodu\" id=\"kod_input\">\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-8\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Cari TCKN/VKN Veya Cari Adı</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"tahsilat_cariAdi\" required=\"\" \r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   id=\"tcknvkn_input\" \r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"Cari tckn/vkn veya cari adı yazmaya başlayıp, listeden seçiniz.\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>B/A (Bakiye)</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"cari_bakiye_display\" style=\"padding: 8px; border: 1px solid #ddd; border-radius: 4px; background-color: #f8f9fa; min-height: 38px; display: flex; align-items: center;\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">Cari seçildikten sonra bakiye görünecek</span>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<h4 class=\"card-title\">Ödeme Yöntemi</h4>\r\n\r\n\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Ödeme Türü</label>\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"select form-control\" name=\"tahsilat_odemeTipi\" id=\"odemeTipi\" required=\"\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Ödeme türü seçiniz...</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"1\">Kasa</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"2\">Banka / POS</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"3\">Çek</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"4\">Senet</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t<?php\r\n\r\n$vaults = getVaultsofCompany();\r\n\r\n$banks = getBanksofCompany();\r\n\r\n\t\t\t\t\t\t\t\t\t\t?>\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\" id=\"kasa_dropdown_container\" style=\"display: none;\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Kasa</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($user_assigned_kasa) && $user_assigned_kasa): ?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"select form-control\" name=\"tahsilat_kasaID\" id=\"kasa\" disabled>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"<?= $user_assigned_kasa->kasa_id; ?>\" selected><?= $user_assigned_kasa->kasa_adi; ?></option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-success\">Size atanmış kasa otomatik seçilmiştir.</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"select form-control\" name=\"tahsilat_kasaID\" id=\"kasa\" disabled>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Kasa bulunamadı</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-danger\">Size atanmış bir kasa bulunmuyor. Lütfen sistem yöneticisi ile iletişime geçin.</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\" id=\"banka_dropdown_container\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Banka</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"select form-control\" name=\"tahsilat_bankaID\" id=\"banka\" disabled>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Banka seçiniz...</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php foreach($banks as $ba){?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"<?= $ba->banka_id; ?>\"><?= $ba->banka_bankaAd.\" - \".$ba->banka_hesapAd; ?></option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<?php }?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-12\" id=\"banka_dosya_alani\" style=\"display: none;\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Dekont/Banka Belgesi <small class=\"text-muted\">(İsteğe bağlı - JPG, PNG, GIF, PDF - Max: 5MB)</small></label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"file\" class=\"form-control\" name=\"banka_gorsel\" id=\"banka_gorsel\" accept=\".jpg,.jpeg,.png,.gif,.pdf\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Mobilde: Dosya seçtikten sonra başka uygulama açmayın</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Dekont ya da banka belgesini yükleyebilirsiniz</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<!-- Çek Bilgileri -->\r\n\r\n\t\t\t\t\t\t\t\t\t<div id=\"cek_alanlari\" style=\"display: none;\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t<h4 class=\"card-title\">Çek Bilgileri</h4>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<?php $bankalarq = \"SELECT * FROM turkiyeBankalarListesi\";\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$bankalarExe = $this->db->query($bankalarq)->result();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>Çek Bankası</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control select\" name=\"cek_bankaID\" id=\"cek_bankaID\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Banka seçiniz...</option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php foreach($bankalarExe as $banka){?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"<?= $banka->trbanka_id?>\"><?= $banka->trbanka_ad;?></option>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php }?>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>Banka Şubesi</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"cek_bankaSube\" id=\"cek_bankaSube\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-12\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>Çek Görseli <small class=\"text-muted\">(İsteğe bağlı - JPG, PNG, GIF, PDF - Max: 5MB)</small></label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"file\" class=\"form-control\" name=\"cek_gorsel\" id=\"cek_gorsel\" accept=\".jpg,.jpeg,.png,.gif,.pdf\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Mobilde: Dosya seçtikten sonra başka uygulama açmayın</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Çek görselini yükleyebilirsiniz</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<!-- Senet Bilgileri -->\r\n\r\n\t\t\t\t\t\t\t\t\t<div id=\"senet_alanlari\" style=\"display: none;\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t<h4 class=\"card-title\">Senet Bilgileri</h4>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Senet Kontrol Alanları -->\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"senet-kontrol-alanlari\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label>Senet Birim Tutarı</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" step=\"0.01\" class=\"form-control\" name=\"senet_tutari\" id=\"senet_tutari\" placeholder=\"Örn: 1000\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Her bir senedin tutarı</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label>Senet Adedi</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" min=\"1\" max=\"10\" class=\"form-control\" name=\"senet_adedi\" id=\"senet_adedi\" placeholder=\"Örn: 3\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Kaç adet senet (1-10)</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label>İlk Vade Tarihi</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"datepicker form-control\" name=\"senet_vade_tarihi\" id=\"senet_vade_tarihi\" autocomplete=\"off\" placeholder=\"gg.aa.yyyy\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">İlk senedin vade tarihi</small>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t\t<!-- Dinamik Senet Detay Alanları -->\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div id=\"senet_detaylari\" style=\"display: none;\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<hr>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<h5 class=\"text-primary\">Senet Detayları</h5>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div id=\"senet_detay_container\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- Dinamik senet kutucukları buraya gelecek -->\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t<h4 class=\"card-title\">Ödeme Bilgileri</h4>\r\n\r\n\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Tarih</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"datepicker form-control\" name=\"tahsilat_tarih\" required=\"\" autocomplete=\"off\" value=\"<?= getirBugun(); ?>\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Tutar</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" step=\"0.01\" class=\"form-control\" name=\"tahsilat_tutar\" id=\"tahsilat_tutar\" required=\"\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-12\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label>Açıklama</label>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<textarea class=\"form-control\" name=\"tahsilat_aciklama\"></textarea>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"btn btn-danger\" style=\"width:100%;\">Kaydet</button>\r\n\r\n\t\t\t\t\t\t\t\t</form>\r\n\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\r\n\t\t</div>\r\n\r\n\t\t<!-- /Page Wrapper -->\r\n\r\n\t\t\r\n\r\n\t</div>\r\n\r\n\t<!-- /Main Wrapper -->\r\n\r\n\t<?php if ($this->session->flashdata('tahsilat_ok')): ?>\r\n\r\n\t<script>\r\n\r\n\tswal({\r\n\r\n\t  title: \"Bilgilendirme\",\r\n\r\n\t  type: \"success\",\r\n\r\n\t  text: \"<?= $this->session->flashdata('tahsilat_ok'); ?>\",\r\n\r\n\t  confirmButtonText:'Tamam',\r\n\r\n\t  button: false,\r\n\r\n\t  timer: 5000,\r\n\r\n\t});\r\n\r\n\t</script>\r\n\r\n\t<?php endif; ?>\r\n\r\n\r\n\r\n\t<?php if ($this->session->flashdata('tahsilat_hata')): ?>\r\n\r\n\t<script>\r\n\r\n\tswal({\r\n\r\n\t  title: \"Bilgilendirme\",\r\n\r\n\t  type: \"error\", \r\n\r\n\t  text: \"<?= $this->session->flashdata('tahsilat_hata'); ?>\",\r\n\r\n\t  confirmButtonText:'Tamam',\r\n\r\n\t  button: false,\r\n\r\n\t  timer: 5000,\r\n\r\n\t});\r\n\r\n\t</script>\r\n\r\n\t<?php endif; ?>\r\n\r\n\t\r\n\r\n\t<?php $this->load->view(\"include/footer-js\"); ?>\r\n\r\n\r\n\r\n<script>\r\n\r\n$(function(){\r\n\r\n   $('.datepicker').datepicker({\r\n\r\n      dateFormat: 'dd.mm.yy',\r\n\r\n      language: 'tr'\r\n\r\n    });\r\n\r\n});\r\n\r\n\r\n\r\n\t$(function() {\r\n\r\n\t    $(\"#tcknvkn_input\").autocomplete({\r\n\r\n\t        source: \"<?= base_url(); ?>fatura/autocompleteDataByTcknVknEarsiv\",\r\n\r\n\t        minLength: 4,\r\n\r\n\t        select: function( event, ui ) {\r\n\r\n\t            event.preventDefault();\r\n\r\n\r\n\r\n\t\t\t\t$(\"#cari_id\").val(ui.item.id);\r\n\r\n            \t$(\"#tcknvkn_input\").val(ui.item.value);\r\n\r\n            \t$(\"#kod_input\").val(ui.item.cari_kodu);\r\n\r\n            \t\r\n\r\n            \t// Bakiye bilgisini getir\r\n\r\n            \tcariBakiyeGetir(ui.item.id);\r\n\r\n\t        }\r\n\r\n\t    });\r\n\r\n\t});\r\n\r\n\r\n\r\n\t// Clear fields when input is empty\r\n\r\n\t$(\"#tcknvkn_input\").on(\"keyup\", function () {\r\n\r\n\t\tvar input = $(\"#tcknvkn_input\").val();\r\n\r\n\r\n\r\n\t\tif(input == \"\") {\r\n\r\n\t\t\t$(\"#cari_id\").val(\"\");\r\n\r\n\t\t\t$(\"#kod_input\").val(\"\");\r\n\r\n\t\t\t$(\"#cari_bakiye_display\").html('<span class=\"text-muted\">Cari seçildikten sonra bakiye görünecek</span>');\r\n\r\n\t\t}\r\n\r\n\t});\t// Cari bakiye getir fonksiyonu\r\n\r\n\tfunction cariBakiyeGetir(cari_id) {\r\n\r\n\t\tconsole.log('Bakiye getiriliyor, cari_id:', cari_id);\r\n\r\n\t\t$.ajax({\r\n\r\n\t\t\turl: \"<?= base_url(); ?>cari/cariBakiyeGetir\",\r\n\r\n\t\t\ttype: \"POST\",\r\n\r\n\t\t\tdata: {\r\n\r\n\t\t\t\tcari_id: cari_id\r\n\r\n\t\t\t},\r\n\r\n\t\t\tdataType: \"json\",\r\n\r\n\t\t\tsuccess: function(response) {\r\n\r\n\t\t\t\tconsole.log('Bakiye response:', response);\r\n\r\n\t\t\t\tif(response.success) {\r\n\r\n\t\t\t\t\t$(\"#cari_bakiye_display\").html(response.bakiye);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t$(\"#cari_bakiye_display\").html('<span class=\"text-danger\">Bakiye alınamadı: ' + (response.message || 'Bilinmeyen hata') + '</span>');\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\terror: function(xhr, status, error) {\r\n\r\n\t\t\t\tconsole.error('Bakiye Ajax hatası:', error);\r\n\r\n\t\t\t\tconsole.error('Status:', status);\r\n\r\n\t\t\t\tconsole.error('Response:', xhr.responseText);\r\n\r\n\t\t\t\t$(\"#cari_bakiye_display\").html('<span class=\"text-danger\">Bakiye alınamadı (bağlantı hatası)</span>');\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\t// Payment method selection logic\r\n\r\n\t$(\"#odemeTipi\").on('change',function(){\r\n\r\n\t\tvar status = $(this).val();\r\n\r\n\t\t\r\n\r\n\t\tif(status == 1){\r\n\r\n\t\t\t// Show kasa dropdown, hide banka dropdown\r\n\r\n\t\t\t$(\"#kasa_dropdown_container\").show();\r\n\r\n\t\t\t$(\"#banka_dropdown_container\").hide();\r\n\r\n\t\t\t\r\n\r\n\t\t\t$(\"#kasa\").prop('disabled', false);\r\n\r\n\t\t\t$(\"#banka\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#banka\").val('').change();\r\n\r\n\t\t\t$(\"#cek_alanlari\").hide();\r\n\r\n\t\t\t$(\"#senet_alanlari\").hide();\r\n\r\n\t\t\t$(\"#banka_dosya_alani\").hide();\r\n\r\n\t\t\tclearCekFields();\r\n\r\n\t\t\tclearSenetFields();\r\n\r\n\t\t\t// Tutar alanını aktif yap\r\n\r\n\t\t\t$(\"#tahsilat_tutar\").prop('disabled', false).prop('required', true);\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Auto-select and disable user's assigned kasa if available\r\n\r\n\t\t\t<?php if (isset($user_assigned_kasa) && $user_assigned_kasa): ?>\r\n\r\n\t\t\t$(\"#kasa\").val('<?php echo $user_assigned_kasa->kasa_id; ?>').change();\r\n\r\n\t\t\t$(\"#kasa\").prop('disabled', true); // Disable so user cannot change it\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Disabled alanın değerini göndermek için hidden input ekle\r\n\r\n\t\t\tvar hiddenKasaInput = $('input[name=\"tahsilat_kasaID_hidden\"]');\r\n\r\n\t\t\tif (hiddenKasaInput.length === 0) {\r\n\r\n\t\t\t\t$('#tahsilatForm').append('<input type=\"hidden\" name=\"tahsilat_kasaID_hidden\" value=\"<?php echo $user_assigned_kasa->kasa_id; ?>\">');\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\thiddenKasaInput.val('<?php echo $user_assigned_kasa->kasa_id; ?>');\r\n\r\n\t\t\t}\r\n\r\n\t\t\t<?php else: ?>\r\n\r\n\t\t\t// If user has no assigned kasa, show warning and disable form submission\r\n\r\n\t\t\t$(\"#kasa\").prop('disabled', true);\r\n\r\n\t\t\t// Hidden input'u kaldır\r\n\r\n\t\t\t$('input[name=\"tahsilat_kasaID_hidden\"]').remove();\r\n\r\n\t\t\talert('Size atanmış bir kasa bulunmuyor. Kasa ödemesi yapabilmek için lütfen sistem yöneticisi ile iletişime geçin.');\r\n\r\n\t\t\t<?php endif; ?>\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\tif(status == 2){\r\n\r\n\t\t\t// Show banka dropdown, hide kasa dropdown\r\n\r\n\t\t\t$(\"#banka_dropdown_container\").show();\r\n\r\n\t\t\t$(\"#kasa_dropdown_container\").hide();\r\n\r\n\t\t\t\r\n\r\n\t\t\t$(\"#banka\").prop('disabled', false);\r\n\r\n\t\t\t$(\"#kasa\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#kasa\").val('').change();\r\n\r\n\t\t\t$(\"#cek_alanlari\").hide();\r\n\r\n\t\t\t$(\"#senet_alanlari\").hide();\r\n\r\n\t\t\t$(\"#banka_dosya_alani\").show();\r\n\r\n\t\t\tclearCekFields();\r\n\r\n\t\t\tclearSenetFields();\r\n\r\n\t\t\t// Tutar alanını aktif yap\r\n\r\n\t\t\t$(\"#tahsilat_tutar\").prop('disabled', false).prop('required', true);\r\n\r\n\t\t\t// Dosya yükleme event'lerini bağla\r\n\r\n\t\t\tbindFileUploadEvents();\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Kasa hidden input'unu temizle\r\n\r\n\t\t\t$('input[name=\"tahsilat_kasaID_hidden\"]').remove();\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\tif(status == 3){\r\n\r\n\t\t\t// Hide both dropdowns for check payment\r\n\r\n\t\t\t$(\"#kasa_dropdown_container\").hide();\r\n\r\n\t\t\t$(\"#banka_dropdown_container\").hide();\r\n\r\n\t\t\t\r\n\r\n\t\t\t$(\"#kasa\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#banka\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#kasa\").val('').change();\r\n\r\n\t\t\t$(\"#banka\").val('').change();\r\n\r\n\t\t\t$(\"#cek_alanlari\").show();\r\n\r\n\t\t\t$(\"#senet_alanlari\").hide();\r\n\r\n\t\t\t$(\"#banka_dosya_alani\").hide();\r\n\r\n\t\t\t// Çek alanlarını zorunlu yap\r\n\r\n\t\t\tmakeCekFieldsRequired(true);\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Kasa hidden input'unu temizle\r\n\r\n\t\t\t$('input[name=\"tahsilat_kasaID_hidden\"]').remove();\r\n\r\n\t\t\tclearSenetFields();\r\n\r\n\t\t\t// Tutar alanını aktif yap\r\n\r\n\t\t\t$(\"#tahsilat_tutar\").prop('disabled', false).prop('required', true);\r\n\r\n\t\t\t// Dosya yükleme event'lerini bağla\r\n\r\n\t\t\tbindFileUploadEvents();\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\tif(status == 4){\r\n\r\n\t\t\t// Hide both dropdowns for promissory note payment\r\n\r\n\t\t\t$(\"#kasa_dropdown_container\").hide();\r\n\r\n\t\t\t$(\"#banka_dropdown_container\").hide();\r\n\r\n\t\t\t\r\n\r\n\t\t\t$(\"#kasa\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#banka\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#kasa\").val('').change();\r\n\r\n\t\t\t$(\"#banka\").val('').change();\r\n\r\n\t\t\t$(\"#cek_alanlari\").hide();\r\n\r\n\t\t\t$(\"#senet_alanlari\").show();\r\n\r\n\t\t\t$(\"#banka_dosya_alani\").hide();\r\n\r\n\t\t\tclearCekFields();\r\n\r\n\t\t\t// Senet alanlarını zorunlu yap\r\n\r\n\t\t\tmakeSenetFieldsRequired(true);\r\n\r\n\t\t\t// Tutar alanını pasif yap ve zorunlu olmaktan çıkar\r\n\r\n\t\t\t$(\"#tahsilat_tutar\").prop('disabled', true).prop('required', false).val('');\r\n\r\n\t\t\t// Dosya yükleme event'lerini bağla\r\n\r\n\t\t\tbindFileUploadEvents();\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Kasa hidden input'unu temizle\r\n\r\n\t\t\t$('input[name=\"tahsilat_kasaID_hidden\"]').remove();\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Mobil kullanıcılar için özel uyarı\r\n\r\n\t\t\tif (isMobile()) {\r\n\r\n\t\t\t\tswal({\r\n\r\n\t\t\t\t\ttitle: \"Mobil Senet Ödeme\",\r\n\r\n\t\t\t\t\ttype: \"info\",\r\n\r\n\t\t\t\t\ttext: \"Mobil cihazınızdan senet ödemesi yapıyorsunuz. Dosya yüklemeleri isteğe bağlıdır ve sorunsuz işlenecek.\",\r\n\r\n\t\t\t\t\tconfirmButtonText: 'Anladım',\r\n\r\n\t\t\t\t\ttimer: 3000\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\tif(status == ''){\r\n\r\n\t\t\t// Hide both dropdowns when no payment method selected\r\n\r\n\t\t\t$(\"#kasa_dropdown_container\").hide();\r\n\r\n\t\t\t$(\"#banka_dropdown_container\").hide();\r\n\r\n\t\t\t\r\n\r\n\t\t\t$(\"#kasa\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#banka\").prop('disabled', true);\r\n\r\n\t\t\t$(\"#kasa\").val('').change();\r\n\r\n\t\t\t$(\"#banka\").val('').change();\r\n\r\n\t\t\t$(\"#cek_alanlari\").hide();\r\n\r\n\t\t\t$(\"#senet_alanlari\").hide();\r\n\r\n\t\t\t$(\"#banka_dosya_alani\").hide();\r\n\r\n\t\t\tclearCekFields();\r\n\r\n\t\t\tclearSenetFields();\r\n\r\n\t\t\t// Tutar alanını aktif yap\r\n\r\n\t\t\t$(\"#tahsilat_tutar\").prop('disabled', false).prop('required', true);\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Kasa hidden input'unu temizle\r\n\r\n\t\t\t$('input[name=\"tahsilat_kasaID_hidden\"]').remove();\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t// Çek alanlarını temizle\r\n\r\n\tfunction clearCekFields() {\r\n\r\n\t\t$(\"#cek_bankaID\").val('').change();\r\n\r\n\t\t$(\"#cek_bankaSube\").val('');\r\n\r\n\t\tmakeCekFieldsRequired(false);\r\n\r\n\t}\t// Çek alanlarını zorunlu/opsiyonel yap\r\n\r\n\tfunction makeCekFieldsRequired(required) {\r\n\r\n\t\t$(\"#cek_bankaID\").prop('required', required);\r\n\r\n\t\t$(\"#cek_bankaSube\").prop('required', required);\r\n\r\n\t}\r\n\r\n\t// Senet alanlarını temizle\r\n\r\n\tfunction clearSenetFields() {\r\n\r\n\t\t// Kontrol alanlarını temizle\r\n\r\n\t\t$(\"#senet_tutari\").val('');\r\n\r\n\t\t$(\"#senet_adedi\").val('');\r\n\r\n\t\t$(\"#senet_vade_tarihi\").val('');\r\n\r\n\t\t\r\n\r\n\t\t// Dinamik alanları temizle\r\n\r\n\t\t$(\"#senet_detay_container\").html('');\r\n\r\n\t\t$(\"#senet_detaylari\").hide();\r\n\r\n\t\t\r\n\r\n\t\tmakeSenetFieldsRequired(false);\r\n\r\n\t}\r\n\r\n\r\n\r\n\t// Senet alanlarını zorunlu/opsiyonel yap\r\n\r\n\tfunction makeSenetFieldsRequired(required) {\r\n\r\n\t\t// Kontrol alanlarını zorunlu yap\r\n\r\n\t\t$(\"#senet_tutari\").prop('required', required);\r\n\r\n\t\t$(\"#senet_adedi\").prop('required', required);\r\n\r\n\t\t$(\"#senet_vade_tarihi\").prop('required', required);\r\n\r\n\t\t\r\n\r\n\t\t// Dinamik alanları da zorunlu yap\r\n\r\n\t\tif(required) {\r\n\r\n\t\t\t$('.senet-tutar').prop('required', true);\r\n\r\n\t\t\t$('.senet-vade').prop('required', true);\r\n\r\n\t\t} else {\r\n\r\n\t\t\t$('.senet-tutar').prop('required', false);\r\n\r\n\t\t\t$('.senet-vade').prop('required', false);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Senet detayları üret\r\n\r\n\tfunction generateSenetDetails() {\r\n\r\n\t\tvar senetTutari = parseFloat($(\"#senet_tutari\").val()) || 0;\r\n\r\n\t\tvar senetAdedi = parseInt($(\"#senet_adedi\").val()) || 0;\r\n\r\n\t\tvar ilkVadeTarihi = $(\"#senet_vade_tarihi\").val();\r\n\r\n\t\t\r\n\r\n\t\t// Validasyon\r\n\r\n\t\tif (senetTutari <= 0 || senetAdedi <= 0 || ilkVadeTarihi == '') {\r\n\r\n\t\t\t$(\"#senet_detaylari\").hide();\r\n\r\n\t\t\t$(\"#senet_detay_container\").html('');\r\n\r\n\t\t\tupdateTahsilatTutar();\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Maksimum 10 senet kontrolü\r\n\r\n\t\tif (senetAdedi > 10) {\r\n\r\n\t\t\tswal({\r\n\r\n\t\t\t\ttitle: \"Uyarı\",\r\n\r\n\t\t\t\ttype: \"warning\",\r\n\r\n\t\t\t\ttext: \"Maksimum 10 adet senet oluşturabilirsiniz.\",\r\n\r\n\t\t\t\tconfirmButtonText: 'Tamam'\r\n\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#senet_adedi\").val(10);\r\n\r\n\t\t\tsenetAdedi = 10;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\tvar html = '';\r\n\r\n\t\tvar toplamTutar = 0;\r\n\r\n\t\t\r\n\r\n\t\t// İlk vade tarihini parse et\r\n\r\n\t\tvar vadeTarihi = parseDate(ilkVadeTarihi);\r\n\r\n\t\tif (!vadeTarihi) {\r\n\r\n\t\t\t$(\"#senet_detaylari\").hide();\r\n\r\n\t\t\t$(\"#senet_detay_container\").html('');\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Senet kutucuklarını oluştur\r\n\r\n\t\tfor (var i = 1; i <= senetAdedi; i++) {\r\n\r\n\t\t\tvar currentVadeTarihi = new Date(vadeTarihi);\r\n\r\n\t\t\tcurrentVadeTarihi.setMonth(currentVadeTarihi.getMonth() + (i - 1));\r\n\r\n\t\t\tvar vadeTarihiFormatted = formatDate(currentVadeTarihi);\r\n\r\n\t\t\t\r\n\r\n\t\t\ttoplamTutar += senetTutari;\r\n\r\n\t\t\t\t\thtml += '<div class=\"col-md-6 mb-3\">';\r\n\r\n\t\t\thtml += '  <div class=\"card border-primary senet-card\">';\r\n\r\n\t\t\thtml += '    <div class=\"card-header bg-primary text-white\">';\r\n\r\n\t\t\thtml += '      <h6 class=\"mb-0\"><i class=\"fa fa-file-text-o mr-2\"></i>Senet ' + i + '</h6>';\r\n\r\n\t\t\thtml += '    </div>';\r\n\r\n\t\t\thtml += '    <div class=\"card-body\">';\t\t\thtml += '      <div class=\"row\">';\r\n\r\n\t\t\thtml += '        <div class=\"col-md-6\">';\r\n\r\n\t\t\thtml += '          <div class=\"form-group\">';\r\n\r\n\t\t\thtml += '            <label><i class=\"fa fa-lira mr-1\"></i>Tutar</label>';\r\n\r\n\t\t\thtml += '            <input type=\"number\" step=\"0.01\" class=\"form-control senet-tutar\" name=\"senet_tutar[]\" value=\"' + senetTutari + '\" required>';\r\n\r\n\t\t\thtml += '          </div>';\r\n\r\n\t\t\thtml += '        </div>';\r\n\r\n\t\t\thtml += '        <div class=\"col-md-6\">';\r\n\r\n\t\t\thtml += '          <div class=\"form-group\">';\r\n\r\n\t\t\thtml += '            <label><i class=\"fa fa-calendar mr-1\"></i>Vade Tarihi</label>';\r\n\r\n\t\t\thtml += '            <input type=\"text\" class=\"datepicker form-control senet-vade\" name=\"senet_vade[]\" value=\"' + vadeTarihiFormatted + '\" autocomplete=\"off\" required>';\r\n\r\n\t\t\thtml += '          </div>';\r\n\r\n\t\t\thtml += '        </div>';\r\n\r\n\t\t\thtml += '      </div>';\r\n\r\n\t\t\thtml += '      <div class=\"row\">';\r\n\r\n\t\t\thtml += '        <div class=\"col-md-12\">';\r\n\r\n\t\t\thtml += '          <div class=\"form-group senet-dosya-alani\">';\r\n\r\n\t\t\thtml += '            <label><i class=\"fa fa-upload mr-1\"></i>Senet Görseli <small class=\"text-muted\">(İsteğe bağlı - JPG, PNG, GIF - Max: 5MB)</small></label>';\r\n\r\n\t\t\thtml += '            <input type=\"file\" class=\"form-control senet-gorsel\" name=\"senet_gorsel[]\" accept=\".jpg,.jpeg,.png,.gif\">';\r\n\r\n\t\t\thtml += '            <small class=\"text-muted\">Mobilde: Dosya seçtikten sonra başka uygulama açmayın</small>';\r\n\r\n\t\t\thtml += '            <small class=\"text-muted\">Senet görselini yükleyebilirsiniz</small>';\r\n\r\n\t\t\thtml += '          </div>';\r\n\r\n\t\t\thtml += '        </div>';\r\n\r\n\t\t\thtml += '      </div>';\r\n\r\n\t\t\thtml += '    </div>';\r\n\r\n\t\t\thtml += '  </div>';\r\n\r\n\t\t\thtml += '</div>';\r\n\r\n\t\t}\r\n\r\n\t\t\t\t// HTML'i ekle\r\n\r\n\t\t$(\"#senet_detay_container\").html('<div class=\"row\">' + html + '</div>');\r\n\r\n\t\t$(\"#senet_detaylari\").show();\r\n\r\n\t\t\r\n\r\n\t\t// Datepicker'ları yeniden başlat\r\n\r\n\t\t$('.datepicker').datepicker({\r\n\r\n\t\t\tdateFormat: 'dd.mm.yy',\r\n\r\n\t\t\tlanguage: 'tr'\r\n\r\n\t\t});\r\n\r\n\t\t\r\n\r\n\t\t// Toplam tutarı güncelle\r\n\r\n\t\tupdateTahsilatTutar();\r\n\r\n\t\t\r\n\r\n\t\t// Senet detay değişikliklerini dinle\r\n\r\n\t\tbindSenetDetailEvents();\r\n\r\n\t\t\r\n\r\n\t\t// Dosya yükleme event'lerini bağla\r\n\r\n\t\tbindFileUploadEvents();\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Tarih parse fonksiyonu (dd.mm.yyyy formatından Date objesine)\r\n\r\n\tfunction parseDate(dateString) {\r\n\r\n\t\tvar parts = dateString.split('.');\r\n\r\n\t\tif (parts.length !== 3) return null;\r\n\r\n\t\t\r\n\r\n\t\tvar day = parseInt(parts[0], 10);\r\n\r\n\t\tvar month = parseInt(parts[1], 10) - 1; // JavaScript ayları 0-11 arası\r\n\r\n\t\tvar year = parseInt(parts[2], 10);\r\n\r\n\t\t\r\n\r\n\t\treturn new Date(year, month, day);\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Tarih formatla fonksiyonu (Date objesinden dd.mm.yyyy formatına)\r\n\r\n\tfunction formatDate(date) {\r\n\r\n\t\tvar day = date.getDate().toString().padStart(2, '0');\r\n\r\n\t\tvar month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n\r\n\t\tvar year = date.getFullYear();\r\n\r\n\t\t\r\n\r\n\t\treturn day + '.' + month + '.' + year;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Tahsilat tutarını güncelle\r\n\r\n\tfunction updateTahsilatTutar() {\r\n\r\n\t\tvar toplamTutar = 0;\r\n\r\n\t\t$('.senet-tutar').each(function() {\r\n\r\n\t\t\tvar tutar = parseFloat($(this).val()) || 0;\r\n\r\n\t\t\ttoplamTutar += tutar;\r\n\r\n\t\t});\r\n\r\n\t\t\r\n\r\n\t\t$(\"#tahsilat_tutar\").val(toplamTutar.toFixed(2));\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Senet detay event'lerini bağla\r\n\r\n\tfunction bindSenetDetailEvents() {\r\n\r\n\t\t// Senet tutarı değiştiğinde toplam tutarı güncelle\r\n\r\n\t\t$(document).off('input', '.senet-tutar').on('input', '.senet-tutar', function() {\r\n\r\n\t\t\tupdateTahsilatTutar();\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t\t// Kontrol alanları değiştiğinde senet detaylarını yeniden üret\r\n\r\n\t$(\"#senet_tutari, #senet_adedi, #senet_vade_tarihi\").on('input change', function() {\r\n\r\n\t\tgenerateSenetDetails();\r\n\r\n\t});\r\n\r\n\t\t// Dosya yükleme event'lerini bağla\r\n\r\n\tfunction bindFileUploadEvents() {\r\n\r\n\t\t// Dinamik olarak eklenen dosya input'ları için event delegation\r\n\r\n\t\t$(document).off('change', '.senet-gorsel').on('change', '.senet-gorsel', function() {\r\n\r\n\t\t\t// Mobilde senet dosya validasyonunu çok basit tut\r\n\r\n\t\t\tif (isMobile()) {\r\n\r\n\t\t\t\tvar $container = $(this).closest('.senet-dosya-alani');\r\n\r\n\t\t\t\t$container.find('.file-error, .file-success').remove();\r\n\r\n\t\t\t\t$container.removeClass('has-error');\r\n\r\n\t\t\t\t\r\n\r\n\t\t\t\tif (this.files && this.files[0]) {\r\n\r\n\t\t\t\t\tshowFileSuccess($container, 'Mobil: Dosya kabul edildi - ' + this.files[0].name);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true; // Mobilde her zaman geçerli\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvalidateFileUpload(this);\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t\t\t// Banka ve çek dosya upload'ları için\r\n\r\n\t\t$(document).off('change', '#banka_gorsel').on('change', '#banka_gorsel', function() {\r\n\r\n\t\t\tvalidateBankaCekFileUpload(this, 'dekont');\r\n\r\n\t\t});\r\n\r\n\t\t\r\n\r\n\t\t$(document).off('change', '#cek_gorsel').on('change', '#cek_gorsel', function() {\r\n\r\n\t\t\tvalidateBankaCekFileUpload(this, 'çek');\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Mobil-friendly dosya yükleme validasyonu\r\n\r\n\tfunction validateFileUpload(input) {\r\n\r\n\t\tvar file = input.files[0];\r\n\r\n\t\tvar $input = $(input);\r\n\r\n\t\tvar $container = $input.closest('.senet-dosya-alani');\r\n\r\n\t\t\r\n\r\n\t\t// Önceki hata mesajlarını temizle\r\n\r\n\t\t$container.find('.file-error, .file-success').remove();\r\n\r\n\t\t$container.removeClass('has-error');\r\n\r\n\t\t\r\n\r\n\t\tif (!file) {\r\n\r\n\t\t\treturn true; // Dosya seçilmemişse geçerli (isteğe bağlı)\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Mobil cihazlarda çok daha toleranslı ol\r\n\r\n\t\tif (isMobile()) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\t// Basit kontrol - sadece dosya var mı?\r\n\r\n\t\t\t\tif (file && file.name) {\r\n\r\n\t\t\t\t\tshowFileSuccess($container, 'Mobil: Dosya hazır - ' + file.name);\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} catch (e) {\r\n\r\n\t\t\t\t// Mobilde herhangi bir hata varsa yok say\r\n\r\n\t\t\t\tconsole.log('Mobil dosya hatası yok sayıldı:', e);\r\n\r\n\t\t\t\tshowFileSuccess($container, 'Mobil: Dosya kabul edildi');\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Masaüstü için detaylı kontrol\r\n\r\n\t\ttry {\r\n\r\n\t\t\tvar fileSize = file.size;\r\n\r\n\t\t\tvar fileName = file.name;\r\n\r\n\t\t\tvar fileType = file.type;\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Dosya özelliklerine erişilemiyorsa geçersiz\r\n\r\n\t\t\tif (!fileName || fileSize === undefined) {\r\n\r\n\t\t\t\tshowFileError($container, 'Dosya erişilemez durumda. Lütfen tekrar seçin.');\r\n\r\n\t\t\t\tinput.value = '';\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} catch (e) {\r\n\r\n\t\t\tshowFileError($container, 'Dosya okuma hatası. Lütfen tekrar seçin.');\r\n\r\n\t\t\tinput.value = '';\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Dosya boyutu kontrolü (5MB = 5 * 1024 * 1024 bytes)\r\n\r\n\t\tvar maxSize = 5 * 1024 * 1024;\r\n\r\n\t\tif (file.size > maxSize) {\r\n\r\n\t\t\tshowFileError($container, 'Dosya boyutu 5MB\\'dan büyük olamaz.');\r\n\r\n\t\t\tinput.value = '';\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Dosya tipi kontrolü\r\n\r\n\t\tvar allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];\r\n\r\n\t\tif (!allowedTypes.includes(file.type)) {\r\n\r\n\t\t\tshowFileError($container, 'Sadece JPG, PNG ve GIF dosyaları kabul edilir.');\r\n\r\n\t\t\tinput.value = '';\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Başarılı yükleme göstergesi\r\n\r\n\t\tshowFileSuccess($container, 'Dosya hazır: ' + file.name);\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\t\t// Banka ve çek dosya yükleme validasyonu\r\n\r\n\tfunction validateBankaCekFileUpload(input, fileType) {\r\n\r\n\t\tvar file = input.files[0];\r\n\r\n\t\tvar $input = $(input);\r\n\r\n\t\tvar $container = $input.closest('.form-group');\r\n\r\n\t\t\r\n\r\n\t\t// Önceki hata mesajlarını temizle\r\n\r\n\t\t$container.find('.file-error, .file-success').remove();\r\n\r\n\t\t$container.removeClass('has-error');\r\n\r\n\t\t\r\n\r\n\t\tif (!file) {\r\n\r\n\t\t\treturn true; // Dosya seçilmemişse geçerli (isteğe bağlı)\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Mobil dosya erişim kontrolü\r\n\r\n\t\ttry {\r\n\r\n\t\t\tvar fileSize = file.size;\r\n\r\n\t\t\tvar fileName = file.name;\r\n\r\n\t\t\tvar fileType = file.type;\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Dosya özelliklerine erişilemiyorsa geçersiz\r\n\r\n\t\t\tif (!fileName || fileSize === undefined) {\r\n\r\n\t\t\t\tshowBankaCekFileError($container, 'Dosya erişilemez durumda. Lütfen tekrar seçin.');\r\n\r\n\t\t\t\tinput.value = '';\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} catch (e) {\r\n\r\n\t\t\tshowBankaCekFileError($container, 'Dosya okuma hatası. Lütfen tekrar seçin.');\r\n\r\n\t\t\tinput.value = '';\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Dosya boyutu kontrolü (5MB = 5 * 1024 * 1024 bytes)\r\n\r\n\t\tvar maxSize = 5 * 1024 * 1024;\r\n\r\n\t\tif (file.size > maxSize) {\r\n\r\n\t\t\tshowBankaCekFileError($container, 'Dosya boyutu 5MB\\'dan büyük olamaz.');\r\n\r\n\t\t\tinput.value = '';\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Dosya tipi kontrolü (banka ve çek için PDF de kabul ediliyor)\r\n\r\n\t\tvar allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf'];\r\n\r\n\t\tif (!allowedTypes.includes(file.type)) {\r\n\r\n\t\t\tshowBankaCekFileError($container, 'Sadece JPG, PNG, GIF ve PDF dosyaları kabul edilir.');\r\n\r\n\t\t\tinput.value = '';\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Başarılı yükleme göstergesi\r\n\r\n\t\tshowBankaCekFileSuccess($container, fileType + ' dosyası hazır: ' + file.name);\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Banka/çek dosya hatası göster\r\n\r\n\tfunction showBankaCekFileError($container, message) {\r\n\r\n\t\t$container.addClass('has-error');\r\n\r\n\t\t$container.append('<div class=\"file-error text-danger small mt-1\"><i class=\"fa fa-exclamation-triangle\"></i> ' + message + '</div>');\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Banka/çek dosya başarı göster\r\n\r\n\tfunction showBankaCekFileSuccess($container, message) {\r\n\r\n\t\t$container.removeClass('has-error');\r\n\r\n\t\t$container.append('<div class=\"file-success text-success small mt-1\"><i class=\"fa fa-check\"></i> ' + message + '</div>');\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Dosya başarı göster\r\n\r\n\tfunction showFileSuccess($container, message) {\r\n\r\n\t\t$container.removeClass('has-error');\r\n\r\n\t\t$container.append('<div class=\"file-success text-success small mt-1\"><i class=\"fa fa-check\"></i> ' + message + '</div>');\r\n\r\n\t}\r\n\r\n\t// Form submit validasyonu\r\n\r\n\t$(\"#tahsilatForm\").on('submit', function(e) {\r\n\r\n\t\tvar odemeTipi = $(\"#odemeTipi\").val();\r\n\r\n\t\tvar hasError = false;\r\n\r\n\t\t\r\n\r\n\t\t// Mobil cihazlarda dosya kontrollerini atla\r\n\t\tif (isMobile()) {\r\n\t\t\tconsole.log('Mobil cihaz tespit edildi - dosya kontrolleri atlanıyor');\r\n\t\t\t// Mobil kullanıcılar için bilgilendirme\r\n\t\t\tswal({\r\n\t\t\t\ttitle: \"Mobil İşlem\",\r\n\t\t\t\ttype: \"info\",\r\n\t\t\t\ttext: \"Mobil cihazınızdan işlem yapıyorsunuz. Dosya yüklemeleri otomatik olarak işlenecek.\",\r\n\t\t\t\ttimer: 2000,\r\n\t\t\t\tshowConfirmButton: false\r\n\t\t\t});\r\n\t\t\treturn true; // Form gönderimini devam ettir\r\n\t\t}\r\n\r\n\t\t// Kasa ödeme tipinde kullanıcının atanmış kasası olup olmadığını kontrol et\r\n\r\n\t\tif (odemeTipi == 1) {\r\n\r\n\t\t\t<?php if (!isset($user_assigned_kasa) || !$user_assigned_kasa): ?>\r\n\r\n\t\t\thasError = true;\r\n\r\n\t\t\tswal({\r\n\r\n\t\t\t\ttitle: \"Hata\",\r\n\r\n\t\t\t\ttype: \"error\",\r\n\r\n\t\t\t\ttext: \"Size atanmış bir kasa bulunmuyor. Kasa ödemesi yapabilmek için lütfen sistem yöneticisi ile iletişime geçin.\",\r\n\r\n\t\t\t\tconfirmButtonText: 'Tamam'\r\n\r\n\t\t\t});\r\n\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t\t<?php endif; ?>\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Senet ödeme tipinde dosya validasyonu\r\n\r\n\t\tif (odemeTipi == 4 && !isMobile()) {\r\n\r\n\t\t\t$('.senet-gorsel').each(function() {\r\n\r\n\t\t\t\tif (this.files.length > 0) {\r\n\r\n\t\t\t\t\tif (!checkFileStillExistsImproved(this)) {\r\n\r\n\t\t\t\t\t\thasError = true;\r\n\r\n\t\t\t\t\t\tshowMobileFileError('Senet dosyalarından biri yüklenirken sorun oluştu. Lütfen dosyaları tekrar seçin.');\r\n\r\n\t\t\t\t\t} else if (!validateFileUpload(this)) {\r\n\r\n\t\t\t\t\t\thasError = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Banka ödeme tipinde dosya validasyonu\r\n\r\n\t\tif (odemeTipi == 2 && !isMobile()) {\r\n\r\n\t\t\tvar bankaFile = document.getElementById('banka_gorsel');\r\n\r\n\t\t\tif (bankaFile && bankaFile.files.length > 0) {\r\n\r\n\t\t\t\tif (!checkFileStillExistsImproved(bankaFile)) {\r\n\r\n\t\t\t\t\thasError = true;\r\n\r\n\t\t\t\t\tshowMobileFileError('Banka dekont dosyası yüklenirken sorun oluştu. Lütfen dosyayı tekrar seçin.');\r\n\r\n\t\t\t\t} else if (!validateBankaCekFileUpload(bankaFile, 'dekont')) {\r\n\r\n\t\t\t\t\thasError = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t\t\t// Çek ödeme tipinde dosya validasyonu\r\n\r\n\t\tif (odemeTipi == 3 && !isMobile()) {\r\n\r\n\t\t\tvar cekFile = document.getElementById('cek_gorsel');\r\n\r\n\t\t\tif (cekFile && cekFile.files.length > 0) {\r\n\r\n\t\t\t\tif (!checkFileStillExistsImproved(cekFile)) {\r\n\r\n\t\t\t\t\thasError = true;\r\n\r\n\t\t\t\t\tshowMobileFileError('Çek dosyası yüklenirken sorun oluştu. Lütfen dosyayı tekrar seçin.');\r\n\r\n\t\t\t\t} else if (!validateBankaCekFileUpload(cekFile, 'çek')) {\r\n\r\n\t\t\t\t\thasError = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\tif (hasError) {\r\n\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t// Show progress for mobile users\r\n\r\n\t\tif (isMobile()) {\r\n\r\n\t\t\tshowUploadProgress();\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t\r\n\r\n\t// Dosya hata göster\r\n\r\n\tfunction showFileError($container, message) {\r\n\r\n\t\t$container.addClass('has-error');\r\n\r\n\t\t$container.append('<div class=\"file-error text-danger small mt-1\"><i class=\"fa fa-exclamation-triangle\"></i> ' + message + '</div>');\r\n\r\n\t\t\r\n\r\n\t\t// Eğer dosya erişim hatası ise otomatik destek talebi oluştur\r\n\r\n\t\tif (message.includes('erişilemez') || message.includes('okuma hatası')) {\r\n\r\n\t\t\tcreateAutoSupportTicketForUploadError('ERR_FILE_ACCESS', message);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Otomatik destek talebi oluştur\r\n\r\n\tfunction createAutoSupportTicketForUploadError(errorType, errorMessage) {\r\n\r\n\t\tvar ticketData = {\r\n\r\n\t\t\terror_type: errorType,\r\n\r\n\t\t\tuser_agent: navigator.userAgent,\r\n\r\n\t\t\tscreen_resolution: screen.width + 'x' + screen.height,\r\n\r\n\t\t\tviewport_size: window.innerWidth + 'x' + window.innerHeight,\r\n\r\n\t\t\turl: window.location.href,\r\n\r\n\t\t\ttimestamp: new Date().toISOString(),\r\n\r\n\t\t\tbrowser_info: getBrowserInfo(),\r\n\r\n\t\t\tdevice_info: JSON.stringify(getDeviceInfo()),\r\n\r\n\t\t\terror_details: errorMessage,\r\n\r\n\t\t\tauto_generated: true\r\n\r\n\t\t};\r\n\r\n\t\t\r\n\r\n\t\t// AJAX ile otomatik destek talebi oluştur\r\n\r\n\t\t$.ajax({\r\n\r\n\t\t\turl: '<?= base_url('talepler/otomatik-talep-olustur') ?>',\r\n\r\n\t\t\ttype: 'POST',\r\n\r\n\t\t\tdata: ticketData,\r\n\r\n\t\t\tdataType: 'json',\r\n\r\n\t\t\tsuccess: function(response) {\r\n\r\n\t\t\t\tif (response.success) {\r\n\r\n\t\t\t\t\tshowAutoTicketCreatedMessage(response.ticket_id);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tshowManualSupportInfo();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\terror: function() {\r\n\r\n\t\t\t\t// Fallback: Manual destek bilgisi göster\r\n\r\n\t\t\t\tshowManualSupportInfo();\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Tarayıcı bilgilerini al\r\n\r\n\tfunction getBrowserInfo() {\r\n\r\n\t\tvar ua = navigator.userAgent;\r\n\r\n\t\tvar browser = 'Unknown';\r\n\r\n\t\tvar version = 'Unknown';\r\n\r\n\t\t\r\n\r\n\t\tif (ua.indexOf('Chrome') > -1) {\r\n\r\n\t\t\tbrowser = 'Chrome';\r\n\r\n\t\t\tversion = ua.match(/Chrome\\/(\\d+)/)[1];\r\n\r\n\t\t} else if (ua.indexOf('Firefox') > -1) {\r\n\r\n\t\t\tbrowser = 'Firefox';\r\n\r\n\t\t\tversion = ua.match(/Firefox\\/(\\d+)/)[1];\r\n\r\n\t\t} else if (ua.indexOf('Safari') > -1) {\r\n\r\n\t\t\tbrowser = 'Safari';\r\n\r\n\t\t\tversion = ua.match(/Safari\\/(\\d+)/)[1];\r\n\r\n\t\t} else if (ua.indexOf('Edge') > -1) {\r\n\r\n\t\t\tbrowser = 'Edge';\r\n\r\n\t\t\tversion = ua.match(/Edge\\/(\\d+)/)[1];\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\treturn browser + ' ' + version;\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Cihaz bilgilerini al\r\n\r\n\tfunction getDeviceInfo() {\r\n\r\n\t\tvar isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n\r\n\t\tvar isTablet = /(iPad|Android(?!.*Mobile))/i.test(navigator.userAgent);\r\n\r\n\t\tvar deviceType = isMobile ? (isTablet ? 'Tablet' : 'Mobile') : 'Desktop';\r\n\r\n\t\t\r\n\r\n\t\treturn {\r\n\r\n\t\t\ttype: deviceType,\r\n\r\n\t\t\tplatform: navigator.platform,\r\n\r\n\t\t\tconnection: navigator.connection ? navigator.connection.effectiveType : 'Unknown',\r\n\r\n\t\t\tlanguage: navigator.language,\r\n\r\n\t\t\tmemory: navigator.deviceMemory || 'Unknown',\r\n\r\n\t\t\tcores: navigator.hardwareConcurrency || 'Unknown'\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Otomatik talep oluşturuldu mesajı göster\r\n\r\n\tfunction showAutoTicketCreatedMessage(ticketId) {\r\n\r\n\t\tswal({\r\n\r\n\t\t\ttitle: \"Destek Talebi Oluşturuldu\",\r\n\r\n\t\t\ttype: \"info\",\r\n\r\n\t\t\thtml: true,\r\n\r\n\t\t\ttext: `\r\n\r\n\t\t\t\t<div style=\"text-align: left;\">\r\n\r\n\t\t\t\t\t<p><strong>Teknik bir sorun tespit edildi ve sizin adınıza otomatik olarak destek talebi oluşturuldu.</strong></p>\r\n\r\n\t\t\t\t\t<br>\r\n\r\n\t\t\t\t\t<p><strong>Talep Numarası:</strong> #${ticketId}</p>\r\n\r\n\t\t\t\t\t<p><strong>Sorun:</strong> Mobil dosya yükleme hatası</p>\r\n\r\n\t\t\t\t\t<p><strong>Durum:</strong> İnceleme altında</p>\r\n\r\n\t\t\t\t\t<br>\r\n\r\n\t\t\t\t\t<p>Teknik ekibimiz sorunu inceleyip size geri dönüş yapacak. Bu sırada:</p>\r\n\r\n\t\t\t\t\t<ul>\r\n\r\n\t\t\t\t\t\t<li>Dosyayı tekrar seçmeyi deneyebilirsiniz</li>\r\n\r\n\t\t\t\t\t\t<li>Tarayıcınızı yeniden başlatabilirsiniz</li>\r\n\r\n\t\t\t\t\t\t<li>Farklı bir dosya formatı deneyebilirsiniz</li>\r\n\r\n\t\t\t\t\t</ul>\r\n\r\n\t\t\t\t</div>\r\n\r\n\t\t\t`,\r\n\r\n\t\t\tconfirmButtonText: 'Anladım',\r\n\r\n\t\t\tshowCancelButton: true,\r\n\r\n\t\t\tcancelButtonText: 'Sayfayı Yenile'\r\n\r\n\t\t}, function(isConfirm) {\r\n\r\n\t\t\tif (!isConfirm) {\r\n\r\n\t\t\t\t// Kullanıcı sayfayı yenilemeyi seçti\r\n\r\n\t\t\t\tlocation.reload();\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Manuel destek bilgisi göster (otomatik sistem çalışmazsa)\r\n\r\n\tfunction showManualSupportInfo() {\r\n\r\n\t\tswal({\r\n\r\n\t\t\ttitle: \"Teknik Destek\",\r\n\r\n\t\t\ttype: \"info\",\r\n\r\n\t\t\thtml: true,\r\n\r\n\t\t\ttext: `\r\n\r\n\t\t\t\t<div style=\"text-align: left;\">\r\n\r\n\t\t\t\t\t<p><strong>Dosya yükleme sorunu yaşıyorsunuz.</strong></p>\r\n\r\n\t\t\t\t\t<br>\r\n\r\n\t\t\t\t\t<p>Hemen çözüm için:</p>\r\n\r\n\t\t\t\t\t<ul>\r\n\r\n\t\t\t\t\t\t<li>📞 <strong>Telefon:</strong> 0212 xxx xx xx</li>\r\n\r\n\t\t\t\t\t\t<li>📧 <strong>E-posta:</strong> destek@ilekasoft.com</li>\r\n\r\n\t\t\t\t\t\t<li>💬 <strong>WhatsApp:</strong> 0532 xxx xx xx</li>\r\n\r\n\t\t\t\t\t</ul>\r\n\r\n\t\t\t\t\t<br>\r\n\r\n\t\t\t\t\t<p>Veya aşağıdaki adımları deneyebilirsiniz:</p>\r\n\r\n\t\t\t\t\t<ol>\r\n\r\n\t\t\t\t\t\t<li>Dosyayı tekrar seçin</li>\r\n\r\n\t\t\t\t\t\t<li>Tarayıcınızı yeniden başlatın</li>\r\n\r\n\t\t\t\t\t\t<li>Farklı bir dosya formatı deneyin</li>\r\n\r\n\t\t\t\t\t</ol>\r\n\r\n\t\t\t\t</div>\r\n\r\n\t\t\t`,\r\n\r\n\t\t\tconfirmButtonText: 'Anladım',\r\n\r\n\t\t\tshowCancelButton: true,\r\n\r\n\t\t\tcancelButtonText: 'Sayfayı Yenile'\r\n\r\n\t\t}, function(isConfirm) {\r\n\r\n\t\t\tif (!isConfirm) {\r\n\r\n\t\t\t\tlocation.reload();\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Dosya hala erişilebilir mi kontrol et (mobil için)\r\n\r\n\tfunction checkFileStillExists(input) {\r\n\r\n\t\tif (!input.files || input.files.length === 0) {\r\n\r\n\t\t\treturn true; // Dosya seçilmemişse OK\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\ttry {\r\n\r\n\t\t\tvar file = input.files[0];\r\n\r\n\t\t\t// Dosya özelliklerine erişmeye çalış\r\n\r\n\t\t\tvar size = file.size;\r\n\r\n\t\t\tvar name = file.name;\r\n\r\n\t\t\tvar type = file.type;\r\n\r\n\t\t\t\r\n\r\n\t\t\t// Erişilebiliyorsa dosya hala geçerli\r\n\r\n\t\t\treturn (name && size !== undefined);\r\n\r\n\t\t} catch (e) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Mobil dosya hatası göster\r\n\r\n\tfunction showMobileFileError(message) {\r\n\r\n\t\tswal({\r\n\r\n\t\t\ttitle: \"Dosya Hatası\",\r\n\r\n\t\t\ttype: \"error\",\r\n\r\n\t\t\ttext: message,\r\n\r\n\t\t\tconfirmButtonText: 'Tamam'\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t// Mobil cihaz kontrolü\r\n\tfunction isMobile() {\r\n\t\treturn window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\r\n\t}\r\n\t\r\n\t// Geliştirilmiş dosya erişim kontrolü\r\n\tfunction checkFileStillExistsImproved(input) {\r\n\t\tif (!input.files || input.files.length === 0) {\r\n\t\t\treturn true; // Dosya seçilmemişse OK\r\n\t\t}\r\n\t\t\r\n\t\t// Mobil cihazlarda dosya erişim sorunlarını tolere et\r\n\t\tif (isMobile()) {\r\n\t\t\ttry {\r\n\t\t\t\tvar file = input.files[0];\r\n\t\t\t\t// Basit dosya varlık kontrolü - mobilde detaylı kontrol yapmayalım\r\n\t\t\t\treturn file && file.name;\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// Mobilde dosya erişim hatalarını yok say, form gönderilmeye devam etsin\r\n\t\t\t\tconsole.log('Mobil dosya erişim hatası (yok sayıldı):', e);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Masaüstü için normal kontrol\r\n\t\ttry {\r\n\t\t\tvar file = input.files[0];\r\n\t\t\tvar size = file.size;\r\n\t\t\tvar name = file.name;\r\n\t\t\tvar type = file.type;\r\n\t\t\treturn (name && size !== undefined);\r\n\t\t} catch (e) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t// Mobil cihaz kontrolü\r\n\r\n\tfunction isMobile() {\r\n\t\t// Gelişmiş mobil cihaz tespit sistemi\r\n\t\tvar userAgent = navigator.userAgent.toLowerCase();\r\n\t\tvar isMobileDevice = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile/i.test(userAgent);\r\n\t\tvar isSmallScreen = window.innerWidth <= 768;\r\n\t\tvar isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n\t\t\r\n\t\t// Birden fazla kriter kullanarak mobil tespit et\r\n\t\tvar isMobileResult = isMobileDevice || (isSmallScreen && isTouchDevice);\r\n\t\t\r\n\t\t// Debug için console'a yazdır\r\n\t\tconsole.log('Mobil kontrol sonucu:', {\r\n\t\t\tuserAgent: userAgent,\r\n\t\t\tisMobileDevice: isMobileDevice,\r\n\t\t\tisSmallScreen: isSmallScreen,\r\n\t\t\tisTouchDevice: isTouchDevice,\r\n\t\t\tfinalResult: isMobileResult\r\n\t\t});\r\n\t\t\r\n\t\treturn isMobileResult;\r\n\t}\r\n\r\n\t\r\n\r\n\t// Yükleme progress göster\r\n\r\n\tfunction showUploadProgress() {\r\n\r\n\t\treturn swal({\r\n\r\n\t\t\ttitle: 'Dosya Yükleniyor',\r\n\r\n\t\t\ttext: 'Lütfen bekleyin...',\r\n\r\n\t\t\ttype: 'info',\r\n\r\n\t\t\tshowConfirmButton: false,\r\n\r\n\t\t\tallowOutsideClick: false\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n</script>\r\n\r\n\r\n\r\n</body>\r\n\r\n</html>\r\n\r\n"
        }
    ]
}