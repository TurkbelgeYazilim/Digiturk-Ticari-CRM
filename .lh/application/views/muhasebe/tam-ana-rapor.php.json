{
    "sourceFile": "application/views/muhasebe/tam-ana-rapor.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 96,
            "patches": [
                {
                    "date": 1755256998985,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755257032298,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -256,9 +256,9 @@\n \t\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t\t\t\t<table class=\"table table-hover table-center mb-0\" id=\"raporTable\">\r\n \t\t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<th>Cari Ad</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th>Müşteri Adı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>İşletme</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Evrak Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Tutarı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Hizmeti</th>\r\n"
                },
                {
                    "date": 1755257398023,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -430,8 +430,10 @@\n \t\t</div>\r\n \t</div>\r\n </div>\r\n \r\n+<?php $this->load->view(\"include/footer-js\"); ?>\r\n+\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/js/dataTables.bootstrap4.min.js\"></script>\r\n \r\n <script>\r\n"
                },
                {
                    "date": 1755257833909,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -256,9 +256,8 @@\n \t\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t\t\t\t<table class=\"table table-hover table-center mb-0\" id=\"raporTable\">\r\n \t\t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<th>Müşteri Adı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>İşletme</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Evrak Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Tutarı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Hizmeti</th>\r\n@@ -281,11 +280,8 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedilen Var': $row_class = 'rapor-reddedilen'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<tr class=\"<?= $row_class ?>\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= htmlspecialchars($veri->cari_ad . ' ' . $veri->cari_soyad) ?></strong>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->cari_isletme ?? '-') ?></td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->evrak_gorselleri)): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n"
                },
                {
                    "date": 1755258844857,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -260,9 +260,8 @@\n \t\t\t\t\t\t\t\t\t\t\t\t<th>İşletme</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Evrak Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Tutarı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Hizmeti</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Tutarı (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Sözleşme Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Tutar</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Durum</th>\r\n@@ -309,15 +308,8 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->satis_sozlesme_hizmeti ?? '-') ?></td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar_kdv_dahil): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk text-primary\"><?= number_format($veri->satis_sozlesme_tutar_kdv_dahil, 2, ',', '.') ?> ₺</span>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->sozlesme_gorselleri)): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$sozlesme_gorseller = explode('|', $veri->sozlesme_gorselleri);\r\n"
                },
                {
                    "date": 1755266392567,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -59,8 +59,49 @@\n \t\t\tfont-size: 0.9rem;\r\n \t\t\topacity: 0.9;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Görsel ve Evrak kolonları için stil */\r\n+\t\t.gorsel-column, .evrak-column {\r\n+\t\t\twidth: 80px;\r\n+\t\t\ttext-align: center;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.gorsel-thumbnail {\r\n+\t\t\twidth: 50px;\r\n+\t\t\theight: 50px;\r\n+\t\t\tobject-fit: cover;\r\n+\t\t\tborder-radius: 5px;\r\n+\t\t\tcursor: pointer;\r\n+\t\t\tborder: 2px solid #e0e0e0;\r\n+\t\t\ttransition: all 0.3s ease;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.gorsel-thumbnail:hover {\r\n+\t\t\tborder-color: #007bff;\r\n+\t\t\ttransform: scale(1.1);\r\n+\t\t}\r\n+\t\t\r\n+\t\t.badge-overlay {\r\n+\t\t\tposition: relative;\r\n+\t\t\tdisplay: inline-block;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.badge-overlay .badge {\r\n+\t\t\tposition: absolute;\r\n+\t\t\ttop: -5px;\r\n+\t\t\tright: -5px;\r\n+\t\t\tfont-size: 10px;\r\n+\t\t\tmin-width: 18px;\r\n+\t\t\theight: 18px;\r\n+\t\t\tline-height: 18px;\r\n+\t\t\tborder-radius: 9px;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.evrak-btn {\r\n+\t\t\tmin-width: 50px;\r\n+\t\t}\r\n+\t\t\r\n \t\t.gorsel-thumb {\r\n \t\t\twidth: 60px;\r\n \t\t\theight: 60px;\r\n \t\t\tobject-fit: cover;\r\n@@ -105,8 +146,18 @@\n \t\t\t.gorsel-thumb {\r\n \t\t\t\twidth: 40px;\r\n \t\t\t\theight: 40px;\r\n \t\t\t}\r\n+\t\t\t\r\n+\t\t\t/* Mobilde görsel ve evrak kolonu boyutlarını ayarla */\r\n+\t\t\t.gorsel-column, .evrak-column {\r\n+\t\t\t\twidth: 60px;\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t.gorsel-thumbnail {\r\n+\t\t\t\twidth: 40px;\r\n+\t\t\t\theight: 40px;\r\n+\t\t\t}\r\n \t\t}\r\n \t</style>\r\n </head>\r\n <body>\r\n@@ -257,9 +308,10 @@\n \t\t\t\t\t\t\t\t\t<table class=\"table table-hover table-center mb-0\" id=\"raporTable\">\r\n \t\t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>İşletme</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<th>Evrak Görselleri</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th class=\"gorsel-column\">İşletme Görsel</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th class=\"evrak-column\">Evrak</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Tutarı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Hizmeti</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Sözleşme Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Tutar</th>\r\n@@ -280,27 +332,56 @@\n \t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<tr class=\"<?= $row_class ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->cari_isletme ?? '-') ?></td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->evrak_gorselleri)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$evrak_gorseller = explode('|', $veri->evrak_gorselleri);\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach (array_slice($evrak_gorseller, 0, 3) as $index => $gorsel): \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-gorsel\" onclick=\"showImageModal('<?= base_url($gorsel) ?>', 'Evrak Görseli')\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?= base_url($gorsel) ?>\" class=\"gorsel-thumb\" alt=\"Evrak\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (count($evrak_gorseller) > 3): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-info\">+<?= count($evrak_gorseller) - 3 ?></span>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"gorsel-column\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t// İşletme görselleri için cari_id kullanarak sayı göster\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isset($veri->cari_id) && !empty($veri->cari_id)): \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Gerçek görsel sayısını almak için bir fonksiyon çağrılabilir\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Şimdilik varsayılan olarak 1 gösterelim, controller'dan gelmeli\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$isletme_gorsel_sayisi = isset($veri->isletme_gorsel_sayisi) ? $veri->isletme_gorsel_sayisi : 0;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($isletme_gorsel_sayisi > 0):\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-success gorsel-btn\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"<?= $isletme_gorsel_sayisi ?> görsel\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id) ?>', 'gorselPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image\"></i> <?= $isletme_gorsel_sayisi ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image text-muted\" title=\"Görsel yok\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tendif;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\telse: \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"evrak-column\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Evrak dosyaları için cari_id kullanarak sayı göster\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isset($veri->cari_id) && !empty($veri->cari_id)): \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Gerçek evrak sayısını almak için bir fonksiyon çağrılabilir\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Controller'dan evrak sayısı gelmeli\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$evrak_sayisi = isset($veri->evrak_sayisi) ? $veri->evrak_sayisi : 0;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($evrak_sayisi > 0):\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-primary evrak-btn\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"<?= $evrak_sayisi ?> evrak\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/evrakGoster/\" . $veri->cari_id) ?>', 'evrakPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-file\"></i> <?= $evrak_sayisi ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-file text-muted\" title=\"Evrak yok\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tendif;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\telse: \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n"
                },
                {
                    "date": 1755268348312,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -312,9 +312,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t<th class=\"gorsel-column\">İşletme Görsel</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th class=\"evrak-column\">Evrak</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Tutarı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Hizmeti</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<th>Sözleşme Görselleri</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th class=\"gorsel-column\">Satış Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Tutar</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Durum</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Tarihi</th>\r\n@@ -388,24 +388,28 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->satis_sozlesme_hizmeti ?? '-') ?></td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->sozlesme_gorselleri)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$sozlesme_gorseller = explode('|', $veri->sozlesme_gorselleri);\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach (array_slice($sozlesme_gorseller, 0, 3) as $index => $gorsel): \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-gorsel\" onclick=\"showImageModal('<?= base_url($gorsel) ?>', 'Sözleşme Görseli')\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?= base_url($gorsel) ?>\" class=\"gorsel-thumb\" alt=\"Sözleşme\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (count($sozlesme_gorseller) > 3): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-info\">+<?= count($sozlesme_gorseller) - 3 ?></span>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"gorsel-column\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Satış görselleri için satis_id kullanarak sayı göster\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Gerçek satış görsel sayısını controller'dan al\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$satis_gorsel_sayisi = isset($veri->satis_gorsel_sayisi) ? $veri->satis_gorsel_sayisi : 0;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($satis_gorsel_sayisi > 0):\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-info gorsel-btn\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"<?= $satis_gorsel_sayisi ?> satış görseli\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id . \"?tip=satis&satis_id=\" . $veri->satis_sozlesme_id) ?>', 'satisGorselPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image\"></i> <?= $satis_gorsel_sayisi ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image text-muted\" title=\"Satış görseli yok\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tendif;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\telse: \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n"
                },
                {
                    "date": 1755269441607,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -325,11 +325,11 @@\n \t\t\t\t\t\t\t\t\t\t\t<?php foreach ($rapor_verileri as $veri): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n \t\t\t\t\t\t\t\t\t\t\t\t$row_class = '';\r\n \t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->tahsilat_durum) {\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onay Bekliyor': $row_class = 'rapor-onay-bekliyor'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onaylandı': $row_class = 'rapor-onaylanan'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedilen Var': $row_class = 'rapor-reddedilen'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Var': $row_class = 'rapor-onaylanan'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Yok': $row_class = 'rapor-reddedilen'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Bilinmeyen': $row_class = 'rapor-onay-bekliyor'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<tr class=\"<?= $row_class ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->cari_isletme ?? '-') ?></td>\r\n@@ -441,12 +441,11 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t$badge_class = 'badge-secondary';\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->tahsilat_durum) {\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onay Bekliyor': $badge_class = 'badge-warning'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onaylandı': $badge_class = 'badge-success'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedilen Var': $badge_class = 'badge-danger'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Var': $badge_class = 'badge-success'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Yok': $badge_class = 'badge-secondary'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Bilinmeyen': $badge_class = 'badge-warning'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-info'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\"><?= $veri->tahsilat_durum ?></span>\r\n"
                },
                {
                    "date": 1755270675387,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -413,9 +413,13 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->tahsilat_tutar): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk text-success\"><?= number_format($veri->tahsilat_tutar, 2, ',', '.') ?> ₺</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk text-success\" style=\"cursor: pointer;\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  onclick=\"showTahsilatModal(<?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme) ?>')\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  title=\"Tahsilat detaylarını görmek için tıklayın\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= number_format($veri->tahsilat_tutar, 2, ',', '.') ?> ₺\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n@@ -502,8 +506,36 @@\n \t\t</div>\r\n \t</div>\r\n </div>\r\n \r\n+<!-- Tahsilat Detay Modal -->\r\n+<div class=\"modal fade\" id=\"tahsilatModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"tahsilatModalLabel\" aria-hidden=\"true\">\r\n+\t<div class=\"modal-dialog modal-xl\" role=\"document\">\r\n+\t\t<div class=\"modal-content\">\r\n+\t\t\t<div class=\"modal-header\">\r\n+\t\t\t\t<h5 class=\"modal-title\" id=\"tahsilatModalLabel\">\r\n+\t\t\t\t\t<i class=\"fa fa-money mr-2\"></i>Tahsilat Detayları\r\n+\t\t\t\t</h5>\r\n+\t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n+\t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n+\t\t\t\t</button>\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"modal-body\">\r\n+\t\t\t\t<div id=\"tahsilatLoading\" class=\"text-center\" style=\"display: none;\">\r\n+\t\t\t\t\t<i class=\"fa fa-spinner fa-spin fa-2x\"></i>\r\n+\t\t\t\t\t<p class=\"mt-2\">Tahsilat verileri yükleniyor...</p>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t<div id=\"tahsilatContent\">\r\n+\t\t\t\t\t<!-- Tahsilat listesi buraya yüklenecek -->\r\n+\t\t\t\t</div>\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"modal-footer\">\r\n+\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Kapat</button>\r\n+\t\t\t</div>\r\n+\t\t</div>\r\n+\t</div>\r\n+</div>\r\n+\r\n <?php $this->load->view(\"include/footer-js\"); ?>\r\n \r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/js/dataTables.bootstrap4.min.js\"></script>\r\n@@ -529,8 +561,92 @@\n \t$('#downloadLink').attr('href', imageSrc);\r\n \t$('#imageModal').modal('show');\r\n }\r\n \r\n+// Tahsilat detay modal fonksiyonu\r\n+function showTahsilatModal(cariId, cariAd) {\r\n+\t$('#tahsilatModalLabel').html('<i class=\"fa fa-money mr-2\"></i>Tahsilat Detayları - ' + cariAd);\r\n+\t$('#tahsilatModal').modal('show');\r\n+\t$('#tahsilatLoading').show();\r\n+\t$('#tahsilatContent').hide();\r\n+\t\r\n+\t// AJAX ile tahsilat verilerini getir\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/getTahsilatDetay\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: { cari_id: cariId },\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\t$('#tahsilatLoading').hide();\r\n+\t\t\t$('#tahsilatContent').show();\r\n+\t\t\t\r\n+\t\t\tif (response.success && response.data.length > 0) {\r\n+\t\t\t\tlet html = `\r\n+\t\t\t\t\t<div class=\"table-responsive\">\r\n+\t\t\t\t\t\t<table class=\"table table-striped table-hover\">\r\n+\t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n+\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t<th>Tarih</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Belge No</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Tahsilat Tipi</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Tutar</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Açıklama</th>\r\n+\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t</thead>\r\n+\t\t\t\t\t\t\t<tbody>\r\n+\t\t\t\t`;\r\n+\t\t\t\t\r\n+\t\t\t\tlet toplamTutar = 0;\r\n+\t\t\t\tresponse.data.forEach(function(item) {\r\n+\t\t\t\t\ttoplamTutar += parseFloat(item.ch_alacak || 0);\r\n+\t\t\t\t\thtml += `\r\n+\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t<td>${item.ch_tarih}</td>\r\n+\t\t\t\t\t\t\t<td>${item.ch_belgeNumarasi || '-'}</td>\r\n+\t\t\t\t\t\t\t<td><span class=\"badge badge-info\">${item.tahsilat_tipi}</span></td>\r\n+\t\t\t\t\t\t\t<td class=\"text-right\"><strong>${parseFloat(item.ch_alacak).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</strong></td>\r\n+\t\t\t\t\t\t\t<td>${item.ch_aciklama || '-'}</td>\r\n+\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t`;\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\thtml += `\r\n+\t\t\t\t\t\t\t</tbody>\r\n+\t\t\t\t\t\t\t<tfoot class=\"thead-dark\">\r\n+\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t<th colspan=\"3\">TOPLAM</th>\r\n+\t\t\t\t\t\t\t\t\t<th class=\"text-right\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n+\t\t\t\t\t\t\t\t\t<th></th>\r\n+\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t</tfoot>\r\n+\t\t\t\t\t\t</table>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`;\r\n+\t\t\t\t\r\n+\t\t\t\t$('#tahsilatContent').html(html);\r\n+\t\t\t} else {\r\n+\t\t\t\t$('#tahsilatContent').html(`\r\n+\t\t\t\t\t<div class=\"alert alert-info text-center\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-info-circle fa-2x mb-2\"></i>\r\n+\t\t\t\t\t\t<h5>Tahsilat Bulunamadı</h5>\r\n+\t\t\t\t\t\t<p>Bu cari için henüz tahsilat kaydı bulunmuyor.</p>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`);\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function() {\r\n+\t\t\t$('#tahsilatLoading').hide();\r\n+\t\t\t$('#tahsilatContent').show().html(`\r\n+\t\t\t\t<div class=\"alert alert-danger text-center\">\r\n+\t\t\t\t\t<i class=\"fa fa-exclamation-triangle fa-2x mb-2\"></i>\r\n+\t\t\t\t\t<h5>Hata Oluştu</h5>\r\n+\t\t\t\t\t<p>Tahsilat verileri yüklenirken bir hata oluştu.</p>\r\n+\t\t\t\t</div>\r\n+\t\t\t`);\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n // Excel export fonksiyonu\r\n function exportToExcel() {\r\n \t// Excel export işlemi için AJAX çağrısı veya form submit\r\n \twindow.open('<?= base_url(\"muhasebe/tam-ana-rapor-excel\") ?>', '_blank');\r\n"
                },
                {
                    "date": 1755274331066,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -113,8 +113,9 @@\n \t\t.gorsel-container {\r\n \t\t\tdisplay: flex;\r\n \t\t\tflex-wrap: wrap;\r\n \t\t\tgap: 5px;\r\n+\t\t\talign-items: center;\r\n \t\t}\r\n \t\t\r\n \t\t.btn-gorsel {\r\n \t\t\tbackground: none;\r\n@@ -127,8 +128,33 @@\n \t\t\ttransform: scale(1.05);\r\n \t\t\ttransition: all 0.3s;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Tahsilat görselleri için küçük butonlar */\r\n+\t\t.btn-sm.btn-outline-success {\r\n+\t\t\tmin-width: 50px;\r\n+\t\t\tfont-size: 0.85rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.btn-sm.btn-outline-warning {\r\n+\t\t\tmin-width: 50px;\r\n+\t\t\tfont-size: 0.85rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.btn-sm.btn-outline-danger {\r\n+\t\t\tmin-width: 50px;\r\n+\t\t\tfont-size: 0.85rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* Bootstrap margin sınıfları (eksikse) */\r\n+\t\t.me-1 {\r\n+\t\t\tmargin-right: 0.25rem !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.mb-1 {\r\n+\t\t\tmargin-bottom: 0.25rem !important;\r\n+\t\t}\r\n+\t\t\r\n \t\t.modal-body img {\r\n \t\t\tmax-width: 100%;\r\n \t\t\theight: auto;\r\n \t\t}\r\n@@ -423,21 +449,44 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->tahsilat_gorselleri)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Tahsilat görselleri için farklı türlerdeki görsel sayılarını göster\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$toplam_tahsilat_gorsel = 0;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$banka_gorsel_sayisi = isset($veri->banka_gorsel_sayisi) ? $veri->banka_gorsel_sayisi : 0;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$cek_gorsel_sayisi = isset($veri->cek_gorsel_sayisi) ? $veri->cek_gorsel_sayisi : 0;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$senet_gorsel_sayisi = isset($veri->senet_gorsel_sayisi) ? $veri->senet_gorsel_sayisi : 0;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$toplam_tahsilat_gorsel = $banka_gorsel_sayisi + $cek_gorsel_sayisi + $senet_gorsel_sayisi;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($toplam_tahsilat_gorsel > 0): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$tahsilat_gorseller = explode('|', $veri->tahsilat_gorselleri);\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach (array_slice($tahsilat_gorseller, 0, 3) as $index => $gorsel): \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-gorsel\" onclick=\"showImageModal('<?= base_url($gorsel) ?>', 'Tahsilat Görseli')\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?= base_url($gorsel) ?>\" class=\"gorsel-thumb\" alt=\"Tahsilat\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($banka_gorsel_sayisi > 0): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-success me-1 mb-1\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"<?= $banka_gorsel_sayisi ?> banka görseli\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id . \"?tip=banka\") ?>', 'bankaGorselPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-university\"></i> <?= $banka_gorsel_sayisi ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (count($tahsilat_gorseller) > 3): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-info\">+<?= count($tahsilat_gorseller) - 3 ?></span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($cek_gorsel_sayisi > 0): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-warning me-1 mb-1\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"<?= $cek_gorsel_sayisi ?> çek görseli\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id . \"?tip=cek\") ?>', 'cekGorselPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-credit-card\"></i> <?= $cek_gorsel_sayisi ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($senet_gorsel_sayisi > 0): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-danger me-1 mb-1\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"<?= $senet_gorsel_sayisi ?> senet görseli\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id . \"?tip=senet\") ?>', 'senetGorselPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-file-text\"></i> <?= $senet_gorsel_sayisi ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n"
                },
                {
                    "date": 1755275157161,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,8 +21,13 @@\n \t\t\tbackground-color: #f8d7da;\r\n \t\t\tborder-left: 4px solid #dc3545;\r\n \t\t}\r\n \t\t\r\n+\t\t.rapor-aktivasyon-aktif {\r\n+\t\t\tbackground-color: #d1ecf1;\r\n+\t\t\tborder-left: 4px solid #17a2b8;\r\n+\t\t}\r\n+\t\t\r\n \t\t.tutar-buyuk {\r\n \t\t\tfont-size: 1.2em;\r\n \t\t\tfont-weight: bold;\r\n \t\t\tcolor: #28a745;\r\n@@ -232,9 +237,9 @@\n \t\t\t\t\t\t\t<div class=\"stats-number\">\r\n \t\t\t\t\t\t\t\t<?= isset($onay_bekleyen_sayisi) ? $onay_bekleyen_sayisi : 0 ?>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t<div class=\"stats-label\">\r\n-\t\t\t\t\t\t\t\t<i class=\"fa fa-clock-o mr-2\"></i>Onay Bekleyen\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-clock-o mr-2\"></i>Aktivasyon Bekleyen\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t</div>\r\n@@ -244,9 +249,9 @@\n \t\t\t\t\t\t\t<div class=\"stats-number\">\r\n \t\t\t\t\t\t\t\t<?= isset($onaylanan_sayisi) ? $onaylanan_sayisi : 0 ?>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t<div class=\"stats-label\">\r\n-\t\t\t\t\t\t\t\t<i class=\"fa fa-check mr-2\"></i>Onaylanan\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-check mr-2\"></i>Aktivasyon Tamamlanan\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t</div>\r\n@@ -341,21 +346,25 @@\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Hizmeti</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th class=\"gorsel-column\">Satış Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Tutar</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Görselleri</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Durum</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Durum</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Tarihi</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Personel</th>\r\n \t\t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t\t\t\t<tbody>\r\n \t\t\t\t\t\t\t\t\t\t\t<?php foreach ($rapor_verileri as $veri): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n \t\t\t\t\t\t\t\t\t\t\t\t$row_class = '';\r\n-\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->tahsilat_durum) {\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Var': $row_class = 'rapor-onaylanan'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Yok': $row_class = 'rapor-reddedilen'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Bilinmeyen': $row_class = 'rapor-onay-bekliyor'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->aktivasyon_durum) {\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Aktif': \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tamamlandı': $row_class = 'rapor-onaylanan'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Beklemede': \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İşlemde': $row_class = 'rapor-onay-bekliyor'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İptal': \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedildi': $row_class = 'rapor-reddedilen'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $row_class = 'rapor-onay-bekliyor'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<tr class=\"<?= $row_class ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->cari_isletme ?? '-') ?></td>\r\n@@ -493,16 +502,23 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t$badge_class = 'badge-secondary';\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->tahsilat_durum) {\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Var': $badge_class = 'badge-success'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Yok': $badge_class = 'badge-secondary'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Bilinmeyen': $badge_class = 'badge-warning'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->aktivasyon_durum) {\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Aktif': \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tamamlandı': $badge_class = 'badge-success'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Beklemede': \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İşlemde': $badge_class = 'badge-warning'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İptal': \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedildi': $badge_class = 'badge-danger'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Belirtilmemiş': $badge_class = 'badge-secondary'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-info'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\"><?= $veri->tahsilat_durum ?></span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t      style=\"background-color: <?= isset($veri->aktivasyon_durum_renk) ? $veri->aktivasyon_durum_renk : '#6c757d' ?>\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $veri->aktivasyon_durum ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_tarihi): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= date('d.m.Y', strtotime($veri->aktivasyon_tarihi)) ?>\r\n"
                },
                {
                    "date": 1755324928513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,8 +168,17 @@\n \t\t\tfont-size: 0.85em;\r\n \t\t\tpadding: 5px 10px;\r\n \t\t}\r\n \t\t\r\n+\t\t.badge-sm {\r\n+\t\t\tfont-size: 0.7em;\r\n+\t\t\tpadding: 2px 6px;\r\n+\t\t}\r\n+\t\t\r\n+\t\t[data-toggle=\"tooltip\"] {\r\n+\t\t\tcursor: help;\r\n+\t\t}\r\n+\t\t\r\n \t\t@media (max-width: 768px) {\r\n \t\t\t.table-responsive {\r\n \t\t\t\tfont-size: 0.875rem;\r\n \t\t\t}\r\n@@ -520,9 +529,21 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_tarihi): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= date('d.m.Y', strtotime($veri->aktivasyon_tarihi)) ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Üye No: <?= htmlspecialchars($veri->aktivasyon_uye_no ?? 'Yok') ?>&#10;Kutu No: <?= htmlspecialchars($veri->aktivasyon_kutu_no ?? 'Yok') ?>&#10;Kart No: <?= htmlspecialchars($veri->aktivasyon_kart_no ?? 'Yok') ?>&#10;Açıklama: <?= htmlspecialchars($veri->aktivasyon_aciklama ?? 'Yok') ?>\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-html=\"true\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: help;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= date('d.m.Y', strtotime($veri->aktivasyon_tarihi)) ?></strong>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\"><?= date('H:i', strtotime($veri->aktivasyon_tarihi)) ?></small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_uye_no): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-info badge-sm\">Üye: <?= htmlspecialchars($veri->aktivasyon_uye_no) ?></small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n"
                },
                {
                    "date": 1755325016761,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -518,9 +518,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Beklemede': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İşlemde': $badge_class = 'badge-warning'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İptal': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedildi': $badge_class = 'badge-danger'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Belirtilmemiş': $badge_class = 'badge-secondary'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Aktif Edilmedi': $badge_class = 'badge-secondary'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-info'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\" \r\n"
                },
                {
                    "date": 1755325030663,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -518,9 +518,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Beklemede': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İşlemde': $badge_class = 'badge-warning'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İptal': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedildi': $badge_class = 'badge-danger'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Aktif Edilmedi': $badge_class = 'badge-secondary'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Belirtilmemiş': $badge_class = 'badge-secondary'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-info'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\" \r\n"
                },
                {
                    "date": 1755325437597,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -518,9 +518,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Beklemede': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İşlemde': $badge_class = 'badge-warning'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İptal': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedildi': $badge_class = 'badge-danger'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Belirtilmemiş': $badge_class = 'badge-secondary'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tanımlanmamış': $badge_class = 'badge-secondary'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-info'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\" \r\n"
                },
                {
                    "date": 1755325801272,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -177,8 +177,23 @@\n \t\t[data-toggle=\"tooltip\"] {\r\n \t\t\tcursor: help;\r\n \t\t}\r\n \t\t\r\n+\t\t.aktivasyon-durum-container {\r\n+\t\t\ttext-align: center;\r\n+\t\t\tmin-width: 100px;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.aktivasyon-durum-container .status-badge {\r\n+\t\t\tdisplay: inline-block;\r\n+\t\t\tmin-width: 80px;\r\n+\t\t\tfont-weight: bold;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.aktivasyon-durum-container small {\r\n+\t\t\topacity: 0.7;\r\n+\t\t}\r\n+\t\t\r\n \t\t@media (max-width: 768px) {\r\n \t\t\t.table-responsive {\r\n \t\t\t\tfont-size: 0.875rem;\r\n \t\t\t}\r\n@@ -510,29 +525,46 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Aktivasyon durum ID'sine göre badge class belirle\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t$badge_class = 'badge-secondary';\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$aktivasyon_durum_id = isset($veri->aktivasyon_durum_id) ? $veri->aktivasyon_durum_id : null;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->aktivasyon_durum) {\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Aktif': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tamamlandı': $badge_class = 'badge-success'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Beklemede': \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İşlemde': $badge_class = 'badge-warning'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İşlemde': \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onay Bekliyor': $badge_class = 'badge-warning'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'İptal': \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedildi': $badge_class = 'badge-danger'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Denemede': $badge_class = 'badge-info'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tanımlanmamış': $badge_class = 'badge-secondary'; break;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-info'; break;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-light'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Aktivasyon durum rengi\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$durum_renk = isset($veri->aktivasyon_durum_renk) ? $veri->aktivasyon_durum_renk : '#6c757d';\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$durum_text = $veri->aktivasyon_durum ?? 'Tanımlanmamış';\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\" \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t      style=\"background-color: <?= isset($veri->aktivasyon_durum_renk) ? $veri->aktivasyon_durum_renk : '#6c757d' ?>\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $veri->aktivasyon_durum ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"aktivasyon-durum-container\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t      style=\"background-color: <?= $durum_renk ?> !important; border-color: <?= $durum_renk ?> !important;\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t      title=\"Durum ID: <?= $aktivasyon_durum_id ?? 'NULL' ?>\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $durum_text ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($aktivasyon_durum_id): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted d-block mt-1\" style=\"font-size: 10px;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tID: <?= $aktivasyon_durum_id ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_tarihi): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Üye No: <?= htmlspecialchars($veri->aktivasyon_uye_no ?? 'Yok') ?>&#10;Kutu No: <?= htmlspecialchars($veri->aktivasyon_kutu_no ?? 'Yok') ?>&#10;Kart No: <?= htmlspecialchars($veri->aktivasyon_kart_no ?? 'Yok') ?>&#10;Açıklama: <?= htmlspecialchars($veri->aktivasyon_aciklama ?? 'Yok') ?>\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Aktivasyon ID: <?= $veri->aktivasyon_id ?? 'Yok' ?>&#10;Durum ID: <?= $veri->aktivasyon_durum_id ?? 'Yok' ?>&#10;Üye No: <?= htmlspecialchars($veri->aktivasyon_uye_no ?? 'Yok') ?>&#10;Kutu No: <?= htmlspecialchars($veri->aktivasyon_kutu_no ?? 'Yok') ?>&#10;Kart No: <?= htmlspecialchars($veri->aktivasyon_kart_no ?? 'Yok') ?>&#10;Kampanya: <?= htmlspecialchars($veri->aktivasyon_kampanya_kodu ?? 'Yok') ?>&#10;Açıklama: <?= htmlspecialchars($veri->aktivasyon_aciklama ?? 'Yok') ?>\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-html=\"true\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: help;\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= date('d.m.Y', strtotime($veri->aktivasyon_tarihi)) ?></strong>\r\n@@ -541,8 +573,12 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_uye_no): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-info badge-sm\">Üye: <?= htmlspecialchars($veri->aktivasyon_uye_no) ?></small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_kampanya_kodu): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-primary badge-sm\">Kampanya: <?= htmlspecialchars($veri->aktivasyon_kampanya_kodu) ?></small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n"
                },
                {
                    "date": 1755325831808,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -552,13 +552,8 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t      style=\"background-color: <?= $durum_renk ?> !important; border-color: <?= $durum_renk ?> !important;\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t      title=\"Durum ID: <?= $aktivasyon_durum_id ?? 'NULL' ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $durum_text ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($aktivasyon_durum_id): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted d-block mt-1\" style=\"font-size: 10px;\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tID: <?= $aktivasyon_durum_id ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_tarihi): ?>\r\n"
                },
                {
                    "date": 1755326214992,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -555,17 +555,17 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_tarihi): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->olusturma_tarihi): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Aktivasyon ID: <?= $veri->aktivasyon_id ?? 'Yok' ?>&#10;Durum ID: <?= $veri->aktivasyon_durum_id ?? 'Yok' ?>&#10;Üye No: <?= htmlspecialchars($veri->aktivasyon_uye_no ?? 'Yok') ?>&#10;Kutu No: <?= htmlspecialchars($veri->aktivasyon_kutu_no ?? 'Yok') ?>&#10;Kart No: <?= htmlspecialchars($veri->aktivasyon_kart_no ?? 'Yok') ?>&#10;Kampanya: <?= htmlspecialchars($veri->aktivasyon_kampanya_kodu ?? 'Yok') ?>&#10;Açıklama: <?= htmlspecialchars($veri->aktivasyon_aciklama ?? 'Yok') ?>\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-html=\"true\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: help;\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= date('d.m.Y', strtotime($veri->aktivasyon_tarihi)) ?></strong>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= date('d.m.Y', strtotime($veri->olusturma_tarihi)) ?></strong>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\"><?= date('H:i', strtotime($veri->aktivasyon_tarihi)) ?></small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\"><?= date('H:i', strtotime($veri->olusturma_tarihi)) ?></small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_uye_no): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-info badge-sm\">Üye: <?= htmlspecialchars($veri->aktivasyon_uye_no) ?></small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n"
                },
                {
                    "date": 1755336555970,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -555,17 +555,24 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->olusturma_tarihi): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Aktivasyon tarihi varsa onu kullan, yoksa oluşturma tarihini kullan\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$display_date = $veri->aktivasyon_tarihi ?? $veri->olusturma_tarihi;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($display_date): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Aktivasyon ID: <?= $veri->aktivasyon_id ?? 'Yok' ?>&#10;Durum ID: <?= $veri->aktivasyon_durum_id ?? 'Yok' ?>&#10;Üye No: <?= htmlspecialchars($veri->aktivasyon_uye_no ?? 'Yok') ?>&#10;Kutu No: <?= htmlspecialchars($veri->aktivasyon_kutu_no ?? 'Yok') ?>&#10;Kart No: <?= htmlspecialchars($veri->aktivasyon_kart_no ?? 'Yok') ?>&#10;Kampanya: <?= htmlspecialchars($veri->aktivasyon_kampanya_kodu ?? 'Yok') ?>&#10;Açıklama: <?= htmlspecialchars($veri->aktivasyon_aciklama ?? 'Yok') ?>\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-html=\"true\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: help;\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= date('d.m.Y', strtotime($veri->olusturma_tarihi)) ?></strong>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= date('d.m.Y', strtotime($display_date)) ?></strong>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\"><?= date('H:i', strtotime($veri->olusturma_tarihi)) ?></small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-primary\"><i class=\"fa fa-clock-o\"></i> <?= date('H:i:s', strtotime($display_date)) ?></small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!$veri->aktivasyon_tarihi && $veri->olusturma_tarihi): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-secondary badge-sm\">Oluşturma Tarihi</small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_uye_no): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-info badge-sm\">Üye: <?= htmlspecialchars($veri->aktivasyon_uye_no) ?></small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n"
                },
                {
                    "date": 1755337221421,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,9 +356,25 @@\n \t\t\t\t\t\t\t\t\t\t<p><?= $error_message ?></p>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t<?php elseif (!empty($rapor_verileri)): ?>\r\n+\t\t\t\t\t\t<?php endif; ?>\r\n+\r\n+\t\t\t\t\t\t<?php if ($this->session->flashdata('excel_hata')): ?>\r\n+\t\t\t\t\t\t\t<div class=\"alert alert-danger m-3\">\r\n+\t\t\t\t\t\t\t\t<div class=\"row\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"col-md-2 text-center\">\r\n+\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-file-excel-o\" style=\"font-size: 3rem; color: #dc3545;\"></i>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"col-md-10\">\r\n+\t\t\t\t\t\t\t\t\t\t<h5><i class=\"fa fa-exclamation-triangle mr-2\"></i>Excel Export Hatası</h5>\r\n+\t\t\t\t\t\t\t\t\t\t<p><?= $this->session->flashdata('excel_hata') ?></p>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t<?php endif; ?>\r\n+\r\n+\t\t\t\t\t\t<?php if (!empty($rapor_verileri)): ?>\r\n \t\t\t\t\t\t\t<div class=\"card-body\">\r\n \t\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t\t\t\t<table class=\"table table-hover table-center mb-0\" id=\"raporTable\">\r\n \t\t\t\t\t\t\t\t\t\t<thead>\r\n"
                },
                {
                    "date": 1755352268327,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -378,8 +378,9 @@\n \t\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t\t\t\t<table class=\"table table-hover table-center mb-0\" id=\"raporTable\">\r\n \t\t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th>Tarih</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>İşletme</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th class=\"gorsel-column\">İşletme Görsel</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th class=\"evrak-column\">Evrak</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Tutarı</th>\r\n@@ -406,8 +407,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $row_class = 'rapor-onay-bekliyor'; break;\r\n \t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<tr class=\"<?= $row_class ?>\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td data-order=\"<?= $veri->kayit_tarihi ? strtotime($veri->kayit_tarihi) : 0 ?>\"><?= $veri->kayit_tarihi ? date('d.m.Y', strtotime($veri->kayit_tarihi)) : '-' ?></td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->cari_isletme ?? '-') ?></td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"gorsel-column\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t// İşletme görselleri için cari_id kullanarak sayı göster\r\n@@ -686,9 +688,9 @@\n \t$('#raporTable').DataTable({\r\n \t\t\"language\": {\r\n \t\t\t\"url\": \"https://cdn.datatables.net/plug-ins/1.13.6/i18n/tr.json\"\r\n \t\t},\r\n-\t\t\"order\": [[ 0, \"asc\" ]],\r\n+\t\t\"order\": [[ 0, \"desc\" ]],  // İlk kolon (Tarih) azalan sıralama\r\n \t\t\"pageLength\": 25,\r\n \t\t\"responsive\": true,\r\n \t\t\"scrollX\": true\r\n \t});\r\n"
                },
                {
                    "date": 1755499988922,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,8 +32,28 @@\n \t\t\tfont-weight: bold;\r\n \t\t\tcolor: #28a745;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Satış sözleşme tutarı link stili */\r\n+\t\t.tutar-buyuk.text-decoration-none {\r\n+\t\t\ttransition: all 0.3s ease;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.tutar-buyuk.text-decoration-none:hover {\r\n+\t\t\tcolor: #1e7e34 !important;\r\n+\t\t\ttext-decoration: none !important;\r\n+\t\t\ttransform: scale(1.05);\r\n+\t\t}\r\n+\t\t\r\n+\t\t.tutar-buyuk .fa-external-link {\r\n+\t\t\topacity: 0.7;\r\n+\t\t\ttransition: opacity 0.3s ease;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.tutar-buyuk:hover .fa-external-link {\r\n+\t\t\topacity: 1;\r\n+\t\t}\r\n+\t\t\r\n \t\t.card-stats {\r\n \t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n \t\t\tcolor: white;\r\n \t\t}\r\n@@ -459,9 +479,20 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= base_url(\"fatura/satis-faturasi/\" . $veri->satis_sozlesme_id) ?>\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   target=\"_blank\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   class=\"tutar-buyuk text-decoration-none\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   title=\"Satış faturası düzenleme sayfasını aç (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   style=\"cursor: pointer; color: #28a745;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-external-link ml-1\" style=\"font-size: 0.8em;\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n"
                },
                {
                    "date": 1755506192855,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -495,9 +495,18 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->satis_sozlesme_hizmeti ?? '-') ?></td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-success\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"gorsel-column\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t// Satış görselleri için satis_id kullanarak sayı göster\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): \r\n"
                },
                {
                    "date": 1755508409275,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,8 +52,29 @@\n \t\t.tutar-buyuk:hover .fa-external-link {\r\n \t\t\topacity: 1;\r\n \t\t}\r\n \t\t\r\n+\t\t/* İşletme link stili */\r\n+\t\t.isletme-link {\r\n+\t\t\tcolor: #007bff;\r\n+\t\t\ttext-decoration: none;\r\n+\t\t\ttransition: all 0.3s ease;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.isletme-link:hover {\r\n+\t\t\tcolor: #0056b3;\r\n+\t\t\ttext-decoration: none;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.isletme-link .fa-external-link-alt {\r\n+\t\t\topacity: 0.6;\r\n+\t\t\ttransition: opacity 0.3s ease;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.isletme-link:hover .fa-external-link-alt {\r\n+\t\t\topacity: 1;\r\n+\t\t}\r\n+\t\t\r\n \t\t.card-stats {\r\n \t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n \t\t\tcolor: white;\r\n \t\t}\r\n@@ -428,9 +449,21 @@\n \t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<tr class=\"<?= $row_class ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td data-order=\"<?= $veri->kayit_tarihi ? strtotime($veri->kayit_tarihi) : 0 ?>\"><?= $veri->kayit_tarihi ? date('d.m.Y', strtotime($veri->kayit_tarihi)) : '-' ?></td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->cari_isletme ?? '-') ?></td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->cari_id) && !empty($veri->cari_id)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= base_url('cari/cari-karti-duzenle/' . $veri->cari_id) ?>\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   target=\"_blank\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   class=\"isletme-link\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   title=\"Cari kartı düzenle\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->cari_isletme ?? '-') ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-external-link-alt fa-sm ml-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->cari_isletme ?? '-') ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"gorsel-column\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t// İşletme görselleri için cari_id kullanarak sayı göster\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isset($veri->cari_id) && !empty($veri->cari_id)): \r\n"
                },
                {
                    "date": 1755584922817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n \t<?php $this->load->view(\"include/head-tags\"); ?>\r\n \t<title>Tam Ana Rapor | İlekaSoft CRM</title>\r\n \t<link rel=\"icon\" type=\"image/x-icon\" href=\"<?= base_url('assets/favicon.ico'); ?>\" />\r\n \t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/css/dataTables.bootstrap4.min.css\"/>\r\n+\t<link rel=\"stylesheet\" href=\"https://code.jquery.com/ui/1.13.2/themes/ui-lightness/jquery-ui.css\"/>\r\n \t\r\n \t<style>\r\n \t\t.rapor-onay-bekliyor {\r\n \t\t\tbackground-color: #fff3cd;\r\n@@ -253,8 +254,56 @@\n \t\t\t\twidth: 40px;\r\n \t\t\t\theight: 40px;\r\n \t\t\t}\r\n \t\t}\r\n+\t\t\r\n+\t\t/* Stok arama autocomplete stilleri */\r\n+\t\t.ui-autocomplete {\r\n+\t\t\tmax-height: 300px;\r\n+\t\t\toverflow-y: auto;\r\n+\t\t\toverflow-x: hidden;\r\n+\t\t\tborder: 1px solid #ddd;\r\n+\t\t\tbackground: white;\r\n+\t\t\tz-index: 9999 !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.ui-autocomplete .ui-menu-item {\r\n+\t\t\tpadding: 0;\r\n+\t\t\tmargin: 0;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.ui-autocomplete .ui-menu-item-wrapper {\r\n+\t\t\tpadding: 8px 12px;\r\n+\t\t\tborder-bottom: 1px solid #eee;\r\n+\t\t\ttransition: background-color 0.2s;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.ui-autocomplete .ui-menu-item-wrapper:hover,\r\n+\t\t.ui-autocomplete .ui-state-focus {\r\n+\t\t\tbackground-color: #f8f9fa !important;\r\n+\t\t\tborder: none !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.ui-autocomplete .ui-state-active {\r\n+\t\t\tbackground-color: #007bff !important;\r\n+\t\t\tcolor: white !important;\r\n+\t\t\tborder: none !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* Stok arama input stili */\r\n+\t\t.stokAdi {\r\n+\t\t\tposition: relative;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.stokAdi:focus {\r\n+\t\t\tborder-color: #007bff;\r\n+\t\t\tbox-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);\r\n+\t\t}\r\n+\t\t\r\n+\t\t.input-group .input-group-text {\r\n+\t\t\tbackground-color: #f8f9fa;\r\n+\t\t\tborder-color: #ced4da;\r\n+\t\t}\r\n \t</style>\r\n </head>\r\n <body>\r\n <div class=\"main-wrapper\">\r\n@@ -513,16 +562,15 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= base_url(\"fatura/satis-faturasi/\" . $veri->satis_sozlesme_id) ?>\" \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   target=\"_blank\" \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   class=\"tutar-buyuk text-decoration-none\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   title=\"Satış faturası düzenleme sayfasını aç (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   style=\"cursor: pointer; color: #28a745;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-link tutar-buyuk text-decoration-none p-0 border-0\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"openStokBilgisiModal(<?= $veri->satis_sozlesme_id ?>, <?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme, ENT_QUOTES) ?>')\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Stok bilgilerini görüntüle ve düzenle (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: pointer; color: #28a745; background: none;\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-external-link ml-1\" style=\"font-size: 0.8em;\"></i>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-edit ml-1\" style=\"font-size: 0.8em;\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n@@ -721,8 +769,39 @@\n \t\t</div>\r\n \t</div>\r\n </div>\r\n \r\n+<!-- Stok Bilgisi Modal -->\r\n+<div class=\"modal fade\" id=\"stokBilgisiModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"stokBilgisiModalLabel\" aria-hidden=\"true\">\r\n+\t<div class=\"modal-dialog modal-lg\" role=\"document\">\r\n+\t\t<div class=\"modal-content\">\r\n+\t\t\t<div class=\"modal-header\">\r\n+\t\t\t\t<h5 class=\"modal-title\" id=\"stokBilgisiModalLabel\">\r\n+\t\t\t\t\t<i class=\"fa fa-boxes mr-2\"></i>Stok Bilgileri\r\n+\t\t\t\t</h5>\r\n+\t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n+\t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n+\t\t\t\t</button>\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"modal-body\">\r\n+\t\t\t\t<div id=\"stokBilgisiLoading\" class=\"text-center p-4\">\r\n+\t\t\t\t\t<i class=\"fa fa-spinner fa-spin fa-2x\"></i>\r\n+\t\t\t\t\t<div class=\"mt-2\">Stok bilgileri yükleniyor...</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t<div id=\"stokBilgisiContent\" style=\"display: none;\">\r\n+\t\t\t\t\t<!-- Stok listesi buraya yüklenecek -->\r\n+\t\t\t\t</div>\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"modal-footer\">\r\n+\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">İptal</button>\r\n+\t\t\t\t<button type=\"button\" class=\"btn btn-success\" id=\"stokBilgisiKaydetBtn\">\r\n+\t\t\t\t\t<i class=\"fa fa-save mr-1\"></i>Kaydet\r\n+\t\t\t\t</button>\r\n+\t\t\t</div>\r\n+\t\t</div>\r\n+\t</div>\r\n+</div>\r\n+\r\n <!-- Tahsilat Detay Modal -->\r\n <div class=\"modal fade\" id=\"tahsilatModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"tahsilatModalLabel\" aria-hidden=\"true\">\r\n \t<div class=\"modal-dialog modal-xl\" role=\"document\">\r\n \t\t<div class=\"modal-content\">\r\n@@ -751,8 +830,9 @@\n </div>\r\n \r\n <?php $this->load->view(\"include/footer-js\"); ?>\r\n \r\n+<script src=\"https://code.jquery.com/ui/1.13.2/jquery-ui.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/js/dataTables.bootstrap4.min.js\"></script>\r\n \r\n <script>\r\n@@ -776,8 +856,391 @@\n \t$('#downloadLink').attr('href', imageSrc);\r\n \t$('#imageModal').modal('show');\r\n }\r\n \r\n+// Stok Bilgisi modal fonksiyonu\r\n+function openStokBilgisiModal(satisId, cariId, cariIsletme) {\r\n+\tconsole.log('openStokBilgisiModal called with:', { satisId, cariId, cariIsletme });\r\n+\t\r\n+\t$('#stokBilgisiModalLabel').html('<i class=\"fa fa-boxes mr-2\"></i>Stok Bilgileri - ' + cariIsletme);\r\n+\t\r\n+\t// Modal'da satis_id ve cari_id'yi sakla\r\n+\t$('#stokBilgisiModal').data('satisId', satisId);\r\n+\t$('#stokBilgisiModal').data('cariId', cariId);\r\n+\t\r\n+\t$('#stokBilgisiModal').modal('show');\r\n+\t$('#stokBilgisiLoading').show();\r\n+\t$('#stokBilgisiContent').hide();\r\n+\t\r\n+\t// AJAX ile stok verilerini getir\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"stok_bilgileri_endpoint.php\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: { \r\n+\t\t\tsatis_id: satisId,\r\n+\t\t\tcari_id: cariId\r\n+\t\t},\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tconsole.log('AJAX Success:', response);\r\n+\t\t\t$('#stokBilgisiLoading').hide();\r\n+\t\t\t$('#stokBilgisiContent').show();\r\n+\t\t\t\r\n+\t\t\tif (response && response.success) {\r\n+\t\t\t\tlet html = `\r\n+\t\t\t\t\t<div class=\"row mb-3\">\r\n+\t\t\t\t\t\t<div class=\"col-md-12\">\r\n+\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"stokSatiriEkle()\">\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-plus mr-1\"></i>Yeni Satır Ekle\r\n+\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t<div class=\"table-responsive\">\r\n+\t\t\t\t\t\t<table class=\"table table-bordered\" id=\"stokTable\">\r\n+\t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n+\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"40%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"25%\">Birim Fiyat (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n+\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t</thead>\r\n+\t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n+\t\t\t\t`;\r\n+\t\t\t\t\r\n+\t\t\t\tif (response.data && response.data.length > 0) {\r\n+\t\t\t\t\tresponse.data.forEach(function(item, index) {\r\n+\t\t\t\t\t\thtml += createStokRow(index, item);\r\n+\t\t\t\t\t});\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\thtml += createStokRow(0, {});\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n+\t\t\t\thtml += `\r\n+\t\t\t\t\t\t\t</tbody>\r\n+\t\t\t\t\t\t</table>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t<div class=\"row mt-3\">\r\n+\t\t\t\t\t\t<div class=\"col-md-6 offset-md-6\">\r\n+\t\t\t\t\t\t\t<div class=\"card\">\r\n+\t\t\t\t\t\t\t\t<div class=\"card-body p-3\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n+\t\t\t\t\t\t\t\t\t\t<strong>Toplam Tutar (KDV Dahil):</strong>\r\n+\t\t\t\t\t\t\t\t\t\t<span id=\"toplamTutar\">0.00 ₺</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">\r\n+\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle\"></i>\r\n+\t\t\t\t\t\t\t\t\t\tBirim fiyatlar KDV dahil olarak girilmelidir\r\n+\t\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`;\r\n+\t\t\t\t\r\n+\t\t\t\t$('#stokBilgisiContent').html(html);\r\n+\t\t\t\t\r\n+\t\t\t\t// Stok arama autocomplete'i başlat\r\n+\t\t\t\tinitStokAutocomplete();\r\n+\t\t\t\t\r\n+\t\t\t\t// Toplam tutarı hesapla\r\n+\t\t\t\thesaplaToplamTutar();\r\n+\t\t\t\t\r\n+\t\t\t\t// Mevcut veriler için KDV ayrıştırmasını göster\r\n+\t\t\t\tdocument.querySelectorAll('.birimFiyat').forEach(function(input) {\r\n+\t\t\t\t\tupdateKdvBreakdown(input);\r\n+\t\t\t\t});\r\n+\t\t\t} else {\r\n+\t\t\t\tconsole.log('AJAX Response not success:', response);\r\n+\t\t\t\t$('#stokBilgisiContent').html(`\r\n+\t\t\t\t\t<div class=\"alert alert-danger text-center\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-exclamation-triangle fa-2x mb-2\"></i>\r\n+\t\t\t\t\t\t<h5>Hata Oluştu</h5>\r\n+\t\t\t\t\t\t<p>${response && response.message ? response.message : 'Stok verileri yüklenirken bir hata oluştu.'}</p>\r\n+\t\t\t\t\t\t<details>\r\n+\t\t\t\t\t\t\t<summary>Debug Bilgisi</summary>\r\n+\t\t\t\t\t\t\t<pre>${JSON.stringify(response, null, 2)}</pre>\r\n+\t\t\t\t\t\t</details>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`);\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.log('AJAX Error:', { xhr, status, error });\r\n+\t\t\tconsole.log('Response Text:', xhr.responseText);\r\n+\t\t\t\r\n+\t\t\t$('#stokBilgisiLoading').hide();\r\n+\t\t\t$('#stokBilgisiContent').show().html(`\r\n+\t\t\t\t<div class=\"alert alert-danger text-center\">\r\n+\t\t\t\t\t<i class=\"fa fa-exclamation-triangle fa-2x mb-2\"></i>\r\n+\t\t\t\t\t<h5>Hata Oluştu</h5>\r\n+\t\t\t\t\t<p>Stok verileri yüklenirken bir hata oluştu.</p>\r\n+\t\t\t\t\t<small class=\"d-block mt-2\">Detay: ${status} - ${error}</small>\r\n+\t\t\t\t\t<small class=\"d-block\">URL: <?= base_url(\"muhasebe/getStokBilgileri\") ?></small>\r\n+\t\t\t\t</div>\r\n+\t\t\t`);\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+// Stok satırı oluştur\r\n+function createStokRow(index, data = {}) {\r\n+\tconsole.log('createStokRow called with:', data);\r\n+\treturn `\r\n+\t\t<tr data-index=\"${index}\">\r\n+\t\t\t<td>\r\n+\t\t\t\t<input type=\"hidden\" name=\"stokId[]\" value=\"${data.stok_id || ''}\" class=\"stokId\">\r\n+\t\t\t\t<input type=\"hidden\" name=\"satisStokId[]\" value=\"${data.satisStok_id || ''}\" class=\"satisStokId\">\r\n+\t\t\t\t<div class=\"input-group\">\r\n+\t\t\t\t\t<input type=\"text\" class=\"form-control stokAdi\" name=\"stokAdi[]\" \r\n+\t\t\t\t\t\t   value=\"${data.stok_adi || ''}\" \r\n+\t\t\t\t\t\t   placeholder=\"Stok adı ara (en az 2 karakter)...\"\r\n+\t\t\t\t\t\t   title=\"Stok arama için en az 2 karakter yazın\">\r\n+\t\t\t\t\t<div class=\"input-group-append\">\r\n+\t\t\t\t\t\t<span class=\"input-group-text\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-search\" title=\"Stok ara\"></i>\r\n+\t\t\t\t\t\t</span>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t${data.stok_kodu ? `<small class=\"text-muted\">Kod: ${data.stok_kodu}</small>` : ''}\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<input type=\"number\" class=\"form-control miktar\" name=\"miktar[]\" \r\n+\t\t\t\t\t   value=\"${data.satisStok_miktar || 1}\" min=\"1\" step=\"0.01\" \r\n+\t\t\t\t\t   onchange=\"hesaplaToplamTutar()\">\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<input type=\"number\" class=\"form-control birimFiyat\" name=\"birimFiyat[]\" \r\n+\t\t\t\t\t   value=\"${data.satisStok_birimFiyat || 0}\" min=\"0\" step=\"0.01\" \r\n+\t\t\t\t\t   placeholder=\"KDV dahil fiyat\"\r\n+\t\t\t\t\t   title=\"KDV dahil birim fiyat giriniz\"\r\n+\t\t\t\t\t   onchange=\"hesaplaToplamTutar(); updateKdvBreakdown(this);\"\r\n+\t\t\t\t\t   onkeyup=\"updateKdvBreakdown(this);\">\r\n+\t\t\t\t<small class=\"text-muted kdv-breakdown\" style=\"font-size: 0.75em;\"></small>\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<select class=\"form-control kdvOrani\" name=\"kdvOrani[]\" onchange=\"hesaplaToplamTutar(); updateKdvBreakdown(this.closest('tr').querySelector('.birimFiyat'));\">\r\n+\t\t\t\t\t<option value=\"0\" ${(data.satisStok_kdv || 0) == 0 ? 'selected' : ''}>%0</option>\r\n+\t\t\t\t\t<option value=\"1\" ${(data.satisStok_kdv || 0) == 1 ? 'selected' : ''}>%1</option>\r\n+\t\t\t\t\t<option value=\"8\" ${(data.satisStok_kdv || 0) == 8 ? 'selected' : ''}>%8</option>\r\n+\t\t\t\t\t<option value=\"18\" ${(data.satisStok_kdv || 0) == 18 ? 'selected' : ''}>%18</option>\r\n+\t\t\t\t\t<option value=\"20\" ${(data.satisStok_kdv || 0) == 20 ? 'selected' : ''}>%20</option>\r\n+\t\t\t\t</select>\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<button type=\"button\" class=\"btn btn-danger btn-sm\" onclick=\"stokSatiriSil(this)\" \r\n+\t\t\t\t\t\ttitle=\"Satırı sil\">\r\n+\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t</button>\r\n+\t\t\t</td>\r\n+\t\t</tr>\r\n+\t`;\r\n+}\r\n+\r\n+// Yeni stok satırı ekle\r\n+function stokSatiriEkle() {\r\n+\tconst tbody = document.getElementById('stokTableBody');\r\n+\tconst newIndex = tbody.children.length;\r\n+\tconst newRow = createStokRow(newIndex, {});\r\n+\ttbody.insertAdjacentHTML('beforeend', newRow);\r\n+\t\r\n+\t// Yeni satır için autocomplete başlat\r\n+\tinitStokAutocomplete();\r\n+\t\r\n+\t// Yeni satırdaki input'a focus ver\r\n+\tconst newRowElement = tbody.lastElementChild;\r\n+\tconst stokAdiInput = newRowElement.querySelector('.stokAdi');\r\n+\tif (stokAdiInput) {\r\n+\t\tstokAdiInput.focus();\r\n+\t}\r\n+}\r\n+\r\n+// Stok satırı sil\r\n+function stokSatiriSil(button) {\r\n+\tif (document.getElementById('stokTableBody').children.length > 1) {\r\n+\t\tbutton.closest('tr').remove();\r\n+\t\thesaplaToplamTutar();\r\n+\t} else {\r\n+\t\talert('En az bir stok satırı olması gereklidir.');\r\n+\t}\r\n+}\r\n+\r\n+// Toplam tutarı hesapla\r\n+function hesaplaToplamTutar() {\r\n+\tlet toplam = 0;\r\n+\t\r\n+\tdocument.querySelectorAll('#stokTableBody tr').forEach(function(row) {\r\n+\t\tconst miktar = parseFloat(row.querySelector('.miktar').value) || 0;\r\n+\t\tconst birimFiyatKdvDahil = parseFloat(row.querySelector('.birimFiyat').value) || 0;\r\n+\t\tconst kdvOrani = parseFloat(row.querySelector('.kdvOrani').value) || 0;\r\n+\t\t\r\n+\t\t// Birim fiyat KDV dahil olduğu için direkt çarpım yapıyoruz\r\n+\t\tconst toplamSatir = miktar * birimFiyatKdvDahil;\r\n+\t\t\r\n+\t\ttoplam += toplamSatir;\r\n+\t});\r\n+\t\r\n+\tdocument.getElementById('toplamTutar').textContent = \r\n+\t\ttoplam.toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺';\r\n+}\r\n+\r\n+// KDV ayrıştırmasını göster\r\n+function updateKdvBreakdown(input) {\r\n+\tconst row = input.closest('tr');\r\n+\tconst kdvDahilFiyat = parseFloat(input.value) || 0;\r\n+\tconst kdvOrani = parseFloat(row.querySelector('.kdvOrani').value) || 0;\r\n+\tconst breakdownElement = row.querySelector('.kdv-breakdown');\r\n+\t\r\n+\tif (kdvDahilFiyat > 0 && kdvOrani > 0) {\r\n+\t\tconst kdvHaricFiyat = kdvDahilFiyat / (1 + (kdvOrani / 100));\r\n+\t\tconst kdvTutari = kdvDahilFiyat - kdvHaricFiyat;\r\n+\t\t\r\n+\t\tbreakdownElement.innerHTML = \r\n+\t\t\t`KDV Hariç: ${kdvHaricFiyat.toFixed(2)} ₺ + KDV(${kdvOrani}%): ${kdvTutari.toFixed(2)} ₺`;\r\n+\t} else {\r\n+\t\tbreakdownElement.innerHTML = '';\r\n+\t}\r\n+}\r\n+\r\n+// Stok autocomplete başlat\r\n+function initStokAutocomplete() {\r\n+\t$('.stokAdi').each(function() {\r\n+\t\t$(this).autocomplete({\r\n+\t\t\tsource: function(request, response) {\r\n+\t\t\t\t$.ajax({\r\n+\t\t\t\t\turl: '<?= base_url(\"stok_arama_endpoint.php\") ?>',\r\n+\t\t\t\t\tdata: { term: request.term },\r\n+\t\t\t\t\tdataType: 'json',\r\n+\t\t\t\t\tbeforeSend: function() {\r\n+\t\t\t\t\t\t// Loading göstergesi ekle\r\n+\t\t\t\t\t\t$('.ui-autocomplete').html('<li class=\"ui-menu-item\"><div class=\"ui-menu-item-wrapper\"><i class=\"fa fa-spinner fa-spin\"></i> Aranıyor...</div></li>');\r\n+\t\t\t\t\t},\r\n+\t\t\t\t\tsuccess: function(data) {\r\n+\t\t\t\t\t\tresponse(data);\r\n+\t\t\t\t\t},\r\n+\t\t\t\t\terror: function() {\r\n+\t\t\t\t\t\tresponse([]);\r\n+\t\t\t\t\t\tconsole.log('Stok arama hatası');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t});\r\n+\t\t\t},\r\n+\t\t\tminLength: 2,\r\n+\t\t\tdelay: 300, // 300ms gecikme ekle\r\n+\t\t\tselect: function(event, ui) {\r\n+\t\t\t\tconsole.log('Stok selected:', ui.item);\r\n+\t\t\t\tconst row = $(this).closest('tr');\r\n+\t\t\t\t\r\n+\t\t\t\t// Stok bilgilerini doldur\r\n+\t\t\t\trow.find('.stokId').val(ui.item.stok_id);\r\n+\t\t\t\t\r\n+\t\t\t\t// KDV oranını önce ayarla\r\n+\t\t\t\tconst kdvSelect = row.find('.kdvOrani');\r\n+\t\t\t\tconst kdvOrani = ui.item.stok_satisKDV || 20;\r\n+\t\t\t\tkdvSelect.val(kdvOrani);\r\n+\t\t\t\t\r\n+\t\t\t\t// Satış fiyatını KDV dahil olarak hesapla\r\n+\t\t\t\tconst satisFiyatiKdvHaric = parseFloat(ui.item.stok_satisFiyati) || 0;\r\n+\t\t\t\tconst kdvCarpani = 1 + (kdvOrani / 100);\r\n+\t\t\t\tconst satisFiyatiKdvDahil = satisFiyatiKdvHaric * kdvCarpani;\r\n+\t\t\t\t\r\n+\t\t\t\trow.find('.birimFiyat').val(satisFiyatiKdvDahil.toFixed(2));\r\n+\t\t\t\t\r\n+\t\t\t\t// KDV ayrıştırmasını güncelle\r\n+\t\t\t\tupdateKdvBreakdown(row.find('.birimFiyat')[0]);\r\n+\t\t\t\t\r\n+\t\t\t\t// Stok kodu göster\r\n+\t\t\t\tlet stokKoduHtml = ui.item.stok_kodu ? \r\n+\t\t\t\t\t`<small class=\"text-muted\">Kod: ${ui.item.stok_kodu}</small>` : '';\r\n+\t\t\t\trow.find('td:first .input-group').next('small').remove();\r\n+\t\t\t\tif (stokKoduHtml) {\r\n+\t\t\t\t\trow.find('td:first .input-group').after(stokKoduHtml);\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n+\t\t\t\thesaplaToplamTutar();\r\n+\t\t\t\treturn false; // Input değerini manuel olarak ayarladık\r\n+\t\t\t},\r\n+\t\t\tfocus: function(event, ui) {\r\n+\t\t\t\t// Focus'ta input değerini değiştirme\r\n+\t\t\t\treturn false;\r\n+\t\t\t}\r\n+\t\t}).focus(function() {\r\n+\t\t\t// Focus'ta minimum karakter sayısını karşılıyorsa arama yap\r\n+\t\t\tif ($(this).val().length >= 2) {\r\n+\t\t\t\t$(this).autocomplete('search', $(this).val());\r\n+\t\t\t}\r\n+\t\t});\r\n+\t});\r\n+}\r\n+\r\n+// Stok bilgilerini kaydet\r\n+$('#stokBilgisiKaydetBtn').click(function() {\r\n+\tconst formData = [];\r\n+\tconst satisId = $('#stokBilgisiModal').data('satisId');\r\n+\tconst cariId = $('#stokBilgisiModal').data('cariId');\r\n+\t\r\n+\tconsole.log('Kaydet clicked with:', { satisId, cariId });\r\n+\t\r\n+\tdocument.querySelectorAll('#stokTableBody tr').forEach(function(row) {\r\n+\t\tconst stokData = {\r\n+\t\t\tsatisStok_id: row.querySelector('.satisStokId').value,\r\n+\t\t\tstok_id: row.querySelector('.stokId').value,\r\n+\t\t\tstok_adi: row.querySelector('.stokAdi').value,\r\n+\t\t\tmiktar: row.querySelector('.miktar').value,\r\n+\t\t\tbirim_fiyat: row.querySelector('.birimFiyat').value,\r\n+\t\t\tkdv_orani: row.querySelector('.kdvOrani').value\r\n+\t\t};\r\n+\t\t\r\n+\t\tif (stokData.stok_adi && stokData.miktar && stokData.birim_fiyat) {\r\n+\t\t\tformData.push(stokData);\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\tif (formData.length === 0) {\r\n+\t\talert('En az bir stok bilgisi girmeniz gereklidir.');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\t// AJAX ile kaydet\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/stokBilgileriKaydet\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: {\r\n+\t\t\tsatis_id: satisId,\r\n+\t\t\tcari_id: cariId,\r\n+\t\t\tstok_bilgileri: formData\r\n+\t\t},\r\n+\t\tdataType: 'json',\r\n+\t\tbeforeSend: function() {\r\n+\t\t\t$('#stokBilgisiKaydetBtn').prop('disabled', true).html('<i class=\"fa fa-spinner fa-spin mr-1\"></i>Kaydediliyor...');\r\n+\t\t},\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tif (response.success) {\r\n+\t\t\t\talert('Stok bilgileri başarıyla kaydedildi.');\r\n+\t\t\t\t$('#stokBilgisiModal').modal('hide');\r\n+\t\t\t\t// Sayfayı yenile\r\n+\t\t\t\tlocation.reload();\r\n+\t\t\t} else {\r\n+\t\t\t\talert('Hata: ' + (response.message || 'Kayıt sırasında bir hata oluştu.'));\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function() {\r\n+\t\t\talert('Kayıt sırasında bir hata oluştu.');\r\n+\t\t},\r\n+\t\tcomplete: function() {\r\n+\t\t\t$('#stokBilgisiKaydetBtn').prop('disabled', false).html('<i class=\"fa fa-save mr-1\"></i>Kaydet');\r\n+\t\t}\r\n+\t});\r\n+});\r\n+\r\n+// Modal açılırken satis_id ve cari_id'yi data attribute olarak sakla\r\n+$('#stokBilgisiModal').on('show.bs.modal', function (e) {\r\n+\tconst satisId = $(e.relatedTarget).data('satis-id');\r\n+\tconst cariId = $(e.relatedTarget).data('cari-id');\r\n+\t$(this).data('satisId', satisId);\r\n+\t$(this).data('cariId', cariId);\r\n+});\r\n+\r\n // Tahsilat detay modal fonksiyonu\r\n function showTahsilatModal(cariId, cariAd) {\r\n \t$('#tahsilatModalLabel').html('<i class=\"fa fa-money mr-2\"></i>Tahsilat Detayları - ' + cariAd);\r\n \t$('#tahsilatModal').modal('show');\r\n"
                },
                {
                    "date": 1755587227984,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1201,9 +1201,9 @@\n \t}\r\n \t\r\n \t// AJAX ile kaydet\r\n \t$.ajax({\r\n-\t\turl: '<?= base_url(\"muhasebe/stokBilgileriKaydet\") ?>',\r\n+\t\turl: '<?= base_url(\"stok_kaydet_endpoint.php\") ?>',\r\n \t\tmethod: 'POST',\r\n \t\tdata: {\r\n \t\t\tsatis_id: satisId,\r\n \t\t\tcari_id: cariId,\r\n"
                },
                {
                    "date": 1755671825420,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -561,31 +561,37 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-link tutar-buyuk text-decoration-none p-0 border-0\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"openStokBilgisiModal(<?= $veri->satis_sozlesme_id ?>, <?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme, ENT_QUOTES) ?>')\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Stok bilgilerini görüntüle ve düzenle (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: pointer; color: #28a745; background: none;\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-edit ml-1\" style=\"font-size: 0.8em;\"></i>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-success\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-link text-decoration-none p-1 border-0\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"openStokBilgisiModal(<?= $veri->satis_sozlesme_id ?>, <?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme, ENT_QUOTES) ?>')\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Stok bilgilerini görüntüle ve düzenle (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: pointer; color: #28a745; background: none;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-boxes mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tStok Bilgileri\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-edit ml-1\" style=\"font-size: 0.8em;\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-success\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"gorsel-column\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n"
                },
                {
                    "date": 1755672207232,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -729,9 +729,28 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->personel ?? '-') ?></td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->personel) && !empty($veri->personel)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"E-posta: <?= htmlspecialchars($veri->kullanici_eposta ?? 'Belirtilmemiş') ?>&#10;Kullanıcı ID: <?= htmlspecialchars($veri->kullanici_id ?? 'Yok') ?>\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-html=\"true\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: help;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->personel) ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- DEBUG: Veri kontrolü -->\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($_GET['debug']) && $_GET['debug'] == '1'): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br><small class=\"text-danger\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDEBUG - kullanici_eposta: <?= isset($veri->kullanici_eposta) ? $veri->kullanici_eposta : 'YOK' ?><br>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDEBUG - kullanici_id: <?= isset($veri->kullanici_id) ? $veri->kullanici_id : 'YOK' ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n \t\t\t\t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t\t\t\t</table>\r\n"
                },
                {
                    "date": 1755782695493,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -693,10 +693,10 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t$durum_text = $veri->aktivasyon_durum ?? 'Tanımlanmamış';\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"aktivasyon-durum-container\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\" \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t      style=\"background-color: <?= $durum_renk ?> !important; border-color: <?= $durum_renk ?> !important;\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t      title=\"Durum ID: <?= $aktivasyon_durum_id ?? 'NULL' ?>\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  style=\"background-color: <?= $durum_renk ?> !important; border-color: <?= $durum_renk ?> !important;\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  title=\"Durum ID: <?= $aktivasyon_durum_id ?? 'NULL' ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $durum_text ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n@@ -1292,23 +1292,29 @@\n \t\t\t\t\t\t\t\t\t<th>Belge No</th>\r\n \t\t\t\t\t\t\t\t\t<th>Tahsilat Tipi</th>\r\n \t\t\t\t\t\t\t\t\t<th>Tutar</th>\r\n \t\t\t\t\t\t\t\t\t<th>Açıklama</th>\r\n+\t\t\t\t\t\t\t\t\t<th>İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody>\r\n \t\t\t\t`;\r\n \t\t\t\t\r\n \t\t\t\tlet toplamTutar = 0;\r\n \t\t\t\tresponse.data.forEach(function(item) {\r\n \t\t\t\t\ttoplamTutar += parseFloat(item.ch_alacak || 0);\r\n+\t\t\t\t\t\r\n \t\t\t\t\thtml += `\r\n \t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t<td>${item.ch_tarih}</td>\r\n \t\t\t\t\t\t\t<td>${item.ch_belgeNumarasi || '-'}</td>\r\n \t\t\t\t\t\t\t<td><span class=\"badge badge-info\">${item.tahsilat_tipi}</span></td>\r\n \t\t\t\t\t\t\t<td class=\"text-right\"><strong>${parseFloat(item.ch_alacak).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</strong></td>\r\n \t\t\t\t\t\t\t<td>${item.ch_aciklama || '-'}</td>\r\n+\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-success mr-1\" onclick=\"tahsilatDuzenleModalAc('${item.ch_id}')\"><i class='fa fa-edit'></i></button>\r\n+\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-danger\" onclick=\"tahsilatSil('${item.ch_id}', this)\"><i class='fa fa-trash'></i></button>\r\n+\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t</tr>\r\n \t\t\t\t\t`;\r\n \t\t\t\t});\r\n \t\t\t\t\r\n@@ -1318,8 +1324,9 @@\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th colspan=\"3\">TOPLAM</th>\r\n \t\t\t\t\t\t\t\t\t<th class=\"text-right\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n+\t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</tfoot>\r\n \t\t\t\t\t\t</table>\r\n \t\t\t\t\t</div>\r\n@@ -1335,15 +1342,22 @@\n \t\t\t\t\t</div>\r\n \t\t\t\t`);\r\n \t\t\t}\r\n \t\t},\r\n-\t\terror: function() {\r\n+\t\terror: function(xhr, status, error) {\r\n \t\t\t$('#tahsilatLoading').hide();\r\n \t\t\t$('#tahsilatContent').show().html(`\r\n \t\t\t\t<div class=\"alert alert-danger text-center\">\r\n \t\t\t\t\t<i class=\"fa fa-exclamation-triangle fa-2x mb-2\"></i>\r\n \t\t\t\t\t<h5>Hata Oluştu</h5>\r\n \t\t\t\t\t<p>Tahsilat verileri yüklenirken bir hata oluştu.</p>\r\n+\t\t\t\t\t<details>\r\n+\t\t\t\t\t\t<summary>Hata Detayı</summary>\r\n+\t\t\t\t\t\t<small>Status: ${status}</small><br>\r\n+\t\t\t\t\t\t<small>Error: ${error}</small><br>\r\n+\t\t\t\t\t\t<small>Response: ${xhr.responseText}</small><br>\r\n+\t\t\t\t\t\t<small>Status Code: ${xhr.status}</small>\r\n+\t\t\t\t\t</details>\r\n \t\t\t\t</div>\r\n \t\t\t`);\r\n \t\t}\r\n \t});\r\n@@ -1358,8 +1372,45 @@\n // Tooltip'leri aktifleştir\r\n $(function () {\r\n \t$('[data-toggle=\"tooltip\"]').tooltip()\r\n });\r\n+\r\n+// Tahsilat Düzenle Modal Aç\r\n+function tahsilatDuzenleModalAc(ch_id) {\r\n+\t// Burada modal açılacak ve ilgili tahsilat verisi yüklenecek\r\n+\talert('Tahsilat düzenleme için modal açılacak. ID: ' + ch_id);\r\n+\t// TODO: Düzenleme modalı ve AJAX ile veri çekme işlemi eklenecek\r\n+}\r\n+\r\n+// Tahsilat Sil\r\n+function tahsilatSil(ch_id, btn) {\r\n+\tif (!confirm('Bu tahsilat kaydını silmek istediğinize emin misiniz?')) return;\r\n+\t\r\n+\tconsole.log('Tahsilat Silme - CH_ID:', ch_id);\r\n+\t$(btn).prop('disabled', true);\r\n+\t\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/tahsilatSil\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: { ch_id: ch_id },\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tconsole.log('Silme Response:', response);\r\n+\t\t\tif (response.success) {\r\n+\t\t\t\t$(btn).closest('tr').fadeOut(300, function() { $(this).remove(); });\r\n+\t\t\t\talert('Başarılı: ' + response.message);\r\n+\t\t\t} else {\r\n+\t\t\t\talert('Silme işlemi başarısız: ' + (response.message || ''));\r\n+\t\t\t\t$(btn).prop('disabled', false);\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.log('Silme Error:', {xhr, status, error, response: xhr.responseText});\r\n+\t\t\talert('Silme işlemi sırasında hata oluştu: ' + error);\r\n+\t\t\t$(btn).prop('disabled', false);\r\n+\t\t}\r\n+\t});\r\n+}\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1756197026985,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1292,28 +1292,27 @@\n \t\t\t\t\t\t\t\t\t<th>Belge No</th>\r\n \t\t\t\t\t\t\t\t\t<th>Tahsilat Tipi</th>\r\n \t\t\t\t\t\t\t\t\t<th>Tutar</th>\r\n \t\t\t\t\t\t\t\t\t<th>Açıklama</th>\r\n-\t\t\t\t\t\t\t\t\t<th>İşlem</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Detay</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody>\r\n \t\t\t\t`;\r\n \t\t\t\t\r\n \t\t\t\tlet toplamTutar = 0;\r\n \t\t\t\tresponse.data.forEach(function(item) {\r\n-\t\t\t\t\ttoplamTutar += parseFloat(item.ch_alacak || 0);\r\n+\t\t\t\t\ttoplamTutar += parseFloat(item.tutar || 0);\r\n \t\t\t\t\t\r\n \t\t\t\t\thtml += `\r\n \t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t<td>${item.ch_tarih}</td>\r\n-\t\t\t\t\t\t\t<td>${item.ch_belgeNumarasi || '-'}</td>\r\n+\t\t\t\t\t\t\t<td>${item.tarih}</td>\r\n+\t\t\t\t\t\t\t<td>${item.belge_no || '-'}</td>\r\n \t\t\t\t\t\t\t<td><span class=\"badge badge-info\">${item.tahsilat_tipi}</span></td>\r\n-\t\t\t\t\t\t\t<td class=\"text-right\"><strong>${parseFloat(item.ch_alacak).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</strong></td>\r\n-\t\t\t\t\t\t\t<td>${item.ch_aciklama || '-'}</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-right\"><strong>${parseFloat(item.tutar).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</strong></td>\r\n+\t\t\t\t\t\t\t<td>${item.aciklama || '-'}</td>\r\n \t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-success mr-1\" onclick=\"tahsilatDuzenleModalAc('${item.ch_id}')\"><i class='fa fa-edit'></i></button>\r\n-\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-danger\" onclick=\"tahsilatSil('${item.ch_id}', this)\"><i class='fa fa-trash'></i></button>\r\n+\t\t\t\t\t\t\t\t<span class=\"badge badge-secondary\">${item.detay || '-'}</span>\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t</tr>\r\n \t\t\t\t\t`;\r\n \t\t\t\t});\r\n"
                },
                {
                    "date": 1756204617196,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -234,76 +234,42 @@\n \t\t.aktivasyon-durum-container small {\r\n \t\t\topacity: 0.7;\r\n \t\t}\r\n \t\t\r\n-\t\t@media (max-width: 768px) {\r\n-\t\t\t.table-responsive {\r\n-\t\t\t\tfont-size: 0.875rem;\r\n-\t\t\t}\r\n-\t\t\t\r\n-\t\t\t.gorsel-thumb {\r\n-\t\t\t\twidth: 40px;\r\n-\t\t\t\theight: 40px;\r\n-\t\t\t}\r\n-\t\t\t\r\n-\t\t\t/* Mobilde görsel ve evrak kolonu boyutlarını ayarla */\r\n-\t\t\t.gorsel-column, .evrak-column {\r\n-\t\t\t\twidth: 60px;\r\n-\t\t\t}\r\n-\t\t\t\r\n-\t\t\t.gorsel-thumbnail {\r\n-\t\t\t\twidth: 40px;\r\n-\t\t\t\theight: 40px;\r\n-\t\t\t}\r\n+\t\t/* Tutar düzenleme stilleri */\r\n+\t\t.tutar-input {\r\n+\t\t\tborder: 1px solid #ced4da !important;\r\n+\t\t\ttransition: all 0.3s ease;\r\n \t\t}\r\n \t\t\r\n-\t\t/* Stok arama autocomplete stilleri */\r\n-\t\t.ui-autocomplete {\r\n-\t\t\tmax-height: 300px;\r\n-\t\t\toverflow-y: auto;\r\n-\t\t\toverflow-x: hidden;\r\n-\t\t\tborder: 1px solid #ddd;\r\n-\t\t\tbackground: white;\r\n-\t\t\tz-index: 9999 !important;\r\n+\t\t.tutar-input:focus {\r\n+\t\t\tborder-color: #007bff !important;\r\n+\t\t\tbox-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25) !important;\r\n \t\t}\r\n \t\t\r\n-\t\t.ui-autocomplete .ui-menu-item {\r\n-\t\t\tpadding: 0;\r\n-\t\t\tmargin: 0;\r\n+\t\t.tutar-degisti {\r\n+\t\t\tbackground-color: #fff3cd !important;\r\n+\t\t\tborder-left: 4px solid #ffc107 !important;\r\n \t\t}\r\n \t\t\r\n-\t\t.ui-autocomplete .ui-menu-item-wrapper {\r\n-\t\t\tpadding: 8px 12px;\r\n-\t\t\tborder-bottom: 1px solid #eee;\r\n-\t\t\ttransition: background-color 0.2s;\r\n+\t\t.tutar-degisti .tutar-input {\r\n+\t\t\tborder-color: #ffc107 !important;\r\n+\t\t\tbackground-color: #fffbee !important;\r\n \t\t}\r\n \t\t\r\n-\t\t.ui-autocomplete .ui-menu-item-wrapper:hover,\r\n-\t\t.ui-autocomplete .ui-state-focus {\r\n-\t\t\tbackground-color: #f8f9fa !important;\r\n-\t\t\tborder: none !important;\r\n+\t\t.input-group-sm {\r\n+\t\t\tmax-width: 150px;\r\n \t\t}\r\n \t\t\r\n-\t\t.ui-autocomplete .ui-state-active {\r\n-\t\t\tbackground-color: #007bff !important;\r\n-\t\t\tcolor: white !important;\r\n-\t\t\tborder: none !important;\r\n+\t\t#kaydetTahsilat {\r\n+\t\t\tanimation: pulse 2s infinite;\r\n \t\t}\r\n \t\t\r\n-\t\t/* Stok arama input stili */\r\n-\t\t.stokAdi {\r\n-\t\t\tposition: relative;\r\n+\t\t@keyframes pulse {\r\n+\t\t\t0% { transform: scale(1); }\r\n+\t\t\t50% { transform: scale(1.05); }\r\n+\t\t\t100% { transform: scale(1); }\r\n \t\t}\r\n-\t\t\r\n-\t\t.stokAdi:focus {\r\n-\t\t\tborder-color: #007bff;\r\n-\t\t\tbox-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);\r\n-\t\t}\r\n-\t\t\r\n-\t\t.input-group .input-group-text {\r\n-\t\t\tbackground-color: #f8f9fa;\r\n-\t\t\tborder-color: #ced4da;\r\n-\t\t}\r\n \t</style>\r\n </head>\r\n <body>\r\n <div class=\"main-wrapper\">\r\n@@ -847,9 +813,19 @@\n \t\t\t\t\t<!-- Tahsilat listesi buraya yüklenecek -->\r\n \t\t\t\t</div>\r\n \t\t\t</div>\r\n \t\t\t<div class=\"modal-footer\">\r\n-\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Kapat</button>\r\n+\t\t\t\t<div class=\"d-flex justify-content-between w-100\">\r\n+\t\t\t\t\t<div>\r\n+\t\t\t\t\t\t<small class=\"text-muted\">Tutarları değiştirdikten sonra kaydetmeyi unutmayın!</small>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t<div>\r\n+\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\" id=\"kaydetTahsilat\" onclick=\"kaydetTutarDegisiklikleri()\" style=\"display: none;\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-save\"></i> Kaydet\r\n+\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Kapat</button>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n \t\t\t</div>\r\n \t\t</div>\r\n \t</div>\r\n </div>\r\n@@ -1303,13 +1279,24 @@\n \t\t\t\tresponse.data.forEach(function(item) {\r\n \t\t\t\t\ttoplamTutar += parseFloat(item.tutar || 0);\r\n \t\t\t\t\t\r\n \t\t\t\t\thtml += `\r\n-\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t<tr data-tahsilat-id=\"${item.unique_id}\" data-tip-kod=\"${item.tip_kod}\" data-source-id=\"${item.source_id}\" data-ch-id=\"${item.cari_hareket_id}\" data-original-tutar=\"${item.tutar}\">\r\n \t\t\t\t\t\t\t<td>${item.tarih}</td>\r\n \t\t\t\t\t\t\t<td>${item.belge_no || '-'}</td>\r\n \t\t\t\t\t\t\t<td><span class=\"badge badge-info\">${item.tahsilat_tipi}</span></td>\r\n-\t\t\t\t\t\t\t<td class=\"text-right\"><strong>${parseFloat(item.tutar).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</strong></td>\r\n+\t\t\t\t\t\t\t<td class=\"text-right\">\r\n+\t\t\t\t\t\t\t\t<div class=\"input-group input-group-sm\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control tutar-input text-right\" \r\n+\t\t\t\t\t\t\t\t\t\t   value=\"${parseFloat(item.tutar).toFixed(2)}\" \r\n+\t\t\t\t\t\t\t\t\t\t   step=\"0.01\" min=\"0\"\r\n+\t\t\t\t\t\t\t\t\t\t   data-original=\"${parseFloat(item.tutar).toFixed(2)}\"\r\n+\t\t\t\t\t\t\t\t\t\t   onchange=\"tutarDegisti(this)\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"input-group-append\">\r\n+\t\t\t\t\t\t\t\t\t\t<span class=\"input-group-text\">₺</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td>${item.aciklama || '-'}</td>\r\n \t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t<span class=\"badge badge-secondary\">${item.detay || '-'}</span>\r\n \t\t\t\t\t\t\t</td>\r\n@@ -1321,9 +1308,9 @@\n \t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t\t<tfoot class=\"thead-dark\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th colspan=\"3\">TOPLAM</th>\r\n-\t\t\t\t\t\t\t\t\t<th class=\"text-right\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n+\t\t\t\t\t\t\t\t\t<th class=\"text-right\" id=\"tahsilat-toplam\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</tfoot>\r\n@@ -1379,36 +1366,227 @@\n \talert('Tahsilat düzenleme için modal açılacak. ID: ' + ch_id);\r\n \t// TODO: Düzenleme modalı ve AJAX ile veri çekme işlemi eklenecek\r\n }\r\n \r\n-// Tahsilat Sil\r\n-function tahsilatSil(ch_id, btn) {\r\n-\tif (!confirm('Bu tahsilat kaydını silmek istediğinize emin misiniz?')) return;\r\n+// Tahsilat düzenleme fonksiyonu\r\n+function editTahsilat(uniqueId, tipKod, sourceId, tahsilatTipi) {\r\n+\tconsole.log('Düzenle:', {uniqueId, tipKod, sourceId, tahsilatTipi});\r\n \t\r\n-\tconsole.log('Tahsilat Silme - CH_ID:', ch_id);\r\n-\t$(btn).prop('disabled', true);\r\n+\t// Tahsilat tipine göre yönlendirme yap\r\n+\tlet editUrl = '';\r\n+\tswitch(tipKod) {\r\n+\t\tcase '1': // Banka/Pos\r\n+\t\t\teditUrl = '<?= base_url(\"banka/banka-hareketi-duzenle/\") ?>' + sourceId;\r\n+\t\t\tbreak;\r\n+\t\tcase '2': // Çek\r\n+\t\t\teditUrl = '<?= base_url(\"cek/cek-duzenle/\") ?>' + sourceId;\r\n+\t\t\tbreak;\r\n+\t\tcase '3': // Kasa/Nakit\r\n+\t\t\teditUrl = '<?= base_url(\"kasa/kasa-hareketi-duzenle/\") ?>' + sourceId;\r\n+\t\t\tbreak;\r\n+\t\tcase '4': // Senet\r\n+\t\t\teditUrl = '<?= base_url(\"senet/senet-duzenle/\") ?>' + sourceId;\r\n+\t\t\tbreak;\r\n+\t\tdefault:\r\n+\t\t\tswal('Uyarı', 'Bilinmeyen tahsilat tipi!', 'warning');\r\n+\t\t\treturn;\r\n+\t}\r\n \t\r\n-\t$.ajax({\r\n-\t\turl: '<?= base_url(\"muhasebe/tahsilatSil\") ?>',\r\n-\t\tmethod: 'POST',\r\n-\t\tdata: { ch_id: ch_id },\r\n-\t\tdataType: 'json',\r\n-\t\tsuccess: function(response) {\r\n-\t\t\tconsole.log('Silme Response:', response);\r\n-\t\t\tif (response.success) {\r\n-\t\t\t\t$(btn).closest('tr').fadeOut(300, function() { $(this).remove(); });\r\n-\t\t\t\talert('Başarılı: ' + response.message);\r\n-\t\t\t} else {\r\n-\t\t\t\talert('Silme işlemi başarısız: ' + (response.message || ''));\r\n-\t\t\t\t$(btn).prop('disabled', false);\r\n+\t// Yeni sekmede düzenleme sayfasını aç\r\n+\twindow.open(editUrl, '_blank');\r\n+}\r\n+\r\n+// Tahsilat silme fonksiyonu\r\n+function deleteTahsilat(cariHareketId, tahsilatTipi, tutar) {\r\n+\tconsole.log('Sil:', {cariHareketId, tahsilatTipi, tutar});\r\n+\t\r\n+\t// Eğer cari hareket ID'si yoksa işlemi durdur\r\n+\tif (!cariHareketId || cariHareketId == 'null' || cariHareketId == '') {\r\n+\t\tswal('Uyarı', 'Bu tahsilat kaydı için cari hareket ID\\'si bulunamadı. Silme işlemi yapılamaz.', 'warning');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\t// Onay penceresi göster\r\n+\tswal({\r\n+\t\ttitle: \"Emin misiniz?\",\r\n+\t\ttext: `${tahsilatTipi} kaydını silmek istediğinize emin misiniz?\\n\\nTutar: ${parseFloat(tutar).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺\\n\\nBu işlem geri alınamaz!`,\r\n+\t\ttype: \"warning\",\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: \"#dc3545\",\r\n+\t\tconfirmButtonText: \"Evet, Sil\",\r\n+\t\tcancelButtonText: \"İptal\",\r\n+\t\tcloseOnConfirm: false\r\n+\t}, function() {\r\n+\t\t// AJAX ile silme işlemi - Mevcut sistem kullanılır\r\n+\t\t$.ajax({\r\n+\t\t\turl: '<?= base_url(\"muhasebe/tahsilatSil\") ?>',\r\n+\t\t\tmethod: 'POST',\r\n+\t\t\tdata: { \r\n+\t\t\t\tch_id: cariHareketId  // Mevcut sistem parametresi\r\n+\t\t\t},\r\n+\t\t\tdataType: 'json',\r\n+\t\t\tbeforeSend: function() {\r\n+\t\t\t\tswal({\r\n+\t\t\t\t\ttitle: \"İşlem Devam Ediyor\",\r\n+\t\t\t\t\ttext: \"Tahsilat kaydı siliniyor...\",\r\n+\t\t\t\t\ttype: \"info\",\r\n+\t\t\t\t\tshowConfirmButton: false,\r\n+\t\t\t\t\tallowOutsideClick: false\r\n+\t\t\t\t});\r\n+\t\t\t},\r\n+\t\t\tsuccess: function(response) {\r\n+\t\t\t\tconsole.log('Silme Response:', response);\r\n+\t\t\t\tif (response.success) {\r\n+\t\t\t\t\tswal({\r\n+\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n+\t\t\t\t\t\ttext: response.message || \"Tahsilat kaydı başarıyla silindi.\",\r\n+\t\t\t\t\t\ttype: \"success\",\r\n+\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n+\t\t\t\t\t}, function() {\r\n+\t\t\t\t\t\t// Satırı tablodan kaldır\r\n+\t\t\t\t\t\t$('[data-ch-id=\"' + cariHareketId + '\"]').fadeOut(300, function() {\r\n+\t\t\t\t\t\t\t$(this).remove();\r\n+\t\t\t\t\t\t\t// Tabloyu yeniden hesapla\r\n+\t\t\t\t\t\t\tupdateTahsilatToplam();\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t});\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tswal(\"Hata!\", response.message || \"Silme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t}\r\n+\t\t\t},\r\n+\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\tconsole.error('Silme Hatası:', {xhr, status, error});\r\n+\t\t\t\tswal(\"Hata!\", \"Tahsilat silme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n \t\t\t}\r\n-\t\t},\r\n-\t\terror: function(xhr, status, error) {\r\n-\t\t\tconsole.log('Silme Error:', {xhr, status, error, response: xhr.responseText});\r\n-\t\t\talert('Silme işlemi sırasında hata oluştu: ' + error);\r\n-\t\t\t$(btn).prop('disabled', false);\r\n+\t\t});\r\n+\t});\r\n+}\r\n+\r\n+// Tahsilat toplamını yeniden hesapla\r\n+function updateTahsilatToplam() {\r\n+\tlet toplam = 0;\r\n+\t$('#tahsilatContent tbody tr').each(function() {\r\n+\t\tlet tutarInput = $(this).find('.tutar-input');\r\n+\t\tlet tutar = parseFloat(tutarInput.val()) || 0;\r\n+\t\ttoplam += tutar;\r\n+\t});\r\n+\t\r\n+\t// Footer'daki toplamı güncelle\r\n+\t$('#tahsilat-toplam').html(toplam.toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺');\r\n+}\r\n+\r\n+// Tutar değiştiğinde çağrılan fonksiyon\r\n+function tutarDegisti(input) {\r\n+\tvar $input = $(input);\r\n+\tvar originalValue = parseFloat($input.data('original'));\r\n+\tvar currentValue = parseFloat($input.val()) || 0;\r\n+\t\r\n+\t// Değişiklik var mı kontrol et\r\n+\tif (originalValue !== currentValue) {\r\n+\t\t$input.closest('tr').addClass('tutar-degisti');\r\n+\t\t$('#kaydetTahsilat').show();\r\n+\t} else {\r\n+\t\t$input.closest('tr').removeClass('tutar-degisti');\r\n+\t\t\r\n+\t\t// Hiç değişiklik kalmadıysa kaydet butonunu gizle\r\n+\t\tif ($('.tutar-degisti').length === 0) {\r\n+\t\t\t$('#kaydetTahsilat').hide();\r\n \t\t}\r\n+\t}\r\n+\t\r\n+\t// Toplamı güncelle\r\n+\tupdateTahsilatToplam();\r\n+}\r\n+\r\n+// Tutar değişikliklerini kaydet\r\n+function kaydetTutarDegisiklikleri() {\r\n+\tvar degisiklikler = [];\r\n+\t\r\n+\t$('.tutar-degisti').each(function() {\r\n+\t\tvar $row = $(this);\r\n+\t\tvar uniqueId = $row.data('tahsilat-id');\r\n+\t\tvar tipKod = $row.data('tip-kod');\r\n+\t\tvar sourceId = $row.data('source-id');\r\n+\t\tvar chId = $row.data('ch-id');\r\n+\t\tvar yeniTutar = parseFloat($row.find('.tutar-input').val());\r\n+\t\tvar eskiTutar = parseFloat($row.data('original-tutar'));\r\n+\t\t\r\n+\t\tdegisiklikler.push({\r\n+\t\t\tunique_id: uniqueId,\r\n+\t\t\ttip_kod: tipKod,\r\n+\t\t\tsource_id: sourceId,\r\n+\t\t\tch_id: chId,\r\n+\t\t\tyeni_tutar: yeniTutar,\r\n+\t\t\teski_tutar: eskiTutar\r\n+\t\t});\r\n \t});\r\n+\t\r\n+\tif (degisiklikler.length === 0) {\r\n+\t\tswal('Bilgi', 'Değişiklik yapılmadı.', 'info');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\t// Onay penceresi göster\r\n+\tswal({\r\n+\t\ttitle: \"Değişiklikleri Kaydet\",\r\n+\t\ttext: `${degisiklikler.length} adet tahsilat tutarı güncellenmek üzere. Devam etmek istiyor musunuz?`,\r\n+\t\ttype: \"warning\",\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: \"#28a745\",\r\n+\t\tconfirmButtonText: \"Evet, Kaydet\",\r\n+\t\tcancelButtonText: \"İptal\",\r\n+\t\tcloseOnConfirm: false\r\n+\t}, function() {\r\n+\t\t// AJAX ile kaydet\r\n+\t\t$.ajax({\r\n+\t\t\turl: '<?= base_url(\"muhasebe/tahsilatTutarGuncelle\") ?>',\r\n+\t\t\tmethod: 'POST',\r\n+\t\t\tdata: { \r\n+\t\t\t\tdegisiklikler: degisiklikler\r\n+\t\t\t},\r\n+\t\t\tdataType: 'json',\r\n+\t\t\tbeforeSend: function() {\r\n+\t\t\t\tswal({\r\n+\t\t\t\t\ttitle: \"Kaydediliyor\",\r\n+\t\t\t\t\ttext: \"Tutar değişiklikleri kaydediliyor...\",\r\n+\t\t\t\t\ttype: \"info\",\r\n+\t\t\t\t\tshowConfirmButton: false,\r\n+\t\t\t\t\tallowOutsideClick: false\r\n+\t\t\t\t});\r\n+\t\t\t},\r\n+\t\t\tsuccess: function(response) {\r\n+\t\t\t\tconsole.log('Kaydet Response:', response);\r\n+\t\t\t\tif (response.success) {\r\n+\t\t\t\t\tswal({\r\n+\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n+\t\t\t\t\t\ttext: response.message || \"Tutar değişiklikleri başarıyla kaydedildi.\",\r\n+\t\t\t\t\t\ttype: \"success\",\r\n+\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n+\t\t\t\t\t}, function() {\r\n+\t\t\t\t\t\t// Değişiklik işaretlerini kaldır\r\n+\t\t\t\t\t\t$('.tutar-degisti').removeClass('tutar-degisti');\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\t// Orijinal değerleri güncelle\r\n+\t\t\t\t\t\t$('.tutar-input').each(function() {\r\n+\t\t\t\t\t\t\t$(this).data('original', $(this).val());\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\t// Kaydet butonunu gizle\r\n+\t\t\t\t\t\t$('#kaydetTahsilat').hide();\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\t// Ana sayfayı yenile (tutarlar değişti)\r\n+\t\t\t\t\t\tlocation.reload();\r\n+\t\t\t\t\t});\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tswal(\"Hata!\", response.message || \"Kaydetme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t}\r\n+\t\t\t},\r\n+\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\tconsole.error('Kaydet Hatası:', {xhr, status, error});\r\n+\t\t\t\tswal(\"Hata!\", \"Kaydetme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n+\t\t\t}\r\n+\t\t});\r\n+\t});\r\n }\r\n </script>\r\n \r\n </body>\r\n"
                },
                {
                    "date": 1756207318807,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1386,9 +1386,9 @@\n \t\tcase '4': // Senet\r\n \t\t\teditUrl = '<?= base_url(\"senet/senet-duzenle/\") ?>' + sourceId;\r\n \t\t\tbreak;\r\n \t\tdefault:\r\n-\t\t\tswal('Uyarı', 'Bilinmeyen tahsilat tipi!', 'warning');\r\n+\t\t\tSwal.fire('Uyarı', 'Bilinmeyen tahsilat tipi!', 'warning');\r\n \t\t\treturn;\r\n \t}\r\n \t\r\n \t// Yeni sekmede düzenleme sayfasını aç\r\n@@ -1400,65 +1400,66 @@\n \tconsole.log('Sil:', {cariHareketId, tahsilatTipi, tutar});\r\n \t\r\n \t// Eğer cari hareket ID'si yoksa işlemi durdur\r\n \tif (!cariHareketId || cariHareketId == 'null' || cariHareketId == '') {\r\n-\t\tswal('Uyarı', 'Bu tahsilat kaydı için cari hareket ID\\'si bulunamadı. Silme işlemi yapılamaz.', 'warning');\r\n+\t\tSwal.fire('Uyarı', 'Bu tahsilat kaydı için cari hareket ID\\'si bulunamadı. Silme işlemi yapılamaz.', 'warning');\r\n \t\treturn;\r\n \t}\r\n \t\r\n \t// Onay penceresi göster\r\n-\tswal({\r\n+\tSwal.fire({\r\n \t\ttitle: \"Emin misiniz?\",\r\n \t\ttext: `${tahsilatTipi} kaydını silmek istediğinize emin misiniz?\\n\\nTutar: ${parseFloat(tutar).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺\\n\\nBu işlem geri alınamaz!`,\r\n-\t\ttype: \"warning\",\r\n+\t\ticon: \"warning\",\r\n \t\tshowCancelButton: true,\r\n \t\tconfirmButtonColor: \"#dc3545\",\r\n \t\tconfirmButtonText: \"Evet, Sil\",\r\n-\t\tcancelButtonText: \"İptal\",\r\n-\t\tcloseOnConfirm: false\r\n-\t}, function() {\r\n-\t\t// AJAX ile silme işlemi - Mevcut sistem kullanılır\r\n-\t\t$.ajax({\r\n-\t\t\turl: '<?= base_url(\"muhasebe/tahsilatSil\") ?>',\r\n-\t\t\tmethod: 'POST',\r\n-\t\t\tdata: { \r\n-\t\t\t\tch_id: cariHareketId  // Mevcut sistem parametresi\r\n-\t\t\t},\r\n-\t\t\tdataType: 'json',\r\n-\t\t\tbeforeSend: function() {\r\n-\t\t\t\tswal({\r\n-\t\t\t\t\ttitle: \"İşlem Devam Ediyor\",\r\n-\t\t\t\t\ttext: \"Tahsilat kaydı siliniyor...\",\r\n-\t\t\t\t\ttype: \"info\",\r\n-\t\t\t\t\tshowConfirmButton: false,\r\n-\t\t\t\t\tallowOutsideClick: false\r\n-\t\t\t\t});\r\n-\t\t\t},\r\n-\t\t\tsuccess: function(response) {\r\n-\t\t\t\tconsole.log('Silme Response:', response);\r\n-\t\t\t\tif (response.success) {\r\n-\t\t\t\t\tswal({\r\n-\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n-\t\t\t\t\t\ttext: response.message || \"Tahsilat kaydı başarıyla silindi.\",\r\n-\t\t\t\t\t\ttype: \"success\",\r\n-\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n-\t\t\t\t\t}, function() {\r\n-\t\t\t\t\t\t// Satırı tablodan kaldır\r\n-\t\t\t\t\t\t$('[data-ch-id=\"' + cariHareketId + '\"]').fadeOut(300, function() {\r\n-\t\t\t\t\t\t\t$(this).remove();\r\n-\t\t\t\t\t\t\t// Tabloyu yeniden hesapla\r\n-\t\t\t\t\t\t\tupdateTahsilatToplam();\r\n+\t\tcancelButtonText: \"İptal\"\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t// AJAX ile silme işlemi - Mevcut sistem kullanılır\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/tahsilatSil\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: { \r\n+\t\t\t\t\tch_id: cariHareketId  // Mevcut sistem parametresi\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tbeforeSend: function() {\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ttitle: \"İşlem Devam Ediyor\",\r\n+\t\t\t\t\t\ttext: \"Tahsilat kaydı siliniyor...\",\r\n+\t\t\t\t\t\ticon: \"info\",\r\n+\t\t\t\t\t\tshowConfirmButton: false,\r\n+\t\t\t\t\t\tallowOutsideClick: false\r\n+\t\t\t\t\t});\r\n+\t\t\t\t},\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tconsole.log('Silme Response:', response);\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n+\t\t\t\t\t\t\ttext: response.message || \"Tahsilat kaydı başarıyla silindi.\",\r\n+\t\t\t\t\t\t\ticon: \"success\",\r\n+\t\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n+\t\t\t\t\t\t}).then(() => {\r\n+\t\t\t\t\t\t\t// Satırı tablodan kaldır\r\n+\t\t\t\t\t\t\t$('[data-ch-id=\"' + cariHareketId + '\"]').fadeOut(300, function() {\r\n+\t\t\t\t\t\t\t\t$(this).remove();\r\n+\t\t\t\t\t\t\t\t// Tabloyu yeniden hesapla\r\n+\t\t\t\t\t\t\t\tupdateTahsilatToplam();\r\n+\t\t\t\t\t\t\t});\r\n \t\t\t\t\t\t});\r\n-\t\t\t\t\t});\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tswal(\"Hata!\", response.message || \"Silme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire(\"Hata!\", response.message || \"Silme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('Silme Hatası:', {xhr, status, error});\r\n+\t\t\t\t\tSwal.fire(\"Hata!\", \"Tahsilat silme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n \t\t\t\t}\r\n-\t\t\t},\r\n-\t\t\terror: function(xhr, status, error) {\r\n-\t\t\t\tconsole.error('Silme Hatası:', {xhr, status, error});\r\n-\t\t\t\tswal(\"Hata!\", \"Tahsilat silme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n-\t\t\t}\r\n-\t\t});\r\n+\t\t\t});\r\n+\t\t}\r\n \t});\r\n }\r\n \r\n // Tahsilat toplamını yeniden hesapla\r\n@@ -1520,72 +1521,73 @@\n \t\t});\r\n \t});\r\n \t\r\n \tif (degisiklikler.length === 0) {\r\n-\t\tswal('Bilgi', 'Değişiklik yapılmadı.', 'info');\r\n+\t\tSwal.fire('Bilgi', 'Değişiklik yapılmadı.', 'info');\r\n \t\treturn;\r\n \t}\r\n \t\r\n \t// Onay penceresi göster\r\n-\tswal({\r\n+\tSwal.fire({\r\n \t\ttitle: \"Değişiklikleri Kaydet\",\r\n \t\ttext: `${degisiklikler.length} adet tahsilat tutarı güncellenmek üzere. Devam etmek istiyor musunuz?`,\r\n-\t\ttype: \"warning\",\r\n+\t\ticon: \"warning\",\r\n \t\tshowCancelButton: true,\r\n \t\tconfirmButtonColor: \"#28a745\",\r\n \t\tconfirmButtonText: \"Evet, Kaydet\",\r\n-\t\tcancelButtonText: \"İptal\",\r\n-\t\tcloseOnConfirm: false\r\n-\t}, function() {\r\n-\t\t// AJAX ile kaydet\r\n-\t\t$.ajax({\r\n-\t\t\turl: '<?= base_url(\"muhasebe/tahsilatTutarGuncelle\") ?>',\r\n-\t\t\tmethod: 'POST',\r\n-\t\t\tdata: { \r\n-\t\t\t\tdegisiklikler: degisiklikler\r\n-\t\t\t},\r\n-\t\t\tdataType: 'json',\r\n-\t\t\tbeforeSend: function() {\r\n-\t\t\t\tswal({\r\n-\t\t\t\t\ttitle: \"Kaydediliyor\",\r\n-\t\t\t\t\ttext: \"Tutar değişiklikleri kaydediliyor...\",\r\n-\t\t\t\t\ttype: \"info\",\r\n-\t\t\t\t\tshowConfirmButton: false,\r\n-\t\t\t\t\tallowOutsideClick: false\r\n-\t\t\t\t});\r\n-\t\t\t},\r\n-\t\t\tsuccess: function(response) {\r\n-\t\t\t\tconsole.log('Kaydet Response:', response);\r\n-\t\t\t\tif (response.success) {\r\n-\t\t\t\t\tswal({\r\n-\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n-\t\t\t\t\t\ttext: response.message || \"Tutar değişiklikleri başarıyla kaydedildi.\",\r\n-\t\t\t\t\t\ttype: \"success\",\r\n-\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n-\t\t\t\t\t}, function() {\r\n-\t\t\t\t\t\t// Değişiklik işaretlerini kaldır\r\n-\t\t\t\t\t\t$('.tutar-degisti').removeClass('tutar-degisti');\r\n-\t\t\t\t\t\t\r\n-\t\t\t\t\t\t// Orijinal değerleri güncelle\r\n-\t\t\t\t\t\t$('.tutar-input').each(function() {\r\n-\t\t\t\t\t\t\t$(this).data('original', $(this).val());\r\n+\t\tcancelButtonText: \"İptal\"\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t// AJAX ile kaydet\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/tahsilatTutarGuncelle\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: { \r\n+\t\t\t\t\tdegisiklikler: degisiklikler\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tbeforeSend: function() {\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ttitle: \"Kaydediliyor\",\r\n+\t\t\t\t\t\ttext: \"Tutar değişiklikleri kaydediliyor...\",\r\n+\t\t\t\t\t\ticon: \"info\",\r\n+\t\t\t\t\t\tshowConfirmButton: false,\r\n+\t\t\t\t\t\tallowOutsideClick: false\r\n+\t\t\t\t\t});\r\n+\t\t\t\t},\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tconsole.log('Kaydet Response:', response);\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n+\t\t\t\t\t\t\ttext: response.message || \"Tutar değişiklikleri başarıyla kaydedildi.\",\r\n+\t\t\t\t\t\t\ticon: \"success\",\r\n+\t\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n+\t\t\t\t\t\t}).then(() => {\r\n+\t\t\t\t\t\t\t// Değişiklik işaretlerini kaldır\r\n+\t\t\t\t\t\t\t$('.tutar-degisti').removeClass('tutar-degisti');\r\n+\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t// Orijinal değerleri güncelle\r\n+\t\t\t\t\t\t\t$('.tutar-input').each(function() {\r\n+\t\t\t\t\t\t\t\t$(this).data('original', $(this).val());\r\n+\t\t\t\t\t\t\t});\r\n+\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t// Kaydet butonunu gizle\r\n+\t\t\t\t\t\t\t$('#kaydetTahsilat').hide();\r\n+\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t// Ana sayfayı yenile (tutarlar değişti)\r\n+\t\t\t\t\t\t\tlocation.reload();\r\n \t\t\t\t\t\t});\r\n-\t\t\t\t\t\t\r\n-\t\t\t\t\t\t// Kaydet butonunu gizle\r\n-\t\t\t\t\t\t$('#kaydetTahsilat').hide();\r\n-\t\t\t\t\t\t\r\n-\t\t\t\t\t\t// Ana sayfayı yenile (tutarlar değişti)\r\n-\t\t\t\t\t\tlocation.reload();\r\n-\t\t\t\t\t});\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\tswal(\"Hata!\", response.message || \"Kaydetme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire(\"Hata!\", response.message || \"Kaydetme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('Kaydet Hatası:', {xhr, status, error});\r\n+\t\t\t\t\tSwal.fire(\"Hata!\", \"Kaydetme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n \t\t\t\t}\r\n-\t\t\t},\r\n-\t\t\terror: function(xhr, status, error) {\r\n-\t\t\t\tconsole.error('Kaydet Hatası:', {xhr, status, error});\r\n-\t\t\t\tswal(\"Hata!\", \"Kaydetme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n-\t\t\t}\r\n-\t\t});\r\n+\t\t\t});\r\n+\t\t}\r\n \t});\r\n }\r\n </script>\r\n \r\n"
                },
                {
                    "date": 1756223747572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,10 @@\n \t<title>Tam Ana Rapor | İlekaSoft CRM</title>\r\n \t<link rel=\"icon\" type=\"image/x-icon\" href=\"<?= base_url('assets/favicon.ico'); ?>\" />\r\n \t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/css/dataTables.bootstrap4.min.css\"/>\r\n \t<link rel=\"stylesheet\" href=\"https://code.jquery.com/ui/1.13.2/themes/ui-lightness/jquery-ui.css\"/>\r\n+\t<!-- SweetAlert2 CSS -->\r\n+\t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css\">\r\n \t\r\n \t<style>\r\n \t\t.rapor-onay-bekliyor {\r\n \t\t\tbackground-color: #fff3cd;\r\n@@ -446,8 +448,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Durum</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Tarihi</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Personel</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th width=\"120\">İşlemler</th>\r\n \t\t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t\t\t\t<tbody>\r\n \t\t\t\t\t\t\t\t\t\t\t<?php foreach ($rapor_verileri as $veri): ?>\r\n@@ -715,8 +718,30 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->cari_id) && !empty($veri->cari_id)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- Düzenle butonu -->\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= base_url('cari/cari-karti-duzenle/' . $veri->cari_id) ?>\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   class=\"btn btn-sm btn-outline-primary mr-1\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   title=\"Cari kartı düzenle\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   target=\"_blank\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-edit\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- Silme butonu -->\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-danger btn-cari-sil\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Cari kaydını sil\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-cari-id=\"<?= htmlspecialchars($veri->cari_id) ?>\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-cari-ad=\"<?= htmlspecialchars($veri->cari_isletme ?? 'Bilinmeyen Cari') ?>\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n \t\t\t\t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t\t\t\t</table>\r\n@@ -831,8 +856,10 @@\n </div>\r\n \r\n <?php $this->load->view(\"include/footer-js\"); ?>\r\n \r\n+<!-- SweetAlert2 JS -->\r\n+<script src=\"https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js\"></script>\r\n <script src=\"https://code.jquery.com/ui/1.13.2/jquery-ui.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/js/dataTables.bootstrap4.min.js\"></script>\r\n \r\n@@ -847,10 +874,174 @@\n \t\t\"pageLength\": 25,\r\n \t\t\"responsive\": true,\r\n \t\t\"scrollX\": true\r\n \t});\r\n+\r\n+\t// Cari silme işlemi\r\n+\t$(document).on('click', '.btn-cari-sil', function() {\r\n+\t\tvar cariId = $(this).data('cari-id');\r\n+\t\tvar cariAd = $(this).data('cari-ad');\r\n+\t\t\r\n+\t\tif (!cariId) {\r\n+\t\t\tSwal.fire({\r\n+\t\t\t\ticon: 'error',\r\n+\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\ttext: 'Cari ID bulunamadı!'\r\n+\t\t\t});\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\t// İlk kontrol: Bağımlı verileri kontrol et\r\n+\t\t$.ajax({\r\n+\t\t\turl: '<?= base_url(\"muhasebe/cari_sil_kontrol\") ?>',\r\n+\t\t\ttype: 'POST',\r\n+\t\t\tdata: {\r\n+\t\t\t\tcari_id: cariId\r\n+\t\t\t},\r\n+\t\t\tdataType: 'json',\r\n+\t\t\tsuccess: function(response) {\r\n+\t\t\t\tif (response.status === 'error') {\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ticon: 'error',\r\n+\t\t\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\t\t\ttext: response.message\r\n+\t\t\t\t\t});\r\n+\t\t\t\t} else if (response.status === 'warning') {\r\n+\t\t\t\t\t// Bağımlı veriler var, detaylı uyarı göster\r\n+\t\t\t\t\tvar bagimliVeriHtml = '<div class=\"alert alert-warning\">';\r\n+\t\t\t\t\tbagimliVeriHtml += '<strong>Uyarı:</strong> Bu işlem geri alınamaz!<br><br>';\r\n+\t\t\t\t\tbagimliVeriHtml += '<strong>Silinecek veriler:</strong><br>';\r\n+\t\t\t\t\tbagimliVeriHtml += '<ul class=\"list-unstyled\">';\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tresponse.data.forEach(function(veri) {\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<li><i class=\"fa fa-exclamation-triangle text-warning\"></i> ';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<strong>' + veri.tablo + ':</strong> ' + veri.adet + ' adet';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<br><small class=\"text-muted\">' + veri.aciklama + '</small></li><br>';\r\n+\t\t\t\t\t});\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tbagimliVeriHtml += '</ul></div>';\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ttitle: 'Cari Kaydı Silinecek',\r\n+\t\t\t\t\t\thtml: '<div class=\"text-left\">' + \r\n+\t\t\t\t\t\t\t  '<p><strong>Cari:</strong> ' + response.cari_bilgi.ad + '</p>' +\r\n+\t\t\t\t\t\t\t  '<p><strong>ID:</strong> ' + response.cari_bilgi.id + '</p>' +\r\n+\t\t\t\t\t\t\t  (response.cari_bilgi.telefon ? '<p><strong>Telefon:</strong> ' + response.cari_bilgi.telefon + '</p>' : '') +\r\n+\t\t\t\t\t\t\t  bagimliVeriHtml + \r\n+\t\t\t\t\t\t\t  '</div>',\r\n+\t\t\t\t\t\ticon: 'warning',\r\n+\t\t\t\t\t\tshowCancelButton: true,\r\n+\t\t\t\t\t\tconfirmButtonColor: '#dc3545',\r\n+\t\t\t\t\t\tcancelButtonColor: '#6c757d',\r\n+\t\t\t\t\t\tconfirmButtonText: '<i class=\"fa fa-trash\"></i> Sil ve Tüm Verileri Temizle',\r\n+\t\t\t\t\t\tcancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n+\t\t\t\t\t\tcustomClass: {\r\n+\t\t\t\t\t\t\tconfirmButton: 'btn btn-danger',\r\n+\t\t\t\t\t\t\tcancelButton: 'btn btn-secondary'\r\n+\t\t\t\t\t\t},\r\n+\t\t\t\t\t\tbuttonsStyling: false\r\n+\t\t\t\t\t}).then((result) => {\r\n+\t\t\t\t\t\tif (result.isConfirmed) {\r\n+\t\t\t\t\t\t\tcariSil(cariId);\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t});\r\n+\t\t\t\t} else if (response.status === 'confirm') {\r\n+\t\t\t\t\t// Bağımlı veri yok, basit onay\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ttitle: 'Cari Kaydı Silinecek',\r\n+\t\t\t\t\t\thtml: '<div class=\"text-left\">' + \r\n+\t\t\t\t\t\t\t  '<p><strong>Cari:</strong> ' + response.cari_bilgi.ad + '</p>' +\r\n+\t\t\t\t\t\t\t  '<p><strong>ID:</strong> ' + response.cari_bilgi.id + '</p>' +\r\n+\t\t\t\t\t\t\t  (response.cari_bilgi.telefon ? '<p><strong>Telefon:</strong> ' + response.cari_bilgi.telefon + '</p>' : '') +\r\n+\t\t\t\t\t\t\t  '<div class=\"alert alert-info\">' +\r\n+\t\t\t\t\t\t\t  '<i class=\"fa fa-info-circle\"></i> Bu cari kaydına ait başka veri bulunmamaktadır.' +\r\n+\t\t\t\t\t\t\t  '</div>' +\r\n+\t\t\t\t\t\t\t  '</div>',\r\n+\t\t\t\t\t\ttext: response.message,\r\n+\t\t\t\t\t\ticon: 'warning',\r\n+\t\t\t\t\t\tshowCancelButton: true,\r\n+\t\t\t\t\t\tconfirmButtonColor: '#dc3545',\r\n+\t\t\t\t\t\tcancelButtonColor: '#6c757d',\r\n+\t\t\t\t\t\tconfirmButtonText: '<i class=\"fa fa-trash\"></i> Sil',\r\n+\t\t\t\t\t\tcancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n+\t\t\t\t\t\tcustomClass: {\r\n+\t\t\t\t\t\t\tconfirmButton: 'btn btn-danger',\r\n+\t\t\t\t\t\t\tcancelButton: 'btn btn-secondary'\r\n+\t\t\t\t\t\t},\r\n+\t\t\t\t\t\tbuttonsStyling: false\r\n+\t\t\t\t\t}).then((result) => {\r\n+\t\t\t\t\t\tif (result.isConfirmed) {\r\n+\t\t\t\t\t\t\tcariSil(cariId);\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t});\r\n+\t\t\t\t}\r\n+\t\t\t},\r\n+\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\tconsole.error('AJAX Error:', error);\r\n+\t\t\t\tSwal.fire({\r\n+\t\t\t\t\ticon: 'error',\r\n+\t\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\t\ttext: 'Kontrol işlemi sırasında bir hata oluştu: ' + error\r\n+\t\t\t\t});\r\n+\t\t\t}\r\n+\t\t});\r\n+\t});\r\n });\r\n \r\n+// Cari silme fonksiyonu\r\n+function cariSil(cariId) {\r\n+\t// Loading göster\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Siliniyor...',\r\n+\t\ttext: 'Lütfen bekleyin, işlem gerçekleştiriliyor.',\r\n+\t\ticon: 'info',\r\n+\t\tallowOutsideClick: false,\r\n+\t\tallowEscapeKey: false,\r\n+\t\tshowConfirmButton: false,\r\n+\t\tdidOpen: () => {\r\n+\t\t\tSwal.showLoading();\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/cari_sil\") ?>',\r\n+\t\ttype: 'POST',\r\n+\t\tdata: {\r\n+\t\t\tcari_id: cariId,\r\n+\t\t\tonay: 'evet'\r\n+\t\t},\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tif (response.status === 'success') {\r\n+\t\t\t\tSwal.fire({\r\n+\t\t\t\t\ticon: 'success',\r\n+\t\t\t\t\ttitle: 'Başarılı',\r\n+\t\t\t\t\ttext: response.message,\r\n+\t\t\t\t\ttimer: 2000,\r\n+\t\t\t\t\tshowConfirmButton: false\r\n+\t\t\t\t}).then(() => {\r\n+\t\t\t\t\t// Sayfayı yenile\r\n+\t\t\t\t\tlocation.reload();\r\n+\t\t\t\t});\r\n+\t\t\t} else {\r\n+\t\t\t\tSwal.fire({\r\n+\t\t\t\t\ticon: 'error',\r\n+\t\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\t\ttext: response.message\r\n+\t\t\t\t});\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.error('AJAX Error:', error);\r\n+\t\t\tSwal.fire({\r\n+\t\t\t\ticon: 'error',\r\n+\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\ttext: 'Silme işlemi sırasında bir hata oluştu: ' + error\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n // Görsel modal fonksiyonu\r\n function showImageModal(imageSrc, title) {\r\n \t$('#imageModalLabel').text(title);\r\n \t$('#modalImage').attr('src', imageSrc);\r\n"
                },
                {
                    "date": 1756224475243,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -988,12 +988,24 @@\n });\r\n \r\n // Cari silme fonksiyonu\r\n function cariSil(cariId) {\r\n+\t// Debug için log\r\n+\tconsole.log('Cari silme işlemi başlatılıyor. Cari ID:', cariId);\r\n+\t\r\n+\tif (!cariId || cariId === '' || cariId === null || cariId === undefined) {\r\n+\t\tSwal.fire({\r\n+\t\t\ticon: 'error',\r\n+\t\t\ttitle: 'Hata',\r\n+\t\t\ttext: 'Geçersiz Cari ID! ID: ' + cariId\r\n+\t\t});\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n \t// Loading göster\r\n \tSwal.fire({\r\n \t\ttitle: 'Siliniyor...',\r\n-\t\ttext: 'Lütfen bekleyin, işlem gerçekleştiriliyor.',\r\n+\t\ttext: 'Lütfen bekleyin, işlem gerçekleştiriliyor. Cari ID: ' + cariId,\r\n \t\ticon: 'info',\r\n \t\tallowOutsideClick: false,\r\n \t\tallowEscapeKey: false,\r\n \t\tshowConfirmButton: false,\r\n@@ -1009,9 +1021,17 @@\n \t\t\tcari_id: cariId,\r\n \t\t\tonay: 'evet'\r\n \t\t},\r\n \t\tdataType: 'json',\r\n+\t\tbeforeSend: function() {\r\n+\t\t\tconsole.log('AJAX Request Data:', {\r\n+\t\t\t\tcari_id: cariId,\r\n+\t\t\t\tonay: 'evet',\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/cari_sil\") ?>'\r\n+\t\t\t});\r\n+\t\t},\r\n \t\tsuccess: function(response) {\r\n+\t\t\tconsole.log('AJAX Success Response:', response);\r\n \t\t\tif (response.status === 'success') {\r\n \t\t\t\tSwal.fire({\r\n \t\t\t\t\ticon: 'success',\r\n \t\t\t\t\ttitle: 'Başarılı',\r\n@@ -1030,13 +1050,44 @@\n \t\t\t\t});\r\n \t\t\t}\r\n \t\t},\r\n \t\terror: function(xhr, status, error) {\r\n-\t\t\tconsole.error('AJAX Error:', error);\r\n+\t\t\tconsole.error('AJAX Error Details:', {\r\n+\t\t\t\txhr: xhr,\r\n+\t\t\t\tstatus: status,\r\n+\t\t\t\terror: error,\r\n+\t\t\t\tresponseText: xhr.responseText,\r\n+\t\t\t\tstatusCode: xhr.status\r\n+\t\t\t});\r\n+\t\t\t\r\n+\t\t\tvar errorMessage = 'Silme işlemi sırasında bir hata oluştu.';\r\n+\t\t\t\r\n+\t\t\t// Detaylı hata mesajı oluştur\r\n+\t\t\tif (xhr.status === 500) {\r\n+\t\t\t\terrorMessage += ' (Server Error - 500)';\r\n+\t\t\t\tif (xhr.responseText) {\r\n+\t\t\t\t\ttry {\r\n+\t\t\t\t\t\tvar responseJson = JSON.parse(xhr.responseText);\r\n+\t\t\t\t\t\tif (responseJson.message) {\r\n+\t\t\t\t\t\t\terrorMessage = responseJson.message;\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t} catch(e) {\r\n+\t\t\t\t\t\t// JSON parse hatası\r\n+\t\t\t\t\t\tconsole.error('Response text:', xhr.responseText);\r\n+\t\t\t\t\t\terrorMessage += '\\nDetay: ' + xhr.responseText.substring(0, 200);\r\n+\t\t\t\t\t}\r\n+\t\t\t\t}\r\n+\t\t\t} else if (xhr.status === 0) {\r\n+\t\t\t\terrorMessage = 'Sunucuya bağlanılamadı.';\r\n+\t\t\t} else {\r\n+\t\t\t\terrorMessage += ' (HTTP ' + xhr.status + ')';\r\n+\t\t\t}\r\n+\t\t\t\r\n \t\t\tSwal.fire({\r\n \t\t\t\ticon: 'error',\r\n \t\t\t\ttitle: 'Hata',\r\n-\t\t\t\ttext: 'Silme işlemi sırasında bir hata oluştu: ' + error\r\n+\t\t\t\ttext: errorMessage,\r\n+\t\t\t\tfooter: 'Lütfen sistem yöneticinizle iletişime geçin.'\r\n \t\t\t});\r\n \t\t}\r\n \t});\r\n }\r\n"
                },
                {
                    "date": 1756281724689,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -446,9 +446,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t<th class=\"gorsel-column\">Satış Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Tutar</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Görselleri</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Durum</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Tarihi</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<th class=\"text-center\">Aktivasyon Tarihi</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th>Personel</th>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<th width=\"120\">İşlemler</th>\r\n \t\t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t\t</thead>\r\n@@ -668,9 +668,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= $durum_text ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"text-center\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t// Aktivasyon tarihi varsa onu kullan, yoksa oluşturma tarihini kullan\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t$display_date = $veri->aktivasyon_tarihi ?? $veri->olusturma_tarihi;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($display_date): ?>\r\n@@ -679,14 +679,8 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-html=\"true\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: help;\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= date('d.m.Y', strtotime($display_date)) ?></strong>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-primary\"><i class=\"fa fa-clock-o\"></i> <?= date('H:i:s', strtotime($display_date)) ?></small>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!$veri->aktivasyon_tarihi && $veri->olusturma_tarihi): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-secondary badge-sm\">Oluşturma Tarihi</small>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_uye_no): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"badge badge-info badge-sm\">Üye: <?= htmlspecialchars($veri->aktivasyon_uye_no) ?></small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n"
                },
                {
                    "date": 1756367338246,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -432,8 +432,69 @@\n \t\t\t\t\t\t<?php endif; ?>\r\n \r\n \t\t\t\t\t\t<?php if (!empty($rapor_verileri)): ?>\r\n \t\t\t\t\t\t\t<div class=\"card-body\">\r\n+\t\t\t\t\t\t\t\t<!-- Arama Formu -->\r\n+\t\t\t\t\t\t\t\t<div class=\"row mb-3\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"col-12\">\r\n+\t\t\t\t\t\t\t\t\t\t<div class=\"card bg-light\">\r\n+\t\t\t\t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<h6 class=\"card-title mb-3\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-search text-primary mr-2\"></i>Arama\r\n+\t\t\t\t\t\t\t\t\t\t\t\t</h6>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<form method=\"GET\" action=\"<?= current_url() ?>\" id=\"searchForm\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"cari_search\">Cari Arama</label>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   class=\"form-control\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   id=\"cari_search\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   name=\"cari_search\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"Ad, Soyad, Vergi No, Telefon veya TC Kimlik No...\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   value=\"<?= htmlspecialchars($this->input->get('cari_search') ?? '') ?>\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   autocomplete=\"off\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"form-text text-muted\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAd, soyad, vergi numarası, firma telefon veya TC kimlik numarası ile arama yapabilirsiniz.\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br><strong>Aranan alanlar:</strong> cari_ad, cari_soyad, cari_vergiNumarasi, cari_firmaTelefon, cari_tckn\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"aktivasyon_durum\">Aktivasyon Durum</label>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control\" id=\"aktivasyon_durum\" name=\"aktivasyon_durum\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Tümü</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"Aktif\" <?= ($this->input->get('aktivasyon_durum') == 'Aktif') ? 'selected' : '' ?>>Aktif</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"Beklemede\" <?= ($this->input->get('aktivasyon_durum') == 'Beklemede') ? 'selected' : '' ?>>Beklemede</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"İşlemde\" <?= ($this->input->get('aktivasyon_durum') == 'İşlemde') ? 'selected' : '' ?>>İşlemde</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"Tamamlandı\" <?= ($this->input->get('aktivasyon_durum') == 'Tamamlandı') ? 'selected' : '' ?>>Tamamlandı</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"İptal\" <?= ($this->input->get('aktivasyon_durum') == 'İptal') ? 'selected' : '' ?>>İptal</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"Reddedildi\" <?= ($this->input->get('aktivasyon_durum') == 'Reddedildi') ? 'selected' : '' ?>>Reddedildi</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label>&nbsp;</label>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"d-flex\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"btn btn-primary mr-2\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-search\"></i> Ara\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"<?= current_url() ?>\" class=\"btn btn-secondary\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-refresh\"></i> Temizle\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t</form>\r\n+\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t<!-- /Arama Formu -->\r\n+\t\t\t\t\t\t\t\t\r\n \t\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t\t\t\t<table class=\"table table-hover table-center mb-0\" id=\"raporTable\">\r\n \t\t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t\t<tr>\r\n@@ -1824,8 +1885,99 @@\n \t\t\t});\r\n \t\t}\r\n \t});\r\n }\r\n+\r\n+// Arama formu geliştirmeleri\r\n+$(document).ready(function() {\r\n+\t// Cari arama autocomplete'i başlat\r\n+\t$('#cari_search').autocomplete({\r\n+\t\tsource: function(request, response) {\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"cari_arama_endpoint.php\") ?>',\r\n+\t\t\t\ttype: 'GET',\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tdata: {\r\n+\t\t\t\t\tterm: request.term\r\n+\t\t\t\t},\r\n+\t\t\t\tbeforeSend: function() {\r\n+\t\t\t\t\t$('.ui-autocomplete').html('<li class=\"ui-menu-item\"><div class=\"ui-menu-item-wrapper\"><i class=\"fa fa-spinner fa-spin\"></i> Aranıyor...</div></li>');\r\n+\t\t\t\t},\r\n+\t\t\t\tsuccess: function(data) {\r\n+\t\t\t\t\tresponse(data);\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function() {\r\n+\t\t\t\t\tconsole.log('Cari arama hatası');\r\n+\t\t\t\t\tresponse([]);\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t},\r\n+\t\tminLength: 2,\r\n+\t\tdelay: 300,\r\n+\t\tselect: function(event, ui) {\r\n+\t\t\t// Seçilen değeri input'a yaz\r\n+\t\t\t$(this).val(ui.item.value);\r\n+\t\t\treturn false; // Input değerini manuel olarak ayarladık\r\n+\t\t},\r\n+\t\tfocus: function(event, ui) {\r\n+\t\t\t$(this).val(ui.item.value);\r\n+\t\t\treturn false;\r\n+\t\t}\r\n+\t}).on('focus', function() {\r\n+\t\t// Focus'ta minimum karakter sayısını karşılıyorsa arama yap\r\n+\t\tif ($(this).val().length >= 2) {\r\n+\t\t\t$(this).autocomplete('search', $(this).val());\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t// Enter tuşu ile arama\r\n+\t$('#cari_search').on('keypress', function(e) {\r\n+\t\tif (e.which == 13) { // Enter tuşu\r\n+\t\t\t$('#searchForm').submit();\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t// Arama inputu gerçek zamanlı filtreleme (opsiyonel - DataTable içinde)\r\n+\tvar table = $('#raporTable').DataTable();\r\n+\t\r\n+\t// Eğer arama parametresi varsa, DataTable'da da arama yap\r\n+\t<?php if (!empty($this->input->get('cari_search'))): ?>\r\n+\tvar searchTerm = '<?= htmlspecialchars($this->input->get('cari_search')) ?>';\r\n+\tif (searchTerm) {\r\n+\t\t// DataTable global arama\r\n+\t\ttable.search(searchTerm).draw();\r\n+\t}\r\n+\t<?php endif; ?>\r\n+\t\r\n+\t// Arama formunu temizle\r\n+\t$('#searchForm').on('reset', function() {\r\n+\t\twindow.location.href = '<?= base_url('muhasebe/tam-ana-rapor') ?>';\r\n+\t});\r\n+\t\r\n+\t// Arama sonuçları sayısını göster\r\n+\t<?php if (!empty($this->input->get('cari_search')) || !empty($this->input->get('aktivasyon_durum'))): ?>\r\n+\t\t<?php \r\n+\t\t$active_filters = [];\r\n+\t\tif (!empty($this->input->get('cari_search'))) {\r\n+\t\t\t$active_filters[] = 'Cari: \"' . htmlspecialchars($this->input->get('cari_search')) . '\"';\r\n+\t\t}\r\n+\t\tif (!empty($this->input->get('aktivasyon_durum'))) {\r\n+\t\t\t$active_filters[] = 'Durum: \"' . htmlspecialchars($this->input->get('aktivasyon_durum')) . '\"';\r\n+\t\t}\r\n+\t\t?>\r\n+\t\t\r\n+\t\t// Arama sonuçları bilgi çubuğunu ekle\r\n+\t\t$('#raporTable_wrapper').prepend(\r\n+\t\t\t'<div class=\"alert alert-info alert-dismissible fade show\" role=\"alert\">' +\r\n+\t\t\t'<i class=\"fa fa-info-circle mr-2\"></i>' +\r\n+\t\t\t'<strong>Arama Sonuçları:</strong> <?= implode(', ', $active_filters) ?> filtreleri ile <?= isset($rapor_verileri) ? count($rapor_verileri) : 0 ?> kayıt bulundu.' +\r\n+\t\t\t'<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\r\n+\t\t\t'<span aria-hidden=\"true\">&times;</span>' +\r\n+\t\t\t'</button>' +\r\n+\t\t\t'</div>'\r\n+\t\t);\r\n+\t<?php endif; ?>\r\n+});\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1756368020182,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -438,9 +438,10 @@\n \t\t\t\t\t\t\t\t\t<div class=\"col-12\">\r\n \t\t\t\t\t\t\t\t\t\t<div class=\"card bg-light\">\r\n \t\t\t\t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t<h6 class=\"card-title mb-3\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-search text-primary mr-2\"></i>Arama\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-search text-primary mr-2\"></i>Cari Arama\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">(Tek arama kutusu - Tüm arama işlemleri buradan yapılır)</small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t</h6>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<form method=\"GET\" action=\"<?= current_url() ?>\" id=\"searchForm\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"row\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-6\">\r\n@@ -449,14 +450,17 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   class=\"form-control\" \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   id=\"cari_search\" \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   name=\"cari_search\" \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"Ad, Soyad, Vergi No, Telefon veya TC Kimlik No...\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"Cari arama: Ad, Soyad, Vergi No, Telefon veya TC Kimlik No ile arayın...\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   value=\"<?= htmlspecialchars($this->input->get('cari_search') ?? '') ?>\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   autocomplete=\"off\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   autocomplete=\"off\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   title=\"Bu tek arama kutusu tüm cari bilgilerini arar\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<small class=\"form-text text-muted\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAd, soyad, vergi numarası, firma telefon veya TC kimlik numarası ile arama yapabilirsiniz.\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br><strong>Aranan alanlar:</strong> cari_ad, cari_soyad, cari_vergiNumarasi, cari_firmaTelefon, cari_tckn\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle text-primary\"></i> <strong>Tek Arama Sistemi:</strong> \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tBu kutucuk tüm cari kayıtlarında arama yapar.\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br><strong>Arama yapılan alanlar:</strong> cari_ad, cari_soyad, cari_vergiNumarasi, cari_firmaTelefon, cari_tckn\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br><small class=\"text-success\">✓ Otomatik tamamlama aktif (2+ karakter yazın)</small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n@@ -927,9 +931,13 @@\n \t\t},\r\n \t\t\"order\": [[ 0, \"desc\" ]],  // İlk kolon (Tarih) azalan sıralama\r\n \t\t\"pageLength\": 25,\r\n \t\t\"responsive\": true,\r\n-\t\t\"scrollX\": true\r\n+\t\t\"scrollX\": true,\r\n+\t\t\"searching\": false,  // DataTable'ın kendi arama kutusunu gizle\r\n+\t\t\"info\": true,  // \"X kayıt gösteriliyor\" bilgisini göster\r\n+\t\t\"lengthChange\": true,  // Sayfa başına kayıt sayısı değiştirme seçeneği\r\n+\t\t\"dom\": 'lrtip'  // Search kutusunu (f) DOM'dan çıkar: l(ength), (f)ilter, (t)able, (i)nfo, (p)agination\r\n \t});\r\n \r\n \t// Cari silme işlemi\r\n \t$(document).on('click', '.btn-cari-sil', function() {\r\n@@ -1888,9 +1896,9 @@\n }\r\n \r\n // Arama formu geliştirmeleri\r\n $(document).ready(function() {\r\n-\t// Cari arama autocomplete'i başlat\r\n+\t// Sadece bizim cari_search inputumuz için autocomplete'i başlat\r\n \t$('#cari_search').autocomplete({\r\n \t\tsource: function(request, response) {\r\n \t\t\t$.ajax({\r\n \t\t\t\turl: '<?= base_url(\"cari_arama_endpoint.php\") ?>',\r\n@@ -1913,11 +1921,13 @@\n \t\t},\r\n \t\tminLength: 2,\r\n \t\tdelay: 300,\r\n \t\tselect: function(event, ui) {\r\n-\t\t\t// Seçilen değeri input'a yaz\r\n+\t\t\t// Seçilen değeri sadece bizim input'a yaz\r\n \t\t\t$(this).val(ui.item.value);\r\n-\t\t\treturn false; // Input değerini manuel olarak ayarladık\r\n+\t\t\t// Form otomatik olarak submit olmasın\r\n+\t\t\tevent.preventDefault();\r\n+\t\t\treturn false;\r\n \t\t},\r\n \t\tfocus: function(event, ui) {\r\n \t\t\t$(this).val(ui.item.value);\r\n \t\t\treturn false;\r\n@@ -1928,27 +1938,15 @@\n \t\t\t$(this).autocomplete('search', $(this).val());\r\n \t\t}\r\n \t});\r\n \t\r\n-\t// Enter tuşu ile arama\r\n+\t// Sadece bizim arama inputumuzda Enter tuşu ile arama\r\n \t$('#cari_search').on('keypress', function(e) {\r\n \t\tif (e.which == 13) { // Enter tuşu\r\n \t\t\t$('#searchForm').submit();\r\n \t\t}\r\n \t});\r\n \t\r\n-\t// Arama inputu gerçek zamanlı filtreleme (opsiyonel - DataTable içinde)\r\n-\tvar table = $('#raporTable').DataTable();\r\n-\t\r\n-\t// Eğer arama parametresi varsa, DataTable'da da arama yap\r\n-\t<?php if (!empty($this->input->get('cari_search'))): ?>\r\n-\tvar searchTerm = '<?= htmlspecialchars($this->input->get('cari_search')) ?>';\r\n-\tif (searchTerm) {\r\n-\t\t// DataTable global arama\r\n-\t\ttable.search(searchTerm).draw();\r\n-\t}\r\n-\t<?php endif; ?>\r\n-\t\r\n \t// Arama formunu temizle\r\n \t$('#searchForm').on('reset', function() {\r\n \t\twindow.location.href = '<?= base_url('muhasebe/tam-ana-rapor') ?>';\r\n \t});\r\n"
                },
                {
                    "date": 1756376046031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -913,8 +913,56 @@\n \t\t</div>\r\n \t</div>\r\n </div>\r\n \r\n+<!-- Görsel Gösterme Modal -->\r\n+<div class=\"modal fade\" id=\"gorselModal\" tabindex=\"-1\" role=\"dialog\">\r\n+\t<div class=\"modal-dialog modal-lg\" role=\"document\">\r\n+\t\t<div class=\"modal-content\">\r\n+\t\t\t<div class=\"modal-header\">\r\n+\t\t\t\t<h5 class=\"modal-title\" id=\"gorselModalTitle\">Görsel</h5>\r\n+\t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\">\r\n+\t\t\t\t\t<span>&times;</span>\r\n+\t\t\t\t</button>\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"modal-body text-center\">\r\n+\t\t\t\t<img id=\"gorselModalImage\" src=\"\" class=\"img-fluid\" style=\"max-height: 500px;\" alt=\"Görsel\">\r\n+\t\t\t</div>\r\n+\t\t</div>\r\n+\t</div>\r\n+</div>\r\n+\r\n+<!-- Görsel Yükleme Modal -->\r\n+<div class=\"modal fade\" id=\"uploadModal\" tabindex=\"-1\" role=\"dialog\">\r\n+\t<div class=\"modal-dialog\" role=\"document\">\r\n+\t\t<div class=\"modal-content\">\r\n+\t\t\t<div class=\"modal-header\">\r\n+\t\t\t\t<h5 class=\"modal-title\" id=\"uploadModalTitle\">Görsel Yükle</h5>\r\n+\t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\">\r\n+\t\t\t\t\t<span>&times;</span>\r\n+\t\t\t\t</button>\r\n+\t\t\t</div>\r\n+\t\t\t<form id=\"uploadForm\" enctype=\"multipart/form-data\">\r\n+\t\t\t\t<div class=\"modal-body\">\r\n+\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t<label>Görsel Dosyası Seçin:</label>\r\n+\t\t\t\t\t\t<input type=\"file\" id=\"gorselFile\" name=\"gorsel\" class=\"form-control-file\" accept=\"image/*,application/pdf\" required>\r\n+\t\t\t\t\t\t<small class=\"form-text text-muted\">\r\n+\t\t\t\t\t\t\tDesteklenen formatlar: JPG, PNG, PDF (Maksimum 10MB)\r\n+\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t<div class=\"modal-footer\">\r\n+\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">İptal</button>\r\n+\t\t\t\t\t<button type=\"submit\" class=\"btn btn-primary\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-upload\"></i> Yükle\r\n+\t\t\t\t\t</button>\r\n+\t\t\t\t</div>\r\n+\t\t\t</form>\r\n+\t\t</div>\r\n+\t</div>\r\n+</div>\r\n+\r\n <?php $this->load->view(\"include/footer-js\"); ?>\r\n \r\n <!-- SweetAlert2 JS -->\r\n <script src=\"https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js\"></script>\r\n@@ -1548,8 +1596,13 @@\n \r\n // Tahsilat detay modal fonksiyonu\r\n function showTahsilatModal(cariId, cariAd) {\r\n \t$('#tahsilatModalLabel').html('<i class=\"fa fa-money mr-2\"></i>Tahsilat Detayları - ' + cariAd);\r\n+\t\r\n+\t// Cari bilgilerini modal'da sakla\r\n+\t$('#tahsilatModal').data('cari-id', cariId);\r\n+\t$('#tahsilatModal').data('cari-ad', cariAd);\r\n+\t\r\n \t$('#tahsilatModal').modal('show');\r\n \t$('#tahsilatLoading').show();\r\n \t$('#tahsilatContent').hide();\r\n \t\r\n@@ -1573,9 +1626,9 @@\n \t\t\t\t\t\t\t\t\t<th>Belge No</th>\r\n \t\t\t\t\t\t\t\t\t<th>Tahsilat Tipi</th>\r\n \t\t\t\t\t\t\t\t\t<th>Tutar</th>\r\n \t\t\t\t\t\t\t\t\t<th>Açıklama</th>\r\n-\t\t\t\t\t\t\t\t\t<th>Detay</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Görsel</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody>\r\n \t\t\t\t`;\r\n@@ -1602,9 +1655,9 @@\n \t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td>${item.aciklama || '-'}</td>\r\n \t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t<span class=\"badge badge-secondary\">${item.detay || '-'}</span>\r\n+\t\t\t\t\t\t\t\t${generateGorselButton(item)}\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t</tr>\r\n \t\t\t\t\t`;\r\n \t\t\t\t});\r\n@@ -1653,8 +1706,229 @@\n \t\t}\r\n \t});\r\n }\r\n \r\n+// Görsel buton oluşturma fonksiyonu\r\n+function generateGorselButton(item) {\r\n+\t// Kasa hareketlerinde görsel alanı yok\r\n+\tif (item.tip_kod == '3') {\r\n+\t\treturn '<span class=\"badge badge-secondary\">Görsel Yok</span>';\r\n+\t}\r\n+\t\r\n+\tlet gorselAlan = '';\r\n+\tlet uploadFolder = '';\r\n+\tlet gorselUrl = '';\r\n+\t\r\n+\t// Tip koduna göre görsel alanı ve upload klasörü belirle\r\n+\tswitch(item.tip_kod) {\r\n+\t\tcase '1': // Banka\r\n+\t\t\tgorselAlan = 'bh_gorsel';\r\n+\t\t\tuploadFolder = 'dekontlar';\r\n+\t\t\tbreak;\r\n+\t\tcase '2': // Çek\r\n+\t\t\tgorselAlan = 'cek_gorsel';  \r\n+\t\t\tuploadFolder = 'cekler';\r\n+\t\t\tbreak;\r\n+\t\tcase '4': // Senet\r\n+\t\t\tgorselAlan = 'senet_gorsel';\r\n+\t\t\tuploadFolder = 'senetler';\r\n+\t\t\tbreak;\r\n+\t}\r\n+\t\r\n+\t// Görsel varsa görüntüleme butonu, yoksa yükleme butonu\r\n+\tif (item.gorsel_dosya && item.gorsel_dosya != '' && item.gorsel_dosya != null) {\r\n+\t\tgorselUrl = '<?= base_url(\"assets/uploads/\") ?>' + uploadFolder + '/' + item.gorsel_dosya;\r\n+\t\treturn `\r\n+\t\t\t<button class=\"btn btn-sm btn-success\" onclick=\"showGorsel('${gorselUrl}', '${item.tahsilat_tipi}')\">\r\n+\t\t\t\t<i class=\"fa fa-image\"></i> Göster\r\n+\t\t\t</button>\r\n+\t\t\t<button class=\"btn btn-sm btn-danger ml-1\" onclick=\"deleteGorsel('${item.unique_id}', '${item.tip_kod}', '${item.source_id}')\">\r\n+\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t</button>\r\n+\t\t`;\r\n+\t} else {\r\n+\t\treturn `\r\n+\t\t\t<button class=\"btn btn-sm btn-primary\" onclick=\"uploadGorsel('${item.unique_id}', '${item.tip_kod}', '${item.source_id}', '${gorselAlan}')\">\r\n+\t\t\t\t<i class=\"fa fa-upload\"></i> Yükle\r\n+\t\t\t</button>\r\n+\t\t`;\r\n+\t}\r\n+}\r\n+\r\n+// Görsel gösterme fonksiyonu\r\n+function showGorsel(gorselUrl, tahsilatTipi) {\r\n+\t$('#gorselModalTitle').text(tahsilatTipi + ' Görseli');\r\n+\t$('#gorselModalImage').attr('src', gorselUrl);\r\n+\t$('#gorselModal').modal('show');\r\n+}\r\n+\r\n+// Görsel yükleme fonksiyonu\r\n+function uploadGorsel(uniqueId, tipKod, sourceId, gorselAlan) {\r\n+\t$('#uploadModalTitle').text('Görsel Yükle');\r\n+\t$('#uploadForm').data('unique-id', uniqueId);\r\n+\t$('#uploadForm').data('tip-kod', tipKod);\r\n+\t$('#uploadForm').data('source-id', sourceId);\r\n+\t$('#uploadForm').data('gorsel-alan', gorselAlan);\r\n+\t$('#uploadModal').modal('show');\r\n+}\r\n+\r\n+// Upload form submit event handler\r\n+$('#uploadForm').on('submit', function(e) {\r\n+\te.preventDefault();\r\n+\t\r\n+\tconst formData = new FormData();\r\n+\tconst fileInput = document.getElementById('gorselFile');\r\n+\tconst file = fileInput.files[0];\r\n+\t\r\n+\tif (!file) {\r\n+\t\tSwal.fire('Uyarı', 'Lütfen bir dosya seçin!', 'warning');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\t// Form verilerini hazırla\r\n+\tconst tipKod = $(this).data('tip-kod');\r\n+\tconst sourceId = $(this).data('source-id');\r\n+\t\r\n+\t// Tip koduna göre tip parametresini belirle\r\n+\tlet tipParam = '';\r\n+\tswitch(tipKod) {\r\n+\t\tcase '1': // Banka\r\n+\t\t\ttipParam = 'bh';\r\n+\t\t\tbreak;\r\n+\t\tcase '2': // Çek  \r\n+\t\t\ttipParam = 'cek';\r\n+\t\t\tbreak;\r\n+\t\tcase '4': // Senet\r\n+\t\t\ttipParam = 'senet';\r\n+\t\t\tbreak;\r\n+\t}\r\n+\t\r\n+\tformData.append('gorsel', file);\r\n+\tformData.append('tip', tipParam);\r\n+\tformData.append('id', sourceId);\r\n+\t\r\n+\t// AJAX ile yükle\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/uploadTahsilatGorsel\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: formData,\r\n+\t\tprocessData: false,\r\n+\t\tcontentType: false,\r\n+\t\tbeforeSend: function() {\r\n+\t\t\t$('#uploadModal .btn[type=\"submit\"]').prop('disabled', true).html('<i class=\"fa fa-spinner fa-spin\"></i> Yükleniyor...');\r\n+\t\t},\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tconsole.log('Upload response:', response);\r\n+\t\t\t\r\n+\t\t\t// Response'un string olup olmadığını kontrol et\r\n+\t\t\tif (typeof response === 'string') {\r\n+\t\t\t\ttry {\r\n+\t\t\t\t\tresponse = JSON.parse(response);\r\n+\t\t\t\t} catch(e) {\r\n+\t\t\t\t\tconsole.error('JSON parse error:', e);\r\n+\t\t\t\t\tSwal.fire(\"Hata!\", \"Sunucu yanıtı işlenemedi: \" + response, \"error\");\r\n+\t\t\t\t\treturn;\r\n+\t\t\t\t}\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\tif (response.success) {\r\n+\t\t\t\tSwal.fire({\r\n+\t\t\t\t\ttitle: \"Başarılı!\",\r\n+\t\t\t\t\ttext: response.message || \"Görsel başarıyla yüklendi.\",\r\n+\t\t\t\t\ticon: \"success\",\r\n+\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n+\t\t\t\t}).then(() => {\r\n+\t\t\t\t\t$('#uploadModal').modal('hide');\r\n+\t\t\t\t\t// Tahsilat modalını yenile\r\n+\t\t\t\t\tconst cariId = $('#tahsilatModal').data('cari-id');\r\n+\t\t\t\t\tconst cariAd = $('#tahsilatModal').data('cari-ad');\r\n+\t\t\t\t\tshowTahsilatModal(cariId, cariAd);\r\n+\t\t\t\t});\r\n+\t\t\t} else {\r\n+\t\t\t\tSwal.fire(\"Hata!\", response.message || \"Yükleme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.error('Upload error:', {xhr, status, error});\r\n+\t\t\tSwal.fire(\"Hata!\", \"Yükleme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n+\t\t},\r\n+\t\tcomplete: function() {\r\n+\t\t\t$('#uploadModal .btn[type=\"submit\"]').prop('disabled', false).html('<i class=\"fa fa-upload\"></i> Yükle');\r\n+\t\t\t$('#gorselFile').val(''); // Dosya inputunu temizle\r\n+\t\t}\r\n+\t});\r\n+});\r\n+\r\n+// Görsel silme fonksiyonu\r\n+function deleteGorsel(uniqueId, tipKod, sourceId) {\r\n+\tSwal.fire({\r\n+\t\ttitle: \"Emin misiniz?\",\r\n+\t\ttext: \"Bu görseli silmek istediğinize emin misiniz?\",\r\n+\t\ticon: \"warning\",\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: \"#dc3545\",\r\n+\t\tconfirmButtonText: \"Evet, Sil\",\r\n+\t\tcancelButtonText: \"İptal\"\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t// Tip koduna göre tip parametresini belirle\r\n+\t\t\tlet tipParam = '';\r\n+\t\t\tswitch(tipKod) {\r\n+\t\t\t\tcase '1': // Banka\r\n+\t\t\t\t\ttipParam = 'bh';\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase '2': // Çek  \r\n+\t\t\t\t\ttipParam = 'cek';\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase '4': // Senet\r\n+\t\t\t\t\ttipParam = 'senet';\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/deleteTahsilatGorsel\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: {\r\n+\t\t\t\t\ttip: tipParam,\r\n+\t\t\t\t\tid: sourceId\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tbeforeSend: function() {\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ttitle: \"Siliniyor\",\r\n+\t\t\t\t\t\ttext: \"Görsel siliniyor...\",\r\n+\t\t\t\t\t\ticon: \"info\",\r\n+\t\t\t\t\t\tshowConfirmButton: false,\r\n+\t\t\t\t\t\tallowOutsideClick: false\r\n+\t\t\t\t\t});\r\n+\t\t\t\t},\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tconsole.log('Delete response:', response);\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n+\t\t\t\t\t\t\ttext: response.message || \"Görsel başarıyla silindi.\",\r\n+\t\t\t\t\t\t\ticon: \"success\",\r\n+\t\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n+\t\t\t\t\t\t}).then(() => {\r\n+\t\t\t\t\t\t\t// Tahsilat modalını yenile\r\n+\t\t\t\t\t\t\tconst cariId = $('#tahsilatModal').data('cari-id');\r\n+\t\t\t\t\t\t\tconst cariAd = $('#tahsilatModal').data('cari-ad');\r\n+\t\t\t\t\t\t\tshowTahsilatModal(cariId, cariAd);\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire(\"Hata!\", response.message || \"Silme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('Delete error:', {xhr, status, error});\r\n+\t\t\t\t\tSwal.fire(\"Hata!\", \"Silme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n // Excel export fonksiyonu\r\n function exportToExcel() {\r\n \t// Excel export işlemi için AJAX çağrısı veya form submit\r\n \twindow.open('<?= base_url(\"muhasebe/tam-ana-rapor-excel\") ?>', '_blank');\r\n"
                },
                {
                    "date": 1756378349122,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -943,14 +943,22 @@\n \t\t\t</div>\r\n \t\t\t<form id=\"uploadForm\" enctype=\"multipart/form-data\">\r\n \t\t\t\t<div class=\"modal-body\">\r\n \t\t\t\t\t<div class=\"form-group\">\r\n-\t\t\t\t\t\t<label>Görsel Dosyası Seçin:</label>\r\n-\t\t\t\t\t\t<input type=\"file\" id=\"gorselFile\" name=\"gorsel\" class=\"form-control-file\" accept=\"image/*,application/pdf\" required>\r\n+\t\t\t\t\t\t<label>Görsel Dosyalarını Seçin:</label>\r\n+\t\t\t\t\t\t<div class=\"custom-file\">\r\n+\t\t\t\t\t\t\t<input type=\"file\" id=\"gorselFile\" name=\"gorseller[]\" class=\"custom-file-input\" accept=\"image/*,application/pdf\" multiple required>\r\n+\t\t\t\t\t\t\t<label class=\"custom-file-label\" for=\"gorselFile\">Dosya(lar) seçin...</label>\r\n+\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t<small class=\"form-text text-muted\">\r\n-\t\t\t\t\t\t\tDesteklenen formatlar: JPG, PNG, PDF (Maksimum 10MB)\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-info-circle\"></i> Desteklenen formatlar: JPG, PNG, PDF (Maksimum 10MB/dosya)\r\n+\t\t\t\t\t\t\t<br><i class=\"fa fa-plus-circle text-success\"></i> Birden fazla dosya seçebilirsiniz (Ctrl+Click)\r\n \t\t\t\t\t\t</small>\r\n \t\t\t\t\t</div>\r\n+\t\t\t\t\t<div id=\"selectedFiles\" class=\"mt-2\" style=\"display: none;\">\r\n+\t\t\t\t\t\t<strong>Seçilen dosyalar:</strong>\r\n+\t\t\t\t\t\t<ul id=\"fileList\" class=\"list-unstyled mt-1\"></ul>\r\n+\t\t\t\t\t</div>\r\n \t\t\t\t</div>\r\n \t\t\t\t<div class=\"modal-footer\">\r\n \t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">İptal</button>\r\n \t\t\t\t\t<button type=\"submit\" class=\"btn btn-primary\">\r\n@@ -1715,9 +1723,8 @@\n \t}\r\n \t\r\n \tlet gorselAlan = '';\r\n \tlet uploadFolder = '';\r\n-\tlet gorselUrl = '';\r\n \t\r\n \t// Tip koduna göre görsel alanı ve upload klasörü belirle\r\n \tswitch(item.tip_kod) {\r\n \t\tcase '1': // Banka\r\n@@ -1733,26 +1740,31 @@\n \t\t\tuploadFolder = 'senetler';\r\n \t\t\tbreak;\r\n \t}\r\n \t\r\n-\t// Görsel varsa görüntüleme butonu, yoksa yükleme butonu\r\n-\tif (item.gorsel_dosya && item.gorsel_dosya != '' && item.gorsel_dosya != null) {\r\n-\t\tgorselUrl = '<?= base_url(\"assets/uploads/\") ?>' + uploadFolder + '/' + item.gorsel_dosya;\r\n-\t\treturn `\r\n-\t\t\t<button class=\"btn btn-sm btn-success\" onclick=\"showGorsel('${gorselUrl}', '${item.tahsilat_tipi}')\">\r\n-\t\t\t\t<i class=\"fa fa-image\"></i> Göster\r\n+\t// Çoklu görsel desteği\r\n+\tlet html = '';\r\n+\tlet gorselSayisi = 0;\r\n+\t\r\n+\tif (item.gorseller && item.gorseller.length > 0) {\r\n+\t\tgorselSayisi = item.gorseller.length;\r\n+\t\t\r\n+\t\t// Görsel galerisi butonu\r\n+\t\thtml += `\r\n+\t\t\t<button class=\"btn btn-sm btn-success\" onclick=\"showGorselGaleri('${item.unique_id}', '${item.tahsilat_tipi}', ${JSON.stringify(item.gorseller).replace(/\"/g, '&quot;')})\">\r\n+\t\t\t\t<i class=\"fa fa-images\"></i> Görseller (${gorselSayisi})\r\n \t\t\t</button>\r\n-\t\t\t<button class=\"btn btn-sm btn-danger ml-1\" onclick=\"deleteGorsel('${item.unique_id}', '${item.tip_kod}', '${item.source_id}')\">\r\n-\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n-\t\t\t</button>\r\n \t\t`;\r\n-\t} else {\r\n-\t\treturn `\r\n-\t\t\t<button class=\"btn btn-sm btn-primary\" onclick=\"uploadGorsel('${item.unique_id}', '${item.tip_kod}', '${item.source_id}', '${gorselAlan}')\">\r\n-\t\t\t\t<i class=\"fa fa-upload\"></i> Yükle\r\n-\t\t\t</button>\r\n-\t\t`;\r\n \t}\r\n+\t\r\n+\t// Her zaman yükleme butonu göster\r\n+\thtml += `\r\n+\t\t<button class=\"btn btn-sm btn-primary ml-1\" onclick=\"uploadGorsel('${item.unique_id}', '${item.tip_kod}', '${item.source_id}', '${gorselAlan}')\">\r\n+\t\t\t<i class=\"fa fa-upload\"></i> ${gorselSayisi > 0 ? 'Ekle' : 'Yükle'}\r\n+\t\t</button>\r\n+\t`;\r\n+\t\r\n+\treturn html;\r\n }\r\n \r\n // Görsel gösterme fonksiyonu\r\n function showGorsel(gorselUrl, tahsilatTipi) {\r\n@@ -1760,15 +1772,79 @@\n \t$('#gorselModalImage').attr('src', gorselUrl);\r\n \t$('#gorselModal').modal('show');\r\n }\r\n \r\n+// Görsel galeri fonksiyonu\r\n+function showGorselGaleri(uniqueId, tahsilatTipi, gorseller) {\r\n+\tlet html = `\r\n+\t\t<div class=\"container-fluid\">\r\n+\t\t\t<div class=\"row\">\r\n+\t`;\r\n+\t\r\n+\tgorseller.forEach(function(gorsel, index) {\r\n+\t\thtml += `\r\n+\t\t\t<div class=\"col-md-4 col-sm-6 mb-3\">\r\n+\t\t\t\t<div class=\"card\">\r\n+\t\t\t\t\t<div class=\"card-img-container\" style=\"height: 200px; overflow: hidden; position: relative;\">\r\n+\t\t\t\t\t\t${gorsel.dosya_adi.toLowerCase().endsWith('.pdf') ? \r\n+\t\t\t\t\t\t\t`<div class=\"d-flex align-items-center justify-content-center h-100 bg-light\">\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-file-pdf fa-3x text-danger\"></i>\r\n+\t\t\t\t\t\t\t\t<div class=\"ml-2\">\r\n+\t\t\t\t\t\t\t\t\t<small class=\"d-block\">PDF Dosyası</small>\r\n+\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">${gorsel.dosya_adi}</small>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>` :\r\n+\t\t\t\t\t\t\t`<img src=\"${gorsel.url}\" class=\"card-img-top\" style=\"height: 100%; object-fit: cover; cursor: pointer;\" \r\n+\t\t\t\t\t\t\t\t onclick=\"showGorsel('${gorsel.url}', '${tahsilatTipi}')\" alt=\"Görsel ${index + 1}\">`\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t<div class=\"card-footer p-2\">\r\n+\t\t\t\t\t\t<div class=\"d-flex justify-content-between align-items-center\">\r\n+\t\t\t\t\t\t\t<small class=\"text-muted\">${gorsel.tip === 'ana' ? 'Ana Görsel' : 'Ek Görsel'}</small>\r\n+\t\t\t\t\t\t\t<div>\r\n+\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-primary\" onclick=\"window.open('${gorsel.url}', '_blank')\" title=\"Tam Boyut\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-external-link\"></i>\r\n+\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-danger ml-1\" onclick=\"deleteGorselFromGaleri('${uniqueId}', '${gorsel.id}', '${gorsel.dosya_adi}')\" title=\"Sil\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t</div>\r\n+\t\t`;\r\n+\t});\r\n+\t\r\n+\thtml += `\r\n+\t\t\t</div>\r\n+\t\t</div>\r\n+\t`;\r\n+\t\r\n+\t$('#gorselModalTitle').text(tahsilatTipi + ' Görselleri (' + gorseller.length + ')');\r\n+\t$('#gorselModalImage').closest('.modal-body').html(html);\r\n+\t$('#gorselModal').modal('show');\r\n+\t\r\n+\t// Modal kapandığında orijinal yapıyı geri getir\r\n+\t$('#gorselModal').one('hidden.bs.modal', function() {\r\n+\t\t$(this).find('.modal-body').html('<img id=\"gorselModalImage\" src=\"\" class=\"img-fluid\" style=\"max-height: 500px;\" alt=\"Görsel\">');\r\n+\t});\r\n+}\r\n+\r\n // Görsel yükleme fonksiyonu\r\n function uploadGorsel(uniqueId, tipKod, sourceId, gorselAlan) {\r\n \t$('#uploadModalTitle').text('Görsel Yükle');\r\n \t$('#uploadForm').data('unique-id', uniqueId);\r\n \t$('#uploadForm').data('tip-kod', tipKod);\r\n \t$('#uploadForm').data('source-id', sourceId);\r\n \t$('#uploadForm').data('gorsel-alan', gorselAlan);\r\n+\t\r\n+\t// Modal'ı temizle\r\n+\t$('#gorselFile').val('');\r\n+\t$('.custom-file-label').text('Dosya(lar) seçin...');\r\n+\t$('#selectedFiles').hide();\r\n+\t$('#fileList').empty();\r\n+\t\r\n \t$('#uploadModal').modal('show');\r\n }\r\n \r\n // Upload form submit event handler\r\n@@ -1776,12 +1852,12 @@\n \te.preventDefault();\r\n \t\r\n \tconst formData = new FormData();\r\n \tconst fileInput = document.getElementById('gorselFile');\r\n-\tconst file = fileInput.files[0];\r\n+\tconst files = fileInput.files;\r\n \t\r\n-\tif (!file) {\r\n-\t\tSwal.fire('Uyarı', 'Lütfen bir dosya seçin!', 'warning');\r\n+\tif (files.length === 0) {\r\n+\t\tSwal.fire('Uyarı', 'Lütfen en az bir dosya seçin!', 'warning');\r\n \t\treturn;\r\n \t}\r\n \t\r\n \t// Form verilerini hazırla\r\n@@ -1801,9 +1877,12 @@\n \t\t\ttipParam = 'senet';\r\n \t\t\tbreak;\r\n \t}\r\n \t\r\n-\tformData.append('gorsel', file);\r\n+\t// Çoklu dosyaları FormData'ya ekle\r\n+\tfor (let i = 0; i < files.length; i++) {\r\n+\t\tformData.append('gorseller[]', files[i]);\r\n+\t}\r\n \tformData.append('tip', tipParam);\r\n \tformData.append('id', sourceId);\r\n \t\r\n \t// AJAX ile yükle\r\n@@ -1830,11 +1909,16 @@\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t\t\r\n \t\t\tif (response.success) {\r\n+\t\t\t\tlet message = response.message || \"Görseller başarıyla yüklendi.\";\r\n+\t\t\t\tif (response.errors && response.errors.length > 0) {\r\n+\t\t\t\t\tmessage += \"\\n\\nUyarılar:\\n\" + response.errors.join(\"\\n\");\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n \t\t\t\tSwal.fire({\r\n \t\t\t\t\ttitle: \"Başarılı!\",\r\n-\t\t\t\t\ttext: response.message || \"Görsel başarıyla yüklendi.\",\r\n+\t\t\t\t\ttext: message,\r\n \t\t\t\t\ticon: \"success\",\r\n \t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n \t\t\t\t}).then(() => {\r\n \t\t\t\t\t$('#uploadModal').modal('hide');\r\n@@ -1853,12 +1937,53 @@\n \t\t},\r\n \t\tcomplete: function() {\r\n \t\t\t$('#uploadModal .btn[type=\"submit\"]').prop('disabled', false).html('<i class=\"fa fa-upload\"></i> Yükle');\r\n \t\t\t$('#gorselFile').val(''); // Dosya inputunu temizle\r\n+\t\t\t$('.custom-file-label').text('Dosya(lar) seçin...');\r\n+\t\t\t$('#selectedFiles').hide();\r\n+\t\t\t$('#fileList').empty();\r\n \t\t}\r\n \t});\r\n });\r\n \r\n+// Dosya seçimi değiştiğinde\r\n+$(document).on('change', '#gorselFile', function() {\r\n+\tconst files = this.files;\r\n+\tconst label = $(this).next('.custom-file-label');\r\n+\tconst selectedFiles = $('#selectedFiles');\r\n+\tconst fileList = $('#fileList');\r\n+\t\r\n+\tif (files.length === 0) {\r\n+\t\tlabel.text('Dosya(lar) seçin...');\r\n+\t\tselectedFiles.hide();\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\tif (files.length === 1) {\r\n+\t\tlabel.text(files[0].name);\r\n+\t} else {\r\n+\t\tlabel.text(files.length + ' dosya seçildi');\r\n+\t}\r\n+\t\r\n+\t// Seçilen dosyaları listele\r\n+\tfileList.empty();\r\n+\tfor (let i = 0; i < files.length; i++) {\r\n+\t\tconst file = files[i];\r\n+\t\tconst fileSize = (file.size / 1024 / 1024).toFixed(2); // MB\r\n+\t\tconst fileType = file.type.startsWith('image/') ? 'Resim' : (file.type === 'application/pdf' ? 'PDF' : 'Dosya');\r\n+\t\t\r\n+\t\tfileList.append(`\r\n+\t\t\t<li class=\"border rounded p-2 mb-1 bg-light\">\r\n+\t\t\t\t<i class=\"fa fa-${file.type.startsWith('image/') ? 'image' : 'file-pdf'} text-${file.type.startsWith('image/') ? 'success' : 'danger'} mr-2\"></i>\r\n+\t\t\t\t<strong>${file.name}</strong>\r\n+\t\t\t\t<small class=\"text-muted ml-2\">(${fileType}, ${fileSize} MB)</small>\r\n+\t\t\t</li>\r\n+\t\t`);\r\n+\t}\r\n+\t\r\n+\tselectedFiles.show();\r\n+});\r\n+\r\n // Görsel silme fonksiyonu\r\n function deleteGorsel(uniqueId, tipKod, sourceId) {\r\n \tSwal.fire({\r\n \t\ttitle: \"Emin misiniz?\",\r\n@@ -1927,8 +2052,42 @@\n \t\t}\r\n \t});\r\n }\r\n \r\n+// Galeriden görsel silme fonksiyonu\r\n+function deleteGorselFromGaleri(uniqueId, gorselId, dosyaAdi) {\r\n+\tSwal.fire({\r\n+\t\ttitle: \"Emin misiniz?\",\r\n+\t\ttext: \"Bu görseli silmek istediğinize emin misiniz?\\n\\nDosya: \" + dosyaAdi,\r\n+\t\ticon: \"warning\",\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: \"#dc3545\",\r\n+\t\tconfirmButtonText: \"Evet, Sil\",\r\n+\t\tcancelButtonText: \"İptal\"\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t// uniqueId'den tip kodunu ve source_id'yi çıkar\r\n+\t\t\tconst parts = uniqueId.split('_');\r\n+\t\t\tlet tipKod = '';\r\n+\t\t\tlet sourceId = parts[1];\r\n+\t\t\t\r\n+\t\t\tswitch(parts[0]) {\r\n+\t\t\t\tcase 'bh':\r\n+\t\t\t\t\ttipKod = '1';\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 'cek':\r\n+\t\t\t\t\ttipKod = '2';\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t\tcase 's':\r\n+\t\t\t\t\ttipKod = '4';\r\n+\t\t\t\t\tbreak;\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\tdeleteGorsel(uniqueId, tipKod, sourceId);\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n // Excel export fonksiyonu\r\n function exportToExcel() {\r\n \t// Excel export işlemi için AJAX çağrısı veya form submit\r\n \twindow.open('<?= base_url(\"muhasebe/tam-ana-rapor-excel\") ?>', '_blank');\r\n"
                },
                {
                    "date": 1756449570258,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -899,9 +899,12 @@\n \t\t\t</div>\r\n \t\t\t<div class=\"modal-footer\">\r\n \t\t\t\t<div class=\"d-flex justify-content-between w-100\">\r\n \t\t\t\t\t<div>\r\n-\t\t\t\t\t\t<small class=\"text-muted\">Tutarları değiştirdikten sonra kaydetmeyi unutmayın!</small>\r\n+\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-success btn-sm\" id=\"yeniTahsilatEkle\" onclick=\"yeniTahsilatEkle()\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-plus mr-1\"></i>Yeni Tahsilat Ekle\r\n+\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t<small class=\"text-muted ml-3\">Tutarları değiştirdikten sonra kaydetmeyi unutmayın!</small>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t\t<div>\r\n \t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\" id=\"kaydetTahsilat\" onclick=\"kaydetTutarDegisiklikleri()\" style=\"display: none;\">\r\n \t\t\t\t\t\t\t<i class=\"fa fa-save\"></i> Kaydet\r\n@@ -1259,13 +1262,14 @@\n \t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t<table class=\"table table-bordered\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"40%\">Stok Adı</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"15%\">Miktar</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"25%\">Birim Fiyat (KDV Dahil)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"15%\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"30%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"12%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\">Görsel</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"13%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n \t\t\t\t`;\r\n@@ -1388,8 +1392,11 @@\n \t\t\t\t\t<option value=\"18\" ${(data.satisStok_kdv || 0) == 18 ? 'selected' : ''}>%18</option>\r\n \t\t\t\t\t<option value=\"20\" ${(data.satisStok_kdv || 0) == 20 ? 'selected' : ''}>%20</option>\r\n \t\t\t\t</select>\r\n \t\t\t</td>\r\n+\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t${generateStokGorselButton(data)}\r\n+\t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-danger btn-sm\" onclick=\"stokSatiriSil(this)\" \r\n \t\t\t\t\t\ttitle=\"Satırı sil\">\r\n \t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n@@ -1635,8 +1642,9 @@\n \t\t\t\t\t\t\t\t\t<th>Tahsilat Tipi</th>\r\n \t\t\t\t\t\t\t\t\t<th>Tutar</th>\r\n \t\t\t\t\t\t\t\t\t<th>Açıklama</th>\r\n \t\t\t\t\t\t\t\t\t<th>Görsel</th>\r\n+\t\t\t\t\t\t\t\t\t<th>İşlemler</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody>\r\n \t\t\t\t`;\r\n@@ -1665,8 +1673,13 @@\n \t\t\t\t\t\t\t<td>${item.aciklama || '-'}</td>\r\n \t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t${generateGorselButton(item)}\r\n \t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t<button class=\"btn btn-danger btn-sm\" onclick=\"tahsilatSil('${item.unique_id}', '${item.tip_kod}', '${item.source_id}')\" title=\"Tahsilatı Sil\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t</tr>\r\n \t\t\t\t\t`;\r\n \t\t\t\t});\r\n \t\t\t\t\r\n@@ -1677,8 +1690,9 @@\n \t\t\t\t\t\t\t\t\t<th colspan=\"3\">TOPLAM</th>\r\n \t\t\t\t\t\t\t\t\t<th class=\"text-right\" id=\"tahsilat-toplam\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n+\t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</tfoot>\r\n \t\t\t\t\t\t</table>\r\n \t\t\t\t\t</div>\r\n@@ -1765,8 +1779,39 @@\n \t\r\n \treturn html;\r\n }\r\n \r\n+// Stok görsel butonu oluşturma fonksiyonu\r\n+function generateStokGorselButton(data) {\r\n+\tif (!data || !data.satisStok_id) {\r\n+\t\treturn '<span class=\"badge badge-secondary\">Henüz kaydedilmemiş</span>';\r\n+\t}\r\n+\t\r\n+\tlet html = '';\r\n+\tlet gorselSayisi = 0;\r\n+\t\r\n+\t// Stok görsellerini kontrol et (varsa)\r\n+\tif (data.stok_gorselleri && data.stok_gorselleri.length > 0) {\r\n+\t\tgorselSayisi = data.stok_gorselleri.length;\r\n+\t\t\r\n+\t\t// Görsel galerisi butonu\r\n+\t\thtml += `\r\n+\t\t\t<button class=\"btn btn-sm btn-success\" onclick=\"showStokGorselGaleri('${data.satisStok_id}', '${data.stok_adi}', ${JSON.stringify(data.stok_gorselleri).replace(/\"/g, '&quot;')})\">\r\n+\t\t\t\t<i class=\"fa fa-images\"></i> (${gorselSayisi})\r\n+\t\t\t</button>\r\n+\t\t`;\r\n+\t}\r\n+\t\r\n+\t// Her zaman yükleme butonu göster\r\n+\thtml += `\r\n+\t\t<button class=\"btn btn-sm btn-primary ${gorselSayisi > 0 ? 'ml-1' : ''}\" onclick=\"uploadStokGorsel('${data.satisStok_id}', '${data.stok_adi || 'Stok'}')\">\r\n+\t\t\t<i class=\"fa fa-upload\"></i> ${gorselSayisi > 0 ? 'Ekle' : 'Yükle'}\r\n+\t\t</button>\r\n+\t`;\r\n+\t\r\n+\treturn html;\r\n+}\r\n+\r\n // Görsel gösterme fonksiyonu\r\n function showGorsel(gorselUrl, tahsilatTipi) {\r\n \t$('#gorselModalTitle').text(tahsilatTipi + ' Görseli');\r\n \t$('#gorselModalImage').attr('src', gorselUrl);\r\n@@ -2406,8 +2451,354 @@\n \t\t\t'</button>' +\r\n \t\t\t'</div>'\r\n \t\t);\r\n \t<?php endif; ?>\r\n+\t\r\n+// Tahsilat silme fonksiyonu\r\n+window.tahsilatSil = function(uniqueId, tipKod, sourceId) {\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Tahsilat Silme Onayı',\r\n+\t\ttext: 'Bu tahsilat kaydını silmek istediğinizden emin misiniz?',\r\n+\t\ticon: 'warning',\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: '#d33',\r\n+\t\tcancelButtonColor: '#3085d6',\r\n+\t\tconfirmButtonText: 'Evet, Sil',\r\n+\t\tcancelButtonText: 'İptal'\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/tahsilatSil\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: {\r\n+\t\t\t\t\tunique_id: uniqueId,\r\n+\t\t\t\t\ttip_kod: tipKod,\r\n+\t\t\t\t\tsource_id: sourceId\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire('Silindi!', 'Tahsilat kaydı başarıyla silindi.', 'success');\r\n+\t\t\t\t\t\t// Tahsilat listesini yenile\r\n+\t\t\t\t\t\tconst cariId = $('#tahsilatModal').data('cari-id');\r\n+\t\t\t\t\t\tconst cariAd = $('#tahsilatModal').data('cari-ad');\r\n+\t\t\t\t\t\tshowTahsilatModal(cariId, cariAd);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire('Hata!', response.message || 'Tahsilat silinirken hata oluştu.', 'error');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function() {\r\n+\t\t\t\t\tSwal.fire('Hata!', 'Tahsilat silinirken beklenmeyen bir hata oluştu.', 'error');\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+};\r\n+\r\n+// Yeni tahsilat ekleme fonksiyonu\r\n+window.yeniTahsilatEkle = function() {\r\n+\tconsole.log('yeniTahsilatEkle fonksiyonu çağrıldı');\r\n+\tconst cariId = $('#tahsilatModal').data('cari-id');\r\n+\tconst cariAd = $('#tahsilatModal').data('cari-ad');\r\n+\t\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Yeni Tahsilat Ekle',\r\n+\t\thtml: `\r\n+\t\t\t<div class=\"form-group text-left\">\r\n+\t\t\t\t<label for=\"tahsilatTipi\">Tahsilat Tipi:</label>\r\n+\t\t\t\t<select id=\"tahsilatTipi\" class=\"form-control\">\r\n+\t\t\t\t\t<option value=\"1\">Banka/Pos</option>\r\n+\t\t\t\t\t<option value=\"2\">Çek</option>\r\n+\t\t\t\t\t<option value=\"3\">Kasa/Nakit</option>\r\n+\t\t\t\t\t<option value=\"4\">Senet</option>\r\n+\t\t\t\t</select>\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"form-group text-left\">\r\n+\t\t\t\t<label for=\"tahsilatTutar\">Tutar:</label>\r\n+\t\t\t\t<input type=\"number\" id=\"tahsilatTutar\" class=\"form-control\" step=\"0.01\" min=\"0\" placeholder=\"0.00\">\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"form-group text-left\">\r\n+\t\t\t\t<label for=\"tahsilatTarih\">Tarih:</label>\r\n+\t\t\t\t<input type=\"date\" id=\"tahsilatTarih\" class=\"form-control\" value=\"${new Date().toISOString().split('T')[0]}\">\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"form-group text-left\">\r\n+\t\t\t\t<label for=\"tahsilatBelgeNo\">Belge No:</label>\r\n+\t\t\t\t<input type=\"text\" id=\"tahsilatBelgeNo\" class=\"form-control\" placeholder=\"Belge numarası (opsiyonel)\">\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"form-group text-left\">\r\n+\t\t\t\t<label for=\"tahsilatAciklama\">Açıklama:</label>\r\n+\t\t\t\t<textarea id=\"tahsilatAciklama\" class=\"form-control\" rows=\"2\" placeholder=\"Açıklama (opsiyonel)\"></textarea>\r\n+\t\t\t</div>\r\n+\t\t`,\r\n+\t\twidth: 500,\r\n+\t\tconfirmButtonText: 'Ekle',\r\n+\t\tshowCancelButton: true,\r\n+\t\tcancelButtonText: 'İptal',\r\n+\t\tpreConfirm: () => {\r\n+\t\t\tconst tipi = document.getElementById('tahsilatTipi').value;\r\n+\t\t\tconst tutar = document.getElementById('tahsilatTutar').value;\r\n+\t\t\tconst tarih = document.getElementById('tahsilatTarih').value;\r\n+\t\t\tconst belgeNo = document.getElementById('tahsilatBelgeNo').value;\r\n+\t\t\tconst aciklama = document.getElementById('tahsilatAciklama').value;\r\n+\t\t\t\r\n+\t\t\tif (!tutar || parseFloat(tutar) <= 0) {\r\n+\t\t\t\tSwal.showValidationMessage('Lütfen geçerli bir tutar girin');\r\n+\t\t\t\treturn false;\r\n+\t\t\t}\r\n+\t\t\tif (!tarih) {\r\n+\t\t\t\tSwal.showValidationMessage('Lütfen tarih girin');\r\n+\t\t\t\treturn false;\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\treturn {\r\n+\t\t\t\ttip_kod: tipi,\r\n+\t\t\t\ttutar: tutar,\r\n+\t\t\t\ttarih: tarih,\r\n+\t\t\t\tbelge_no: belgeNo,\r\n+\t\t\t\taciklama: aciklama,\r\n+\t\t\t\tcari_id: cariId\r\n+\t\t\t};\r\n+\t\t}\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/yeniTahsilatEkle\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: result.value,\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire('Başarılı!', 'Yeni tahsilat kaydı başarıyla eklendi.', 'success');\r\n+\t\t\t\t\t\t// Tahsilat listesini yenile\r\n+\t\t\t\t\t\tshowTahsilatModal(cariId, cariAd);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire('Hata!', response.message || 'Tahsilat eklenirken hata oluştu.', 'error');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function() {\r\n+\t\t\t\t\tSwal.fire('Hata!', 'Tahsilat eklenirken beklenmeyen bir hata oluştu.', 'error');\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+};\r\n+\r\n+// Stok görsel galeri fonksiyonu\r\n+window.showStokGorselGaleri = function(satisStokId, stokAdi, gorseller) {\r\n+\tlet html = `\r\n+\t\t<div class=\"container-fluid\">\r\n+\t\t\t<div class=\"row\">\r\n+\t`;\r\n+\t\r\n+\tgorseller.forEach(function(gorsel, index) {\r\n+\t\thtml += `\r\n+\t\t\t<div class=\"col-md-4 col-sm-6 mb-3\">\r\n+\t\t\t\t<div class=\"card\">\r\n+\t\t\t\t\t<div class=\"card-img-container\" style=\"height: 200px; overflow: hidden; position: relative;\">\r\n+\t\t\t\t\t\t${gorsel.dosya_adi.toLowerCase().endsWith('.pdf') ? \r\n+\t\t\t\t\t\t\t`<div class=\"d-flex align-items-center justify-content-center h-100 bg-light\">\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-file-pdf fa-3x text-danger\"></i>\r\n+\t\t\t\t\t\t\t\t<div class=\"ml-2\">\r\n+\t\t\t\t\t\t\t\t\t<small class=\"d-block\">PDF Dosyası</small>\r\n+\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">${gorsel.dosya_adi}</small>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>` :\r\n+\t\t\t\t\t\t\t`<img src=\"${gorsel.url}\" class=\"card-img-top\" style=\"height: 100%; object-fit: cover; cursor: pointer;\" \r\n+\t\t\t\t\t\t\t\t onclick=\"showGorsel('${gorsel.url}', '${stokAdi}')\" alt=\"Stok Görseli ${index + 1}\">`\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t<div class=\"card-footer p-2\">\r\n+\t\t\t\t\t\t<div class=\"d-flex justify-content-between align-items-center\">\r\n+\t\t\t\t\t\t\t<small class=\"text-muted\">${gorsel.dosya_adi}</small>\r\n+\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-danger\" onclick=\"stokGorselSil('${gorsel.id}', '${satisStokId}')\">\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t</div>\r\n+\t\t`;\r\n+\t});\r\n+\t\r\n+\thtml += `\r\n+\t\t\t</div>\r\n+\t\t\t<div class=\"row mt-3\">\r\n+\t\t\t\t<div class=\"col-md-12 text-center\">\r\n+\t\t\t\t\t<button class=\"btn btn-primary\" onclick=\"uploadStokGorsel('${satisStokId}', '${stokAdi}')\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-plus\"></i> Yeni Görsel Ekle\r\n+\t\t\t\t\t</button>\r\n+\t\t\t\t</div>\r\n+\t\t\t</div>\r\n+\t\t</div>\r\n+\t`;\r\n+\t\r\n+\tSwal.fire({\r\n+\t\ttitle: `${stokAdi} - Stok Görselleri`,\r\n+\t\thtml: html,\r\n+\t\twidth: '90%',\r\n+\t\tshowCloseButton: true,\r\n+\t\tshowConfirmButton: false\r\n+\t});\r\n+};\r\n+\r\n+// Stok görsel yükleme fonksiyonu\r\n+window.uploadStokGorsel = function(satisStokId, stokAdi) {\r\n+\tif (!satisStokId) {\r\n+\t\tSwal.fire('Hata!', 'Önce stok kaydını kaydetmelisiniz.', 'error');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\tSwal.fire({\r\n+\t\ttitle: `${stokAdi} - Görsel Yükle`,\r\n+\t\thtml: `\r\n+\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t<label>Görsel Dosyaları Seçin:</label>\r\n+\t\t\t\t<div class=\"custom-file\">\r\n+\t\t\t\t\t<input type=\"file\" class=\"custom-file-input\" id=\"stokGorselFile\" multiple accept=\"image/*,.pdf\">\r\n+\t\t\t\t\t<label class=\"custom-file-label\">Dosya(lar) seçin...</label>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t<small class=\"text-muted\">JPG, PNG veya PDF formatında dosyalar yükleyebilirsiniz.</small>\r\n+\t\t\t</div>\r\n+\t\t\t<div id=\"stokSelectedFiles\" style=\"display: none;\">\r\n+\t\t\t\t<h6>Seçilen Dosyalar:</h6>\r\n+\t\t\t\t<ul id=\"stokFileList\" class=\"list-unstyled\"></ul>\r\n+\t\t\t</div>\r\n+\t\t`,\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonText: 'Yükle',\r\n+\t\tcancelButtonText: 'İptal',\r\n+\t\tpreConfirm: () => {\r\n+\t\t\tconst files = document.getElementById('stokGorselFile').files;\r\n+\t\t\tif (files.length === 0) {\r\n+\t\t\t\tSwal.showValidationMessage('Lütfen en az bir dosya seçin');\r\n+\t\t\t\treturn false;\r\n+\t\t\t}\r\n+\t\t\treturn files;\r\n+\t\t}\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\tconst files = result.value;\r\n+\t\t\tconst formData = new FormData();\r\n+\t\t\t\r\n+\t\t\tformData.append('satisStok_id', satisStokId);\r\n+\t\t\tformData.append('stok_adi', stokAdi);\r\n+\t\t\t\r\n+\t\t\tfor (let i = 0; i < files.length; i++) {\r\n+\t\t\t\tformData.append('stok_gorseller[]', files[i]);\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/stokGorselYukle\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: formData,\r\n+\t\t\t\tprocessData: false,\r\n+\t\t\t\tcontentType: false,\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire('Başarılı!', 'Stok görselleri başarıyla yüklendi.', 'success');\r\n+\t\t\t\t\t\t// Stok bilgilerini yenile\r\n+\t\t\t\t\t\tconst satisId = $('#stokBilgisiModal').data('satisId');\r\n+\t\t\t\t\t\tconst cariId = $('#stokBilgisiModal').data('cariId');\r\n+\t\t\t\t\t\t// Modal'ı yeniden yükle\r\n+\t\t\t\t\t\t$('#stokBilgisiModal').modal('hide');\r\n+\t\t\t\t\t\tsetTimeout(() => {\r\n+\t\t\t\t\t\t\tconst cariIsletme = $('#stokBilgisiModalLabel').text().split(' - ')[1] || 'Stok Bilgileri';\r\n+\t\t\t\t\t\t\topenStokBilgisiModal(satisId, cariId, cariIsletme);\r\n+\t\t\t\t\t\t}, 500);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire('Hata!', response.message || 'Görsel yüklenirken hata oluştu.', 'error');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function() {\r\n+\t\t\t\t\tSwal.fire('Hata!', 'Görsel yüklenirken beklenmeyen bir hata oluştu.', 'error');\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t// Dosya seçimi değiştiğinde\r\n+\t$(document).off('change', '#stokGorselFile').on('change', '#stokGorselFile', function() {\r\n+\t\tconst files = this.files;\r\n+\t\tconst label = $(this).next('.custom-file-label');\r\n+\t\tconst selectedFiles = $('#stokSelectedFiles');\r\n+\t\tconst fileList = $('#stokFileList');\r\n+\t\t\r\n+\t\tif (files.length === 0) {\r\n+\t\t\tlabel.text('Dosya(lar) seçin...');\r\n+\t\t\tselectedFiles.hide();\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tif (files.length === 1) {\r\n+\t\t\tlabel.text(files[0].name);\r\n+\t\t} else {\r\n+\t\t\tlabel.text(files.length + ' dosya seçildi');\r\n+\t\t}\r\n+\t\t\r\n+\t\t// Seçilen dosyaları listele\r\n+\t\tfileList.empty();\r\n+\t\tfor (let i = 0; i < files.length; i++) {\r\n+\t\t\tconst file = files[i];\r\n+\t\t\tconst fileSize = (file.size / 1024 / 1024).toFixed(2); // MB\r\n+\t\t\tconst fileType = file.type.startsWith('image/') ? 'Resim' : (file.type === 'application/pdf' ? 'PDF' : 'Dosya');\r\n+\t\t\t\r\n+\t\t\tfileList.append(`\r\n+\t\t\t\t<li class=\"border rounded p-2 mb-1 bg-light\">\r\n+\t\t\t\t\t<i class=\"fa fa-${file.type.startsWith('image/') ? 'image' : 'file-pdf'} text-${file.type.startsWith('image/') ? 'success' : 'danger'} mr-2\"></i>\r\n+\t\t\t\t\t<strong>${file.name}</strong>\r\n+\t\t\t\t\t<small class=\"text-muted ml-2\">(${fileType}, ${fileSize} MB)</small>\r\n+\t\t\t\t</li>\r\n+\t\t\t`);\r\n+\t\t}\r\n+\t\t\r\n+\t\tselectedFiles.show();\r\n+\t});\r\n+};\r\n+\r\n+// Stok görsel silme fonksiyonu\r\n+// Stok görsel silme fonksiyonu\r\n+window.stokGorselSil = function(gorselId, satisStokId) {\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Görsel Silme Onayı',\r\n+\t\ttext: 'Bu görseli silmek istediğinizden emin misiniz?',\r\n+\t\ticon: 'warning',\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: '#d33',\r\n+\t\tcancelButtonColor: '#3085d6',\r\n+\t\tconfirmButtonText: 'Evet, Sil',\r\n+\t\tcancelButtonText: 'İptal'\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/stokGorselSil\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: {\r\n+\t\t\t\t\tgorsel_id: gorselId,\r\n+\t\t\t\t\tsatisStok_id: satisStokId\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire('Silindi!', 'Görsel başarıyla silindi.', 'success');\r\n+\t\t\t\t\t\t// Modal'ı kapat ve stok bilgilerini yenile\r\n+\t\t\t\t\t\tSwal.close();\r\n+\t\t\t\t\t\tconst satisId = $('#stokBilgisiModal').data('satisId');\r\n+\t\t\t\t\t\tconst cariId = $('#stokBilgisiModal').data('cariId');\r\n+\t\t\t\t\t\t// Modal'ı yeniden yükle\r\n+\t\t\t\t\t\tconst cariIsletme = $('#stokBilgisiModalLabel').text().split(' - ')[1] || 'Stok Bilgileri';\r\n+\t\t\t\t\t\topenStokBilgisiModal(satisId, cariId, cariIsletme);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire('Hata!', response.message || 'Görsel silinirken hata oluştu.', 'error');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function() {\r\n+\t\t\t\t\tSwal.fire('Hata!', 'Görsel silinirken beklenmeyen bir hata oluştu.', 'error');\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+};\r\n+\r\n });\r\n </script>\r\n \r\n </body>\r\n"
                },
                {
                    "date": 1756562515642,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1376,9 +1376,9 @@\n \t\t\t\t\t   onchange=\"hesaplaToplamTutar()\">\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<input type=\"number\" class=\"form-control birimFiyat\" name=\"birimFiyat[]\" \r\n-\t\t\t\t\t   value=\"${data.satisStok_birimFiyat || 0}\" min=\"0\" step=\"0.01\" \r\n+\t\t\t\t\t   value=\"${data.satisStok_fiyatMiktar || 0}\" min=\"0\" step=\"0.01\" \r\n \t\t\t\t\t   placeholder=\"KDV dahil fiyat\"\r\n \t\t\t\t\t   title=\"KDV dahil birim fiyat giriniz\"\r\n \t\t\t\t\t   onchange=\"hesaplaToplamTutar(); updateKdvBreakdown(this);\"\r\n \t\t\t\t\t   onkeyup=\"updateKdvBreakdown(this);\">\r\n"
                },
                {
                    "date": 1756721246056,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -97,8 +97,62 @@\n \t\t.card-stats .card-body {\r\n \t\t\tpadding: 1.5rem;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Satış detayları akordiyon stilleri */\r\n+\t\t.satis-detaylar {\r\n+\t\t\tbackground-color: #f8f9fa;\r\n+\t\t\tborder: 1px solid #dee2e6;\r\n+\t\t\tborder-radius: 0.375rem;\r\n+\t\t\tpadding: 0.75rem;\r\n+\t\t\tmargin-top: 0.5rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-card {\r\n+\t\t\tborder: 1px solid #e3f2fd;\r\n+\t\t\tbackground-color: #fafafa;\r\n+\t\t\ttransition: box-shadow 0.2s ease;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-card:hover {\r\n+\t\t\tbox-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-tutar-container,\r\n+\t\t.satis-hizmet-container {\r\n+\t\t\tposition: relative;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-detaylar-liste {\r\n+\t\t\tmax-height: 300px;\r\n+\t\t\toverflow-y: auto;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* Akordiyon butonu stilleri */\r\n+\t\t.btn-outline-primary:focus,\r\n+\t\t.btn-outline-info:focus {\r\n+\t\t\tbox-shadow: none;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* Scroll bar özelleştirmesi */\r\n+\t\t.satis-detaylar-liste::-webkit-scrollbar {\r\n+\t\t\twidth: 6px;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-detaylar-liste::-webkit-scrollbar-track {\r\n+\t\t\tbackground: #f1f1f1;\r\n+\t\t\tborder-radius: 3px;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-detaylar-liste::-webkit-scrollbar-thumb {\r\n+\t\t\tbackground: #c1c1c1;\r\n+\t\t\tborder-radius: 3px;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-detaylar-liste::-webkit-scrollbar-thumb:hover {\r\n+\t\t\tbackground: #a8a8a8;\r\n+\t\t}\r\n+\t\t\r\n \t\t.stats-number {\r\n \t\t\tfont-size: 2rem;\r\n \t\t\tfont-weight: bold;\r\n \t\t\tmargin-bottom: 0.5rem;\r\n@@ -595,28 +649,55 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"satis-tutar-container\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->toplam_satis_sayisi) && $veri->toplam_satis_sayisi > 1): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-outline-primary ml-2\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"toggleSatisDetaylar(<?= $veri->cari_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"toggle-btn-<?= $veri->cari_id ?>\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"<?= $veri->toplam_satis_sayisi ?> satış var - detayları göster/gizle\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-plus\"></i> <?= $veri->toplam_satis_sayisi ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- Akordiyon içerik alanı (başlangıçta gizli) -->\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"satis-detaylar-<?= $veri->cari_id ?>\" class=\"satis-detaylar mt-2\" style=\"display: none;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-spinner fa-spin text-primary\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"ml-1\">Satışlar yükleniyor...</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-link text-decoration-none p-1 border-0\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"openStokBilgisiModal(<?= $veri->satis_sozlesme_id ?>, <?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme, ENT_QUOTES) ?>')\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Stok bilgilerini görüntüle ve düzenle (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: pointer; color: #28a745; background: none;\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-boxes mr-1\"></i>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tStok Bilgileri\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"satis-hizmet-container\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-link text-decoration-none p-1 border-0\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"openStokBilgisiModal(<?= $veri->satis_sozlesme_id ?>, <?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme, ENT_QUOTES) ?>')\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Stok bilgilerini görüntüle ve düzenle (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: pointer; color: #28a745; background: none;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-boxes mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tStok Bilgileri\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-edit ml-1\" style=\"font-size: 0.8em;\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->toplam_satis_sayisi) && $veri->toplam_satis_sayisi > 1): ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-outline-info mt-1\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"toggleSatisDetaylar(<?= $veri->cari_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Bu cariye ait tüm hizmetleri göster/gizle\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-list\"></i> Tümü\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-edit ml-1\" style=\"font-size: 0.8em;\"></i>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-success\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n@@ -2798,8 +2879,105 @@\n \t});\r\n };\r\n \r\n });\r\n+\r\n+// Satış detaylarını akordiyon şeklinde açma/kapama (Global scope)\r\n+window.toggleSatisDetaylar = function(cari_id) {\r\n+\tconst detayDiv = document.getElementById('satis-detaylar-' + cari_id);\r\n+\tconst toggleBtn = document.getElementById('toggle-btn-' + cari_id);\r\n+\tconst icon = toggleBtn.querySelector('i');\r\n+\t\r\n+\tif (detayDiv.style.display === 'none' || detayDiv.style.display === '') {\r\n+\t\t// Açılıyor\r\n+\t\tif (!detayDiv.dataset.loaded) {\r\n+\t\t\t// İlk kez yükleniyorsa AJAX ile veri getir\r\n+\t\t\twindow.loadSatisDetaylar(cari_id);\r\n+\t\t}\r\n+\t\tdetayDiv.style.display = 'block';\r\n+\t\ticon.className = 'fa fa-minus';\r\n+\t\ttoggleBtn.title = 'Satış detaylarını gizle';\r\n+\t\t\r\n+\t\t// Smooth açılış efekti\r\n+\t\t$(detayDiv).slideDown(300);\r\n+\t} else {\r\n+\t\t// Kapanıyor\r\n+\t\t$(detayDiv).slideUp(300, function() {\r\n+\t\t\tdetayDiv.style.display = 'none';\r\n+\t\t});\r\n+\t\ticon.className = 'fa fa-plus';\r\n+\t\ttoggleBtn.title = 'Satış detaylarını göster';\r\n+\t}\r\n+}\r\n+\r\n+// AJAX ile satış detaylarını yükle (Global scope)\r\n+window.loadSatisDetaylar = function(cari_id) {\r\n+\tconst detayDiv = document.getElementById('satis-detaylar-' + cari_id);\r\n+\t\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/testSatisList\") ?>',\r\n+\t\ttype: 'POST',\r\n+\t\tdata: { cari_id: cari_id },\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tif (response.success) {\r\n+\t\t\t\tlet html = '<div class=\"satis-detaylar-liste\">';\r\n+\t\t\t\t\r\n+\t\t\t\tresponse.satislar.forEach(function(satis, index) {\r\n+\t\t\t\t\thtml += `\r\n+\t\t\t\t\t\t<div class=\"card mb-2 satis-card\">\r\n+\t\t\t\t\t\t\t<div class=\"card-body p-2\">\r\n+\t\t\t\t\t\t\t\t<div class=\"row align-items-center\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Satış ${index + 1}</small><br>\r\n+\t\t\t\t\t\t\t\t\t\t<strong class=\"text-success\">${satis.satis_sozlesme_tutari || '0'} TL</strong>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Hizmet</small><br>\r\n+\t\t\t\t\t\t\t\t\t\t<span class=\"text-info\">${satis.satis_sozlesme_hizmet || 'Belirtilmemiş'}</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Tarih</small><br>\r\n+\t\t\t\t\t\t\t\t\t\t<span>${satis.tarih || 'Bilinmeyen'}</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"col-md-2 text-right\">\r\n+\t\t\t\t\t\t\t\t\t\t${satis.gorsel_sayisi > 0 ? `\r\n+\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-outline-info\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\") ?>${cari_id}?tip=satis&satis_id=${satis.satis_id}', 'satisGorsel', 'width=800,height=600,scrollbars=yes,resizable=yes')\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"${satis.gorsel_sayisi} görsel\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image\"></i> ${satis.gorsel_sayisi}\r\n+\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t` : '<span class=\"text-muted small\">Görsel yok</span>'}\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t`;\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\thtml += '</div>';\r\n+\t\t\t\tdetayDiv.innerHTML = html;\r\n+\t\t\t\tdetayDiv.dataset.loaded = 'true';\r\n+\t\t\t} else {\r\n+\t\t\t\tdetayDiv.innerHTML = `\r\n+\t\t\t\t\t<div class=\"alert alert-warning alert-sm\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-exclamation-triangle\"></i> \r\n+\t\t\t\t\t\t${response.message || 'Satışlar yüklenirken bir hata oluştu.'}\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`;\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function() {\r\n+\t\t\tdetayDiv.innerHTML = `\r\n+\t\t\t\t<div class=\"alert alert-danger alert-sm\">\r\n+\t\t\t\t\t<i class=\"fa fa-exclamation-circle\"></i> \r\n+\t\t\t\t\tSatışlar yüklenirken bir hata oluştu. Lütfen tekrar deneyin.\r\n+\t\t\t\t</div>\r\n+\t\t\t`;\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1756809260195,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,11 @@\n \t<title>Tam Ana Rapor | İlekaSoft CRM</title>\r\n \t<link rel=\"icon\" type=\"image/x-icon\" href=\"<?= base_url('assets/favicon.ico'); ?>\" />\r\n \t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/css/dataTables.bootstrap4.min.css\"/>\r\n \t<link rel=\"stylesheet\" href=\"https://code.jquery.com/ui/1.13.2/themes/ui-lightness/jquery-ui.css\"/>\r\n+\t<!-- Select2 CSS -->\r\n+\t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css\"/>\r\n+\t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css\"/>\r\n \t<!-- SweetAlert2 CSS -->\r\n \t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css\">\r\n \t\r\n \t<style>\r\n@@ -97,8 +100,40 @@\n \t\t.card-stats .card-body {\r\n \t\t\tpadding: 1.5rem;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Select2 Stok Dropdown Özelleştirmeleri */\r\n+\t\t.select2-container--bootstrap-5 .select2-selection {\r\n+\t\t\tborder: 1px solid #ced4da !important;\r\n+\t\t\tborder-radius: 0.375rem !important;\r\n+\t\t\tmin-height: calc(1.5em + 0.75rem + 2px) !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.select2-container--bootstrap-5 .select2-selection--single {\r\n+\t\t\tline-height: calc(1.5em + 0.75rem) !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered {\r\n+\t\t\tpadding-left: 0.75rem !important;\r\n+\t\t\tpadding-right: 2rem !important;\r\n+\t\t\tcolor: #495057 !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.select2-container--bootstrap-5 .select2-dropdown {\r\n+\t\t\tborder-color: #ced4da !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.select2-container--bootstrap-5 .select2-results__option--highlighted[aria-selected] {\r\n+\t\t\tbackground-color: #007bff !important;\r\n+\t\t\tcolor: #fff !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.select2-container--bootstrap-5.select2-container--focus .select2-selection {\r\n+\t\t\tborder-color: #80bdff !important;\r\n+\t\t\tbox-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25) !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t\r\n \t\t/* Satış detayları akordiyon stilleri */\r\n \t\t.satis-detaylar {\r\n \t\t\tbackground-color: #f8f9fa;\r\n \t\t\tborder: 1px solid #dee2e6;\r\n@@ -1060,8 +1095,10 @@\n <script src=\"https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js\"></script>\r\n <script src=\"https://code.jquery.com/ui/1.13.2/jquery-ui.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js\"></script>\r\n <script src=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/js/dataTables.bootstrap4.min.js\"></script>\r\n+<!-- Select2 JS -->\r\n+<script src=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js\"></script>\r\n \r\n <script>\r\n $(document).ready(function() {\r\n \t// DataTable başlat\r\n@@ -1437,20 +1474,11 @@\n \t\t<tr data-index=\"${index}\">\r\n \t\t\t<td>\r\n \t\t\t\t<input type=\"hidden\" name=\"stokId[]\" value=\"${data.stok_id || ''}\" class=\"stokId\">\r\n \t\t\t\t<input type=\"hidden\" name=\"satisStokId[]\" value=\"${data.satisStok_id || ''}\" class=\"satisStokId\">\r\n-\t\t\t\t<div class=\"input-group\">\r\n-\t\t\t\t\t<input type=\"text\" class=\"form-control stokAdi\" name=\"stokAdi[]\" \r\n-\t\t\t\t\t\t   value=\"${data.stok_adi || ''}\" \r\n-\t\t\t\t\t\t   placeholder=\"Stok adı ara (en az 2 karakter)...\"\r\n-\t\t\t\t\t\t   title=\"Stok arama için en az 2 karakter yazın\">\r\n-\t\t\t\t\t<div class=\"input-group-append\">\r\n-\t\t\t\t\t\t<span class=\"input-group-text\">\r\n-\t\t\t\t\t\t\t<i class=\"fa fa-search\" title=\"Stok ara\"></i>\r\n-\t\t\t\t\t\t</span>\r\n-\t\t\t\t\t</div>\r\n-\t\t\t\t</div>\r\n-\t\t\t\t${data.stok_kodu ? `<small class=\"text-muted\">Kod: ${data.stok_kodu}</small>` : ''}\r\n+\t\t\t\t<select class=\"form-control stokDropdown\" name=\"stokAdi[]\" style=\"width: 100%;\">\r\n+\t\t\t\t\t${data.stok_adi ? `<option value=\"${data.stok_id}\" selected>${data.stok_adi}${data.stok_kodu ? ' (Kod: ' + data.stok_kodu + ')' : ''}</option>` : '<option value=\"\">Stok seçiniz...</option>'}\r\n+\t\t\t\t</select>\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<input type=\"number\" class=\"form-control miktar\" name=\"miktar[]\" \r\n \t\t\t\t\t   value=\"${data.satisStok_miktar || 1}\" min=\"1\" step=\"0.01\" \r\n@@ -1493,16 +1521,16 @@\n \tconst newIndex = tbody.children.length;\r\n \tconst newRow = createStokRow(newIndex, {});\r\n \ttbody.insertAdjacentHTML('beforeend', newRow);\r\n \t\r\n-\t// Yeni satır için autocomplete başlat\r\n+\t// Yeni satır için dropdown'u başlat\r\n \tinitStokAutocomplete();\r\n \t\r\n-\t// Yeni satırdaki input'a focus ver\r\n+\t// Yeni satırdaki dropdown'u aç\r\n \tconst newRowElement = tbody.lastElementChild;\r\n-\tconst stokAdiInput = newRowElement.querySelector('.stokAdi');\r\n-\tif (stokAdiInput) {\r\n-\t\tstokAdiInput.focus();\r\n+\tconst stokDropdown = newRowElement.querySelector('.stokDropdown');\r\n+\tif (stokDropdown) {\r\n+\t\t$(stokDropdown).select2('open');\r\n \t}\r\n }\r\n \r\n // Stok satırı sil\r\n@@ -1551,76 +1579,124 @@\n \t\tbreakdownElement.innerHTML = '';\r\n \t}\r\n }\r\n \r\n-// Stok autocomplete başlat\r\n+// Stok dropdown başlat\r\n function initStokAutocomplete() {\r\n-\t$('.stokAdi').each(function() {\r\n-\t\t$(this).autocomplete({\r\n-\t\t\tsource: function(request, response) {\r\n-\t\t\t\t$.ajax({\r\n-\t\t\t\t\turl: '<?= base_url(\"stok_arama_endpoint.php\") ?>',\r\n-\t\t\t\t\tdata: { term: request.term },\r\n-\t\t\t\t\tdataType: 'json',\r\n-\t\t\t\t\tbeforeSend: function() {\r\n-\t\t\t\t\t\t// Loading göstergesi ekle\r\n-\t\t\t\t\t\t$('.ui-autocomplete').html('<li class=\"ui-menu-item\"><div class=\"ui-menu-item-wrapper\"><i class=\"fa fa-spinner fa-spin\"></i> Aranıyor...</div></li>');\r\n-\t\t\t\t\t},\r\n-\t\t\t\t\tsuccess: function(data) {\r\n-\t\t\t\t\t\tresponse(data);\r\n-\t\t\t\t\t},\r\n-\t\t\t\t\terror: function() {\r\n-\t\t\t\t\t\tresponse([]);\r\n-\t\t\t\t\t\tconsole.log('Stok arama hatası');\r\n+\tconsole.log('initStokAutocomplete çağrıldı');\r\n+\t\r\n+\t$('.stokDropdown').each(function() {\r\n+\t\tconsole.log('Dropdown işleniyor:', this);\r\n+\t\t\r\n+\t\t// Eğer zaten Select2 uygulanmışsa, yeniden uygulama\r\n+\t\tif ($(this).data('select2')) {\r\n+\t\t\tconsole.log('Mevcut Select2 yok ediliyor');\r\n+\t\t\t$(this).select2('destroy');\r\n+\t\t}\r\n+\t\t\r\n+\t\t$(this).select2({\r\n+\t\t\ttheme: 'bootstrap-5',\r\n+\t\t\twidth: '100%',\r\n+\t\t\tplaceholder: 'Stok seçiniz...',\r\n+\t\t\tallowClear: true,\r\n+\t\t\tajax: {\r\n+\t\t\t\turl: '<?= base_url('index.php/Muhasebe/stok_dropdown') ?>', // Controller method URL\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tdelay: 250,\r\n+\t\t\t\tdata: function (params) {\r\n+\t\t\t\t\tconsole.log('AJAX İstek parametreleri:', params);\r\n+\t\t\t\t\treturn {\r\n+\t\t\t\t\t\tq: params.term, // arama terimi\r\n+\t\t\t\t\t\tpage: params.page || 1\r\n+\t\t\t\t\t};\r\n+\t\t\t\t},\r\n+\t\t\t\tprocessResults: function (data, params) {\r\n+\t\t\t\t\tconsole.log('AJAX Yanıtı alındı:', data);\r\n+\t\t\t\t\tparams.page = params.page || 1;\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tif (data.error) {\r\n+\t\t\t\t\t\tconsole.error('API Hatası:', data.error);\r\n \t\t\t\t\t}\r\n-\t\t\t\t});\r\n+\t\t\t\t\t\r\n+\t\t\t\t\treturn {\r\n+\t\t\t\t\t\tresults: data.results || [],\r\n+\t\t\t\t\t\tpagination: {\r\n+\t\t\t\t\t\t\tmore: data.pagination && data.pagination.more\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t};\r\n+\t\t\t\t},\r\n+\t\t\t\tcache: true,\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('AJAX Hatası:', {xhr, status, error});\r\n+\t\t\t\t\tconsole.error('Yanıt Metni:', xhr.responseText);\r\n+\t\t\t\t}\r\n \t\t\t},\r\n-\t\t\tminLength: 2,\r\n-\t\t\tdelay: 300, // 300ms gecikme ekle\r\n-\t\t\tselect: function(event, ui) {\r\n-\t\t\t\tconsole.log('Stok selected:', ui.item);\r\n+\t\t\tminimumInputLength: 0, // Dropdown açıldığında tüm stokları göster\r\n+\t\t\tescapeMarkup: function (markup) { \r\n+\t\t\t\treturn markup; \r\n+\t\t\t},\r\n+\t\t\ttemplateResult: function(data) {\r\n+\t\t\t\tif (data.loading) return data.text;\r\n+\t\t\t\treturn data.text;\r\n+\t\t\t},\r\n+\t\t\ttemplateSelection: function(data) {\r\n+\t\t\t\treturn data.text || data.id;\r\n+\t\t\t}\r\n+\t\t}).on('select2:select', function (e) {\r\n+\t\t\tconst selectedData = e.params.data;\r\n+\t\t\tconsole.log('Stok seçildi:', selectedData);\r\n+\t\t\t\r\n+\t\t\tif (selectedData.stok_data) {\r\n \t\t\t\tconst row = $(this).closest('tr');\r\n+\t\t\t\tconst stokData = selectedData.stok_data;\r\n \t\t\t\t\r\n-\t\t\t\t// Stok bilgilerini doldur\r\n-\t\t\t\trow.find('.stokId').val(ui.item.stok_id);\r\n+\t\t\t\t// Stok ID'yi gizli alana kaydet\r\n+\t\t\t\trow.find('.stokId').val(stokData.stok_id);\r\n+\t\t\t\tconsole.log('Stok ID ayarlandı:', stokData.stok_id);\r\n \t\t\t\t\r\n \t\t\t\t// KDV oranını önce ayarla\r\n \t\t\t\tconst kdvSelect = row.find('.kdvOrani');\r\n-\t\t\t\tconst kdvOrani = ui.item.stok_satisKDV || 20;\r\n+\t\t\t\tconst kdvOrani = stokData.stok_satisKDV || 20;\r\n \t\t\t\tkdvSelect.val(kdvOrani);\r\n+\t\t\t\tconsole.log('KDV ayarlandı:', kdvOrani);\r\n \t\t\t\t\r\n \t\t\t\t// Satış fiyatını KDV dahil olarak hesapla\r\n-\t\t\t\tconst satisFiyatiKdvHaric = parseFloat(ui.item.stok_satisFiyati) || 0;\r\n+\t\t\t\tconst satisFiyatiKdvHaric = parseFloat(stokData.stok_satisFiyati) || 0;\r\n \t\t\t\tconst kdvCarpani = 1 + (kdvOrani / 100);\r\n \t\t\t\tconst satisFiyatiKdvDahil = satisFiyatiKdvHaric * kdvCarpani;\r\n \t\t\t\t\r\n \t\t\t\trow.find('.birimFiyat').val(satisFiyatiKdvDahil.toFixed(2));\r\n+\t\t\t\tconsole.log('Birim fiyat ayarlandı:', satisFiyatiKdvDahil.toFixed(2));\r\n \t\t\t\t\r\n \t\t\t\t// KDV ayrıştırmasını güncelle\r\n \t\t\t\tupdateKdvBreakdown(row.find('.birimFiyat')[0]);\r\n \t\t\t\t\r\n-\t\t\t\t// Stok kodu göster\r\n-\t\t\t\tlet stokKoduHtml = ui.item.stok_kodu ? \r\n-\t\t\t\t\t`<small class=\"text-muted\">Kod: ${ui.item.stok_kodu}</small>` : '';\r\n-\t\t\t\trow.find('td:first .input-group').next('small').remove();\r\n-\t\t\t\tif (stokKoduHtml) {\r\n-\t\t\t\t\trow.find('td:first .input-group').after(stokKoduHtml);\r\n-\t\t\t\t}\r\n-\t\t\t\t\r\n+\t\t\t\t// Toplam tutarı yeniden hesapla\r\n \t\t\t\thesaplaToplamTutar();\r\n-\t\t\t\treturn false; // Input değerini manuel olarak ayarladık\r\n-\t\t\t},\r\n-\t\t\tfocus: function(event, ui) {\r\n-\t\t\t\t// Focus'ta input değerini değiştirme\r\n-\t\t\t\treturn false;\r\n \t\t\t}\r\n-\t\t}).focus(function() {\r\n-\t\t\t// Focus'ta minimum karakter sayısını karşılıyorsa arama yap\r\n-\t\t\tif ($(this).val().length >= 2) {\r\n-\t\t\t\t$(this).autocomplete('search', $(this).val());\r\n-\t\t\t}\r\n+\t\t}).on('select2:clear', function (e) {\r\n+\t\t\tconsole.log('Select2 temizlendi');\r\n+\t\t\t// Temizlendiğinde ilgili alanları da temizle\r\n+\t\t\tconst row = $(this).closest('tr');\r\n+\t\t\trow.find('.stokId').val('');\r\n+\t\t\trow.find('.birimFiyat').val('0');\r\n+\t\t\trow.find('.kdvOrani').val('20');\r\n+\t\t\t\r\n+\t\t\t// KDV ayrıştırmasını temizle\r\n+\t\t\trow.find('.kdv-breakdown').html('');\r\n+\t\t\t\r\n+\t\t\t// Toplam tutarı yeniden hesapla\r\n+\t\t\thesaplaToplamTutar();\r\n+\t\t}).on('select2:open', function (e) {\r\n+\t\t\tconsole.log('Select2 açıldı');\r\n+\t\t}).on('select2:opening', function (e) {\r\n+\t\t\tconsole.log('Select2 açılıyor...');\r\n \t\t});\r\n+\t\t\r\n+\t\tconsole.log('Dropdown için Select2 başlatıldı');\r\n \t});\r\n+\t\r\n+\tconsole.log('initStokAutocomplete tamamlandı');\r\n }\r\n \r\n // Stok bilgilerini kaydet\r\n $('#stokBilgisiKaydetBtn').click(function() {\r\n@@ -1630,24 +1706,26 @@\n \t\r\n \tconsole.log('Kaydet clicked with:', { satisId, cariId });\r\n \t\r\n \tdocument.querySelectorAll('#stokTableBody tr').forEach(function(row) {\r\n+\t\tconst stokDropdown = row.querySelector('.stokDropdown');\r\n+\t\tconst selectedOption = stokDropdown ? stokDropdown.options[stokDropdown.selectedIndex] : null;\r\n \t\tconst stokData = {\r\n \t\t\tsatisStok_id: row.querySelector('.satisStokId').value,\r\n \t\t\tstok_id: row.querySelector('.stokId').value,\r\n-\t\t\tstok_adi: row.querySelector('.stokAdi').value,\r\n+\t\t\tstok_adi: selectedOption ? selectedOption.text.split(' (')[0] : '', // Sadece stok adını al, kodu çıkar\r\n \t\t\tmiktar: row.querySelector('.miktar').value,\r\n \t\t\tbirim_fiyat: row.querySelector('.birimFiyat').value,\r\n \t\t\tkdv_orani: row.querySelector('.kdvOrani').value\r\n \t\t};\r\n \t\t\r\n-\t\tif (stokData.stok_adi && stokData.miktar && stokData.birim_fiyat) {\r\n+\t\tif (stokData.stok_id && stokData.miktar && stokData.birim_fiyat) {\r\n \t\t\tformData.push(stokData);\r\n \t\t}\r\n \t});\r\n \t\r\n \tif (formData.length === 0) {\r\n-\t\talert('En az bir stok bilgisi girmeniz gereklidir.');\r\n+\t\talert('En az bir stok seçip, miktar ve birim fiyat girmeniz gereklidir.');\r\n \t\treturn;\r\n \t}\r\n \t\r\n \t// AJAX ile kaydet\r\n"
                },
                {
                    "date": 1756810205550,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -359,8 +359,45 @@\n \t\t\t0% { transform: scale(1); }\r\n \t\t\t50% { transform: scale(1.05); }\r\n \t\t\t100% { transform: scale(1); }\r\n \t\t}\r\n+\t\t\r\n+\t\t/* Modal ve tablo iyileştirmeleri */\r\n+\t\t#stokBilgisiModal .modal-xl {\r\n+\t\t\tmax-width: 95%;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal .table th,\r\n+\t\t#stokBilgisiModal .table td {\r\n+\t\t\tpadding: 0.5rem;\r\n+\t\t\tvertical-align: middle;\r\n+\t\t\tfont-size: 0.9rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal .select2-container {\r\n+\t\t\twidth: 100% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal .select2-selection--single {\r\n+\t\t\theight: calc(1.5em + 0.75rem + 2px);\r\n+\t\t\tpadding: 0.375rem 0.75rem;\r\n+\t\t\tfont-size: 0.9rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal .select2-selection__rendered {\r\n+\t\t\tpadding-left: 0;\r\n+\t\t\tpadding-right: 0;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal .form-control {\r\n+\t\t\tfont-size: 0.9rem;\r\n+\t\t\tpadding: 0.375rem 0.5rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal .btn-sm {\r\n+\t\t\tpadding: 0.25rem 0.5rem;\r\n+\t\t\tfont-size: 0.8rem;\r\n+\t\t}\r\n \t</style>\r\n </head>\r\n <body>\r\n <div class=\"main-wrapper\">\r\n@@ -962,9 +999,9 @@\n </div>\r\n \r\n <!-- Stok Bilgisi Modal -->\r\n <div class=\"modal fade\" id=\"stokBilgisiModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"stokBilgisiModalLabel\" aria-hidden=\"true\">\r\n-\t<div class=\"modal-dialog modal-lg\" role=\"document\">\r\n+\t<div class=\"modal-dialog modal-xl\" role=\"document\">\r\n \t\t<div class=\"modal-content\">\r\n \t\t\t<div class=\"modal-header\">\r\n \t\t\t\t<h5 class=\"modal-title\" id=\"stokBilgisiModalLabel\">\r\n \t\t\t\t\t<i class=\"fa fa-boxes mr-2\"></i>Stok Bilgileri\r\n@@ -972,9 +1009,9 @@\n \t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n \t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n \t\t\t\t</button>\r\n \t\t\t</div>\r\n-\t\t\t<div class=\"modal-body\">\r\n+\t\t\t<div class=\"modal-body p-2\">\r\n \t\t\t\t<div id=\"stokBilgisiLoading\" class=\"text-center p-4\">\r\n \t\t\t\t\t<i class=\"fa fa-spinner fa-spin fa-2x\"></i>\r\n \t\t\t\t\t<div class=\"mt-2\">Stok bilgileri yükleniyor...</div>\r\n \t\t\t\t</div>\r\n@@ -1376,18 +1413,18 @@\n \t\t\t\t\t\t\t\t<i class=\"fa fa-plus mr-1\"></i>Yeni Satır Ekle\r\n \t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n-\t\t\t\t\t<div class=\"table-responsive\">\r\n-\t\t\t\t\t\t<table class=\"table table-bordered\" id=\"stokTable\">\r\n+\t\t\t\t\t<div class=\"w-100\">\r\n+\t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"30%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"35%\">Stok Adı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"12%\">Miktar</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"18%\">Birim Fiyat (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\">Görsel</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"13%\">İşlem</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n \t\t\t\t`;\r\n"
                },
                {
                    "date": 1756902581174,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -396,8 +396,53 @@\n \t\t#stokBilgisiModal .btn-sm {\r\n \t\t\tpadding: 0.25rem 0.5rem;\r\n \t\t\tfont-size: 0.8rem;\r\n \t\t}\r\n+\t\t\r\n+\t\t/* Satış Sözleşmesi Modal Styles */\r\n+\t\t#satisSozlesmeModal .modal-body {\r\n+\t\t\tmax-height: 70vh;\r\n+\t\t\toverflow-y: auto;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#satisSozlesmeModal .table-responsive {\r\n+\t\t\tmax-height: 300px;\r\n+\t\t\toverflow-y: auto;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#satisSozlesmeModal .form-control {\r\n+\t\t\tfont-size: 0.875rem;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#satisSozlesmeModal .stok-autocomplete {\r\n+\t\t\twidth: 100%;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* Select2 Modal içinde özel stiller */\r\n+\t\t#satisSozlesmeModal .select2-container {\r\n+\t\t\twidth: 100% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#satisSozlesmeModal .select2-selection--single {\r\n+\t\t\theight: calc(1.5em + 0.75rem + 2px) !important;\r\n+\t\t\tborder: 1px solid #ced4da !important;\r\n+\t\t\tborder-radius: 0.25rem !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#satisSozlesmeModal .select2-selection__rendered {\r\n+\t\t\tline-height: calc(1.5em + 0.75rem) !important;\r\n+\t\t\tpadding-left: 0.75rem !important;\r\n+\t\t\tcolor: #495057 !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#satisSozlesmeModal .select2-selection__arrow {\r\n+\t\t\theight: calc(1.5em + 0.75rem) !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* Select2 dropdown z-index modalda */\r\n+\t\t.select2-dropdown {\r\n+\t\t\tz-index: 9999 !important;\r\n+\t\t}\r\n \t</style>\r\n </head>\r\n <body>\r\n <div class=\"main-wrapper\">\r\n@@ -775,9 +820,14 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-success\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"openSatisSozlesmeModal(<?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme, ENT_QUOTES) ?>')\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Satış sözleşmesi oluştur\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-plus mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSözleşme Oluştur\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"gorsel-column\">\r\n@@ -1125,8 +1175,175 @@\n \t\t</div>\r\n \t</div>\r\n </div>\r\n \r\n+<!-- Satış Sözleşmesi Oluşturma Modal -->\r\n+<div class=\"modal fade\" id=\"satisSozlesmeModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"satisSozlesmeModalLabel\" aria-hidden=\"true\">\r\n+\t<div class=\"modal-dialog modal-xl\" role=\"document\">\r\n+\t\t<div class=\"modal-content\">\r\n+\t\t\t<div class=\"modal-header\">\r\n+\t\t\t\t<h5 class=\"modal-title\" id=\"satisSozlesmeModalLabel\">\r\n+\t\t\t\t\t<i class=\"fa fa-file-contract mr-2\"></i>Satış Sözleşmesi Oluştur\r\n+\t\t\t\t</h5>\r\n+\t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n+\t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n+\t\t\t\t</button>\r\n+\t\t\t</div>\r\n+\t\t\t<form id=\"satisSozlesmeForm\" action=\"<?= base_url(\"fatura/satisFaturasiOlustur\"); ?>\" method=\"POST\" enctype=\"multipart/form-data\">\r\n+\t\t\t\t<div class=\"modal-body\">\r\n+\t\t\t\t\t<div class=\"row\">\r\n+\t\t\t\t\t\t<div class=\"col-md-6\">\r\n+\t\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">Müşteri Bilgileri</h6>\r\n+\t\t\t\t\t\t\t<input type=\"hidden\" name=\"satis_cariID\" id=\"modalCariID\" value=\"\">\r\n+\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t<label>Müşteri Adı</label>\r\n+\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"modalCariAdi\" readonly>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t<div class=\"col-md-6\">\r\n+\t\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">Sözleşme Bilgileri</h6>\r\n+\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t<label>Sözleşme No <span class=\"text-danger\">*</span></label>\r\n+\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"satis_faturaNo\" required>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t<div class=\"row\">\r\n+\t\t\t\t\t\t<div class=\"col-md-6\">\r\n+\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t<label>Sözleşme Tarihi <span class=\"text-danger\">*</span></label>\r\n+\t\t\t\t\t\t\t\t<input type=\"date\" class=\"form-control\" name=\"satis_faturaTarihi\" value=\"<?= date('Y-m-d') ?>\" required>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t<div class=\"col-md-6\">\r\n+\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t<label>Vade Tarihi</label>\r\n+\t\t\t\t\t\t\t\t<input type=\"date\" class=\"form-control\" name=\"satis_vadeTarihi\">\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\r\n+\t\t\t\t\t<div class=\"row\">\r\n+\t\t\t\t\t\t<div class=\"col-md-12\">\r\n+\t\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">Hizmet/Ürün Bilgileri</h6>\r\n+\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n+\t\t\t\t\t\t\t\t<table class=\"table table-sm\" id=\"modalStokTable\">\r\n+\t\t\t\t\t\t\t\t\t<thead>\r\n+\t\t\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"40%\">Hizmet/Ürün Adı</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"15%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"15%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Toplam</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\">İşlem</th>\r\n+\t\t\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t\t\t</thead>\r\n+\t\t\t\t\t\t\t\t\t<tbody>\r\n+\t\t\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control stok-dropdown\" name=\"stok_id[]\" style=\"width: 100%;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Hizmet/Ürün seçin...</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t$anaHesap = anaHesapBilgisi();\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tif ($anaHesap) {\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$stokQuery = \"SELECT stok_id, stok_ad, stok_kodu, stok_satisFiyati, stok_satisKDV \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  FROM stok \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  WHERE stok_olusturanAnaHesap = ? \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND stok_durum = 1 \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  ORDER BY stok_ad ASC\";\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$stokResults = $this->db->query($stokQuery, [$anaHesap])->result();\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach ($stokResults as $stok) {\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$displayText = $stok->stok_ad;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!empty($stok->stok_kodu)) {\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$displayText .= ' (' . $stok->stok_kodu . ')';\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\techo '<option value=\"' . $stok->stok_id . '\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-stok-ad=\"' . htmlspecialchars($stok->stok_ad) . '\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-satis-fiyati=\"' . ($stok->stok_satisFiyati ?: 0) . '\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-satis-kdv=\"' . ($stok->stok_satisKDV ?: 18) . '\">' . \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thtmlspecialchars($displayText) . '</option>';\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"stok_adi[]\" class=\"stok-adi-hidden\">\r\n+\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control miktar\" name=\"miktar[]\" value=\"1\" min=\"1\" step=\"0.01\">\r\n+\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control birim-fiyat\" name=\"birim_fiyat[]\" value=\"0\" min=\"0\" step=\"0.01\">\r\n+\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control kdv-orani\" name=\"kdv_orani[]\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"0\">%0</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"1\">%1</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"10\">%10</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"18\" selected>%18</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"20\">%20</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n+\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control toplam\" readonly>\r\n+\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-danger remove-row\" onclick=\"removeStokRow(this)\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t\t\t</tbody>\r\n+\t\t\t\t\t\t\t\t</table>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-info\" onclick=\"addStokRow()\">\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-plus\"></i> Yeni Satır Ekle\r\n+\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\r\n+\t\t\t\t\t<div class=\"row mt-3\">\r\n+\t\t\t\t\t\t<div class=\"col-md-8\">\r\n+\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t<label>Açıklama</label>\r\n+\t\t\t\t\t\t\t\t<textarea class=\"form-control\" name=\"satis_aciklama\" rows=\"3\"></textarea>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t<div class=\"card\">\r\n+\t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n+\t\t\t\t\t\t\t\t\t<h6>Toplam Tutar</h6>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n+\t\t\t\t\t\t\t\t\t\t<span>Ara Toplam:</span>\r\n+\t\t\t\t\t\t\t\t\t\t<span id=\"modalAraToplam\">0.00 ₺</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n+\t\t\t\t\t\t\t\t\t\t<span>KDV:</span>\r\n+\t\t\t\t\t\t\t\t\t\t<span id=\"modalKDVToplam\">0.00 ₺</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<hr>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between font-weight-bold\">\r\n+\t\t\t\t\t\t\t\t\t\t<span>Genel Toplam:</span>\r\n+\t\t\t\t\t\t\t\t\t\t<span id=\"modalGenelToplam\">0.00 ₺</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"satis_genelToplam\" id=\"modalGenelToplamInput\" value=\"0\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"satis_vergiDahilToplam\" id=\"modalVergiDahilToplamInput\" value=\"0\">\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t<div class=\"modal-footer\">\r\n+\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">İptal</button>\r\n+\t\t\t\t\t<button type=\"submit\" class=\"btn btn-success\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-save mr-1\"></i>Sözleşme Oluştur\r\n+\t\t\t\t\t</button>\r\n+\t\t\t\t</div>\r\n+\t\t\t</form>\r\n+\t\t</div>\r\n+\t</div>\r\n+</div>\r\n+\r\n <?php $this->load->view(\"include/footer-js\"); ?>\r\n \r\n <!-- SweetAlert2 JS -->\r\n <script src=\"https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js\"></script>\r\n@@ -1376,8 +1593,445 @@\n \t$('#downloadLink').attr('href', imageSrc);\r\n \t$('#imageModal').modal('show');\r\n }\r\n \r\n+// Satış Sözleşmesi Modal fonksiyonu\r\n+function openSatisSozlesmeModal(cariId, cariIsletme) {\r\n+\tconsole.log('openSatisSozlesmeModal called with:', { cariId, cariIsletme });\r\n+\t\r\n+\t// Modal başlığını güncelle\r\n+\t$('#satisSozlesmeModalLabel').html('<i class=\"fa fa-file-contract mr-2\"></i>Satış Sözleşmesi Oluştur - ' + cariIsletme);\r\n+\t\r\n+\t// Müşteri bilgilerini doldur\r\n+\t$('#modalCariID').val(cariId);\r\n+\t$('#modalCariAdi').val(cariIsletme);\r\n+\t\r\n+\t// Form'u sıfırla\r\n+\t$('#satisSozlesmeForm')[0].reset();\r\n+\t$('#modalCariID').val(cariId);\r\n+\t$('#modalCariAdi').val(cariIsletme);\r\n+\t$('input[name=\"satis_faturaTarihi\"]').val('<?= date('Y-m-d') ?>');\r\n+\t\r\n+\t// Tablo hesaplamalarını sıfırla\r\n+\tupdateModalTotals();\r\n+\t\r\n+\t// Event'leri başlat\r\n+\tinitializeModalEvents();\r\n+\t\r\n+\t$('#satisSozlesmeModal').modal('show');\r\n+}\r\n+\r\n+// Modal tablo hesaplamaları\r\n+function updateModalTotals() {\r\n+\tlet araToplam = 0;\r\n+\tlet kdvToplam = 0;\r\n+\t\r\n+\t$('#modalStokTable tbody tr').each(function() {\r\n+\t\tconst miktar = parseFloat($(this).find('.miktar').val()) || 0;\r\n+\t\tconst birimFiyat = parseFloat($(this).find('.birim-fiyat').val()) || 0;\r\n+\t\tconst kdvOrani = parseFloat($(this).find('.kdv-orani').val()) || 0;\r\n+\t\t\r\n+\t\tconst satirToplam = miktar * birimFiyat;\r\n+\t\tconst satirKdv = satirToplam * (kdvOrani / 100);\r\n+\t\tconst satirGenelToplam = satirToplam + satirKdv;\r\n+\t\t\r\n+\t\t$(this).find('.toplam').val(satirGenelToplam.toFixed(2) + ' ₺');\r\n+\t\t\r\n+\t\taraToplam += satirToplam;\r\n+\t\tkdvToplam += satirKdv;\r\n+\t});\r\n+\t\r\n+\tconst genelToplam = araToplam + kdvToplam;\r\n+\t\r\n+\t$('#modalAraToplam').text(araToplam.toFixed(2) + ' ₺');\r\n+\t$('#modalKDVToplam').text(kdvToplam.toFixed(2) + ' ₺');\r\n+\t$('#modalGenelToplam').text(genelToplam.toFixed(2) + ' ₺');\r\n+\t$('#modalGenelToplamInput').val(genelToplam.toFixed(2));\r\n+\t$('#modalVergiDahilToplamInput').val(genelToplam.toFixed(2));\r\n+}\r\n+\r\n+// Yeni stok satırı ekleme\r\n+function addStokRow() {\r\n+\t// Mevcut ilk satırdaki select'in option'larını kopyala\r\n+\tconst firstStokSelect = $('#modalStokTable tbody tr:first-child .stok-dropdown');\r\n+\tconst stokOptions = firstStokSelect.html();\r\n+\t\r\n+\tconst newRow = `\r\n+\t\t<tr>\r\n+\t\t\t<td>\r\n+\t\t\t\t<select class=\"form-control stok-dropdown\" name=\"stok_id[]\" style=\"width: 100%;\">\r\n+\t\t\t\t\t${stokOptions}\r\n+\t\t\t\t</select>\r\n+\t\t\t\t<input type=\"hidden\" name=\"stok_adi[]\" class=\"stok-adi-hidden\">\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<input type=\"number\" class=\"form-control miktar\" name=\"miktar[]\" value=\"1\" min=\"1\" step=\"0.01\">\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<input type=\"number\" class=\"form-control birim-fiyat\" name=\"birim_fiyat[]\" value=\"0\" min=\"0\" step=\"0.01\">\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<select class=\"form-control kdv-orani\" name=\"kdv_orani[]\">\r\n+\t\t\t\t\t<option value=\"0\">%0</option>\r\n+\t\t\t\t\t<option value=\"1\">%1</option>\r\n+\t\t\t\t\t<option value=\"10\">%10</option>\r\n+\t\t\t\t\t<option value=\"18\" selected>%18</option>\r\n+\t\t\t\t\t<option value=\"20\">%20</option>\r\n+\t\t\t\t</select>\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<input type=\"text\" class=\"form-control toplam\" readonly>\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n+\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-danger remove-row\" onclick=\"removeStokRow(this)\">\r\n+\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t</button>\r\n+\t\t\t</td>\r\n+\t\t</tr>\r\n+\t`;\r\n+\t$('#modalStokTable tbody').append(newRow);\r\n+\tinitializeModalEvents();\r\n+\tinitializeStokDropdownEvents();\r\n+}\r\n+\r\n+// Stok satırını silme\r\n+function removeStokRow(button) {\r\n+\tif ($('#modalStokTable tbody tr').length > 1) {\r\n+\t\t$(button).closest('tr').remove();\r\n+\t\tupdateModalTotals();\r\n+\t}\r\n+}\r\n+\r\n+// Modal event'leri başlatma\r\n+function initializeModalEvents() {\r\n+\t// Miktar, birim fiyat ve KDV değiştiğinde toplam hesapla\r\n+\t$(document).off('input', '#modalStokTable .miktar, #modalStokTable .birim-fiyat')\r\n+\t\t.on('input', '#modalStokTable .miktar, #modalStokTable .birim-fiyat', function() {\r\n+\t\t\tupdateModalTotals();\r\n+\t\t});\r\n+\t\r\n+\t$(document).off('change', '#modalStokTable .kdv-orani')\r\n+\t\t.on('change', '#modalStokTable .kdv-orani', function() {\r\n+\t\t\tupdateModalTotals();\r\n+\t\t});\r\n+\t\r\n+\t// Stok dropdown değişimi\r\n+\tinitializeStokDropdownEvents();\r\n+}\r\n+\r\n+// Stok dropdown event'leri\r\n+function initializeStokDropdownEvents() {\r\n+\t$(document).off('change', '.stok-dropdown')\r\n+\t\t.on('change', '.stok-dropdown', function() {\r\n+\t\t\tconst selectedOption = $(this).find('option:selected');\r\n+\t\t\tconst row = $(this).closest('tr');\r\n+\t\t\t\r\n+\t\t\tif (selectedOption.val()) {\r\n+\t\t\t\t// Seçili stok bilgilerini al\r\n+\t\t\t\tconst stokAd = selectedOption.data('stok-ad');\r\n+\t\t\t\tconst satisFiyati = parseFloat(selectedOption.data('satis-fiyati')) || 0;\r\n+\t\t\t\tconst satisKDV = parseFloat(selectedOption.data('satis-kdv')) || 18;\r\n+\t\t\t\t\r\n+\t\t\t\tconsole.log('Selected stok:', {stokAd, satisFiyati, satisKDV});\r\n+\t\t\t\t\r\n+\t\t\t\t// Form alanlarını doldur\r\n+\t\t\t\trow.find('.stok-adi-hidden').val(stokAd);\r\n+\t\t\t\trow.find('.birim-fiyat').val(satisFiyati.toFixed(2));\r\n+\t\t\t\trow.find('.kdv-orani').val(satisKDV);\r\n+\t\t\t} else {\r\n+\t\t\t\t// Temizle\r\n+\t\t\t\trow.find('.stok-adi-hidden').val('');\r\n+\t\t\t\trow.find('.birim-fiyat').val('0');\r\n+\t\t\t\trow.find('.kdv-orani').val('18');\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\tupdateModalTotals();\r\n+\t\t});\r\n+}\r\n+\r\n+// Select2 dropdown'ları için initialize fonksiyonu\r\n+function initializeSelect2ForModal() {\r\n+\t$('#satisSozlesmeModal .stok-select2').each(function() {\r\n+\t\tif (!$(this).hasClass('select2-hidden-accessible')) {\r\n+\t\t\tinitializeStokSelect2($(this));\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+// Yeni satırlar için Select2 initialize\r\n+function initializeSelect2ForNewRows() {\r\n+\t$('#modalStokTable tbody tr:last-child .stok-select2').each(function() {\r\n+\t\tif (!$(this).hasClass('select2-hidden-accessible')) {\r\n+\t\t\tinitializeStokSelect2($(this));\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+// Tek bir Select2 element için initialize\r\n+function initializeStokSelect2(element) {\r\n+\telement.select2({\r\n+\t\tdropdownParent: $('#satisSozlesmeModal'),\r\n+\t\tplaceholder: 'Hizmet/Ürün seçin veya arayın...',\r\n+\t\tallowClear: true,\r\n+\t\tminimumInputLength: 2,\r\n+\t\tlanguage: {\r\n+\t\t\tinputTooShort: function() {\r\n+\t\t\t\treturn 'En az 2 karakter yazın...';\r\n+\t\t\t},\r\n+\t\t\tsearching: function() {\r\n+\t\t\t\treturn 'Aranıyor...';\r\n+\t\t\t},\r\n+\t\t\tnoResults: function() {\r\n+\t\t\t\treturn 'Sonuç bulunamadı';\r\n+\t\t\t},\r\n+\t\t\terrorLoading: function() {\r\n+\t\t\t\treturn 'Sonuçlar yüklenirken hata oluştu.';\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\tajax: {\r\n+\t\t\turl: '<?= base_url(\"fatura/stokArama\") ?>',\r\n+\t\t\tdataType: 'json',\r\n+\t\t\tdelay: 300,\r\n+\t\t\tdata: function(params) {\r\n+\t\t\t\tconsole.log('Select2 AJAX Request - params:', params);\r\n+\t\t\t\treturn {\r\n+\t\t\t\t\tterm: params.term || '',\r\n+\t\t\t\t\tpage: params.page || 1\r\n+\t\t\t\t};\r\n+\t\t\t},\r\n+\t\t\tprocessResults: function(data, params) {\r\n+\t\t\t\tconsole.log('Select2 AJAX Response - data:', data);\r\n+\t\t\t\tconsole.log('Select2 AJAX Response - params:', params);\r\n+\t\t\t\t\r\n+\t\t\t\t// Hata kontrolü\r\n+\t\t\t\tif (data && data.error) {\r\n+\t\t\t\t\tconsole.error('Stok arama hatası:', data.message);\r\n+\t\t\t\t\treturn { results: [] };\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n+\t\t\t\t// Eğer data bir array değilse, boş array döndür\r\n+\t\t\t\tif (!Array.isArray(data)) {\r\n+\t\t\t\t\tconsole.error('Beklenmeyen veri formatı:', data);\r\n+\t\t\t\t\tconsole.error('Data type:', typeof data);\r\n+\t\t\t\t\treturn { results: [] };\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n+\t\t\t\tconst results = data.map(function(item) {\r\n+\t\t\t\t\tconsole.log('Mapping item:', item);\r\n+\t\t\t\t\treturn {\r\n+\t\t\t\t\t\tid: item.stok_id,\r\n+\t\t\t\t\t\ttext: item.stok_ad + (item.stok_kodu ? ' (' + item.stok_kodu + ')' : ''),\r\n+\t\t\t\t\t\tstok_data: {\r\n+\t\t\t\t\t\t\tstok_id: item.stok_id,\r\n+\t\t\t\t\t\t\tstok_ad: item.stok_ad,\r\n+\t\t\t\t\t\t\tstok_kodu: item.stok_kodu,\r\n+\t\t\t\t\t\t\tsatis_fiyati: item.stok_satisFiyati || 0,\r\n+\t\t\t\t\t\t\tsatis_kdv: item.stok_satisKDV || 18\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t};\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\tconsole.log('Final results for Select2:', results);\r\n+\t\t\t\treturn { results: results };\r\n+\t\t\t},\r\n+\t\t\tcache: true,\r\n+\t\t\t// Hata yakalama\r\n+\t\t\ttransport: function(params, success, failure) {\r\n+\t\t\t\tconsole.log('Select2 transport - URL:', params.url);\r\n+\t\t\t\tconsole.log('Select2 transport - data:', params.data);\r\n+\t\t\t\t\r\n+\t\t\t\tvar $request = $.ajax(params);\r\n+\t\t\t\t\r\n+\t\t\t\t$request.then(function(data) {\r\n+\t\t\t\t\tconsole.log('Transport success - data:', data);\r\n+\t\t\t\t\tconsole.log('Transport success - data type:', typeof data);\r\n+\t\t\t\t\tsuccess(data);\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\t$request.fail(function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('Transport failed - xhr status:', xhr.status);\r\n+\t\t\t\t\tconsole.error('Transport failed - xhr readyState:', xhr.readyState);\r\n+\t\t\t\t\tconsole.error('Transport failed - status:', status);\r\n+\t\t\t\t\tconsole.error('Transport failed - error:', error);\r\n+\t\t\t\t\tconsole.error('Transport failed - responseText (first 500 chars):', xhr.responseText ? xhr.responseText.substring(0, 500) : 'No response text');\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t// HTML response kontrolü\r\n+\t\t\t\t\tif (xhr.responseText && xhr.responseText.trim().startsWith('<!DOCTYPE')) {\r\n+\t\t\t\t\t\tconsole.error('HTML response detected - likely authentication error or page not found');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tfailure();\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\treturn $request;\r\n+\t\t\t}\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t// Seçim değiştiğinde\r\n+\telement.on('select2:select', function(e) {\r\n+\t\tconst data = e.params.data;\r\n+\t\tconsole.log('Select2 selected data:', data);\r\n+\t\tconst row = $(this).closest('tr');\r\n+\t\t\r\n+\t\tif (data && data.stok_id) {\r\n+\t\t\t// Fiyat ve KDV bilgilerini doldur (endpoint'ten gelen format)\r\n+\t\t\tconst satisFiyati = parseFloat(data.stok_satisFiyati) || 0;\r\n+\t\t\tconst satisKDV = parseFloat(data.stok_satisKDV) || 18;\r\n+\t\t\t\r\n+\t\t\tconsole.log('Setting prices - satisFiyati:', satisFiyati, 'satisKDV:', satisKDV);\r\n+\t\t\t\r\n+\t\t\trow.find('.stok-adi-hidden').val(data.stok_ad);\r\n+\t\t\trow.find('.birim-fiyat').val(satisFiyati.toFixed(2));\r\n+\t\t\trow.find('.kdv-orani').val(satisKDV);\r\n+\t\t\t\r\n+\t\t\t// Stok ID'yi gizli inputa kaydet\r\n+\t\t\trow.find('.stok-id').val(data.stok_id);\r\n+\t\t\t\r\n+\t\t\t// Toplamları güncelle\r\n+\t\t\tupdateModalTotals();\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t// Temizlendiğinde\r\n+\telement.on('select2:clear', function() {\r\n+\t\tconst row = $(this).closest('tr');\r\n+\t\trow.find('.stok-adi-hidden').val('');\r\n+\t\trow.find('.birim-fiyat').val('0');\r\n+\t\tupdateModalTotals();\r\n+\t});\r\n+}\r\n+\r\n+// Form gönderme işlemi\r\n+$('#satisSozlesmeForm').on('submit', function(e) {\r\n+\te.preventDefault();\r\n+\t\r\n+\t// Form validasyonu\r\n+\tif (!$(this).find('input[name=\"satis_faturaNo\"]').val().trim()) {\r\n+\t\talert('Sözleşme numarası zorunludur!');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\t// En az bir stok kontrolü\r\n+\tlet hasValidStok = false;\r\n+\t$('#modalStokTable tbody tr').each(function() {\r\n+\t\tconst stokId = $(this).find('.stok-dropdown').val();\r\n+\t\tconst miktar = $(this).find('.miktar').val();\r\n+\t\tif (stokId && miktar > 0) {\r\n+\t\t\thasValidStok = true;\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\tif (!hasValidStok) {\r\n+\t\talert('En az bir hizmet/ürün seçmelisiniz!');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\t// Loading göster\r\n+\tconst submitBtn = $(this).find('button[type=\"submit\"]');\r\n+\tconst originalText = submitBtn.html();\r\n+\tsubmitBtn.html('<i class=\"fa fa-spinner fa-spin mr-1\"></i>Oluşturuluyor...').prop('disabled', true);\r\n+\t\r\n+\t// Form verilerini manuel olarak hazırla\r\n+\tlet formData = new FormData();\r\n+\t\r\n+\t// Temel form verileri\r\n+\tformData.append('satis_cariID', $('#modalCariID').val());\r\n+\tformData.append('satis_faturaNo', $('input[name=\"satis_faturaNo\"]').val());\r\n+\tformData.append('satis_faturaTarihi', $('input[name=\"satis_faturaTarihi\"]').val());\r\n+\tformData.append('satis_vadeTarihi', $('input[name=\"satis_vadeTarihi\"]').val());\r\n+\tformData.append('satis_aciklama', $('textarea[name=\"satis_aciklama\"]').val());\r\n+\t\r\n+\t// Toplam değerleri\r\n+\tconst araToplam = parseFloat($('#modalAraToplam').text().replace(' ₺', '')) || 0;\r\n+\tconst kdvToplam = parseFloat($('#modalKDVToplam').text().replace(' ₺', '')) || 0;\r\n+\tconst genelToplam = parseFloat($('#modalGenelToplam').text().replace(' ₺', '')) || 0;\r\n+\t\r\n+\tformData.append('aratopHidden', araToplam.toFixed(2));\r\n+\tformData.append('kdvtopHidden', kdvToplam.toFixed(2));\r\n+\tformData.append('geneltopHidden', genelToplam.toFixed(2));\r\n+\tformData.append('vergidahilHidden', genelToplam.toFixed(2));\r\n+\tformData.append('netTutarInput', genelToplam.toFixed(2));\r\n+\tformData.append('satis_genelToplam', genelToplam.toFixed(2));\r\n+\tformData.append('satis_vergiDahilToplam', genelToplam.toFixed(2));\r\n+\t\r\n+\t// Varsayılan değerler\r\n+\tformData.append('satis_paraBirimi', 1); // TL\r\n+\tformData.append('indirimtopHidden', 0);\r\n+\tformData.append('tevkifattopHidden', 0);\r\n+\t\r\n+\t// Stok verilerini ekle\r\n+\tlet stokIndex = 0;\r\n+\t$('#modalStokTable tbody tr').each(function() {\r\n+\t\tconst stokId = $(this).find('.stok-dropdown').val();\r\n+\t\tconst stokAdi = $(this).find('.stok-adi-hidden').val();\r\n+\t\tconst miktar = $(this).find('.miktar').val();\r\n+\t\tconst birimFiyat = $(this).find('.birim-fiyat').val();\r\n+\t\tconst kdvOrani = $(this).find('.kdv-orani').val();\r\n+\t\t\r\n+\t\tif (stokId && miktar > 0) {\r\n+\t\t\t// Controller'ın beklediği format\r\n+\t\t\tformData.append(`stokid[${stokIndex}]`, stokId);\r\n+\t\t\tformData.append(`stokadi[${stokIndex}]`, stokAdi);\r\n+\t\t\tformData.append(`miktar[${stokIndex}]`, miktar);\r\n+\t\t\tformData.append(`birimfiyat[${stokIndex}]`, birimFiyat);\r\n+\t\t\tformData.append(`kdv[${stokIndex}]`, kdvOrani);\r\n+\t\t\t\r\n+\t\t\t// Toplam hesapla (KDV hariç)\r\n+\t\t\tconst satirToplam = parseFloat(miktar) * parseFloat(birimFiyat);\r\n+\t\t\tformData.append(`toplamHidden[${stokIndex}]`, satirToplam.toFixed(2));\r\n+\t\t\t\r\n+\t\t\t// Varsayılan değerler\r\n+\t\t\tformData.append(`stokkodu[${stokIndex}]`, '');\r\n+\t\t\tformData.append(`barkod[${stokIndex}]`, '');\r\n+\t\t\tformData.append(`birim[${stokIndex}]`, 1); // Adet\r\n+\t\t\tformData.append(`indirimyuzde[${stokIndex}]`, 0);\r\n+\t\t\tformData.append(`tevkifat[${stokIndex}]`, \"0|0\");\r\n+\t\t\t\r\n+\t\t\tstokIndex++;\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t// AJAX ile gönder\r\n+\t$.ajax({\r\n+\t\turl: $(this).attr('action'),\r\n+\t\ttype: 'POST',\r\n+\t\tdata: formData,\r\n+\t\tprocessData: false,\r\n+\t\tcontentType: false,\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tif (response.success) {\r\n+\t\t\t\talert('Satış sözleşmesi başarıyla oluşturuldu!');\r\n+\t\t\t\t$('#satisSozlesmeModal').modal('hide');\r\n+\t\t\t\tlocation.reload(); // Sayfayı yenile\r\n+\t\t\t} else {\r\n+\t\t\t\talert('Hata: ' + (response.message || 'Bilinmeyen bir hata oluştu.'));\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.error('AJAX Error:', {xhr, status, error});\r\n+\t\t\tlet errorMessage = 'Bir hata oluştu. Lütfen tekrar deneyin.';\r\n+\t\t\t\r\n+\t\t\tif (xhr.responseText) {\r\n+\t\t\t\ttry {\r\n+\t\t\t\t\tconst response = JSON.parse(xhr.responseText);\r\n+\t\t\t\t\tif (response.message) {\r\n+\t\t\t\t\t\terrorMessage = response.message;\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} catch(e) {\r\n+\t\t\t\t\t// JSON parse hatası\r\n+\t\t\t\t}\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\talert(errorMessage);\r\n+\t\t},\r\n+\t\tcomplete: function() {\r\n+\t\t\tsubmitBtn.html(originalText).prop('disabled', false);\r\n+\t\t}\r\n+\t});\r\n+});\r\n+\r\n // Stok Bilgisi modal fonksiyonu\r\n function openStokBilgisiModal(satisId, cariId, cariIsletme) {\r\n \tconsole.log('openStokBilgisiModal called with:', { satisId, cariId, cariIsletme });\r\n \t\r\n@@ -3091,8 +3745,18 @@\n \t\t}\r\n \t});\r\n }\r\n \r\n+// Belge hazır olduğunda modal event'lerini başlat\r\n+$(document).ready(function() {\r\n+\tinitializeModalEvents();\r\n+\t\r\n+\t// Modal gösterildiğinde Select2'yi başlat\r\n+\t$('#satisSozlesmeModal').on('shown.bs.modal', function() {\r\n+\t\tinitializeSelect2ForModal();\r\n+\t});\r\n+});\r\n+\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1756905342724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1231,11 +1231,11 @@\n \t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t\t\t<th width=\"40%\">Hizmet/Ürün Adı</th>\r\n \t\t\t\t\t\t\t\t\t\t\t<th width=\"15%\">Miktar</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t\t\t<th width=\"15%\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Toplam</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Toplam (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t\t\t<tbody>\r\n@@ -1271,9 +1271,9 @@\n \t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control miktar\" name=\"miktar[]\" value=\"1\" min=\"1\" step=\"0.01\">\r\n \t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control birim-fiyat\" name=\"birim_fiyat[]\" value=\"0\" min=\"0\" step=\"0.01\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control birim-fiyat\" name=\"birim_fiyat[]\" value=\"0\" min=\"0\" step=\"0.01\" readonly>\r\n \t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control kdv-orani\" name=\"kdv_orani[]\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"0\">%0</option>\r\n@@ -1283,9 +1283,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"20\">%20</option>\r\n \t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n \t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control toplam\" readonly>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control toplam\" name=\"toplam[]\" min=\"0\" step=\"0.01\" placeholder=\"KDV dahil tutar girin\">\r\n \t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-danger remove-row\" onclick=\"removeStokRow(this)\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n@@ -1312,18 +1312,18 @@\n \t\t\t\t\t\t\t<div class=\"card\">\r\n \t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n \t\t\t\t\t\t\t\t\t<h6>Toplam Tutar</h6>\r\n \t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n-\t\t\t\t\t\t\t\t\t\t<span>Ara Toplam:</span>\r\n+\t\t\t\t\t\t\t\t\t\t<span>Ara Toplam (KDV Hariç):</span>\r\n \t\t\t\t\t\t\t\t\t\t<span id=\"modalAraToplam\">0.00 ₺</span>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n-\t\t\t\t\t\t\t\t\t\t<span>KDV:</span>\r\n+\t\t\t\t\t\t\t\t\t\t<span>KDV Tutarı:</span>\r\n \t\t\t\t\t\t\t\t\t\t<span id=\"modalKDVToplam\">0.00 ₺</span>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t<hr>\r\n \t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between font-weight-bold\">\r\n-\t\t\t\t\t\t\t\t\t\t<span>Genel Toplam:</span>\r\n+\t\t\t\t\t\t\t\t\t\t<span>Genel Toplam (KDV Dahil):</span>\r\n \t\t\t\t\t\t\t\t\t\t<span id=\"modalGenelToplam\">0.00 ₺</span>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"satis_genelToplam\" id=\"modalGenelToplamInput\" value=\"0\">\r\n \t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"satis_vergiDahilToplam\" id=\"modalVergiDahilToplamInput\" value=\"0\">\r\n@@ -1623,26 +1623,24 @@\n // Modal tablo hesaplamaları\r\n function updateModalTotals() {\r\n \tlet araToplam = 0;\r\n \tlet kdvToplam = 0;\r\n+\tlet genelToplam = 0;\r\n \t\r\n \t$('#modalStokTable tbody tr').each(function() {\r\n-\t\tconst miktar = parseFloat($(this).find('.miktar').val()) || 0;\r\n-\t\tconst birimFiyat = parseFloat($(this).find('.birim-fiyat').val()) || 0;\r\n+\t\tconst toplamKdvDahil = parseFloat($(this).find('.toplam').val()) || 0; // KDV dahil tutar\r\n \t\tconst kdvOrani = parseFloat($(this).find('.kdv-orani').val()) || 0;\r\n \t\t\r\n-\t\tconst satirToplam = miktar * birimFiyat;\r\n-\t\tconst satirKdv = satirToplam * (kdvOrani / 100);\r\n-\t\tconst satirGenelToplam = satirToplam + satirKdv;\r\n+\t\t// KDV dahil tutardan KDV hariç tutarı hesapla\r\n+\t\tconst kdvCarpani = 1 + (kdvOrani / 100);\r\n+\t\tconst toplamKdvHaric = kdvCarpani > 0 ? toplamKdvDahil / kdvCarpani : toplamKdvDahil;\r\n+\t\tconst satirKdv = toplamKdvDahil - toplamKdvHaric;\r\n \t\t\r\n-\t\t$(this).find('.toplam').val(satirGenelToplam.toFixed(2) + ' ₺');\r\n-\t\t\r\n-\t\taraToplam += satirToplam;\r\n+\t\taraToplam += toplamKdvHaric;\r\n \t\tkdvToplam += satirKdv;\r\n+\t\tgenelToplam += toplamKdvDahil;\r\n \t});\r\n \t\r\n-\tconst genelToplam = araToplam + kdvToplam;\r\n-\t\r\n \t$('#modalAraToplam').text(araToplam.toFixed(2) + ' ₺');\r\n \t$('#modalKDVToplam').text(kdvToplam.toFixed(2) + ' ₺');\r\n \t$('#modalGenelToplam').text(genelToplam.toFixed(2) + ' ₺');\r\n \t$('#modalGenelToplamInput').val(genelToplam.toFixed(2));\r\n@@ -1666,9 +1664,9 @@\n \t\t\t<td>\r\n \t\t\t\t<input type=\"number\" class=\"form-control miktar\" name=\"miktar[]\" value=\"1\" min=\"1\" step=\"0.01\">\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n-\t\t\t\t<input type=\"number\" class=\"form-control birim-fiyat\" name=\"birim_fiyat[]\" value=\"0\" min=\"0\" step=\"0.01\">\r\n+\t\t\t\t<input type=\"number\" class=\"form-control birim-fiyat\" name=\"birim_fiyat[]\" value=\"0\" min=\"0\" step=\"0.01\" readonly>\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<select class=\"form-control kdv-orani\" name=\"kdv_orani[]\">\r\n \t\t\t\t\t<option value=\"0\">%0</option>\r\n@@ -1678,9 +1676,9 @@\n \t\t\t\t\t<option value=\"20\">%20</option>\r\n \t\t\t\t</select>\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n-\t\t\t\t<input type=\"text\" class=\"form-control toplam\" readonly>\r\n+\t\t\t\t<input type=\"number\" class=\"form-control toplam\" name=\"toplam[]\" min=\"0\" step=\"0.01\" placeholder=\"KDV dahil tutar girin\">\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-danger remove-row\" onclick=\"removeStokRow(this)\">\r\n \t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n@@ -1702,11 +1700,23 @@\n }\r\n \r\n // Modal event'leri başlatma\r\n function initializeModalEvents() {\r\n-\t// Miktar, birim fiyat ve KDV değiştiğinde toplam hesapla\r\n-\t$(document).off('input', '#modalStokTable .miktar, #modalStokTable .birim-fiyat')\r\n-\t\t.on('input', '#modalStokTable .miktar, #modalStokTable .birim-fiyat', function() {\r\n+\t// Miktar ve toplam değiştiğinde birim fiyat hesapla (KDV dahil)\r\n+\t$(document).off('input', '#modalStokTable .miktar, #modalStokTable .toplam')\r\n+\t\t.on('input', '#modalStokTable .miktar, #modalStokTable .toplam', function() {\r\n+\t\t\tconst row = $(this).closest('tr');\r\n+\t\t\tconst miktar = parseFloat(row.find('.miktar').val()) || 0;\r\n+\t\t\tconst toplamKdvDahil = parseFloat(row.find('.toplam').val()) || 0; // KDV dahil tutar\r\n+\t\t\t\r\n+\t\t\t// Birim fiyatı hesapla (KDV dahil toplam / miktar)\r\n+\t\t\tif (miktar > 0) {\r\n+\t\t\t\tconst birimFiyatKdvDahil = toplamKdvDahil / miktar;\r\n+\t\t\t\trow.find('.birim-fiyat').val(birimFiyatKdvDahil.toFixed(2));\r\n+\t\t\t} else {\r\n+\t\t\t\trow.find('.birim-fiyat').val('0.00');\r\n+\t\t\t}\r\n+\t\t\t\r\n \t\t\tupdateModalTotals();\r\n \t\t});\r\n \t\r\n \t$(document).off('change', '#modalStokTable .kdv-orani')\r\n@@ -1727,22 +1737,30 @@\n \t\t\t\r\n \t\t\tif (selectedOption.val()) {\r\n \t\t\t\t// Seçili stok bilgilerini al\r\n \t\t\t\tconst stokAd = selectedOption.data('stok-ad');\r\n-\t\t\t\tconst satisFiyati = parseFloat(selectedOption.data('satis-fiyati')) || 0;\r\n+\t\t\t\tconst satisFiyatiKdvHaric = parseFloat(selectedOption.data('satis-fiyati')) || 0;\r\n \t\t\t\tconst satisKDV = parseFloat(selectedOption.data('satis-kdv')) || 18;\r\n \t\t\t\t\r\n-\t\t\t\tconsole.log('Selected stok:', {stokAd, satisFiyati, satisKDV});\r\n+\t\t\t\tconsole.log('Selected stok:', {stokAd, satisFiyatiKdvHaric, satisKDV});\r\n \t\t\t\t\r\n+\t\t\t\t// KDV dahil birim fiyatı hesapla\r\n+\t\t\t\tconst kdvCarpani = 1 + (satisKDV / 100);\r\n+\t\t\t\tconst birimFiyatKdvDahil = satisFiyatiKdvHaric * kdvCarpani;\r\n+\t\t\t\t\r\n \t\t\t\t// Form alanlarını doldur\r\n \t\t\t\trow.find('.stok-adi-hidden').val(stokAd);\r\n-\t\t\t\trow.find('.birim-fiyat').val(satisFiyati.toFixed(2));\r\n+\t\t\t\trow.find('.birim-fiyat').val(birimFiyatKdvDahil.toFixed(2)); // KDV dahil birim fiyat göster\r\n \t\t\t\trow.find('.kdv-orani').val(satisKDV);\r\n+\t\t\t\t\r\n+\t\t\t\t// Toplam alanını temizle, kullanıcı KDV dahil tutarı kendisi girecek\r\n+\t\t\t\trow.find('.toplam').val('');\r\n \t\t\t} else {\r\n \t\t\t\t// Temizle\r\n \t\t\t\trow.find('.stok-adi-hidden').val('');\r\n \t\t\t\trow.find('.birim-fiyat').val('0');\r\n \t\t\t\trow.find('.kdv-orani').val('18');\r\n+\t\t\t\trow.find('.toplam').val('');\r\n \t\t\t}\r\n \t\t\t\r\n \t\t\tupdateModalTotals();\r\n \t\t});\r\n@@ -1966,21 +1984,19 @@\n \t\tconst stokAdi = $(this).find('.stok-adi-hidden').val();\r\n \t\tconst miktar = $(this).find('.miktar').val();\r\n \t\tconst birimFiyat = $(this).find('.birim-fiyat').val();\r\n \t\tconst kdvOrani = $(this).find('.kdv-orani').val();\r\n+\t\tconst toplam = $(this).find('.toplam').val();\r\n \t\t\r\n-\t\tif (stokId && miktar > 0) {\r\n+\t\tif (stokId && miktar > 0 && toplam > 0) {\r\n \t\t\t// Controller'ın beklediği format\r\n \t\t\tformData.append(`stokid[${stokIndex}]`, stokId);\r\n \t\t\tformData.append(`stokadi[${stokIndex}]`, stokAdi);\r\n \t\t\tformData.append(`miktar[${stokIndex}]`, miktar);\r\n \t\t\tformData.append(`birimfiyat[${stokIndex}]`, birimFiyat);\r\n \t\t\tformData.append(`kdv[${stokIndex}]`, kdvOrani);\r\n+\t\t\tformData.append(`toplamHidden[${stokIndex}]`, toplam);\r\n \t\t\t\r\n-\t\t\t// Toplam hesapla (KDV hariç)\r\n-\t\t\tconst satirToplam = parseFloat(miktar) * parseFloat(birimFiyat);\r\n-\t\t\tformData.append(`toplamHidden[${stokIndex}]`, satirToplam.toFixed(2));\r\n-\t\t\t\r\n \t\t\t// Varsayılan değerler\r\n \t\t\tformData.append(`stokkodu[${stokIndex}]`, '');\r\n \t\t\tformData.append(`barkod[${stokIndex}]`, '');\r\n \t\t\tformData.append(`birim[${stokIndex}]`, 1); // Adet\r\n"
                },
                {
                    "date": 1756913353271,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1243,27 +1243,23 @@\n \t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control stok-dropdown\" name=\"stok_id[]\" style=\"width: 100%;\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Hizmet/Ürün seçin...</option>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t$anaHesap = anaHesapBilgisi();\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tif ($anaHesap) {\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t$stokQuery = \"SELECT stok_id, stok_ad, stok_kodu, stok_satisFiyati, stok_satisKDV \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  FROM stok \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  WHERE stok_olusturanAnaHesap = ? \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND stok_durum = 1 \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  ORDER BY stok_ad ASC\";\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t$stokResults = $this->db->query($stokQuery, [$anaHesap])->result();\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach ($stokResults as $stok) {\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$displayText = $stok->stok_ad;\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!empty($stok->stok_kodu)) {\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$displayText .= ' (' . $stok->stok_kodu . ')';\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\techo '<option value=\"' . $stok->stok_id . '\" \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-stok-ad=\"' . htmlspecialchars($stok->stok_ad) . '\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-satis-fiyati=\"' . ($stok->stok_satisFiyati ?: 0) . '\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-satis-kdv=\"' . ($stok->stok_satisKDV ?: 18) . '\">' . \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thtmlspecialchars($displayText) . '</option>';\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t$stokQuery = \"SELECT stok_id, stok_ad, stok_kodu, stok_satisFiyati, stok_satisKDV \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  FROM stok \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  WHERE stok_durum = 1 \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  ORDER BY stok_ad ASC\";\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t$stokResults = $this->db->query($stokQuery)->result();\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tforeach ($stokResults as $stok) {\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t$displayText = $stok->stok_ad;\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!empty($stok->stok_kodu)) {\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$displayText .= ' (' . $stok->stok_kodu . ')';\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\techo '<option value=\"' . $stok->stok_id . '\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-stok-ad=\"' . htmlspecialchars($stok->stok_ad) . '\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-satis-fiyati=\"' . ($stok->stok_satisFiyati ?: 0) . '\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-satis-kdv=\"' . ($stok->stok_satisKDV ?: 18) . '\">' . \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thtmlspecialchars($displayText) . '</option>';\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n \t\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"stok_adi[]\" class=\"stok-adi-hidden\">\r\n@@ -1306,8 +1302,16 @@\n \t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t<label>Açıklama</label>\r\n \t\t\t\t\t\t\t\t<textarea class=\"form-control\" name=\"satis_aciklama\" rows=\"3\"></textarea>\r\n \t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t<label>Sözleşme Dosyaları <small class=\"text-muted\">(PDF, DOC, DOCX, JPG, JPEG, PNG)</small></label>\r\n+\t\t\t\t\t\t\t\t<input type=\"file\" class=\"form-control-file\" name=\"sozlesme_dosyalari[]\" id=\"sozlesmeDosyalari\" multiple accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\">\r\n+\t\t\t\t\t\t\t\t<small class=\"form-text text-muted\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle\"></i> Birden fazla dosya seçebilirsiniz. Maksimum dosya boyutu: 10MB\r\n+\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t\t<div id=\"selectedFiles\" class=\"mt-2\"></div>\r\n+\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t<div class=\"col-md-4\">\r\n \t\t\t\t\t\t\t<div class=\"card\">\r\n \t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n@@ -1326,8 +1330,12 @@\n \t\t\t\t\t\t\t\t\t\t<span id=\"modalGenelToplam\">0.00 ₺</span>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"satis_genelToplam\" id=\"modalGenelToplamInput\" value=\"0\">\r\n \t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"satis_vergiDahilToplam\" id=\"modalVergiDahilToplamInput\" value=\"0\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"aratopHidden\" id=\"modalAraToplamInput\" value=\"0\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"kdvtopHidden\" id=\"modalKDVToplamInput\" value=\"0\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"geneltopHidden\" id=\"modalGenelToplamInput2\" value=\"0\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"hidden\" name=\"vergidahilHidden\" id=\"modalVergiDahilToplamInput2\" value=\"0\">\r\n \t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n@@ -1644,8 +1652,14 @@\n \t$('#modalKDVToplam').text(kdvToplam.toFixed(2) + ' ₺');\r\n \t$('#modalGenelToplam').text(genelToplam.toFixed(2) + ' ₺');\r\n \t$('#modalGenelToplamInput').val(genelToplam.toFixed(2));\r\n \t$('#modalVergiDahilToplamInput').val(genelToplam.toFixed(2));\r\n+\t\r\n+\t// Backend için gerekli hidden alanları güncelle\r\n+\t$('#modalAraToplamInput').val(araToplam.toFixed(2));\r\n+\t$('#modalKDVToplamInput').val(kdvToplam.toFixed(2));\r\n+\t$('#modalGenelToplamInput2').val(genelToplam.toFixed(2));\r\n+\t$('#modalVergiDahilToplamInput2').val(genelToplam.toFixed(2));\r\n }\r\n \r\n // Yeni stok satırı ekleme\r\n function addStokRow() {\r\n@@ -3769,10 +3783,80 @@\n \t// Modal gösterildiğinde Select2'yi başlat\r\n \t$('#satisSozlesmeModal').on('shown.bs.modal', function() {\r\n \t\tinitializeSelect2ForModal();\r\n \t});\r\n+\t\r\n+\t// Dosya seçimi event'i\r\n+\t$('#sozlesmeDosyalari').on('change', function() {\r\n+\t\tshowSelectedFiles();\r\n+\t});\r\n });\r\n \r\n+// Seçilen dosyaları göster\r\n+function showSelectedFiles() {\r\n+\tconst fileInput = document.getElementById('sozlesmeDosyalari');\r\n+\tconst selectedFilesDiv = document.getElementById('selectedFiles');\r\n+\t\r\n+\tif (fileInput.files.length === 0) {\r\n+\t\tselectedFilesDiv.innerHTML = '';\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\tlet html = '<div class=\"selected-files-list\">';\r\n+\thtml += '<strong>Seçilen Dosyalar:</strong>';\r\n+\thtml += '<div class=\"list-group mt-2\">';\r\n+\t\r\n+\tfor (let i = 0; i < fileInput.files.length; i++) {\r\n+\t\tconst file = fileInput.files[i];\r\n+\t\tconst fileSize = (file.size / 1024 / 1024).toFixed(2); // MB\r\n+\t\tconst fileIcon = getFileIcon(file.name);\r\n+\t\t\r\n+\t\thtml += `<div class=\"list-group-item d-flex justify-content-between align-items-center\">\r\n+\t\t\t<div>\r\n+\t\t\t\t<i class=\"fa ${fileIcon} mr-2\"></i>\r\n+\t\t\t\t<strong>${file.name}</strong>\r\n+\t\t\t\t<small class=\"text-muted\"> (${fileSize} MB)</small>\r\n+\t\t\t</div>\r\n+\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-danger\" onclick=\"removeFile(${i})\">\r\n+\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t</button>\r\n+\t\t</div>`;\r\n+\t}\r\n+\t\r\n+\thtml += '</div></div>';\r\n+\tselectedFilesDiv.innerHTML = html;\r\n+}\r\n+\r\n+// Dosya ikonu belirleme\r\n+function getFileIcon(fileName) {\r\n+\tconst extension = fileName.split('.').pop().toLowerCase();\r\n+\t\r\n+\tswitch (extension) {\r\n+\t\tcase 'pdf': return 'fa-file-pdf text-danger';\r\n+\t\tcase 'doc':\r\n+\t\tcase 'docx': return 'fa-file-word text-primary';\r\n+\t\tcase 'jpg':\r\n+\t\tcase 'jpeg':\r\n+\t\tcase 'png': return 'fa-file-image text-success';\r\n+\t\tdefault: return 'fa-file text-secondary';\r\n+\t}\r\n+}\r\n+\r\n+// Dosya silme (geçici, yeni FileList oluşturmak gerek)\r\n+function removeFile(index) {\r\n+\tconst fileInput = document.getElementById('sozlesmeDosyalari');\r\n+\tconst dt = new DataTransfer();\r\n+\t\r\n+\tfor (let i = 0; i < fileInput.files.length; i++) {\r\n+\t\tif (i !== index) {\r\n+\t\t\tdt.items.add(fileInput.files[i]);\r\n+\t\t}\r\n+\t}\r\n+\t\r\n+\tfileInput.files = dt.files;\r\n+\tshowSelectedFiles();\r\n+}\r\n+\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1756914206051,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1187,9 +1187,9 @@\n \t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n \t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n \t\t\t\t</button>\r\n \t\t\t</div>\r\n-\t\t\t<form id=\"satisSozlesmeForm\" action=\"<?= base_url(\"fatura/satisFaturasiOlustur\"); ?>\" method=\"POST\" enctype=\"multipart/form-data\">\r\n+\t\t\t<form id=\"satisSozlesmeForm\" action=\"<?= base_url(\"fatura/satisFaturasiOlustur\"); ?>\" method=\"POST\">\r\n \t\t\t\t<div class=\"modal-body\">\r\n \t\t\t\t\t<div class=\"row\">\r\n \t\t\t\t\t\t<div class=\"col-md-6\">\r\n \t\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">Müşteri Bilgileri</h6>\r\n@@ -1302,16 +1302,8 @@\n \t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t<label>Açıklama</label>\r\n \t\t\t\t\t\t\t\t<textarea class=\"form-control\" name=\"satis_aciklama\" rows=\"3\"></textarea>\r\n \t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t<div class=\"form-group\">\r\n-\t\t\t\t\t\t\t\t<label>Sözleşme Dosyaları <small class=\"text-muted\">(PDF, DOC, DOCX, JPG, JPEG, PNG)</small></label>\r\n-\t\t\t\t\t\t\t\t<input type=\"file\" class=\"form-control-file\" name=\"sozlesme_dosyalari[]\" id=\"sozlesmeDosyalari\" multiple accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\">\r\n-\t\t\t\t\t\t\t\t<small class=\"form-text text-muted\">\r\n-\t\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle\"></i> Birden fazla dosya seçebilirsiniz. Maksimum dosya boyutu: 10MB\r\n-\t\t\t\t\t\t\t\t</small>\r\n-\t\t\t\t\t\t\t\t<div id=\"selectedFiles\" class=\"mt-2\"></div>\r\n-\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t<div class=\"col-md-4\">\r\n \t\t\t\t\t\t\t<div class=\"card\">\r\n \t\t\t\t\t\t\t\t<div class=\"card-body\">\r\n@@ -3783,80 +3775,10 @@\n \t// Modal gösterildiğinde Select2'yi başlat\r\n \t$('#satisSozlesmeModal').on('shown.bs.modal', function() {\r\n \t\tinitializeSelect2ForModal();\r\n \t});\r\n-\t\r\n-\t// Dosya seçimi event'i\r\n-\t$('#sozlesmeDosyalari').on('change', function() {\r\n-\t\tshowSelectedFiles();\r\n-\t});\r\n });\r\n \r\n-// Seçilen dosyaları göster\r\n-function showSelectedFiles() {\r\n-\tconst fileInput = document.getElementById('sozlesmeDosyalari');\r\n-\tconst selectedFilesDiv = document.getElementById('selectedFiles');\r\n-\t\r\n-\tif (fileInput.files.length === 0) {\r\n-\t\tselectedFilesDiv.innerHTML = '';\r\n-\t\treturn;\r\n-\t}\r\n-\t\r\n-\tlet html = '<div class=\"selected-files-list\">';\r\n-\thtml += '<strong>Seçilen Dosyalar:</strong>';\r\n-\thtml += '<div class=\"list-group mt-2\">';\r\n-\t\r\n-\tfor (let i = 0; i < fileInput.files.length; i++) {\r\n-\t\tconst file = fileInput.files[i];\r\n-\t\tconst fileSize = (file.size / 1024 / 1024).toFixed(2); // MB\r\n-\t\tconst fileIcon = getFileIcon(file.name);\r\n-\t\t\r\n-\t\thtml += `<div class=\"list-group-item d-flex justify-content-between align-items-center\">\r\n-\t\t\t<div>\r\n-\t\t\t\t<i class=\"fa ${fileIcon} mr-2\"></i>\r\n-\t\t\t\t<strong>${file.name}</strong>\r\n-\t\t\t\t<small class=\"text-muted\"> (${fileSize} MB)</small>\r\n-\t\t\t</div>\r\n-\t\t\t<button type=\"button\" class=\"btn btn-sm btn-outline-danger\" onclick=\"removeFile(${i})\">\r\n-\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n-\t\t\t</button>\r\n-\t\t</div>`;\r\n-\t}\r\n-\t\r\n-\thtml += '</div></div>';\r\n-\tselectedFilesDiv.innerHTML = html;\r\n-}\r\n-\r\n-// Dosya ikonu belirleme\r\n-function getFileIcon(fileName) {\r\n-\tconst extension = fileName.split('.').pop().toLowerCase();\r\n-\t\r\n-\tswitch (extension) {\r\n-\t\tcase 'pdf': return 'fa-file-pdf text-danger';\r\n-\t\tcase 'doc':\r\n-\t\tcase 'docx': return 'fa-file-word text-primary';\r\n-\t\tcase 'jpg':\r\n-\t\tcase 'jpeg':\r\n-\t\tcase 'png': return 'fa-file-image text-success';\r\n-\t\tdefault: return 'fa-file text-secondary';\r\n-\t}\r\n-}\r\n-\r\n-// Dosya silme (geçici, yeni FileList oluşturmak gerek)\r\n-function removeFile(index) {\r\n-\tconst fileInput = document.getElementById('sozlesmeDosyalari');\r\n-\tconst dt = new DataTransfer();\r\n-\t\r\n-\tfor (let i = 0; i < fileInput.files.length; i++) {\r\n-\t\tif (i !== index) {\r\n-\t\t\tdt.items.add(fileInput.files[i]);\r\n-\t\t}\r\n-\t}\r\n-\t\r\n-\tfileInput.files = dt.files;\r\n-\tshowSelectedFiles();\r\n-}\r\n-\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1756916069204,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -266,8 +266,26 @@\n \t\t\ttransform: scale(1.05);\r\n \t\t\ttransition: all 0.3s;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Görsel yok - yükleme butonu stilleri */\r\n+\t\t.btn-outline-secondary.gorsel-btn {\r\n+\t\t\tborder: 1px dashed #6c757d;\r\n+\t\t\tbackground-color: transparent;\r\n+\t\t\ttransition: all 0.3s ease;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.btn-outline-secondary.gorsel-btn:hover {\r\n+\t\t\tbackground-color: #6c757d;\r\n+\t\t\tborder-color: #6c757d;\r\n+\t\t\tcolor: white;\r\n+\t\t\ttransform: scale(1.05);\r\n+\t\t}\r\n+\t\t\r\n+\t\t.btn-outline-secondary.gorsel-btn:hover .text-muted {\r\n+\t\t\tcolor: white !important;\r\n+\t\t}\r\n+\t\t\r\n \t\t/* Tahsilat görselleri için küçük butonlar */\r\n \t\t.btn-sm.btn-outline-success {\r\n \t\t\tmin-width: 50px;\r\n \t\t\tfont-size: 0.85rem;\r\n@@ -732,9 +750,14 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id) ?>', 'gorselPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image\"></i> <?= $isletme_gorsel_sayisi ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image text-muted\" title=\"Görsel yok\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-secondary gorsel-btn\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"İşletme görseli yok - Görselleri görüntülemek ve yüklemek için tıklayın\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id) ?>', 'gorselPencere', 'width=1000,height=700,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image text-muted mr-1\"></i><i class=\"fa fa-plus\" style=\"font-size: 10px; margin-left: -2px;\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tendif;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\telse: \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n@@ -844,9 +867,14 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id . \"?tip=satis&satis_id=\" . $veri->satis_sozlesme_id) ?>', 'satisGorselPencere', 'width=800,height=600,scrollbars=yes,resizable=yes')\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image\"></i> <?= $satis_gorsel_sayisi ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image text-muted\" title=\"Satış görseli yok\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button \r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"btn btn-sm btn-outline-secondary gorsel-btn\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Satış görseli yok - Görselleri görüntülemek ve yüklemek için tıklayın\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\" . $veri->cari_id . \"?tip=satis&satis_id=\" . $veri->satis_sozlesme_id) ?>', 'satisGorselPencere', 'width=1000,height=700,scrollbars=yes,resizable=yes')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image text-muted mr-1\"></i><i class=\"fa fa-plus\" style=\"font-size: 10px; margin-left: -2px;\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tendif;\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\telse: \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n"
                },
                {
                    "date": 1757054283680,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -459,8 +459,13 @@\n \t\t/* Select2 dropdown z-index modalda */\r\n \t\t.select2-dropdown {\r\n \t\t\tz-index: 9999 !important;\r\n \t\t}\r\n+\t\t\r\n+\t\t/* KDV breakdown bilgisini gizle */\r\n+\t\t.kdv-breakdown {\r\n+\t\t\tdisplay: none !important;\r\n+\t\t}\r\n \t</style>\r\n </head>\r\n <body>\r\n <div class=\"main-wrapper\">\r\n"
                },
                {
                    "date": 1757058573041,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1262,14 +1262,14 @@\n \t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t\t\t<table class=\"table table-sm\" id=\"modalStokTable\">\r\n \t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"40%\">Hizmet/Ürün Adı</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"15%\">Miktar</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat (KDV Dahil)</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"15%\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"20%\">Toplam (KDV Dahil)</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\">İşlem</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"42%\">Hizmet/Ürün Adı</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"5%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"22%\">Birim Fiyat (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"8%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"18%\">Toplam (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t\t\t<tbody>\r\n \t\t\t\t\t\t\t\t\t\t<tr>\r\n@@ -2126,13 +2126,13 @@\n \t\t\t\t\t<div class=\"w-100\">\r\n \t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"35%\">Stok Adı</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"12%\">Miktar</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"18%\">Birim Fiyat (KDV Dahil)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"15%\">Görsel</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"40%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"5%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"8%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"17%\">Görsel</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n"
                },
                {
                    "date": 1757059381667,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -464,8 +464,23 @@\n \t\t/* KDV breakdown bilgisini gizle */\r\n \t\t.kdv-breakdown {\r\n \t\t\tdisplay: none !important;\r\n \t\t}\r\n+\t\t\r\n+\t\t/* Miktar input genişliği */\r\n+\t\t.miktar {\r\n+\t\t\tmax-width: 80px !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* Birim fiyat input genişliği */\r\n+\t\t.birimFiyat {\r\n+\t\t\tmax-width: 120px !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* KDV dropdown genişliği */\r\n+\t\t.kdvOrani {\r\n+\t\t\tmax-width: 80px !important;\r\n+\t\t}\r\n \t</style>\r\n </head>\r\n <body>\r\n <div class=\"main-wrapper\">\r\n@@ -1262,13 +1277,13 @@\n \t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n \t\t\t\t\t\t\t\t<table class=\"table table-sm\" id=\"modalStokTable\">\r\n \t\t\t\t\t\t\t\t\t<thead>\r\n \t\t\t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"42%\">Hizmet/Ürün Adı</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"5%\">Miktar</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"22%\">Birim Fiyat (KDV Dahil)</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"8%\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t\t\t<th width=\"18%\">Toplam (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"55%\">Hizmet/Ürün Adı</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"8%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t\t\t<th width=\"7%\">Toplam (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t\t\t<tbody>\r\n@@ -2126,14 +2141,14 @@\n \t\t\t\t\t<div class=\"w-100\">\r\n \t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"40%\">Stok Adı</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"5%\">Miktar</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"20%\">Birim Fiyat (KDV Dahil)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"8%\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"17%\">Görsel</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"10%\">İşlem</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"55%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"8%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"7%\">Görsel</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n \t\t\t\t`;\r\n"
                },
                {
                    "date": 1757070300496,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -364,8 +364,18 @@\n \t\t\tborder-color: #ffc107 !important;\r\n \t\t\tbackground-color: #fffbee !important;\r\n \t\t}\r\n \t\t\r\n+\t\t.vade-tarih-degisti {\r\n+\t\t\tbackground-color: #e7f3ff !important;\r\n+\t\t\tborder-left: 4px solid #007bff !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.vade-tarih-degisti .vade-tarih-input {\r\n+\t\t\tborder-color: #007bff !important;\r\n+\t\t\tbackground-color: #f0f8ff !important;\r\n+\t\t}\r\n+\t\t\r\n \t\t.input-group-sm {\r\n \t\t\tmax-width: 150px;\r\n \t\t}\r\n \t\t\r\n@@ -1401,8 +1411,263 @@\n <!-- Select2 JS -->\r\n <script src=\"https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js\"></script>\r\n \r\n <script>\r\n+// Global fonksiyonları en başta tanımla\r\n+function showTahsilatModal(cariId, cariAd) {\r\n+\t$('#tahsilatModalLabel').html('<i class=\"fa fa-money mr-2\"></i>Tahsilat Detayları - ' + cariAd);\r\n+\t\r\n+\t// Cari bilgilerini modal'da sakla\r\n+\t$('#tahsilatModal').data('cari-id', cariId);\r\n+\t$('#tahsilatModal').data('cari-ad', cariAd);\r\n+\t\r\n+\t$('#tahsilatModal').modal('show');\r\n+\t$('#tahsilatLoading').show();\r\n+\t$('#tahsilatContent').hide();\r\n+\t\r\n+\t// AJAX ile tahsilat verilerini getir\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/getTahsilatDetay\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: { cari_id: cariId },\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\t$('#tahsilatLoading').hide();\r\n+\t\t\t$('#tahsilatContent').show();\r\n+\t\t\t\r\n+\t\t\tif (response.success && response.data.length > 0) {\r\n+\t\t\t\tlet html = `\r\n+\t\t\t\t\t<div class=\"table-responsive\">\r\n+\t\t\t\t\t\t<table class=\"table table-striped table-hover\">\r\n+\t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n+\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t<th>Tarih</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Belge No</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Tahsilat Tipi</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Tutar</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Vade Tarihi</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Açıklama</th>\r\n+\t\t\t\t\t\t\t\t\t<th>Görsel</th>\r\n+\t\t\t\t\t\t\t\t\t<th>İşlemler</th>\r\n+\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t</thead>\r\n+\t\t\t\t\t\t\t<tbody>\r\n+\t\t\t\t`;\r\n+\t\t\t\t\r\n+\t\t\t\tlet toplamTutar = 0;\r\n+\t\t\t\tresponse.data.forEach(function(item) {\r\n+\t\t\t\t\ttoplamTutar += parseFloat(item.tutar || 0);\r\n+\t\t\t\t\t\r\n+\t\t\t\t\thtml += `\r\n+\t\t\t\t\t\t<tr data-tahsilat-id=\"${item.unique_id}\" data-tip-kod=\"${item.tip_kod}\" data-source-id=\"${item.source_id}\" data-ch-id=\"${item.cari_hareket_id}\" data-original-tutar=\"${item.tutar}\">\r\n+\t\t\t\t\t\t\t<td>${item.tarih}</td>\r\n+\t\t\t\t\t\t\t<td>${item.belge_no || '-'}</td>\r\n+\t\t\t\t\t\t\t<td><span class=\"badge badge-info\">${item.tahsilat_tipi}</span></td>\r\n+\t\t\t\t\t\t\t<td class=\"text-right\">\r\n+\t\t\t\t\t\t\t\t<div class=\"input-group input-group-sm\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control tutar-input text-right\" \r\n+\t\t\t\t\t\t\t\t\t\t   value=\"${parseFloat(item.tutar).toFixed(2)}\" \r\n+\t\t\t\t\t\t\t\t\t\t   step=\"0.01\" min=\"0\"\r\n+\t\t\t\t\t\t\t\t\t\t   data-original=\"${parseFloat(item.tutar).toFixed(2)}\"\r\n+\t\t\t\t\t\t\t\t\t\t   onchange=\"tutarDegisti(this)\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"input-group-append\">\r\n+\t\t\t\t\t\t\t\t\t\t<span class=\"input-group-text\">₺</span>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t${(item.tip_kod == '2' || item.tip_kod == '4') ? \r\n+\t\t\t\t\t\t\t\t\t`<div class=\"input-group input-group-sm\">\r\n+\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"form-control vade-tarih-input text-center\" \r\n+\t\t\t\t\t\t\t\t\t\t\t   value=\"${item.vade_tarih ? item.vade_tarih : ''}\" \r\n+\t\t\t\t\t\t\t\t\t\t\t   data-original=\"${item.vade_tarih ? item.vade_tarih : ''}\"\r\n+\t\t\t\t\t\t\t\t\t\t\t   onchange=\"vadeTarihiDegisti(this)\">\r\n+\t\t\t\t\t\t\t\t\t</div>` : \r\n+\t\t\t\t\t\t\t\t\t'<span class=\"text-muted\">-</span>'}\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td>${item.aciklama || '-'}</td>\r\n+\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t${generateGorselButton(item)}\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t<button class=\"btn btn-danger btn-sm\" onclick=\"tahsilatSil('${item.unique_id}', '${item.tip_kod}', '${item.source_id}')\" title=\"Tahsilatı Sil\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n+\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t`;\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\thtml += `\r\n+\t\t\t\t\t\t\t</tbody>\r\n+\t\t\t\t\t\t\t<tfoot class=\"thead-dark\">\r\n+\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t<th colspan=\"3\">TOPLAM</th>\r\n+\t\t\t\t\t\t\t\t\t<th class=\"text-right\" id=\"tahsilat-toplam\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n+\t\t\t\t\t\t\t\t\t<th></th>\r\n+\t\t\t\t\t\t\t\t\t<th></th>\r\n+\t\t\t\t\t\t\t\t\t<th></th>\r\n+\t\t\t\t\t\t\t\t\t<th></th>\r\n+\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t</tfoot>\r\n+\t\t\t\t\t\t</table>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`;\r\n+\t\t\t\t\r\n+\t\t\t\t$('#tahsilatContent').html(html);\r\n+\t\t\t} else {\r\n+\t\t\t\t$('#tahsilatContent').html(`\r\n+\t\t\t\t\t<div class=\"alert alert-info text-center\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-info-circle fa-2x mb-2\"></i>\r\n+\t\t\t\t\t\t<h5>Tahsilat Bulunamadı</h5>\r\n+\t\t\t\t\t\t<p>Bu cari için henüz tahsilat kaydı bulunmuyor.</p>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`);\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\t$('#tahsilatLoading').hide();\r\n+\t\t\t$('#tahsilatContent').show().html(`\r\n+\t\t\t\t<div class=\"alert alert-danger text-center\">\r\n+\t\t\t\t\t<i class=\"fa fa-exclamation-triangle fa-2x mb-2\"></i>\r\n+\t\t\t\t\t<h5>Hata Oluştu</h5>\r\n+\t\t\t\t\t<p>Tahsilat verileri yüklenirken bir hata oluştu.</p>\r\n+\t\t\t\t\t<details>\r\n+\t\t\t\t\t\t<summary>Hata Detayı</summary>\r\n+\t\t\t\t\t\t<small>Status: ${status}</small><br>\r\n+\t\t\t\t\t\t<small>Error: ${error}</small><br>\r\n+\t\t\t\t\t\t<small>Response: ${xhr.responseText}</small><br>\r\n+\t\t\t\t\t\t<small>Status Code: ${xhr.status}</small>\r\n+\t\t\t\t\t</details>\r\n+\t\t\t\t</div>\r\n+\t\t\t`);\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+// Vade tarihi değiştiğinde çağrılan fonksiyon\r\n+function vadeTarihiDegisti(input) {\r\n+\tvar $input = $(input);\r\n+\tvar originalValue = $input.data('original');\r\n+\tvar currentValue = $input.val();\r\n+\t\r\n+\t// Değişiklik var mı kontrol et\r\n+\tif (originalValue !== currentValue) {\r\n+\t\t$input.closest('tr').addClass('vade-tarih-degisti');\r\n+\t\t$('#kaydetTahsilat').show();\r\n+\t} else {\r\n+\t\t$input.closest('tr').removeClass('vade-tarih-degisti');\r\n+\t\t\r\n+\t\t// Hiç değişiklik kalmadıysa kaydet butonunu gizle\r\n+\t\tif ($('.tutar-degisti, .vade-tarih-degisti').length === 0) {\r\n+\t\t\t$('#kaydetTahsilat').hide();\r\n+\t\t}\r\n+\t}\r\n+}\r\n+\r\n+// Diğer gerekli fonksiyonlar\r\n+function tutarDegisti(input) {\r\n+\tvar $input = $(input);\r\n+\tvar originalValue = parseFloat($input.data('original'));\r\n+\tvar currentValue = parseFloat($input.val()) || 0;\r\n+\t\r\n+\t// Değişiklik var mı kontrol et\r\n+\tif (originalValue !== currentValue) {\r\n+\t\t$input.closest('tr').addClass('tutar-degisti');\r\n+\t\t$('#kaydetTahsilat').show();\r\n+\t} else {\r\n+\t\t$input.closest('tr').removeClass('tutar-degisti');\r\n+\t\t\r\n+\t\t// Hiç değişiklik kalmadıysa kaydet butonunu gizle\r\n+\t\tif ($('.tutar-degisti, .vade-tarih-degisti').length === 0) {\r\n+\t\t\t$('#kaydetTahsilat').hide();\r\n+\t\t}\r\n+\t}\r\n+\t\r\n+\t// Toplamı güncelle\r\n+\tupdateTahsilatToplam();\r\n+}\r\n+\r\n+function updateTahsilatToplam() {\r\n+\tlet toplam = 0;\r\n+\t$('#tahsilatContent tbody tr').each(function() {\r\n+\t\tlet tutarInput = $(this).find('.tutar-input');\r\n+\t\tlet tutar = parseFloat(tutarInput.val()) || 0;\r\n+\t\ttoplam += tutar;\r\n+\t});\r\n+\t\r\n+\t// Footer'daki toplamı güncelle\r\n+\t$('#tahsilat-toplam').html(toplam.toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺');\r\n+}\r\n+\r\n+function tahsilatSil(uniqueId, tipKod, sourceId) {\r\n+\tSwal.fire({\r\n+\t\ttitle: \"Emin misiniz?\",\r\n+\t\ttext: \"Bu tahsilat kaydını silmek istediğinizden emin misiniz?\",\r\n+\t\ticon: \"warning\",\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: \"#3085d6\",\r\n+\t\tcancelButtonColor: \"#d33\",\r\n+\t\tconfirmButtonText: \"Evet, sil!\",\r\n+\t\tcancelButtonText: \"İptal\"\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t// AJAX ile sil\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/tahsilatSil\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: {\r\n+\t\t\t\t\tunique_id: uniqueId,\r\n+\t\t\t\t\ttip_kod: tipKod,\r\n+\t\t\t\t\tsource_id: sourceId\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire(\"Silindi!\", \"Tahsilat kaydı başarıyla silindi.\", \"success\").then(() => {\r\n+\t\t\t\t\t\t\t// Modal'ı yenile\r\n+\t\t\t\t\t\t\tconst cariId = $('#tahsilatModal').data('cari-id');\r\n+\t\t\t\t\t\t\tconst cariAd = $('#tahsilatModal').data('cari-ad');\r\n+\t\t\t\t\t\t\tshowTahsilatModal(cariId, cariAd);\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire(\"Hata!\", response.message || \"Silme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tSwal.fire(\"Hata!\", \"Silme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+function generateGorselButton(item) {\r\n+\t// Kasa hareketlerinde görsel alanı yok\r\n+\tif (item.tip_kod == '3') {\r\n+\t\treturn '<span class=\"badge badge-secondary\">Görsel Yok</span>';\r\n+\t}\r\n+\t\r\n+\tlet html = '';\r\n+\t\r\n+\t// Mevcut görseller varsa göster\r\n+\tif (item.gorseller && item.gorseller.length > 0) {\r\n+\t\tif (item.gorseller.length === 1) {\r\n+\t\t\t// Tek görsel\r\n+\t\t\thtml += `<button class=\"btn btn-sm btn-info\" onclick=\"showGorsel('${item.gorseller[0]}', '${item.tahsilat_tipi}')\">\r\n+\t\t\t\t<i class=\"fa fa-image\"></i> Görsel\r\n+\t\t\t</button>`;\r\n+\t\t} else {\r\n+\t\t\t// Çoklu görsel\r\n+\t\t\thtml += `<button class=\"btn btn-sm btn-info\" onclick=\"showGorselGaleri('${item.unique_id}', '${item.tahsilat_tipi}', ${JSON.stringify(item.gorseller).replace(/\"/g, '&quot;')})\">\r\n+\t\t\t\t<i class=\"fa fa-images\"></i> ${item.gorseller.length} Görsel\r\n+\t\t\t</button>`;\r\n+\t\t}\r\n+\t}\r\n+\t\r\n+\treturn html || '<span class=\"text-muted\">-</span>';\r\n+}\r\n+\r\n $(document).ready(function() {\r\n \t// DataTable başlat\r\n \t$('#raporTable').DataTable({\r\n \t\t\"language\": {\r\n@@ -1642,9 +1907,9 @@\n \t$('#imageModal').modal('show');\r\n }\r\n \r\n // Satış Sözleşmesi Modal fonksiyonu\r\n-function openSatisSozlesmeModal(cariId, cariIsletme) {\r\n+window.openSatisSozlesmeModal = function(cariId, cariIsletme) {\r\n \tconsole.log('openSatisSozlesmeModal called with:', { cariId, cariIsletme });\r\n \t\r\n \t// Modal başlığını güncelle\r\n \t$('#satisSozlesmeModalLabel').html('<i class=\"fa fa-file-contract mr-2\"></i>Satış Sözleşmesi Oluştur - ' + cariIsletme);\r\n@@ -1701,9 +1966,9 @@\n \t$('#modalVergiDahilToplamInput2').val(genelToplam.toFixed(2));\r\n }\r\n \r\n // Yeni stok satırı ekleme\r\n-function addStokRow() {\r\n+window.addStokRow = function() {\r\n \t// Mevcut ilk satırdaki select'in option'larını kopyala\r\n \tconst firstStokSelect = $('#modalStokTable tbody tr:first-child .stok-dropdown');\r\n \tconst stokOptions = firstStokSelect.html();\r\n \t\r\n@@ -1745,9 +2010,9 @@\n \tinitializeStokDropdownEvents();\r\n }\r\n \r\n // Stok satırını silme\r\n-function removeStokRow(button) {\r\n+window.removeStokRow = function(button) {\r\n \tif ($('#modalStokTable tbody tr').length > 1) {\r\n \t\t$(button).closest('tr').remove();\r\n \t\tupdateModalTotals();\r\n \t}\r\n@@ -2101,9 +2366,9 @@\n \t});\r\n });\r\n \r\n // Stok Bilgisi modal fonksiyonu\r\n-function openStokBilgisiModal(satisId, cariId, cariIsletme) {\r\n+window.openStokBilgisiModal = function(satisId, cariId, cariIsletme) {\r\n \tconsole.log('openStokBilgisiModal called with:', { satisId, cariId, cariIsletme });\r\n \t\r\n \t$('#stokBilgisiModalLabel').html('<i class=\"fa fa-boxes mr-2\"></i>Stok Bilgileri - ' + cariIsletme);\r\n \t\r\n@@ -2276,9 +2541,9 @@\n \t`;\r\n }\r\n \r\n // Yeni stok satırı ekle\r\n-function stokSatiriEkle() {\r\n+window.stokSatiriEkle = function() {\r\n \tconst tbody = document.getElementById('stokTableBody');\r\n \tconst newIndex = tbody.children.length;\r\n \tconst newRow = createStokRow(newIndex, {});\r\n \ttbody.insertAdjacentHTML('beforeend', newRow);\r\n@@ -2291,9 +2556,9 @@\n \tconst stokDropdown = newRowElement.querySelector('.stokDropdown');\r\n \tif (stokDropdown) {\r\n \t\t$(stokDropdown).select2('open');\r\n \t}\r\n-}\r\n+};\r\n \r\n // Stok satırı sil\r\n function stokSatiriSil(button) {\r\n \tif (document.getElementById('stokTableBody').children.length > 1) {\r\n@@ -2528,179 +2793,8 @@\n \t$(this).data('satisId', satisId);\r\n \t$(this).data('cariId', cariId);\r\n });\r\n \r\n-// Tahsilat detay modal fonksiyonu\r\n-function showTahsilatModal(cariId, cariAd) {\r\n-\t$('#tahsilatModalLabel').html('<i class=\"fa fa-money mr-2\"></i>Tahsilat Detayları - ' + cariAd);\r\n-\t\r\n-\t// Cari bilgilerini modal'da sakla\r\n-\t$('#tahsilatModal').data('cari-id', cariId);\r\n-\t$('#tahsilatModal').data('cari-ad', cariAd);\r\n-\t\r\n-\t$('#tahsilatModal').modal('show');\r\n-\t$('#tahsilatLoading').show();\r\n-\t$('#tahsilatContent').hide();\r\n-\t\r\n-\t// AJAX ile tahsilat verilerini getir\r\n-\t$.ajax({\r\n-\t\turl: '<?= base_url(\"muhasebe/getTahsilatDetay\") ?>',\r\n-\t\tmethod: 'POST',\r\n-\t\tdata: { cari_id: cariId },\r\n-\t\tdataType: 'json',\r\n-\t\tsuccess: function(response) {\r\n-\t\t\t$('#tahsilatLoading').hide();\r\n-\t\t\t$('#tahsilatContent').show();\r\n-\t\t\t\r\n-\t\t\tif (response.success && response.data.length > 0) {\r\n-\t\t\t\tlet html = `\r\n-\t\t\t\t\t<div class=\"table-responsive\">\r\n-\t\t\t\t\t\t<table class=\"table table-striped table-hover\">\r\n-\t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n-\t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th>Tarih</th>\r\n-\t\t\t\t\t\t\t\t\t<th>Belge No</th>\r\n-\t\t\t\t\t\t\t\t\t<th>Tahsilat Tipi</th>\r\n-\t\t\t\t\t\t\t\t\t<th>Tutar</th>\r\n-\t\t\t\t\t\t\t\t\t<th>Açıklama</th>\r\n-\t\t\t\t\t\t\t\t\t<th>Görsel</th>\r\n-\t\t\t\t\t\t\t\t\t<th>İşlemler</th>\r\n-\t\t\t\t\t\t\t\t</tr>\r\n-\t\t\t\t\t\t\t</thead>\r\n-\t\t\t\t\t\t\t<tbody>\r\n-\t\t\t\t`;\r\n-\t\t\t\t\r\n-\t\t\t\tlet toplamTutar = 0;\r\n-\t\t\t\tresponse.data.forEach(function(item) {\r\n-\t\t\t\t\ttoplamTutar += parseFloat(item.tutar || 0);\r\n-\t\t\t\t\t\r\n-\t\t\t\t\thtml += `\r\n-\t\t\t\t\t\t<tr data-tahsilat-id=\"${item.unique_id}\" data-tip-kod=\"${item.tip_kod}\" data-source-id=\"${item.source_id}\" data-ch-id=\"${item.cari_hareket_id}\" data-original-tutar=\"${item.tutar}\">\r\n-\t\t\t\t\t\t\t<td>${item.tarih}</td>\r\n-\t\t\t\t\t\t\t<td>${item.belge_no || '-'}</td>\r\n-\t\t\t\t\t\t\t<td><span class=\"badge badge-info\">${item.tahsilat_tipi}</span></td>\r\n-\t\t\t\t\t\t\t<td class=\"text-right\">\r\n-\t\t\t\t\t\t\t\t<div class=\"input-group input-group-sm\">\r\n-\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"form-control tutar-input text-right\" \r\n-\t\t\t\t\t\t\t\t\t\t   value=\"${parseFloat(item.tutar).toFixed(2)}\" \r\n-\t\t\t\t\t\t\t\t\t\t   step=\"0.01\" min=\"0\"\r\n-\t\t\t\t\t\t\t\t\t\t   data-original=\"${parseFloat(item.tutar).toFixed(2)}\"\r\n-\t\t\t\t\t\t\t\t\t\t   onchange=\"tutarDegisti(this)\">\r\n-\t\t\t\t\t\t\t\t\t<div class=\"input-group-append\">\r\n-\t\t\t\t\t\t\t\t\t\t<span class=\"input-group-text\">₺</span>\r\n-\t\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t<td>${item.aciklama || '-'}</td>\r\n-\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t${generateGorselButton(item)}\r\n-\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t<td class=\"text-center\">\r\n-\t\t\t\t\t\t\t\t<button class=\"btn btn-danger btn-sm\" onclick=\"tahsilatSil('${item.unique_id}', '${item.tip_kod}', '${item.source_id}')\" title=\"Tahsilatı Sil\">\r\n-\t\t\t\t\t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n-\t\t\t\t\t\t\t\t</button>\r\n-\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t</tr>\r\n-\t\t\t\t\t`;\r\n-\t\t\t\t});\r\n-\t\t\t\t\r\n-\t\t\t\thtml += `\r\n-\t\t\t\t\t\t\t</tbody>\r\n-\t\t\t\t\t\t\t<tfoot class=\"thead-dark\">\r\n-\t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th colspan=\"3\">TOPLAM</th>\r\n-\t\t\t\t\t\t\t\t\t<th class=\"text-right\" id=\"tahsilat-toplam\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n-\t\t\t\t\t\t\t\t\t<th></th>\r\n-\t\t\t\t\t\t\t\t\t<th></th>\r\n-\t\t\t\t\t\t\t\t\t<th></th>\r\n-\t\t\t\t\t\t\t\t</tr>\r\n-\t\t\t\t\t\t\t</tfoot>\r\n-\t\t\t\t\t\t</table>\r\n-\t\t\t\t\t</div>\r\n-\t\t\t\t`;\r\n-\t\t\t\t\r\n-\t\t\t\t$('#tahsilatContent').html(html);\r\n-\t\t\t} else {\r\n-\t\t\t\t$('#tahsilatContent').html(`\r\n-\t\t\t\t\t<div class=\"alert alert-info text-center\">\r\n-\t\t\t\t\t\t<i class=\"fa fa-info-circle fa-2x mb-2\"></i>\r\n-\t\t\t\t\t\t<h5>Tahsilat Bulunamadı</h5>\r\n-\t\t\t\t\t\t<p>Bu cari için henüz tahsilat kaydı bulunmuyor.</p>\r\n-\t\t\t\t\t</div>\r\n-\t\t\t\t`);\r\n-\t\t\t}\r\n-\t\t},\r\n-\t\terror: function(xhr, status, error) {\r\n-\t\t\t$('#tahsilatLoading').hide();\r\n-\t\t\t$('#tahsilatContent').show().html(`\r\n-\t\t\t\t<div class=\"alert alert-danger text-center\">\r\n-\t\t\t\t\t<i class=\"fa fa-exclamation-triangle fa-2x mb-2\"></i>\r\n-\t\t\t\t\t<h5>Hata Oluştu</h5>\r\n-\t\t\t\t\t<p>Tahsilat verileri yüklenirken bir hata oluştu.</p>\r\n-\t\t\t\t\t<details>\r\n-\t\t\t\t\t\t<summary>Hata Detayı</summary>\r\n-\t\t\t\t\t\t<small>Status: ${status}</small><br>\r\n-\t\t\t\t\t\t<small>Error: ${error}</small><br>\r\n-\t\t\t\t\t\t<small>Response: ${xhr.responseText}</small><br>\r\n-\t\t\t\t\t\t<small>Status Code: ${xhr.status}</small>\r\n-\t\t\t\t\t</details>\r\n-\t\t\t\t</div>\r\n-\t\t\t`);\r\n-\t\t}\r\n-\t});\r\n-}\r\n-\r\n-// Görsel buton oluşturma fonksiyonu\r\n-function generateGorselButton(item) {\r\n-\t// Kasa hareketlerinde görsel alanı yok\r\n-\tif (item.tip_kod == '3') {\r\n-\t\treturn '<span class=\"badge badge-secondary\">Görsel Yok</span>';\r\n-\t}\r\n-\t\r\n-\tlet gorselAlan = '';\r\n-\tlet uploadFolder = '';\r\n-\t\r\n-\t// Tip koduna göre görsel alanı ve upload klasörü belirle\r\n-\tswitch(item.tip_kod) {\r\n-\t\tcase '1': // Banka\r\n-\t\t\tgorselAlan = 'bh_gorsel';\r\n-\t\t\tuploadFolder = 'dekontlar';\r\n-\t\t\tbreak;\r\n-\t\tcase '2': // Çek\r\n-\t\t\tgorselAlan = 'cek_gorsel';  \r\n-\t\t\tuploadFolder = 'cekler';\r\n-\t\t\tbreak;\r\n-\t\tcase '4': // Senet\r\n-\t\t\tgorselAlan = 'senet_gorsel';\r\n-\t\t\tuploadFolder = 'senetler';\r\n-\t\t\tbreak;\r\n-\t}\r\n-\t\r\n-\t// Çoklu görsel desteği\r\n-\tlet html = '';\r\n-\tlet gorselSayisi = 0;\r\n-\t\r\n-\tif (item.gorseller && item.gorseller.length > 0) {\r\n-\t\tgorselSayisi = item.gorseller.length;\r\n-\t\t\r\n-\t\t// Görsel galerisi butonu\r\n-\t\thtml += `\r\n-\t\t\t<button class=\"btn btn-sm btn-success\" onclick=\"showGorselGaleri('${item.unique_id}', '${item.tahsilat_tipi}', ${JSON.stringify(item.gorseller).replace(/\"/g, '&quot;')})\">\r\n-\t\t\t\t<i class=\"fa fa-images\"></i> Görseller (${gorselSayisi})\r\n-\t\t\t</button>\r\n-\t\t`;\r\n-\t}\r\n-\t\r\n-\t// Her zaman yükleme butonu göster\r\n-\thtml += `\r\n-\t\t<button class=\"btn btn-sm btn-primary ml-1\" onclick=\"uploadGorsel('${item.unique_id}', '${item.tip_kod}', '${item.source_id}', '${gorselAlan}')\">\r\n-\t\t\t<i class=\"fa fa-upload\"></i> ${gorselSayisi > 0 ? 'Ekle' : 'Yükle'}\r\n-\t\t</button>\r\n-\t`;\r\n-\t\r\n-\treturn html;\r\n-}\r\n-\r\n // Stok görsel butonu oluşturma fonksiyonu\r\n function generateStokGorselButton(data) {\r\n \tif (!data || !data.satisStok_id) {\r\n \t\treturn '<span class=\"badge badge-secondary\">Henüz kaydedilmemiş</span>';\r\n@@ -3052,9 +3146,9 @@\n \t});\r\n }\r\n \r\n // Excel export fonksiyonu\r\n-function exportToExcel() {\r\n+window.exportToExcel = function() {\r\n \t// Excel export işlemi için AJAX çağrısı veya form submit\r\n \twindow.open('<?= base_url(\"muhasebe/tam-ana-rapor-excel\") ?>', '_blank');\r\n }\r\n \r\n@@ -3164,48 +3258,13 @@\n \t\t}\r\n \t});\r\n }\r\n \r\n-// Tahsilat toplamını yeniden hesapla\r\n-function updateTahsilatToplam() {\r\n-\tlet toplam = 0;\r\n-\t$('#tahsilatContent tbody tr').each(function() {\r\n-\t\tlet tutarInput = $(this).find('.tutar-input');\r\n-\t\tlet tutar = parseFloat(tutarInput.val()) || 0;\r\n-\t\ttoplam += tutar;\r\n-\t});\r\n-\t\r\n-\t// Footer'daki toplamı güncelle\r\n-\t$('#tahsilat-toplam').html(toplam.toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺');\r\n-}\r\n-\r\n-// Tutar değiştiğinde çağrılan fonksiyon\r\n-function tutarDegisti(input) {\r\n-\tvar $input = $(input);\r\n-\tvar originalValue = parseFloat($input.data('original'));\r\n-\tvar currentValue = parseFloat($input.val()) || 0;\r\n-\t\r\n-\t// Değişiklik var mı kontrol et\r\n-\tif (originalValue !== currentValue) {\r\n-\t\t$input.closest('tr').addClass('tutar-degisti');\r\n-\t\t$('#kaydetTahsilat').show();\r\n-\t} else {\r\n-\t\t$input.closest('tr').removeClass('tutar-degisti');\r\n-\t\t\r\n-\t\t// Hiç değişiklik kalmadıysa kaydet butonunu gizle\r\n-\t\tif ($('.tutar-degisti').length === 0) {\r\n-\t\t\t$('#kaydetTahsilat').hide();\r\n-\t\t}\r\n-\t}\r\n-\t\r\n-\t// Toplamı güncelle\r\n-\tupdateTahsilatToplam();\r\n-}\r\n-\r\n-// Tutar değişikliklerini kaydet\r\n-function kaydetTutarDegisiklikleri() {\r\n+// Tutar ve vade tarihi değişikliklerini kaydet\r\n+window.kaydetTutarDegisiklikleri = function() {\r\n \tvar degisiklikler = [];\r\n \t\r\n+\t// Tutar değişikliklerini topla\r\n \t$('.tutar-degisti').each(function() {\r\n \t\tvar $row = $(this);\r\n \t\tvar uniqueId = $row.data('tahsilat-id');\r\n \t\tvar tipKod = $row.data('tip-kod');\r\n@@ -3219,21 +3278,43 @@\n \t\t\ttip_kod: tipKod,\r\n \t\t\tsource_id: sourceId,\r\n \t\t\tch_id: chId,\r\n \t\t\tyeni_tutar: yeniTutar,\r\n-\t\t\teski_tutar: eskiTutar\r\n+\t\t\teski_tutar: eskiTutar,\r\n+\t\t\tdegisiklik_tipi: 'tutar'\r\n \t\t});\r\n \t});\r\n \t\r\n+\t// Vade tarihi değişikliklerini topla\r\n+\t$('.vade-tarih-degisti').each(function() {\r\n+\t\tvar $row = $(this);\r\n+\t\tvar uniqueId = $row.data('tahsilat-id');\r\n+\t\tvar tipKod = $row.data('tip-kod');\r\n+\t\tvar sourceId = $row.data('source-id');\r\n+\t\tvar chId = $row.data('ch-id');\r\n+\t\tvar yeniVadeTarihi = $row.find('.vade-tarih-input').val();\r\n+\t\tvar eskiVadeTarihi = $row.find('.vade-tarih-input').data('original');\r\n+\t\t\r\n+\t\tdegisiklikler.push({\r\n+\t\t\tunique_id: uniqueId,\r\n+\t\t\ttip_kod: tipKod,\r\n+\t\t\tsource_id: sourceId,\r\n+\t\t\tch_id: chId,\r\n+\t\t\tyeni_vade_tarihi: yeniVadeTarihi,\r\n+\t\t\teski_vade_tarihi: eskiVadeTarihi,\r\n+\t\t\tdegisiklik_tipi: 'vade_tarihi'\r\n+\t\t});\r\n+\t});\r\n+\t\r\n \tif (degisiklikler.length === 0) {\r\n \t\tSwal.fire('Bilgi', 'Değişiklik yapılmadı.', 'info');\r\n \t\treturn;\r\n \t}\r\n \t\r\n \t// Onay penceresi göster\r\n \tSwal.fire({\r\n \t\ttitle: \"Değişiklikleri Kaydet\",\r\n-\t\ttext: `${degisiklikler.length} adet tahsilat tutarı güncellenmek üzere. Devam etmek istiyor musunuz?`,\r\n+\t\ttext: `${degisiklikler.length} adet tahsilat bilgisi güncellenmek üzere. Devam etmek istiyor musunuz?`,\r\n \t\ticon: \"warning\",\r\n \t\tshowCancelButton: true,\r\n \t\tconfirmButtonColor: \"#28a745\",\r\n \t\tconfirmButtonText: \"Evet, Kaydet\",\r\n@@ -3241,18 +3322,18 @@\n \t}).then((result) => {\r\n \t\tif (result.isConfirmed) {\r\n \t\t\t// AJAX ile kaydet\r\n \t\t\t$.ajax({\r\n-\t\t\t\turl: '<?= base_url(\"muhasebe/tahsilatTutarGuncelle\") ?>',\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/tahsilatGuncelle\") ?>',\r\n \t\t\t\tmethod: 'POST',\r\n \t\t\t\tdata: { \r\n \t\t\t\t\tdegisiklikler: degisiklikler\r\n \t\t\t\t},\r\n \t\t\t\tdataType: 'json',\r\n \t\t\t\tbeforeSend: function() {\r\n \t\t\t\t\tSwal.fire({\r\n \t\t\t\t\t\ttitle: \"Kaydediliyor\",\r\n-\t\t\t\t\t\ttext: \"Tutar değişiklikleri kaydediliyor...\",\r\n+\t\t\t\t\t\ttext: \"Tahsilat bilgileri kaydediliyor...\",\r\n \t\t\t\t\t\ticon: \"info\",\r\n \t\t\t\t\t\tshowConfirmButton: false,\r\n \t\t\t\t\t\tallowOutsideClick: false\r\n \t\t\t\t\t});\r\n@@ -3261,23 +3342,32 @@\n \t\t\t\t\tconsole.log('Kaydet Response:', response);\r\n \t\t\t\t\tif (response.success) {\r\n \t\t\t\t\t\tSwal.fire({\r\n \t\t\t\t\t\t\ttitle: \"Başarılı!\",\r\n-\t\t\t\t\t\t\ttext: response.message || \"Tutar değişiklikleri başarıyla kaydedildi.\",\r\n+\t\t\t\t\t\t\ttext: response.message || \"Tahsilat bilgileri başarıyla kaydedildi.\",\r\n \t\t\t\t\t\t\ticon: \"success\",\r\n \t\t\t\t\t\t\tconfirmButtonText: \"Tamam\"\r\n \t\t\t\t\t\t}).then(() => {\r\n \t\t\t\t\t\t\t// Değişiklik işaretlerini kaldır\r\n-\t\t\t\t\t\t\t$('.tutar-degisti').removeClass('tutar-degisti');\r\n+\t\t\t\t\t\t\t$('.tutar-degisti, .vade-tarih-degisti').removeClass('tutar-degisti vade-tarih-degisti');\r\n \t\t\t\t\t\t\t\r\n \t\t\t\t\t\t\t// Orijinal değerleri güncelle\r\n \t\t\t\t\t\t\t$('.tutar-input').each(function() {\r\n \t\t\t\t\t\t\t\t$(this).data('original', $(this).val());\r\n \t\t\t\t\t\t\t});\r\n+\t\t\t\t\t\t\t$('.vade-tarih-input').each(function() {\r\n+\t\t\t\t\t\t\t\t$(this).data('original', $(this).val());\r\n+\t\t\t\t\t\t\t});\r\n \t\t\t\t\t\t\t\r\n \t\t\t\t\t\t\t// Kaydet butonunu gizle\r\n \t\t\t\t\t\t\t$('#kaydetTahsilat').hide();\r\n+\t\t\t\t\t\t\t$('.tutar-input').each(function() {\r\n+\t\t\t\t\t\t\t\t$(this).data('original', $(this).val());\r\n+\t\t\t\t\t\t\t});\r\n \t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\t// Kaydet butonunu gizle\r\n+\t\t\t\t\t\t\t$('#kaydetTahsilat').hide();\r\n+\t\t\t\t\t\t\t\r\n \t\t\t\t\t\t\t// Ana sayfayı yenile (tutarlar değişti)\r\n \t\t\t\t\t\t\tlocation.reload();\r\n \t\t\t\t\t\t});\r\n \t\t\t\t\t} else {\r\n@@ -3290,9 +3380,9 @@\n \t\t\t\t}\r\n \t\t\t});\r\n \t\t}\r\n \t});\r\n-}\r\n+};\r\n \r\n // Arama formu geliştirmeleri\r\n $(document).ready(function() {\r\n \t// Sadece bizim cari_search inputumuz için autocomplete'i başlat\r\n"
                },
                {
                    "date": 1757070823816,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -559,9 +559,9 @@\n \t\t\t\t<div class=\"col-xl-3 col-sm-6 col-12\">\r\n \t\t\t\t\t<div class=\"card card-stats card-danger\">\r\n \t\t\t\t\t\t<div class=\"card-body\">\r\n \t\t\t\t\t\t\t<div class=\"stats-number\">\r\n-\t\t\t\t\t\t\t\t<?= number_format($toplam_satis_tutar ?? 0, 2, ',', '.') ?> ₺\r\n+\t\t\t\t\t\t\t\t<?= number_format($toplam_satis_tutar ?? 0, 0, ',', '.') ?> ₺\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t<div class=\"stats-label\">\r\n \t\t\t\t\t\t\t\t<i class=\"fa fa-money mr-2\"></i>Toplam Satış\r\n \t\t\t\t\t\t\t</div>\r\n@@ -577,9 +577,9 @@\n \t\t\t\t\t\t<div class=\"card-body text-center\">\r\n \t\t\t\t\t\t\t<h5 class=\"card-title\">Toplam Satış Tutarı (KDV Dahil)</h5>\r\n \t\t\t\t\t\t\t<h3 class=\"text-primary\">\r\n \t\t\t\t\t\t\t\t<i class=\"fa fa-shopping-cart mr-2\"></i>\r\n-\t\t\t\t\t\t\t\t<?= number_format($toplam_satis_tutar ?? 0, 2, ',', '.') ?> ₺\r\n+\t\t\t\t\t\t\t\t<?= number_format($toplam_satis_tutar ?? 0, 0, ',', '.') ?> ₺\r\n \t\t\t\t\t\t\t</h3>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t</div>\r\n@@ -588,9 +588,9 @@\n \t\t\t\t\t\t<div class=\"card-body text-center\">\r\n \t\t\t\t\t\t\t<h5 class=\"card-title\">Toplam Tahsilat Tutarı</h5>\r\n \t\t\t\t\t\t\t<h3 class=\"text-success\">\r\n \t\t\t\t\t\t\t\t<i class=\"fa fa-money mr-2\"></i>\r\n-\t\t\t\t\t\t\t\t<?= number_format($toplam_tahsilat_tutar ?? 0, 2, ',', '.') ?> ₺\r\n+\t\t\t\t\t\t\t\t<?= number_format($toplam_tahsilat_tutar ?? 0, 0, ',', '.') ?> ₺\r\n \t\t\t\t\t\t\t</h3>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t</div>\r\n@@ -820,9 +820,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"satis-tutar-container\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 0, ',', '.') ?> ₺</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->toplam_satis_sayisi) && $veri->toplam_satis_sayisi > 1): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-outline-primary ml-2\" \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"toggleSatisDetaylar(<?= $veri->cari_id ?>)\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"toggle-btn-<?= $veri->cari_id ?>\"\r\n@@ -915,9 +915,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->tahsilat_tutar): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk text-success\" style=\"cursor: pointer;\" \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  onclick=\"showTahsilatModal(<?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme) ?>')\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  title=\"Tahsilat detaylarını görmek için tıklayın\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= number_format($veri->tahsilat_tutar, 2, ',', '.') ?> ₺\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= number_format($veri->tahsilat_tutar, 0, ',', '.') ?> ₺\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n@@ -1501,9 +1501,9 @@\n \t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t\t<tfoot class=\"thead-dark\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th colspan=\"3\">TOPLAM</th>\r\n-\t\t\t\t\t\t\t\t\t<th class=\"text-right\" id=\"tahsilat-toplam\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺</th>\r\n+\t\t\t\t\t\t\t\t\t<th class=\"text-right\" id=\"tahsilat-toplam\">${toplamTutar.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ₺</th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n \t\t\t\t\t\t\t\t\t<th></th>\r\n@@ -1595,9 +1595,9 @@\n \t\ttoplam += tutar;\r\n \t});\r\n \t\r\n \t// Footer'daki toplamı güncelle\r\n-\t$('#tahsilat-toplam').html(toplam.toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺');\r\n+\t$('#tahsilat-toplam').html(toplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + ' ₺');\r\n }\r\n \r\n function tahsilatSil(uniqueId, tipKod, sourceId) {\r\n \tSwal.fire({\r\n@@ -2584,9 +2584,9 @@\n \t\ttoplam += toplamSatir;\r\n \t});\r\n \t\r\n \tdocument.getElementById('toplamTutar').textContent = \r\n-\t\ttoplam.toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺';\r\n+\t\ttoplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + ' ₺';\r\n }\r\n \r\n // KDV ayrıştırmasını göster\r\n function updateKdvBreakdown(input) {\r\n@@ -3204,9 +3204,9 @@\n \t\r\n \t// Onay penceresi göster\r\n \tSwal.fire({\r\n \t\ttitle: \"Emin misiniz?\",\r\n-\t\ttext: `${tahsilatTipi} kaydını silmek istediğinize emin misiniz?\\n\\nTutar: ${parseFloat(tutar).toLocaleString('tr-TR', {minimumFractionDigits: 2})} ₺\\n\\nBu işlem geri alınamaz!`,\r\n+\t\ttext: `${tahsilatTipi} kaydını silmek istediğinize emin misiniz?\\n\\nTutar: ${parseFloat(tutar).toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ₺\\n\\nBu işlem geri alınamaz!`,\r\n \t\ticon: \"warning\",\r\n \t\tshowCancelButton: true,\r\n \t\tconfirmButtonColor: \"#dc3545\",\r\n \t\tconfirmButtonText: \"Evet, Sil\",\r\n"
                },
                {
                    "date": 1757074994046,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3246,14 +3246,28 @@\n \t\t\t\t\t\t\t\tupdateTahsilatToplam();\r\n \t\t\t\t\t\t\t});\r\n \t\t\t\t\t\t});\r\n \t\t\t\t\t} else {\r\n-\t\t\t\t\t\tSwal.fire(\"Hata!\", response.message || \"Silme işlemi başarısız oldu.\", \"error\");\r\n+\t\t\t\t\t\tSwal.fire(\"Hata!\", response.message || \"Tahsilat silinirken beklenmeyen bir hata oluştu.\", \"error\");\r\n \t\t\t\t\t}\r\n \t\t\t\t},\r\n \t\t\t\terror: function(xhr, status, error) {\r\n \t\t\t\t\tconsole.error('Silme Hatası:', {xhr, status, error});\r\n-\t\t\t\t\tSwal.fire(\"Hata!\", \"Tahsilat silme işlemi sırasında bir hata oluştu: \" + error, \"error\");\r\n+\t\t\t\t\tlet errorMessage = \"Tahsilat silme işlemi sırasında bir hata oluştu.\";\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t// Daha detaylı hata mesajı\r\n+\t\t\t\t\tif (xhr.responseJSON && xhr.responseJSON.message) {\r\n+\t\t\t\t\t\terrorMessage = xhr.responseJSON.message;\r\n+\t\t\t\t\t} else if (xhr.responseText) {\r\n+\t\t\t\t\t\ttry {\r\n+\t\t\t\t\t\t\tconst response = JSON.parse(xhr.responseText);\r\n+\t\t\t\t\t\t\terrorMessage = response.message || errorMessage;\r\n+\t\t\t\t\t\t} catch (e) {\r\n+\t\t\t\t\t\t\terrorMessage += \" (Sunucu hatası: \" + xhr.status + \")\";\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t}\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tSwal.fire(\"Hata!\", errorMessage, \"error\");\r\n \t\t\t\t}\r\n \t\t\t});\r\n \t\t}\r\n \t});\r\n@@ -3495,10 +3509,25 @@\n \t\t\t\t\t} else {\r\n \t\t\t\t\t\tSwal.fire('Hata!', response.message || 'Tahsilat silinirken hata oluştu.', 'error');\r\n \t\t\t\t\t}\r\n \t\t\t\t},\r\n-\t\t\t\terror: function() {\r\n-\t\t\t\t\tSwal.fire('Hata!', 'Tahsilat silinirken beklenmeyen bir hata oluştu.', 'error');\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('Tahsilat silme hatası:', {xhr, status, error});\r\n+\t\t\t\t\tlet errorMessage = \"Tahsilat silinirken beklenmeyen bir hata oluştu.\";\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t// Daha detaylı hata mesajı\r\n+\t\t\t\t\tif (xhr.responseJSON && xhr.responseJSON.message) {\r\n+\t\t\t\t\t\terrorMessage = xhr.responseJSON.message;\r\n+\t\t\t\t\t} else if (xhr.responseText) {\r\n+\t\t\t\t\t\ttry {\r\n+\t\t\t\t\t\t\tconst response = JSON.parse(xhr.responseText);\r\n+\t\t\t\t\t\t\terrorMessage = response.message || errorMessage;\r\n+\t\t\t\t\t\t} catch (e) {\r\n+\t\t\t\t\t\t\terrorMessage += \" (HTTP \" + xhr.status + \")\";\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t}\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tSwal.fire('Hata!', errorMessage, 'error');\r\n \t\t\t\t}\r\n \t\t\t});\r\n \t\t}\r\n \t});\r\n"
                },
                {
                    "date": 1757159372759,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2609,8 +2609,9 @@\n // Stok dropdown başlat\r\n function initStokAutocomplete() {\r\n \tconsole.log('initStokAutocomplete çağrıldı');\r\n \t\r\n+\t\r\n \t$('.stokDropdown').each(function() {\r\n \t\tconsole.log('Dropdown işleniyor:', this);\r\n \t\t\r\n \t\t// Eğer zaten Select2 uygulanmışsa, yeniden uygulama\r\n@@ -2624,9 +2625,9 @@\n \t\t\twidth: '100%',\r\n \t\t\tplaceholder: 'Stok seçiniz...',\r\n \t\t\tallowClear: true,\r\n \t\t\tajax: {\r\n-\t\t\t\turl: '<?= base_url('index.php/Muhasebe/stok_dropdown') ?>', // Controller method URL\r\n+\t\t\t\turl: '<?= base_url('stok_dropdown_endpoint.php') ?>', // Real database endpoint\r\n \t\t\t\tdataType: 'json',\r\n \t\t\t\tdelay: 250,\r\n \t\t\t\tdata: function (params) {\r\n \t\t\t\t\tconsole.log('AJAX İstek parametreleri:', params);\r\n"
                },
                {
                    "date": 1757160319056,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3726,9 +3726,9 @@\n \t\t\t\tformData.append('stok_gorseller[]', files[i]);\r\n \t\t\t}\r\n \t\t\t\r\n \t\t\t$.ajax({\r\n-\t\t\t\turl: '<?= base_url(\"muhasebe/stokGorselYukle\") ?>',\r\n+\t\t\t\turl: '<?= base_url(\"stok_gorsel_yukle_endpoint.php\") ?>',\r\n \t\t\t\tmethod: 'POST',\r\n \t\t\t\tdata: formData,\r\n \t\t\t\tprocessData: false,\r\n \t\t\t\tcontentType: false,\r\n"
                },
                {
                    "date": 1757163901477,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2406,13 +2406,12 @@\n \t\t\t\t\t<div class=\"w-100\">\r\n \t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"55%\">Stok Adı</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"8%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"60%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\">Miktar</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"7%\">Görsel</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n@@ -2527,11 +2526,8 @@\n \t\t\t\t\t<option value=\"18\" ${(data.satisStok_kdv || 0) == 18 ? 'selected' : ''}>%18</option>\r\n \t\t\t\t\t<option value=\"20\" ${(data.satisStok_kdv || 0) == 20 ? 'selected' : ''}>%20</option>\r\n \t\t\t\t</select>\r\n \t\t\t</td>\r\n-\t\t\t<td class=\"text-center\">\r\n-\t\t\t\t${generateStokGorselButton(data)}\r\n-\t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-danger btn-sm\" onclick=\"stokSatiriSil(this)\" \r\n \t\t\t\t\t\ttitle=\"Satırı sil\">\r\n \t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n"
                },
                {
                    "date": 1757332850831,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2406,12 +2406,14 @@\n \t\t\t\t\t<div class=\"w-100\">\r\n \t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"60%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"5%\">ID</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"55%\">Stok Adı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\">Miktar</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\">Kullanıcı Sayısı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n@@ -2496,8 +2498,11 @@\n function createStokRow(index, data = {}) {\r\n \tconsole.log('createStokRow called with:', data);\r\n \treturn `\r\n \t\t<tr data-index=\"${index}\">\r\n+\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t<small class=\"text-muted\">${data.satisStok_id || '-'}</small>\r\n+\t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<input type=\"hidden\" name=\"stokId[]\" value=\"${data.stok_id || ''}\" class=\"stokId\">\r\n \t\t\t\t<input type=\"hidden\" name=\"satisStokId[]\" value=\"${data.satisStok_id || ''}\" class=\"satisStokId\">\r\n \t\t\t\t<select class=\"form-control stokDropdown\" name=\"stokAdi[]\" style=\"width: 100%;\">\r\n@@ -2527,8 +2532,13 @@\n \t\t\t\t\t<option value=\"20\" ${(data.satisStok_kdv || 0) == 20 ? 'selected' : ''}>%20</option>\r\n \t\t\t\t</select>\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n+\t\t\t\t<input type=\"number\" class=\"form-control kullaniciSayisi\" name=\"kullaniciSayisi[]\" \r\n+\t\t\t\t\t   value=\"${data.satisStok_kullanici_sayisi || ''}\" min=\"0\" \r\n+\t\t\t\t\t   placeholder=\"Kullanıcı sayısı\">\r\n+\t\t\t</td>\r\n+\t\t\t<td>\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-danger btn-sm\" onclick=\"stokSatiriSil(this)\" \r\n \t\t\t\t\t\ttitle=\"Satırı sil\">\r\n \t\t\t\t\t<i class=\"fa fa-trash\"></i>\r\n \t\t\t\t</button>\r\n@@ -2737,9 +2747,10 @@\n \t\t\tstok_id: row.querySelector('.stokId').value,\r\n \t\t\tstok_adi: selectedOption ? selectedOption.text.split(' (')[0] : '', // Sadece stok adını al, kodu çıkar\r\n \t\t\tmiktar: row.querySelector('.miktar').value,\r\n \t\t\tbirim_fiyat: row.querySelector('.birimFiyat').value,\r\n-\t\t\tkdv_orani: row.querySelector('.kdvOrani').value\r\n+\t\t\tkdv_orani: row.querySelector('.kdvOrani').value,\r\n+\t\t\tkullanici_sayisi: row.querySelector('.kullaniciSayisi').value\r\n \t\t};\r\n \t\t\r\n \t\tif (stokData.stok_id && stokData.miktar && stokData.birim_fiyat) {\r\n \t\t\tformData.push(stokData);\r\n"
                },
                {
                    "date": 1757927522984,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1483,9 +1483,9 @@\n \t\t\t\t\t\t\t\t\t\t\t   onchange=\"vadeTarihiDegisti(this)\">\r\n \t\t\t\t\t\t\t\t\t</div>` : \r\n \t\t\t\t\t\t\t\t\t'<span class=\"text-muted\">-</span>'}\r\n \t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t<td>${item.aciklama || '-'}</td>\r\n+\t\t\t\t\t\t\t<td style=\"max-width: 200px; word-wrap: break-word; white-space: normal; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;\" title=\"${item.aciklama || '-'}\">${(item.aciklama && item.aciklama.length > 50) ? item.aciklama.substring(0, 50) + '...' : (item.aciklama || '-')}</td>\r\n \t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t${generateGorselButton(item)}\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td class=\"text-center\">\r\n"
                },
                {
                    "date": 1758016385059,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1652,9 +1652,9 @@\n \t// Mevcut görseller varsa göster\r\n \tif (item.gorseller && item.gorseller.length > 0) {\r\n \t\tif (item.gorseller.length === 1) {\r\n \t\t\t// Tek görsel\r\n-\t\t\thtml += `<button class=\"btn btn-sm btn-info\" onclick=\"showGorsel('${item.gorseller[0]}', '${item.tahsilat_tipi}')\">\r\n+\t\t\thtml += `<button class=\"btn btn-sm btn-info\" onclick=\"showGorsel('${item.gorseller[0].url}', '${item.tahsilat_tipi}')\">\r\n \t\t\t\t<i class=\"fa fa-image\"></i> Görsel\r\n \t\t\t</button>`;\r\n \t\t} else {\r\n \t\t\t// Çoklu görsel\r\n"
                },
                {
                    "date": 1758016620868,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1651,11 +1651,16 @@\n \t\r\n \t// Mevcut görseller varsa göster\r\n \tif (item.gorseller && item.gorseller.length > 0) {\r\n \t\tif (item.gorseller.length === 1) {\r\n-\t\t\t// Tek görsel\r\n-\t\t\thtml += `<button class=\"btn btn-sm btn-info\" onclick=\"showGorsel('${item.gorseller[0].url}', '${item.tahsilat_tipi}')\">\r\n-\t\t\t\t<i class=\"fa fa-image\"></i> Görsel\r\n+\t\t\t// Tek görsel - PDF kontrolü yap\r\n+\t\t\tconst isPdf = item.gorseller[0].dosya_adi && item.gorseller[0].dosya_adi.toLowerCase().endsWith('.pdf');\r\n+\t\t\tconst icon = isPdf ? 'fa-file-pdf' : 'fa-image';\r\n+\t\t\tconst text = isPdf ? 'PDF' : 'Görsel';\r\n+\t\t\tconst btnClass = isPdf ? 'btn-danger' : 'btn-info';\r\n+\t\t\t\r\n+\t\t\thtml += `<button class=\"btn btn-sm ${btnClass}\" onclick=\"showGorsel('${item.gorseller[0].url}', '${item.tahsilat_tipi}')\">\r\n+\t\t\t\t<i class=\"fa ${icon}\"></i> ${text}\r\n \t\t\t</button>`;\r\n \t\t} else {\r\n \t\t\t// Çoklu görsel\r\n \t\t\thtml += `<button class=\"btn btn-sm btn-info\" onclick=\"showGorselGaleri('${item.unique_id}', '${item.tahsilat_tipi}', ${JSON.stringify(item.gorseller).replace(/\"/g, '&quot;')})\">\r\n@@ -2835,12 +2840,65 @@\n \r\n // Görsel gösterme fonksiyonu\r\n function showGorsel(gorselUrl, tahsilatTipi) {\r\n \t$('#gorselModalTitle').text(tahsilatTipi + ' Görseli');\r\n-\t$('#gorselModalImage').attr('src', gorselUrl);\r\n+\t\r\n+\t// Dosya uzantısını kontrol et\r\n+\tconst fileExtension = gorselUrl.split('.').pop().toLowerCase();\r\n+\tconst modalBody = $('#gorselModalImage').closest('.modal-body');\r\n+\t\r\n+\tif (fileExtension === 'pdf') {\r\n+\t\t// PDF için özel görünüm\r\n+\t\tmodalBody.html(`\r\n+\t\t\t<div class=\"text-center\">\r\n+\t\t\t\t<div class=\"pdf-preview-container\" style=\"min-height: 400px; border: 2px dashed #ddd; border-radius: 8px; padding: 20px;\">\r\n+\t\t\t\t\t<i class=\"fa fa-file-pdf fa-5x text-danger mb-3\"></i>\r\n+\t\t\t\t\t<h5>PDF Dosyası</h5>\r\n+\t\t\t\t\t<p class=\"text-muted mb-3\">PDF dosyasını görüntülemek için aşağıdaki butonları kullanın:</p>\r\n+\t\t\t\t\t<div class=\"btn-group\" role=\"group\">\r\n+\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\" onclick=\"window.open('${gorselUrl}', '_blank')\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-external-link\"></i> Yeni Sekmede Aç\r\n+\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-info\" onclick=\"showPdfInModal('${gorselUrl}')\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-eye\"></i> Modal İçinde Görüntüle\r\n+\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t</div>\r\n+\t\t`);\r\n+\t} else {\r\n+\t\t// Resim dosyaları için normal görünüm\r\n+\t\tmodalBody.html('<img id=\"gorselModalImage\" src=\"' + gorselUrl + '\" class=\"img-fluid\" style=\"max-height: 500px;\" alt=\"Görsel\">');\r\n+\t}\r\n+\t\r\n \t$('#gorselModal').modal('show');\r\n+\t\r\n+\t// Modal kapandığında orijinal yapıyı geri getir\r\n+\t$('#gorselModal').one('hidden.bs.modal', function() {\r\n+\t\t$(this).find('.modal-body').html('<img id=\"gorselModalImage\" src=\"\" class=\"img-fluid\" style=\"max-height: 500px;\" alt=\"Görsel\">');\r\n+\t});\r\n }\r\n \r\n+// PDF'yi modal içinde gösterme fonksiyonu\r\n+function showPdfInModal(pdfUrl) {\r\n+\tconst modalBody = $('#gorselModalImage').closest('.modal-body');\r\n+\tmodalBody.html(`\r\n+\t\t<div class=\"text-center mb-3\">\r\n+\t\t\t<button type=\"button\" class=\"btn btn-secondary btn-sm\" onclick=\"showGorsel('${pdfUrl}', 'PDF')\">\r\n+\t\t\t\t<i class=\"fa fa-arrow-left\"></i> Geri\r\n+\t\t\t</button>\r\n+\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm ml-2\" onclick=\"window.open('${pdfUrl}', '_blank')\">\r\n+\t\t\t\t<i class=\"fa fa-external-link\"></i> Yeni Sekmede Aç\r\n+\t\t\t</button>\r\n+\t\t</div>\r\n+\t\t<div style=\"width: 100%; height: 600px; border: 1px solid #ddd;\">\r\n+\t\t\t<iframe src=\"${pdfUrl}\" style=\"width: 100%; height: 100%; border: none;\" type=\"application/pdf\">\r\n+\t\t\t\t<p>PDF görüntülenemiyor. <a href=\"${pdfUrl}\" target=\"_blank\">Buraya tıklayarak açabilirsiniz.</a></p>\r\n+\t\t\t</iframe>\r\n+\t\t</div>\r\n+\t`);\r\n+}\r\n+\r\n // Görsel galeri fonksiyonu\r\n function showGorselGaleri(uniqueId, tahsilatTipi, gorseller) {\r\n \tlet html = `\r\n \t\t<div class=\"container-fluid\">\r\n"
                },
                {
                    "date": 1758628430605,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1724,11 +1724,25 @@\n \t\t\t\t\tbagimliVeriHtml += '<strong>Silinecek veriler:</strong><br>';\r\n \t\t\t\t\tbagimliVeriHtml += '<ul class=\"list-unstyled\">';\r\n \t\t\t\t\t\r\n \t\t\t\t\tresponse.data.forEach(function(veri) {\r\n-\t\t\t\t\t\tbagimliVeriHtml += '<li><i class=\"fa fa-exclamation-triangle text-warning\"></i> ';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<li class=\"d-flex justify-content-between align-items-center mb-2 p-2 border rounded\">';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<div>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<i class=\"fa fa-exclamation-triangle text-warning\"></i> ';\r\n \t\t\t\t\t\tbagimliVeriHtml += '<strong>' + veri.tablo + ':</strong> ' + veri.adet + ' adet';\r\n-\t\t\t\t\t\tbagimliVeriHtml += '<br><small class=\"text-muted\">' + veri.aciklama + '</small></li><br>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<br><small class=\"text-muted\">' + veri.aciklama + '</small>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '</div>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<div class=\"btn-group\">';\r\n+\t\t\t\t\t\t// Seçmeli silme butonu\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<button class=\"btn btn-sm btn-outline-info\" onclick=\"secmeliVeriSil(\\'' + veri.tablo_kodu + '\\', ' + cariId + ', \\'' + veri.tablo + '\\', ' + veri.adet + ')\" title=\"Seçerek sil\">';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<i class=\"fa fa-list-ul\"></i>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '</button>';\r\n+\t\t\t\t\t\t// Tamamen silme butonu  \r\n+\t\t\t\t\t\tbagimliVeriHtml += '<button class=\"btn btn-sm btn-outline-danger\" onclick=\"tekVeriSil(\\'' + veri.tablo_kodu + '\\', ' + cariId + ', \\'' + veri.tablo + '\\')\" title=\"Tümünü sil\">';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '<i class=\"fa fa-trash\"></i>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '</button>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '</div>';\r\n+\t\t\t\t\t\tbagimliVeriHtml += '</li>';\r\n \t\t\t\t\t});\r\n \t\t\t\t\t\r\n \t\t\t\t\tbagimliVeriHtml += '</ul></div>';\r\n \t\t\t\t\t\r\n@@ -3904,8 +3918,309 @@\n };\r\n \r\n });\r\n \r\n+// Tek veri türü silme fonksiyonu\r\n+window.tekVeriSil = function(tabloKodu, cariId, tabloAdi) {\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Veri Silme Onayı',\r\n+\t\thtml: `<div class=\"text-left\">\r\n+\t\t\t<p><strong>Tablo:</strong> ${tabloAdi}</p>\r\n+\t\t\t<p><strong>Cari ID:</strong> ${cariId}</p>\r\n+\t\t\t<div class=\"alert alert-warning\">\r\n+\t\t\t\t<i class=\"fa fa-exclamation-triangle\"></i>\r\n+\t\t\t\tBu işlem sadece <strong>${tabloAdi}</strong> verilerini silecektir.\r\n+\t\t\t\tDiğer veriler etkilenmeyecektir.\r\n+\t\t\t</div>\r\n+\t\t</div>`,\r\n+\t\ticon: 'warning',\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: '#dc3545',\r\n+\t\tcancelButtonColor: '#6c757d',\r\n+\t\tconfirmButtonText: '<i class=\"fa fa-trash\"></i> Sil',\r\n+\t\tcancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n+\t\tcustomClass: {\r\n+\t\t\tconfirmButton: 'btn btn-danger',\r\n+\t\t\tcancelButton: 'btn btn-secondary'\r\n+\t\t},\r\n+\t\tbuttonsStyling: false\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t// Loading göster\r\n+\t\t\tSwal.fire({\r\n+\t\t\t\ttitle: 'Siliniyor...',\r\n+\t\t\t\ttext: `${tabloAdi} verileri siliniyor...`,\r\n+\t\t\t\ticon: 'info',\r\n+\t\t\t\tallowOutsideClick: false,\r\n+\t\t\t\tallowEscapeKey: false,\r\n+\t\t\t\tshowConfirmButton: false,\r\n+\t\t\t\tdidOpen: () => {\r\n+\t\t\t\t\tSwal.showLoading();\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t\t\r\n+\t\t\t// AJAX ile silme işlemi\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/tek_veri_sil\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: {\r\n+\t\t\t\t\tcari_id: cariId,\r\n+\t\t\t\t\ttablo_kodu: tabloKodu,\r\n+\t\t\t\t\ttablo_adi: tabloAdi\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.status === 'success') {\r\n+\t\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\t\ticon: 'success',\r\n+\t\t\t\t\t\t\ttitle: 'Başarılı',\r\n+\t\t\t\t\t\t\ttext: response.message,\r\n+\t\t\t\t\t\t\tconfirmButtonText: 'Tamam'\r\n+\t\t\t\t\t\t}).then(() => {\r\n+\t\t\t\t\t\t\t// Sayfayı yenile\r\n+\t\t\t\t\t\t\tlocation.reload();\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\t\ticon: 'error',\r\n+\t\t\t\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\t\t\t\ttext: response.message || 'Silme işlemi başarısız oldu'\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('Tek veri silme hatası:', {xhr, status, error});\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ticon: 'error',\r\n+\t\t\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\t\t\ttext: 'Silme işlemi sırasında bir hata oluştu: ' + error\r\n+\t\t\t\t\t});\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+// Seçmeli veri silme fonksiyonu\r\n+window.secmeliVeriSil = function(tabloKodu, cariId, tabloAdi, toplamAdet) {\r\n+\tconsole.log('Seçmeli veri sil - Cari ID:', cariId, 'Tablo:', tabloKodu);\r\n+\t\r\n+\t// Loading göster\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Yükleniyor...',\r\n+\t\ttext: `${tabloAdi} verileri getiriliyor...`,\r\n+\t\ticon: 'info',\r\n+\t\tallowOutsideClick: false,\r\n+\t\tallowEscapeKey: false,\r\n+\t\tshowConfirmButton: false,\r\n+\t\tdidOpen: () => {\r\n+\t\t\tSwal.showLoading();\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t// AJAX ile veri listesini getir\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/veri_listesi_getir\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: {\r\n+\t\t\tcari_id: cariId,\r\n+\t\t\ttablo_kodu: tabloKodu,\r\n+\t\t\ttablo_adi: tabloAdi\r\n+\t\t},\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tif (response.status === 'success' && response.data && response.data.length > 0) {\r\n+\t\t\t\t// Seçim modalı oluştur\r\n+\t\t\t\tlet secimHtml = '<div class=\"text-left\">';\r\n+\t\t\t\tsecimHtml += '<p><strong>Silmek istediğiniz kayıtları seçin:</strong></p>';\r\n+\t\t\t\tsecimHtml += '<div class=\"mb-3\">';\r\n+\t\t\t\tsecimHtml += '<button type=\"button\" class=\"btn btn-sm btn-outline-primary\" onclick=\"tumunuSec(true)\">Tümünü Seç</button> ';\r\n+\t\t\t\tsecimHtml += '<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" onclick=\"tumunuSec(false)\">Tümünü Kaldır</button>';\r\n+\t\t\t\tsecimHtml += '</div>';\r\n+\t\t\t\tsecimHtml += '<div style=\"max-height: 400px; overflow-y: auto;\">';\r\n+\t\t\t\tsecimHtml += '<table class=\"table table-sm table-hover\">';\r\n+\t\t\t\tsecimHtml += '<thead><tr>';\r\n+\t\t\t\t\r\n+\t\t\t\t// Tablo başlıklarını oluştur\r\n+\t\t\t\tif (response.columns && response.columns.length > 0) {\r\n+\t\t\t\t\tsecimHtml += '<th width=\"50\"><input type=\"checkbox\" id=\"selectAll\" onchange=\"tumunuSec(this.checked)\"></th>';\r\n+\t\t\t\t\tresponse.columns.forEach(function(column) {\r\n+\t\t\t\t\t\tsecimHtml += '<th>' + column + '</th>';\r\n+\t\t\t\t\t});\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n+\t\t\t\tsecimHtml += '</tr></thead><tbody>';\r\n+\t\t\t\t\r\n+\t\t\t\t// Veri satırlarını oluştur\r\n+\t\t\t\tresponse.data.forEach(function(row, index) {\r\n+\t\t\t\t\tsecimHtml += '<tr>';\r\n+\t\t\t\t\tsecimHtml += '<td><input type=\"checkbox\" class=\"kayit-checkbox\" value=\"' + row.id + '\" data-index=\"' + index + '\"></td>';\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t// Sütun verilerini göster\r\n+\t\t\t\t\tif (response.columns && response.columns.length > 0) {\r\n+\t\t\t\t\t\tresponse.columns.forEach(function(column) {\r\n+\t\t\t\t\t\t\tlet value = row[column.toLowerCase()] || row[column] || '-';\r\n+\t\t\t\t\t\t\t// Tarih formatlaması\r\n+\t\t\t\t\t\t\tif (typeof value === 'string' && value.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\r\n+\t\t\t\t\t\t\t\tvalue = new Date(value).toLocaleDateString('tr-TR');\r\n+\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t// Para formatlaması\r\n+\t\t\t\t\t\t\tif (column.toLowerCase().includes('tutar') || column.toLowerCase().includes('fiyat')) {\r\n+\t\t\t\t\t\t\t\tif (!isNaN(value) && value !== '-') {\r\n+\t\t\t\t\t\t\t\t\tvalue = parseFloat(value).toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺';\r\n+\t\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\tsecimHtml += '<td>' + value + '</td>';\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t}\r\n+\t\t\t\t\t\r\n+\t\t\t\t\tsecimHtml += '</tr>';\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\tsecimHtml += '</tbody></table>';\r\n+\t\t\t\tsecimHtml += '</div>';\r\n+\t\t\t\tsecimHtml += '<div class=\"mt-3 text-muted\">';\r\n+\t\t\t\tsecimHtml += '<small>Toplam ' + response.data.length + ' kayıt bulundu. Seçilen kayıtlar silinecektir.</small>';\r\n+\t\t\t\tsecimHtml += '</div>';\r\n+\t\t\t\tsecimHtml += '</div>';\r\n+\t\t\t\t\r\n+\t\t\t\tSwal.fire({\r\n+\t\t\t\t\ttitle: tabloAdi + ' - Kayıt Seçimi',\r\n+\t\t\t\t\thtml: secimHtml,\r\n+\t\t\t\t\ticon: 'question',\r\n+\t\t\t\t\tshowCancelButton: true,\r\n+\t\t\t\t\tconfirmButtonColor: '#dc3545',\r\n+\t\t\t\t\tcancelButtonColor: '#6c757d',\r\n+\t\t\t\t\tconfirmButtonText: '<i class=\"fa fa-trash\"></i> Seçilenleri Sil',\r\n+\t\t\t\t\tcancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n+\t\t\t\t\tcustomClass: {\r\n+\t\t\t\t\t\tconfirmButton: 'btn btn-danger',\r\n+\t\t\t\t\t\tcancelButton: 'btn btn-secondary'\r\n+\t\t\t\t\t},\r\n+\t\t\t\t\tbuttonsStyling: false,\r\n+\t\t\t\t\twidth: '80%',\r\n+\t\t\t\t\tpreConfirm: () => {\r\n+\t\t\t\t\t\t// Seçilen kayıtları al\r\n+\t\t\t\t\t\tconst secilenler = [];\r\n+\t\t\t\t\t\t$('.kayit-checkbox:checked').each(function() {\r\n+\t\t\t\t\t\t\tsecilenler.push($(this).val());\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\tif (secilenler.length === 0) {\r\n+\t\t\t\t\t\t\tSwal.showValidationMessage('Lütfen en az bir kayıt seçin.');\r\n+\t\t\t\t\t\t\treturn false;\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\treturn secilenler;\r\n+\t\t\t\t\t}\r\n+\t\t\t\t}).then((result) => {\r\n+\t\t\t\t\tif (result.isConfirmed && result.value) {\r\n+\t\t\t\t\t\t// Seçilen kayıtları sil\r\n+\t\t\t\t\t\tseciliKayitlariSil(tabloKodu, cariId, tabloAdi, result.value);\r\n+\t\t\t\t\t}\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t} else {\r\n+\t\t\t\tSwal.fire({\r\n+\t\t\t\t\ticon: 'info',\r\n+\t\t\t\t\ttitle: 'Bilgi',\r\n+\t\t\t\t\ttext: response.message || 'Bu veri türünde kayıt bulunamadı.'\r\n+\t\t\t\t});\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.error('Veri listesi getirme hatası:', {xhr, status, error});\r\n+\t\t\tSwal.fire({\r\n+\t\t\t\ticon: 'error',\r\n+\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\ttext: 'Veri listesi getirilirken bir hata oluştu: ' + error\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+// Tümünü seç/kaldır fonksiyonu\r\n+window.tumunuSec = function(secilsin) {\r\n+\t$('.kayit-checkbox').prop('checked', secilsin);\r\n+\t$('#selectAll').prop('checked', secilsin);\r\n+}\r\n+\r\n+// Seçili kayıtları sil\r\n+window.seciliKayitlariSil = function(tabloKodu, cariId, tabloAdi, secilenIdler) {\r\n+\tconsole.log('Seçili kayıtları sil - Cari ID:', cariId, 'Tablo:', tabloKodu, 'Seçilen IDler:', secilenIdler);\r\n+\t\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Silme Onayı',\r\n+\t\ttext: `${secilenIdler.length} adet ${tabloAdi} kaydı silinecek. Emin misiniz?`,\r\n+\t\ticon: 'warning',\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonColor: '#dc3545',\r\n+\t\tcancelButtonColor: '#6c757d',\r\n+\t\tconfirmButtonText: '<i class=\"fa fa-trash\"></i> Sil',\r\n+\t\tcancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n+\t\tcustomClass: {\r\n+\t\t\tconfirmButton: 'btn btn-danger',\r\n+\t\t\tcancelButton: 'btn btn-secondary'\r\n+\t\t},\r\n+\t\tbuttonsStyling: false\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\t// Loading göster\r\n+\t\t\tSwal.fire({\r\n+\t\t\t\ttitle: 'Siliniyor...',\r\n+\t\t\t\ttext: `${secilenIdler.length} kayıt siliniyor...`,\r\n+\t\t\t\ticon: 'info',\r\n+\t\t\t\tallowOutsideClick: false,\r\n+\t\t\t\tallowEscapeKey: false,\r\n+\t\t\t\tshowConfirmButton: false,\r\n+\t\t\t\tdidOpen: () => {\r\n+\t\t\t\t\tSwal.showLoading();\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t\t\r\n+\t\t\t// AJAX ile seçili kayıtları sil\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"muhasebe/secili_kayitlari_sil\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: {\r\n+\t\t\t\t\tcari_id: cariId,\r\n+\t\t\t\t\ttablo_kodu: tabloKodu,\r\n+\t\t\t\t\ttablo_adi: tabloAdi,\r\n+\t\t\t\t\tsecilen_idler: secilenIdler\r\n+\t\t\t\t},\r\n+\t\t\t\tdataType: 'json',\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.status === 'success') {\r\n+\t\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\t\ticon: 'success',\r\n+\t\t\t\t\t\t\ttitle: 'Başarılı',\r\n+\t\t\t\t\t\t\ttext: response.message,\r\n+\t\t\t\t\t\t\tconfirmButtonText: 'Tamam'\r\n+\t\t\t\t\t\t}).then(() => {\r\n+\t\t\t\t\t\t\t// Sayfayı yenile\r\n+\t\t\t\t\t\t\tlocation.reload();\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\t\ticon: 'error',\r\n+\t\t\t\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\t\t\t\ttext: response.message || 'Silme işlemi başarısız oldu'\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t\tconsole.error('Seçili kayıtları silme hatası:', {xhr, status, error});\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ticon: 'error',\r\n+\t\t\t\t\t\ttitle: 'Hata',\r\n+\t\t\t\t\t\ttext: 'Silme işlemi sırasında bir hata oluştu: ' + error\r\n+\t\t\t\t\t});\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n // Satış detaylarını akordiyon şeklinde açma/kapama (Global scope)\r\n window.toggleSatisDetaylar = function(cari_id) {\r\n \tconst detayDiv = document.getElementById('satis-detaylar-' + cari_id);\r\n \tconst toggleBtn = document.getElementById('toggle-btn-' + cari_id);\r\n"
                },
                {
                    "date": 1758629241110,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4057,9 +4057,22 @@\n \t\t\t\t\t\r\n \t\t\t\t\t// Sütun verilerini göster\r\n \t\t\t\t\tif (response.columns && response.columns.length > 0) {\r\n \t\t\t\t\t\tresponse.columns.forEach(function(column) {\r\n-\t\t\t\t\t\t\tlet value = row[column.toLowerCase()] || row[column] || '-';\r\n+\t\t\t\t\t\t\t// Sütun başlığına göre doğru field'ı bul\r\n+\t\t\t\t\t\t\tlet fieldName = '';\r\n+\t\t\t\t\t\t\tif (column === 'Fatura No') {\r\n+\t\t\t\t\t\t\t\tfieldName = 'fatura_no';\r\n+\t\t\t\t\t\t\t} else if (column === 'Fatura Tarihi') {\r\n+\t\t\t\t\t\t\t\tfieldName = 'fatura_tarihi';\r\n+\t\t\t\t\t\t\t} else if (column === 'Açıklama') {\r\n+\t\t\t\t\t\t\t\tfieldName = 'aciklama';\r\n+\t\t\t\t\t\t\t} else {\r\n+\t\t\t\t\t\t\t\tfieldName = column.toLowerCase().replace(' ', '_');\r\n+\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\tlet value = row[fieldName] || row[column.toLowerCase()] || row[column] || '-';\r\n+\t\t\t\t\t\t\t\r\n \t\t\t\t\t\t\t// Tarih formatlaması\r\n \t\t\t\t\t\t\tif (typeof value === 'string' && value.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\r\n \t\t\t\t\t\t\t\tvalue = new Date(value).toLocaleDateString('tr-TR');\r\n \t\t\t\t\t\t\t}\r\n"
                },
                {
                    "date": 1758636537232,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -186,8 +186,28 @@\n \t\t.satis-detaylar-liste::-webkit-scrollbar-thumb:hover {\r\n \t\t\tbackground: #a8a8a8;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Satış detay kartları için özel stiller */\r\n+\t\t.satis-card {\r\n+\t\t\tborder: 1px solid #e3e6f0;\r\n+\t\t\tborder-radius: 5px;\r\n+\t\t\tbackground: #fff;\r\n+\t\t\tbox-shadow: 0 1px 3px rgba(0,0,0,0.12);\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-card .card-body {\r\n+\t\t\tpadding: 12px !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t.satis-detaylar {\r\n+\t\t\tbackground: #f8f9fa;\r\n+\t\t\tborder: 1px solid #dee2e6;\r\n+\t\t\tborder-radius: 5px;\r\n+\t\t\tpadding: 10px;\r\n+\t\t\tmargin-top: 8px;\r\n+\t\t}\r\n+\t\t\r\n \t\t.stats-number {\r\n \t\t\tfont-size: 2rem;\r\n \t\t\tfont-weight: bold;\r\n \t\t\tmargin-bottom: 0.5rem;\r\n@@ -860,12 +880,20 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->toplam_satis_sayisi) && $veri->toplam_satis_sayisi > 1): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-outline-info mt-1\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"toggleSatisDetaylar(<?= $veri->cari_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"toggleSatisDetay2(<?= $veri->cari_id ?>)\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"toggle-btn2-<?= $veri->cari_id ?>\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Bu cariye ait tüm hizmetleri göster/gizle\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-list\"></i> Tümü\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<!-- Satış detayları için div -->\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"satis-detaylar2-<?= $veri->cari_id ?>\" class=\"satis-detaylar mt-2\" style=\"display: none;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-spinner fa-spin text-primary\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"ml-1\">Satışlar yükleniyor...</span>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n@@ -4260,18 +4288,53 @@\n \t\ttoggleBtn.title = 'Satış detaylarını göster';\r\n \t}\r\n }\r\n \r\n-// AJAX ile satış detaylarını yükle (Global scope)\r\n-window.loadSatisDetaylar = function(cari_id) {\r\n-\tconst detayDiv = document.getElementById('satis-detaylar-' + cari_id);\r\n+// İkinci toggle sistemi için (Tümü butonu)\r\n+window.toggleSatisDetay2 = function(cari_id) {\r\n+\tconst detayDiv = document.getElementById('satis-detaylar2-' + cari_id);\r\n+\tconst toggleBtn = document.getElementById('toggle-btn2-' + cari_id);\r\n+\tconst icon = toggleBtn.querySelector('i');\r\n \t\r\n+\tif (detayDiv.style.display === 'none' || detayDiv.style.display === '') {\r\n+\t\t// Açılıyor\r\n+\t\tif (!detayDiv.dataset.loaded) {\r\n+\t\t\t// İlk kez yükleniyorsa AJAX ile veri getir\r\n+\t\t\twindow.loadSatisDetaylar2(cari_id);\r\n+\t\t}\r\n+\t\tdetayDiv.style.display = 'block';\r\n+\t\ticon.className = 'fa fa-minus';\r\n+\t\ttoggleBtn.title = 'Satış detaylarını gizle';\r\n+\t\t\r\n+\t\t// Smooth açılış efekti\r\n+\t\t$(detayDiv).slideDown(300);\r\n+\t} else {\r\n+\t\t// Kapanıyor\r\n+\t\t$(detayDiv).slideUp(300, function() {\r\n+\t\t\tdetayDiv.style.display = 'none';\r\n+\t\t});\r\n+\t\ticon.className = 'fa fa-list';\r\n+\t\ttoggleBtn.title = 'Bu cariye ait tüm hizmetleri göster/gizle';\r\n+\t}\r\n+}\r\n+\r\n+// AJAX ile satış detaylarını yükle (İkinci sistem için)\r\n+window.loadSatisDetaylar2 = function(cari_id) {\r\n+\tconst detayDiv = document.getElementById('satis-detaylar2-' + cari_id);\r\n+\t\r\n+\tconsole.log('loadSatisDetaylar2 çağrıldı, cari_id:', cari_id);\r\n+\t\r\n \t$.ajax({\r\n \t\turl: '<?= base_url(\"muhasebe/testSatisList\") ?>',\r\n \t\ttype: 'POST',\r\n \t\tdata: { cari_id: cari_id },\r\n \t\tdataType: 'json',\r\n+\t\tbeforeSend: function() {\r\n+\t\t\tconsole.log('AJAX isteği gönderiliyor...');\r\n+\t\t\tdetayDiv.innerHTML = '<div class=\"alert alert-info alert-sm\"><i class=\"fa fa-spinner fa-spin\"></i> Yükleniyor...</div>';\r\n+\t\t},\r\n \t\tsuccess: function(response) {\r\n+\t\t\tconsole.log('AJAX başarılı, response:', response);\r\n \t\t\tif (response.success) {\r\n \t\t\t\tlet html = '<div class=\"satis-detaylar-liste\">';\r\n \t\t\t\t\r\n \t\t\t\tresponse.satislar.forEach(function(satis, index) {\r\n@@ -4280,9 +4343,9 @@\n \t\t\t\t\t\t\t<div class=\"card-body p-2\">\r\n \t\t\t\t\t\t\t\t<div class=\"row align-items-center\">\r\n \t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n \t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Satış ${index + 1}</small><br>\r\n-\t\t\t\t\t\t\t\t\t\t<strong class=\"text-success\">${satis.satis_sozlesme_tutari || '0'} TL</strong>\r\n+\t\t\t\t\t\t\t\t\t\t<strong class=\"text-success\">${satis.satis_sozlesme_tutari || '0'}</strong>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n \t\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">Hizmet</small><br>\r\n \t\t\t\t\t\t\t\t\t\t<span class=\"text-info\">${satis.satis_sozlesme_hizmet || 'Belirtilmemiş'}</span>\r\n@@ -4293,9 +4356,9 @@\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t<div class=\"col-md-2 text-right\">\r\n \t\t\t\t\t\t\t\t\t\t${satis.gorsel_sayisi > 0 ? `\r\n \t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-outline-info\" \r\n-\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\") ?>${cari_id}?tip=satis&satis_id=${satis.satis_id}', 'satisGorsel', 'width=800,height=600,scrollbars=yes,resizable=yes')\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"window.open('<?= base_url(\"cari/gorselGoster/\") ?>${cari_id}?tip=satis&satis_id=${satis.satis_sozlesme_id}', 'satisGorsel', 'width=800,height=600,scrollbars=yes,resizable=yes')\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"${satis.gorsel_sayisi} görsel\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-image\"></i> ${satis.gorsel_sayisi}\r\n \t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t` : '<span class=\"text-muted small\">Görsel yok</span>'}\r\n@@ -4317,19 +4380,79 @@\n \t\t\t\t\t</div>\r\n \t\t\t\t`;\r\n \t\t\t}\r\n \t\t},\r\n-\t\terror: function() {\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.log('AJAX hatası:', xhr, status, error);\r\n+\t\t\tconsole.log('Response text:', xhr.responseText);\r\n \t\t\tdetayDiv.innerHTML = `\r\n \t\t\t\t<div class=\"alert alert-danger alert-sm\">\r\n \t\t\t\t\t<i class=\"fa fa-exclamation-circle\"></i> \r\n \t\t\t\t\tSatışlar yüklenirken bir hata oluştu. Lütfen tekrar deneyin.\r\n+\t\t\t\t\t<br><small>Hata: ${error} (Status: ${status})</small>\r\n \t\t\t\t</div>\r\n \t\t\t`;\r\n \t\t}\r\n \t});\r\n }\r\n \r\n+// AJAX ile satış detaylarını yükle (Global scope)\r\n+window.loadSatisDetaylar = function(cari_id) {\r\n+\tconst detayDiv = document.getElementById('satis-detaylar-' + cari_id);\r\n+\t\r\n+\tconsole.log('loadSatisDetaylar çağrıldı, cari_id:', cari_id);\r\n+\t\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/testSatisList\") ?>',\r\n+\t\ttype: 'POST',\r\n+\t\tdata: { cari_id: cari_id },\r\n+\t\tdataType: 'json',\r\n+\t\tbeforeSend: function() {\r\n+\t\t\tconsole.log('AJAX isteği gönderiliyor...');\r\n+\t\t\tdetayDiv.innerHTML = '<div class=\"alert alert-info alert-sm\"><i class=\"fa fa-spinner fa-spin\"></i> Yükleniyor...</div>';\r\n+\t\t},\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tconsole.log('AJAX başarılı, response:', response);\r\n+\t\t\tif (response.success && response.satislar.length > 0) {\r\n+\t\t\t\tlet html = '<div style=\"padding: 8px; background: #f8f9fa; border-radius: 5px; max-height: 200px; overflow-y: auto;\">';\r\n+\t\t\t\thtml += '<strong style=\"color: #007bff; font-size: 12px; display: block; margin-bottom: 8px;\"><i class=\"fa fa-list\"></i> Satış Detayları (' + response.satislar.length + ' adet)</strong>';\r\n+\t\t\t\t\r\n+\t\t\t\tresponse.satislar.forEach(function(satis, index) {\r\n+\t\t\t\t\thtml += `\r\n+\t\t\t\t\t\t<div style=\"background: white; margin-bottom: 5px; padding: 8px; border-radius: 3px; border-left: 3px solid #007bff; font-size: 12px;\">\r\n+\t\t\t\t\t\t\t<span style=\"color: #28a745; font-weight: bold;\">${satis.satis_sozlesme_tutari || '0 TL'}</span>\r\n+\t\t\t\t\t\t\t<span style=\"color: #6c757d; margin-left: 10px;\">-</span>\r\n+\t\t\t\t\t\t\t<span style=\"color: #007bff; margin-left: 5px;\">${satis.satis_sozlesme_hizmet || 'Hizmet Yok'}</span>\r\n+\t\t\t\t\t\t\t${satis.gorsel_sayisi > 0 ? `<span style=\"color: #17a2b8; margin-left: 10px;\"><i class=\"fa fa-image\"></i> ${satis.gorsel_sayisi}</span>` : ''}\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t`;\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\thtml += '</div>';\r\n+\t\t\t\tdetayDiv.innerHTML = html;\r\n+\t\t\t\tdetayDiv.dataset.loaded = 'true';\r\n+\t\t\t} else {\r\n+\t\t\t\tdetayDiv.innerHTML = `\r\n+\t\t\t\t\t<div style=\"padding: 10px; background: #fff3cd; border-radius: 5px; border: 1px solid #ffeaa7; color: #856404; font-size: 12px;\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-info-circle\"></i> Satış kaydı bulunamadı.\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`;\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.log('AJAX hatası:', xhr, status, error);\r\n+\t\t\tconsole.log('Response text:', xhr.responseText);\r\n+\t\t\tdetayDiv.innerHTML = `\r\n+\t\t\t\t<div class=\"alert alert-danger alert-sm\">\r\n+\t\t\t\t\t<i class=\"fa fa-exclamation-circle\"></i> \r\n+\t\t\t\t\tSatışlar yüklenirken bir hata oluştu. Lütfen tekrar deneyin.\r\n+\t\t\t\t\t<br><small>Hata: ${error} (Status: ${status})</small>\r\n+\t\t\t\t</div>\r\n+\t\t\t`;\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n // Belge hazır olduğunda modal event'lerini başlat\r\n $(document).ready(function() {\r\n \tinitializeModalEvents();\r\n \t\r\n"
                },
                {
                    "date": 1759496005487,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -837,9 +837,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td data-order=\"<?= $veri->satis_sozlesme_tutar ? floatval($veri->satis_sozlesme_tutar) : -1 ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"satis-tutar-container\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 0, ',', '.') ?> ₺</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->toplam_satis_sayisi) && $veri->toplam_satis_sayisi > 1): ?>\r\n@@ -938,9 +938,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t<td data-order=\"<?= $veri->tahsilat_tutar ? floatval($veri->tahsilat_tutar) : -1 ?>\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->tahsilat_tutar): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk text-success\" style=\"cursor: pointer;\" \r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  onclick=\"showTahsilatModal(<?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme) ?>')\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  title=\"Tahsilat detaylarını görmek için tıklayın\">\r\n@@ -1705,9 +1705,9 @@\n \t$('#raporTable').DataTable({\r\n \t\t\"language\": {\r\n \t\t\t\"url\": \"https://cdn.datatables.net/plug-ins/1.13.6/i18n/tr.json\"\r\n \t\t},\r\n-\t\t\"order\": [[ 0, \"desc\" ]],  // İlk kolon (Tarih) azalan sıralama\r\n+\t\t\"order\": [[ 4, \"desc\" ]],  // Satış Sözleşme Tutarı sütunu (index 4) azalan sıralama\r\n \t\t\"pageLength\": 25,\r\n \t\t\"responsive\": true,\r\n \t\t\"scrollX\": true,\r\n \t\t\"searching\": false,  // DataTable'ın kendi arama kutusunu gizle\r\n"
                },
                {
                    "date": 1759497337547,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2454,12 +2454,12 @@\n \t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">ID</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"55%\">Stok Adı</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"10%\">Miktar</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"65%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">Miktar</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"10%\">KDV (%)</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">KDV (%)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\">Kullanıcı Sayısı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n@@ -2555,9 +2555,9 @@\n \t\t\t\t<select class=\"form-control stokDropdown\" name=\"stokAdi[]\" style=\"width: 100%;\">\r\n \t\t\t\t\t${data.stok_adi ? `<option value=\"${data.stok_id}\" selected>${data.stok_adi}${data.stok_kodu ? ' (Kod: ' + data.stok_kodu + ')' : ''}</option>` : '<option value=\"\">Stok seçiniz...</option>'}\r\n \t\t\t\t</select>\r\n \t\t\t</td>\r\n-\t\t\t<td>\r\n+\t\t\t<td style=\"display: none;\">\r\n \t\t\t\t<input type=\"number\" class=\"form-control miktar\" name=\"miktar[]\" \r\n \t\t\t\t\t   value=\"${data.satisStok_miktar || 1}\" min=\"1\" step=\"0.01\" \r\n \t\t\t\t\t   onchange=\"hesaplaToplamTutar()\">\r\n \t\t\t</td>\r\n@@ -2569,9 +2569,9 @@\n \t\t\t\t\t   onchange=\"hesaplaToplamTutar(); updateKdvBreakdown(this);\"\r\n \t\t\t\t\t   onkeyup=\"updateKdvBreakdown(this);\">\r\n \t\t\t\t<small class=\"text-muted kdv-breakdown\" style=\"font-size: 0.75em;\"></small>\r\n \t\t\t</td>\r\n-\t\t\t<td>\r\n+\t\t\t<td style=\"display: none;\">\r\n \t\t\t\t<select class=\"form-control kdvOrani\" name=\"kdvOrani[]\" onchange=\"hesaplaToplamTutar(); updateKdvBreakdown(this.closest('tr').querySelector('.birimFiyat'));\">\r\n \t\t\t\t\t<option value=\"0\" ${(data.satisStok_kdv || 0) == 0 ? 'selected' : ''}>%0</option>\r\n \t\t\t\t\t<option value=\"1\" ${(data.satisStok_kdv || 0) == 1 ? 'selected' : ''}>%1</option>\r\n \t\t\t\t\t<option value=\"8\" ${(data.satisStok_kdv || 0) == 8 ? 'selected' : ''}>%8</option>\r\n"
                },
                {
                    "date": 1759502614807,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1146,15 +1146,37 @@\n \t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n \t\t\t\t</button>\r\n \t\t\t</div>\r\n \t\t\t<div class=\"modal-body p-2\">\r\n-\t\t\t\t<div id=\"stokBilgisiLoading\" class=\"text-center p-4\">\r\n-\t\t\t\t\t<i class=\"fa fa-spinner fa-spin fa-2x\"></i>\r\n-\t\t\t\t\t<div class=\"mt-2\">Stok bilgileri yükleniyor...</div>\r\n+\t\t\t\t<div class=\"row\">\r\n+\t\t\t\t\t<div class=\"col-md-9\">\r\n+\t\t\t\t\t\t<div id=\"stokBilgisiLoading\" class=\"text-center p-4\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-spinner fa-spin fa-2x\"></i>\r\n+\t\t\t\t\t\t\t<div class=\"mt-2\">Stok bilgileri yükleniyor...</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t<div id=\"stokBilgisiContent\" style=\"display: none;\">\r\n+\t\t\t\t\t\t\t<!-- Stok listesi buraya yüklenecek -->\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t<div class=\"card\">\r\n+\t\t\t\t\t\t\t<div class=\"card-header bg-info text-white\">\r\n+\t\t\t\t\t\t\t\t<h6 class=\"mb-0\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-users mr-2\"></i>Cari Detayları\r\n+\t\t\t\t\t\t\t\t</h6>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t<div class=\"card-body p-2\">\r\n+\t\t\t\t\t\t\t\t<div id=\"cariDetayLoading\" class=\"text-center p-2\" style=\"display: none;\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-spinner fa-spin\"></i>\r\n+\t\t\t\t\t\t\t\t\t<div class=\"mt-1 small\">Cari bilgileri yükleniyor...</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t<div id=\"cariDetayContent\">\r\n+\t\t\t\t\t\t\t\t\t<!-- Cari detayları buraya yüklenecek -->\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n \t\t\t\t</div>\r\n-\t\t\t\t<div id=\"stokBilgisiContent\" style=\"display: none;\">\r\n-\t\t\t\t\t<!-- Stok listesi buraya yüklenecek -->\r\n-\t\t\t\t</div>\r\n \t\t\t</div>\r\n \t\t\t<div class=\"modal-footer\">\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">İptal</button>\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-success\" id=\"stokBilgisiKaydetBtn\">\r\n@@ -2426,8 +2448,11 @@\n \t$('#stokBilgisiModal').modal('show');\r\n \t$('#stokBilgisiLoading').show();\r\n \t$('#stokBilgisiContent').hide();\r\n \t\r\n+\t// Cari detaylarını yükle\r\n+\tloadCariDetaylar(cariId);\r\n+\t\r\n \t// AJAX ile stok verilerini getir\r\n \t$.ajax({\r\n \t\turl: '<?= base_url(\"stok_bilgileri_endpoint.php\") ?>',\r\n \t\tmethod: 'POST',\r\n@@ -4461,8 +4486,90 @@\n \t\tinitializeSelect2ForModal();\r\n \t});\r\n });\r\n \r\n+// Cari detaylarını yükleyen fonksiyon\r\n+function loadCariDetaylar(cariId) {\r\n+\tconsole.log('loadCariDetaylar çağrıldı, cariId:', cariId);\r\n+\t\r\n+\t$('#cariDetayLoading').show();\r\n+\t$('#cariDetayContent').html('');\r\n+\t\r\n+\t// AJAX ile cari detaylarını getir\r\n+\t$.ajax({\r\n+\t\turl: '<?= base_url(\"muhasebe/getCariDetaylar\") ?>',\r\n+\t\tmethod: 'POST',\r\n+\t\tdata: { cari_id: cariId },\r\n+\t\tdataType: 'json',\r\n+\t\tsuccess: function(response) {\r\n+\t\t\tconsole.log('Cari detay response:', response);\r\n+\t\t\t$('#cariDetayLoading').hide();\r\n+\t\t\t\r\n+\t\t\tif (response.success && response.data && response.data.length > 0) {\r\n+\t\t\t\tlet html = '';\r\n+\t\t\t\t\r\n+\t\t\t\tresponse.data.forEach(function(item) {\r\n+\t\t\t\t\tconst detayClass = getDetayClass(item.Kalem);\r\n+\t\t\t\t\tconst iconClass = getDetayIcon(item.Kalem);\r\n+\t\t\t\t\t\r\n+\t\t\t\t\thtml += `\r\n+\t\t\t\t\t\t<div class=\"mb-2 p-2 border rounded ${detayClass}\">\r\n+\t\t\t\t\t\t\t<div class=\"d-flex align-items-center\">\r\n+\t\t\t\t\t\t\t\t<i class=\"${iconClass} mr-2\"></i>\r\n+\t\t\t\t\t\t\t\t<strong class=\"small\">${item.Kalem}</strong>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t<div class=\"mt-1\">\r\n+\t\t\t\t\t\t\t\t<small class=\"text-muted d-block\">${item.Detay}</small>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t`;\r\n+\t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\t$('#cariDetayContent').html(html);\r\n+\t\t\t} else {\r\n+\t\t\t\t$('#cariDetayContent').html(`\r\n+\t\t\t\t\t<div class=\"text-center text-muted p-3\">\r\n+\t\t\t\t\t\t<i class=\"fa fa-info-circle fa-2x mb-2\"></i>\r\n+\t\t\t\t\t\t<div class=\"small\">Bu cari için detay bilgisi bulunamadı.</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t`);\r\n+\t\t\t}\r\n+\t\t},\r\n+\t\terror: function(xhr, status, error) {\r\n+\t\t\tconsole.error('Cari detay hatası:', {xhr, status, error});\r\n+\t\t\t$('#cariDetayLoading').hide();\r\n+\t\t\t$('#cariDetayContent').html(`\r\n+\t\t\t\t<div class=\"alert alert-danger alert-sm\">\r\n+\t\t\t\t\t<i class=\"fa fa-exclamation-triangle\"></i>\r\n+\t\t\t\t\t<div class=\"small\">Cari detayları yüklenirken hata oluştu.</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t`);\r\n+\t\t}\r\n+\t});\r\n+}\r\n+\r\n+// Detay kategorilerine göre stil sınıfı döndür\r\n+function getDetayClass(kalem) {\r\n+\tswitch(kalem) {\r\n+\t\tcase 'Çek': return 'border-warning bg-light';\r\n+\t\tcase 'Banka & Pos': return 'border-success bg-light';\r\n+\t\tcase 'Senet': return 'border-danger bg-light';\r\n+\t\tcase 'Nakit (Kasa)': return 'border-info bg-light';\r\n+\t\tdefault: return 'border-secondary bg-light';\r\n+\t}\r\n+}\r\n+\r\n+// Detay kategorilerine göre ikon döndür\r\n+function getDetayIcon(kalem) {\r\n+\tswitch(kalem) {\r\n+\t\tcase 'Çek': return 'fa fa-credit-card text-warning';\r\n+\t\tcase 'Banka & Pos': return 'fa fa-university text-success';\r\n+\t\tcase 'Senet': return 'fa fa-file-text text-danger';\r\n+\t\tcase 'Nakit (Kasa)': return 'fa fa-money text-info';\r\n+\t\tdefault: return 'fa fa-info-circle text-secondary';\r\n+\t}\r\n+}\r\n+\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1759506673251,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1158,13 +1158,8 @@\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t\t<div class=\"col-md-3\">\r\n \t\t\t\t\t\t<div class=\"card\">\r\n-\t\t\t\t\t\t\t<div class=\"card-header bg-info text-white\">\r\n-\t\t\t\t\t\t\t\t<h6 class=\"mb-0\">\r\n-\t\t\t\t\t\t\t\t\t<i class=\"fa fa-users mr-2\"></i>Cari Detayları\r\n-\t\t\t\t\t\t\t\t</h6>\r\n-\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t<div class=\"card-body p-2\">\r\n \t\t\t\t\t\t\t\t<div id=\"cariDetayLoading\" class=\"text-center p-2\" style=\"display: none;\">\r\n \t\t\t\t\t\t\t\t\t<i class=\"fa fa-spinner fa-spin\"></i>\r\n \t\t\t\t\t\t\t\t\t<div class=\"mt-1 small\">Cari bilgileri yükleniyor...</div>\r\n"
                },
                {
                    "date": 1759581215739,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1146,32 +1146,15 @@\n \t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n \t\t\t\t</button>\r\n \t\t\t</div>\r\n \t\t\t<div class=\"modal-body p-2\">\r\n-\t\t\t\t<div class=\"row\">\r\n-\t\t\t\t\t<div class=\"col-md-9\">\r\n-\t\t\t\t\t\t<div id=\"stokBilgisiLoading\" class=\"text-center p-4\">\r\n-\t\t\t\t\t\t\t<i class=\"fa fa-spinner fa-spin fa-2x\"></i>\r\n-\t\t\t\t\t\t\t<div class=\"mt-2\">Stok bilgileri yükleniyor...</div>\r\n-\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t<div id=\"stokBilgisiContent\" style=\"display: none;\">\r\n-\t\t\t\t\t\t\t<!-- Stok listesi buraya yüklenecek -->\r\n-\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t</div>\r\n-\t\t\t\t\t<div class=\"col-md-3\">\r\n-\t\t\t\t\t\t<div class=\"card\">\r\n-\t\t\t\t\t\t\t<div class=\"card-body p-2\">\r\n-\t\t\t\t\t\t\t\t<div id=\"cariDetayLoading\" class=\"text-center p-2\" style=\"display: none;\">\r\n-\t\t\t\t\t\t\t\t\t<i class=\"fa fa-spinner fa-spin\"></i>\r\n-\t\t\t\t\t\t\t\t\t<div class=\"mt-1 small\">Cari bilgileri yükleniyor...</div>\r\n-\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t<div id=\"cariDetayContent\">\r\n-\t\t\t\t\t\t\t\t\t<!-- Cari detayları buraya yüklenecek -->\r\n-\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t</div>\r\n+\t\t\t\t<div id=\"stokBilgisiLoading\" class=\"text-center p-4\">\r\n+\t\t\t\t\t<i class=\"fa fa-spinner fa-spin fa-2x\"></i>\r\n+\t\t\t\t\t<div class=\"mt-2\">Stok bilgileri yükleniyor...</div>\r\n \t\t\t\t</div>\r\n+\t\t\t\t<div id=\"stokBilgisiContent\" style=\"display: none;\">\r\n+\t\t\t\t\t<!-- Stok listesi buraya yüklenecek -->\r\n+\t\t\t\t</div>\r\n \t\t\t</div>\r\n \t\t\t<div class=\"modal-footer\">\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">İptal</button>\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-success\" id=\"stokBilgisiKaydetBtn\">\r\n@@ -2443,11 +2426,8 @@\n \t$('#stokBilgisiModal').modal('show');\r\n \t$('#stokBilgisiLoading').show();\r\n \t$('#stokBilgisiContent').hide();\r\n \t\r\n-\t// Cari detaylarını yükle\r\n-\tloadCariDetaylar(cariId);\r\n-\t\r\n \t// AJAX ile stok verilerini getir\r\n \t$.ajax({\r\n \t\turl: '<?= base_url(\"stok_bilgileri_endpoint.php\") ?>',\r\n \t\tmethod: 'POST',\r\n@@ -4481,90 +4461,10 @@\n \t\tinitializeSelect2ForModal();\r\n \t});\r\n });\r\n \r\n-// Cari detaylarını yükleyen fonksiyon\r\n-function loadCariDetaylar(cariId) {\r\n-\tconsole.log('loadCariDetaylar çağrıldı, cariId:', cariId);\r\n-\t\r\n-\t$('#cariDetayLoading').show();\r\n-\t$('#cariDetayContent').html('');\r\n-\t\r\n-\t// AJAX ile cari detaylarını getir\r\n-\t$.ajax({\r\n-\t\turl: '<?= base_url(\"muhasebe/getCariDetaylar\") ?>',\r\n-\t\tmethod: 'POST',\r\n-\t\tdata: { cari_id: cariId },\r\n-\t\tdataType: 'json',\r\n-\t\tsuccess: function(response) {\r\n-\t\t\tconsole.log('Cari detay response:', response);\r\n-\t\t\t$('#cariDetayLoading').hide();\r\n-\t\t\t\r\n-\t\t\tif (response.success && response.data && response.data.length > 0) {\r\n-\t\t\t\tlet html = '';\r\n-\t\t\t\t\r\n-\t\t\t\tresponse.data.forEach(function(item) {\r\n-\t\t\t\t\tconst detayClass = getDetayClass(item.Kalem);\r\n-\t\t\t\t\tconst iconClass = getDetayIcon(item.Kalem);\r\n-\t\t\t\t\t\r\n-\t\t\t\t\thtml += `\r\n-\t\t\t\t\t\t<div class=\"mb-2 p-2 border rounded ${detayClass}\">\r\n-\t\t\t\t\t\t\t<div class=\"d-flex align-items-center\">\r\n-\t\t\t\t\t\t\t\t<i class=\"${iconClass} mr-2\"></i>\r\n-\t\t\t\t\t\t\t\t<strong class=\"small\">${item.Kalem}</strong>\r\n-\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t<div class=\"mt-1\">\r\n-\t\t\t\t\t\t\t\t<small class=\"text-muted d-block\">${item.Detay}</small>\r\n-\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t`;\r\n-\t\t\t\t});\r\n-\t\t\t\t\r\n-\t\t\t\t$('#cariDetayContent').html(html);\r\n-\t\t\t} else {\r\n-\t\t\t\t$('#cariDetayContent').html(`\r\n-\t\t\t\t\t<div class=\"text-center text-muted p-3\">\r\n-\t\t\t\t\t\t<i class=\"fa fa-info-circle fa-2x mb-2\"></i>\r\n-\t\t\t\t\t\t<div class=\"small\">Bu cari için detay bilgisi bulunamadı.</div>\r\n-\t\t\t\t\t</div>\r\n-\t\t\t\t`);\r\n-\t\t\t}\r\n-\t\t},\r\n-\t\terror: function(xhr, status, error) {\r\n-\t\t\tconsole.error('Cari detay hatası:', {xhr, status, error});\r\n-\t\t\t$('#cariDetayLoading').hide();\r\n-\t\t\t$('#cariDetayContent').html(`\r\n-\t\t\t\t<div class=\"alert alert-danger alert-sm\">\r\n-\t\t\t\t\t<i class=\"fa fa-exclamation-triangle\"></i>\r\n-\t\t\t\t\t<div class=\"small\">Cari detayları yüklenirken hata oluştu.</div>\r\n-\t\t\t\t</div>\r\n-\t\t\t`);\r\n-\t\t}\r\n-\t});\r\n-}\r\n+// Cari detay fonksiyonları kaldırıldı - sadece stok bilgileri gösterilecek\r\n \r\n-// Detay kategorilerine göre stil sınıfı döndür\r\n-function getDetayClass(kalem) {\r\n-\tswitch(kalem) {\r\n-\t\tcase 'Çek': return 'border-warning bg-light';\r\n-\t\tcase 'Banka & Pos': return 'border-success bg-light';\r\n-\t\tcase 'Senet': return 'border-danger bg-light';\r\n-\t\tcase 'Nakit (Kasa)': return 'border-info bg-light';\r\n-\t\tdefault: return 'border-secondary bg-light';\r\n-\t}\r\n-}\r\n-\r\n-// Detay kategorilerine göre ikon döndür\r\n-function getDetayIcon(kalem) {\r\n-\tswitch(kalem) {\r\n-\t\tcase 'Çek': return 'fa fa-credit-card text-warning';\r\n-\t\tcase 'Banka & Pos': return 'fa fa-university text-success';\r\n-\t\tcase 'Senet': return 'fa fa-file-text text-danger';\r\n-\t\tcase 'Nakit (Kasa)': return 'fa fa-money text-info';\r\n-\t\tdefault: return 'fa fa-info-circle text-secondary';\r\n-\t}\r\n-}\r\n-\r\n </script>\r\n \r\n </body>\r\n </html>\r\n"
                },
                {
                    "date": 1759744524749,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2473,28 +2473,82 @@\n \t\t\t\t} else {\r\n \t\t\t\t\thtml += createStokRow(0, {});\r\n \t\t\t\t}\r\n \t\t\t\t\r\n+\t\t\t\t// Toplam satırı ekle\r\n \t\t\t\thtml += `\r\n+\t\t\t\t\t\t\t<tr class=\"toplam-satir\">\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t<strong>TOPLAM TUTAR (KDV DAHİL)</strong>\r\n+\t\t\t\t\t\t\t\t\t<br><small class=\"text-muted\">\r\n+\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle\"></i> Birim fiyatlar KDV dahil olarak girilmelidir\r\n+\t\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" id=\"toplamTutar\" value=\"0.00 ₺\" readonly style=\"background-color: #f8f9fa; font-weight: bold; width: 120px;\">\r\n+\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t</tbody>\r\n+\t\t\t\t\t</table>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t<!-- Tahsilat Detayları Tablosu -->\r\n+\t\t\t\t\t<div class=\"w-100 mt-4\">\r\n+\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-credit-card mr-2 text-info\"></i>Tahsilat Detayları\r\n+\t\t\t\t\t\t</h6>\r\n+\t\t\t\t\t\t<table class=\"table table-bordered table-sm table-hover\" id=\"tahsilatDetayTable\">\r\n+\t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n+\t\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"20%\">Kalem</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"63%\">Detay</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"17%\" class=\"text-left\" style=\"padding-left: 10px;\">Toplam</th>\r\n+\t\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t\t</thead>\r\n+\t\t\t\t\t\t\t<tbody id=\"tahsilatDetayTableBody\">\r\n+\t\t\t\t`;\r\n+\t\t\t\t\r\n+\t\t\t\t// Tahsilat verilerini göster\r\n+\t\t\t\tif (response.tahsilat_data && response.tahsilat_data.length > 0) {\r\n+\t\t\t\t\tresponse.tahsilat_data.forEach(function(item) {\r\n+\t\t\t\t\t\t// Eğer detay uzunsa kısalt\r\n+\t\t\t\t\t\tlet detayText = item.Detay;\r\n+\t\t\t\t\t\tlet showMoreBtn = '';\r\n+\t\t\t\t\t\tif (detayText.length > 100 && detayText !== '—') {\r\n+\t\t\t\t\t\t\tshowMoreBtn = `<br><small><a href=\"javascript:void(0)\" onclick=\"toggleDetay(this)\" class=\"text-primary\">Daha fazla göster</a></small>`;\r\n+\t\t\t\t\t\t\tdetayText = `<span class=\"detay-short\">${detayText.substring(0, 100)}...</span><span class=\"detay-full\" style=\"display:none;\">${item.Detay}</span>`;\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\thtml += `\r\n+\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t\t<td><strong>${item.Kalem}</strong></td>\r\n+\t\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t\t<small style=\"word-break: break-all;\">${detayText}</small>\r\n+\t\t\t\t\t\t\t\t\t${showMoreBtn}\r\n+\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-left\" style=\"padding-left: 10px;\">\r\n+\t\t\t\t\t\t\t\t\t<strong>${item.Toplam} ₺</strong>\r\n+\t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t`;\r\n+\t\t\t\t\t});\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\thtml += `\r\n+\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t<td colspan=\"3\" class=\"text-center text-muted\">\r\n+\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle mr-1\"></i>Bu cari için henüz tahsilat kaydı bulunmuyor.\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t`;\r\n+\t\t\t\t}\r\n+\t\t\t\t\r\n+\t\t\t\thtml += `\r\n \t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t</table>\r\n \t\t\t\t\t</div>\r\n-\t\t\t\t\t<div class=\"row mt-3\">\r\n-\t\t\t\t\t\t<div class=\"col-md-6 offset-md-6\">\r\n-\t\t\t\t\t\t\t<div class=\"card\">\r\n-\t\t\t\t\t\t\t\t<div class=\"card-body p-3\">\r\n-\t\t\t\t\t\t\t\t\t<div class=\"d-flex justify-content-between\">\r\n-\t\t\t\t\t\t\t\t\t\t<strong>Toplam Tutar (KDV Dahil):</strong>\r\n-\t\t\t\t\t\t\t\t\t\t<span id=\"toplamTutar\">0.00 ₺</span>\r\n-\t\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t\t<small class=\"text-muted\">\r\n-\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle\"></i>\r\n-\t\t\t\t\t\t\t\t\t\tBirim fiyatlar KDV dahil olarak girilmelidir\r\n-\t\t\t\t\t\t\t\t\t</small>\r\n-\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t</div>\r\n \t\t\t\t`;\r\n \t\t\t\t\r\n \t\t\t\t$('#stokBilgisiContent').html(html);\r\n \t\t\t\t\r\n@@ -2625,21 +2679,42 @@\n // Toplam tutarı hesapla\r\n function hesaplaToplamTutar() {\r\n \tlet toplam = 0;\r\n \t\r\n-\tdocument.querySelectorAll('#stokTableBody tr').forEach(function(row) {\r\n-\t\tconst miktar = parseFloat(row.querySelector('.miktar').value) || 0;\r\n-\t\tconst birimFiyatKdvDahil = parseFloat(row.querySelector('.birimFiyat').value) || 0;\r\n-\t\tconst kdvOrani = parseFloat(row.querySelector('.kdvOrani').value) || 0;\r\n+\tconsole.log('hesaplaToplamTutar çağrıldı');\r\n+\t\r\n+\t// Sadece normal stok satırlarını hesapla, toplam satırını hariç tut\r\n+\tconst rows = document.querySelectorAll('#stokTableBody tr:not(.toplam-satir)');\r\n+\tconsole.log('Bulunan satır sayısı:', rows.length);\r\n+\t\r\n+\trows.forEach(function(row, index) {\r\n+\t\tconst miktarInput = row.querySelector('.miktar');\r\n+\t\tconst birimFiyatInput = row.querySelector('.birimFiyat');\r\n+\t\tconst kdvOraniInput = row.querySelector('.kdvOrani');\r\n \t\t\r\n-\t\t// Birim fiyat KDV dahil olduğu için direkt çarpım yapıyoruz\r\n-\t\tconst toplamSatir = miktar * birimFiyatKdvDahil;\r\n-\t\t\r\n-\t\ttoplam += toplamSatir;\r\n+\t\tif (miktarInput && birimFiyatInput && kdvOraniInput) {\r\n+\t\t\tconst miktar = parseFloat(miktarInput.value) || 0;\r\n+\t\t\tconst birimFiyatKdvDahil = parseFloat(birimFiyatInput.value) || 0;\r\n+\t\t\t\r\n+\t\t\tconsole.log(`Satır ${index + 1}: miktar=${miktar}, birimFiyat=${birimFiyatKdvDahil}`);\r\n+\t\t\t\r\n+\t\t\t// Birim fiyat KDV dahil olduğu için direkt çarpım yapıyoruz\r\n+\t\t\tconst toplamSatir = miktar * birimFiyatKdvDahil;\r\n+\t\t\t\r\n+\t\t\ttoplam += toplamSatir;\r\n+\t\t}\r\n \t});\r\n \t\r\n-\tdocument.getElementById('toplamTutar').textContent = \r\n-\t\ttoplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + ' ₺';\r\n+\tconsole.log('Hesaplanan toplam:', toplam);\r\n+\t\r\n+\tconst toplamTutarElement = document.getElementById('toplamTutar');\r\n+\tif (toplamTutarElement) {\r\n+\t\tconst formattedToplam = toplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + ' ₺';\r\n+\t\tconsole.log('Formatlanan toplam:', formattedToplam);\r\n+\t\ttoplamTutarElement.value = formattedToplam;\r\n+\t} else {\r\n+\t\tconsole.log('toplamTutar elementi bulunamadı');\r\n+\t}\r\n }\r\n \r\n // KDV ayrıştırmasını göster\r\n function updateKdvBreakdown(input) {\r\n@@ -2658,8 +2733,27 @@\n \t\tbreakdownElement.innerHTML = '';\r\n \t}\r\n }\r\n \r\n+// Tahsilat detaylarını toggle etmek için fonksiyon\r\n+function toggleDetay(element) {\r\n+\tconst parent = element.closest('td');\r\n+\tconst shortSpan = parent.querySelector('.detay-short');\r\n+\tconst fullSpan = parent.querySelector('.detay-full');\r\n+\t\r\n+\tif (shortSpan.style.display === 'none') {\r\n+\t\t// Şu an tam metin gösteriliyor, kısa versiyonu göster\r\n+\t\tshortSpan.style.display = 'inline';\r\n+\t\tfullSpan.style.display = 'none';\r\n+\t\telement.textContent = 'Daha fazla göster';\r\n+\t} else {\r\n+\t\t// Şu an kısa metin gösteriliyor, tam versiyonu göster\r\n+\t\tshortSpan.style.display = 'none';\r\n+\t\tfullSpan.style.display = 'inline';\r\n+\t\telement.textContent = 'Daha az göster';\r\n+\t}\r\n+}\r\n+\r\n // Stok dropdown başlat\r\n function initStokAutocomplete() {\r\n \tconsole.log('initStokAutocomplete çağrıldı');\r\n \t\r\n"
                },
                {
                    "date": 1759745069338,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2501,17 +2501,21 @@\n \t\t\t\t\t\t</h6>\r\n \t\t\t\t\t\t<table class=\"table table-bordered table-sm table-hover\" id=\"tahsilatDetayTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"20%\">Kalem</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"63%\">Detay</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"17%\" class=\"text-left\" style=\"padding-left: 10px;\">Toplam</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">ID</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"65%\">Kalem / Detay</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\" class=\"text-center\">Toplam</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\" class=\"text-center\">—</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">—</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"tahsilatDetayTableBody\">\r\n \t\t\t\t`;\r\n \t\t\t\t\r\n \t\t\t\t// Tahsilat verilerini göster\r\n+\t\t\t\tlet tahsilatToplam = 0;\r\n+\t\t\t\tlet tahsilatIndex = 1;\r\n \t\t\t\tif (response.tahsilat_data && response.tahsilat_data.length > 0) {\r\n \t\t\t\t\tresponse.tahsilat_data.forEach(function(item) {\r\n \t\t\t\t\t\t// Eğer detay uzunsa kısalt\r\n \t\t\t\t\t\tlet detayText = item.Detay;\r\n@@ -2520,32 +2524,55 @@\n \t\t\t\t\t\t\tshowMoreBtn = `<br><small><a href=\"javascript:void(0)\" onclick=\"toggleDetay(this)\" class=\"text-primary\">Daha fazla göster</a></small>`;\r\n \t\t\t\t\t\t\tdetayText = `<span class=\"detay-short\">${detayText.substring(0, 100)}...</span><span class=\"detay-full\" style=\"display:none;\">${item.Detay}</span>`;\r\n \t\t\t\t\t\t}\r\n \t\t\t\t\t\t\r\n+\t\t\t\t\t\t// Toplam hesapla (sadece sayısal değerler için)\r\n+\t\t\t\t\t\tconst tutarValue = parseFloat(item.Toplam.replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\r\n+\t\t\t\t\t\ttahsilatToplam += tutarValue;\r\n+\t\t\t\t\t\t\r\n \t\t\t\t\t\thtml += `\r\n \t\t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t\t<td><strong>${item.Kalem}</strong></td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">${tahsilatIndex}</td>\r\n \t\t\t\t\t\t\t\t<td>\r\n-\t\t\t\t\t\t\t\t\t<small style=\"word-break: break-all;\">${detayText}</small>\r\n+\t\t\t\t\t\t\t\t\t<strong>${item.Kalem}</strong><br>\r\n+\t\t\t\t\t\t\t\t\t<small class=\"text-muted\" style=\"word-break: break-all;\">${detayText}</small>\r\n \t\t\t\t\t\t\t\t\t${showMoreBtn}\r\n \t\t\t\t\t\t\t\t</td>\r\n-\t\t\t\t\t\t\t\t<td class=\"text-left\" style=\"padding-left: 10px;\">\r\n-\t\t\t\t\t\t\t\t\t<strong>${item.Toplam} ₺</strong>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" value=\"${item.Toplam} ₺\" readonly style=\"background-color: #f8f9fa; width: 120px;\">\r\n \t\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n \t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t`;\r\n+\t\t\t\t\t\ttahsilatIndex++;\r\n \t\t\t\t\t});\r\n \t\t\t\t} else {\r\n \t\t\t\t\thtml += `\r\n \t\t\t\t\t\t<tr>\r\n-\t\t\t\t\t\t\t<td colspan=\"3\" class=\"text-center text-muted\">\r\n+\t\t\t\t\t\t\t<td colspan=\"5\" class=\"text-center text-muted\">\r\n \t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle mr-1\"></i>Bu cari için henüz tahsilat kaydı bulunmuyor.\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t</tr>\r\n \t\t\t\t\t`;\r\n \t\t\t\t}\r\n \t\t\t\t\r\n+\t\t\t\t// Tahsilat toplam satırını ekle - Stok tablosuyla aynı format\r\n \t\t\t\thtml += `\r\n+\t\t\t\t\t\t<tr class=\"tahsilat-toplam-satir\">\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t<strong>TOPLAM TAHSİLAT</strong>\r\n+\t\t\t\t\t\t\t\t<br><small class=\"text-muted\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-calculator\"></i> Tüm tahsilat türlerinin toplamı\r\n+\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" value=\"${tahsilatToplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ₺\" readonly style=\"background-color: #f8f9fa; font-weight: bold; width: 120px;\">\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t</table>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t`;\r\n"
                },
                {
                    "date": 1759745252386,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2495,11 +2495,8 @@\n \t\t\t\t</div>\r\n \t\t\t\t\t\r\n \t\t\t\t\t<!-- Tahsilat Detayları Tablosu -->\r\n \t\t\t\t\t<div class=\"w-100 mt-4\">\r\n-\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">\r\n-\t\t\t\t\t\t\t<i class=\"fa fa-credit-card mr-2 text-info\"></i>Tahsilat Detayları\r\n-\t\t\t\t\t\t</h6>\r\n \t\t\t\t\t\t<table class=\"table table-bordered table-sm table-hover\" id=\"tahsilatDetayTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">ID</th>\r\n@@ -2525,9 +2522,9 @@\n \t\t\t\t\t\t\tdetayText = `<span class=\"detay-short\">${detayText.substring(0, 100)}...</span><span class=\"detay-full\" style=\"display:none;\">${item.Detay}</span>`;\r\n \t\t\t\t\t\t}\r\n \t\t\t\t\t\t\r\n \t\t\t\t\t\t// Toplam hesapla (sadece sayısal değerler için)\r\n-\t\t\t\t\t\tconst tutarValue = parseFloat(item.Toplam.replace(/[^\\d,.-]/g, '').replace(',', '.')) || 0;\r\n+\t\t\t\t\t\tconst tutarValue = parseFloat(item.Toplam.replace(/[^\\d]/g, '')) || 0;\r\n \t\t\t\t\t\ttahsilatToplam += tutarValue;\r\n \t\t\t\t\t\t\r\n \t\t\t\t\t\thtml += `\r\n \t\t\t\t\t\t\t<tr>\r\n"
                },
                {
                    "date": 1759745309820,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2416,9 +2416,9 @@\n // Stok Bilgisi modal fonksiyonu\r\n window.openStokBilgisiModal = function(satisId, cariId, cariIsletme) {\r\n \tconsole.log('openStokBilgisiModal called with:', { satisId, cariId, cariIsletme });\r\n \t\r\n-\t$('#stokBilgisiModalLabel').html('<i class=\"fa fa-boxes mr-2\"></i>Stok Bilgileri - ' + cariIsletme);\r\n+\t$('#stokBilgisiModalLabel').html('<i class=\"fa fa-boxes mr-2\"></i>Hizmet Bilgileri - ' + cariIsletme);\r\n \t\r\n \t// Modal'da satis_id ve cari_id'yi sakla\r\n \t$('#stokBilgisiModal').data('satisId', satisId);\r\n \t$('#stokBilgisiModal').data('cariId', cariId);\r\n@@ -2454,9 +2454,9 @@\n \t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">ID</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"65%\">Stok Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"65%\">Hizmet Adı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">Miktar</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">KDV (%)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\">Kullanıcı Sayısı</th>\r\n@@ -2499,9 +2499,9 @@\n \t\t\t\t\t\t<table class=\"table table-bordered table-sm table-hover\" id=\"tahsilatDetayTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">ID</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"65%\">Kalem / Detay</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"65%\">Ödeme Türü / Detay</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\" class=\"text-center\">Toplam</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" class=\"text-center\">—</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">—</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n"
                },
                {
                    "date": 1759745700090,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2563,13 +2563,27 @@\n \t\t\t\t\t\t\t\t\t<i class=\"fa fa-calculator\"></i> Tüm tahsilat türlerinin toplamı\r\n \t\t\t\t\t\t\t\t</small>\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td class=\"text-center\">\r\n-\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" value=\"${tahsilatToplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ₺\" readonly style=\"background-color: #f8f9fa; font-weight: bold; width: 120px;\">\r\n+\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" id=\"toplamTahsilat\" value=\"${tahsilatToplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ₺\" readonly style=\"background-color: #f8f9fa; font-weight: bold; width: 120px;\">\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n \t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n \t\t\t\t\t\t</tr>\r\n+\t\t\t\t\t\t<tr class=\"kalan-satir\" style=\"background-color: #fff3cd; border: 2px solid #ffc107;\">\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t<td>\r\n+\t\t\t\t\t\t\t\t<strong style=\"color: #856404;\">KALAN TUTAR</strong>\r\n+\t\t\t\t\t\t\t\t<br><small class=\"text-muted\">\r\n+\t\t\t\t\t\t\t\t\t<i class=\"fa fa-exclamation-triangle\" style=\"color: #856404;\"></i> Ödenmesi gereken tutar\r\n+\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" id=\"kalanTutar\" value=\"0 ₺\" readonly style=\"background-color: #fff3cd; font-weight: bold; width: 120px; color: #856404; border: 1px solid #ffc107;\">\r\n+\t\t\t\t\t\t\t</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t</table>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t`;\r\n@@ -2737,10 +2751,61 @@\n \t\ttoplamTutarElement.value = formattedToplam;\r\n \t} else {\r\n \t\tconsole.log('toplamTutar elementi bulunamadı');\r\n \t}\r\n+\t\r\n+\t// Kalan tutarı hesapla\r\n+\thesaplaKalanTutar(toplam);\r\n }\r\n \r\n+// Kalan tutarı hesapla (Stok Toplam - Tahsilat Toplam)\r\n+function hesaplaKalanTutar(stokToplam) {\r\n+\tconst toplamTahsilatElement = document.getElementById('toplamTahsilat');\r\n+\tconst kalanTutarElement = document.getElementById('kalanTutar');\r\n+\t\r\n+\tif (toplamTahsilatElement && kalanTutarElement) {\r\n+\t\t// Tahsilat toplamını al (sadece sayıları)\r\n+\t\tconst tahsilatToplamStr = toplamTahsilatElement.value.replace(/[^\\d]/g, '');\r\n+\t\tconst tahsilatToplam = parseFloat(tahsilatToplamStr) || 0;\r\n+\t\t\r\n+\t\tconsole.log('Stok Toplam:', stokToplam, 'Tahsilat Toplam:', tahsilatToplam);\r\n+\t\t\r\n+\t\t// Kalan tutarı hesapla\r\n+\t\tconst kalanTutar = stokToplam - tahsilatToplam;\r\n+\t\t\r\n+\t\t// Kalan tutara göre renklendirme\r\n+\t\tlet backgroundColor = '#d4edda'; // Yeşil (ödendi)\r\n+\t\tlet textColor = '#155724';\r\n+\t\tlet borderColor = '#c3e6cb';\r\n+\t\t\r\n+\t\tif (kalanTutar > 0) {\r\n+\t\t\tbackgroundColor = '#fff3cd'; // Sarı (kalan var)\r\n+\t\t\ttextColor = '#856404';\r\n+\t\t\tborderColor = '#ffc107';\r\n+\t\t} else if (kalanTutar < 0) {\r\n+\t\t\tbackgroundColor = '#f8d7da'; // Kırmızı (fazla ödeme)\r\n+\t\t\ttextColor = '#721c24';\r\n+\t\t\tborderColor = '#f5c6cb';\r\n+\t\t}\r\n+\t\t\r\n+\t\t// Kalan tutarı input'a yaz\r\n+\t\tconst formattedKalan = Math.abs(kalanTutar).toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + ' ₺';\r\n+\t\tkalanTutarElement.value = formattedKalan;\r\n+\t\t\r\n+\t\t// Renklendirmeyi uygula\r\n+\t\tkalanTutarElement.style.backgroundColor = backgroundColor;\r\n+\t\tkalanTutarElement.style.color = textColor;\r\n+\t\tkalanTutarElement.style.borderColor = borderColor;\r\n+\t\t\r\n+\t\t// Satırı da renklendir\r\n+\t\tconst kalanSatir = kalanTutarElement.closest('tr');\r\n+\t\tif (kalanSatir) {\r\n+\t\t\tkalanSatir.style.backgroundColor = backgroundColor;\r\n+\t\t\tkalanSatir.style.borderColor = borderColor;\r\n+\t\t}\r\n+\t}\r\n+}\r\n+\r\n // KDV ayrıştırmasını göster\r\n function updateKdvBreakdown(input) {\r\n \tconst row = input.closest('tr');\r\n \tconst kdvDahilFiyat = parseFloat(input.value) || 0;\r\n"
                },
                {
                    "date": 1759745819710,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2521,10 +2521,28 @@\n \t\t\t\t\t\t\tshowMoreBtn = `<br><small><a href=\"javascript:void(0)\" onclick=\"toggleDetay(this)\" class=\"text-primary\">Daha fazla göster</a></small>`;\r\n \t\t\t\t\t\t\tdetayText = `<span class=\"detay-short\">${detayText.substring(0, 100)}...</span><span class=\"detay-full\" style=\"display:none;\">${item.Detay}</span>`;\r\n \t\t\t\t\t\t}\r\n \t\t\t\t\t\t\r\n-\t\t\t\t\t\t// Toplam hesapla (sadece sayısal değerler için)\r\n-\t\t\t\t\t\tconst tutarValue = parseFloat(item.Toplam.replace(/[^\\d]/g, '')) || 0;\r\n+\t\t\t\t\t\t// Toplam hesapla (sayı formatını düzelt)\r\n+\t\t\t\t\t\tlet tutarStr = item.Toplam.toString();\r\n+\t\t\t\t\t\t// Binlik ayırıcıları (virgül, nokta) kaldır ve sadece son noktayı ondalık ayırıcı olarak bırak\r\n+\t\t\t\t\t\ttutarStr = tutarStr.replace(/[^\\d.,]/g, ''); // Sadece rakam, virgül ve nokta bırak\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\t// Türkçe format (123.456,78) veya İngilizce format (123,456.78) kontrolü\r\n+\t\t\t\t\t\tif (tutarStr.includes(',')) {\r\n+\t\t\t\t\t\t\t// Eğer virgülden sonra 2 hane varsa ondalık ayırıcı, yoksa binlik ayırıcı\r\n+\t\t\t\t\t\t\tconst parts = tutarStr.split(',');\r\n+\t\t\t\t\t\t\tif (parts.length === 2 && parts[1].length <= 2) {\r\n+\t\t\t\t\t\t\t\t// Türkçe format: 123.456,78\r\n+\t\t\t\t\t\t\t\ttutarStr = tutarStr.replace(/\\./g, '').replace(',', '.');\r\n+\t\t\t\t\t\t\t} else {\r\n+\t\t\t\t\t\t\t\t// İngilizce format: 123,456.78\r\n+\t\t\t\t\t\t\t\ttutarStr = tutarStr.replace(/,/g, '');\r\n+\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\tconst tutarValue = parseFloat(tutarStr) || 0;\r\n+\t\t\t\t\t\tconsole.log('Item:', item.Kalem, 'Toplam:', item.Toplam, 'Parsed:', tutarValue);\r\n \t\t\t\t\t\ttahsilatToplam += tutarValue;\r\n \t\t\t\t\t\t\r\n \t\t\t\t\t\thtml += `\r\n \t\t\t\t\t\t\t<tr>\r\n"
                },
                {
                    "date": 1759745830224,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2499,9 +2499,9 @@\n \t\t\t\t\t\t<table class=\"table table-bordered table-sm table-hover\" id=\"tahsilatDetayTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">ID</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"65%\">Ödeme Türü / Detay</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"65%\">Tahsilat Türü / Detay</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\" class=\"text-center\">Toplam</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" class=\"text-center\">—</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">—</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n"
                },
                {
                    "date": 1759745859137,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2576,11 +2576,8 @@\n \t\t\t\t\t\t<tr class=\"tahsilat-toplam-satir\">\r\n \t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n \t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t<strong>TOPLAM TAHSİLAT</strong>\r\n-\t\t\t\t\t\t\t\t<br><small class=\"text-muted\">\r\n-\t\t\t\t\t\t\t\t\t<i class=\"fa fa-calculator\"></i> Tüm tahsilat türlerinin toplamı\r\n-\t\t\t\t\t\t\t\t</small>\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td class=\"text-center\">\r\n \t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" id=\"toplamTahsilat\" value=\"${tahsilatToplam.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})} ₺\" readonly style=\"background-color: #f8f9fa; font-weight: bold; width: 120px;\">\r\n \t\t\t\t\t\t\t</td>\r\n"
                },
                {
                    "date": 1759745900230,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2587,11 +2587,8 @@\n \t\t\t\t\t\t<tr class=\"kalan-satir\" style=\"background-color: #fff3cd; border: 2px solid #ffc107;\">\r\n \t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n \t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t<strong style=\"color: #856404;\">KALAN TUTAR</strong>\r\n-\t\t\t\t\t\t\t\t<br><small class=\"text-muted\">\r\n-\t\t\t\t\t\t\t\t\t<i class=\"fa fa-exclamation-triangle\" style=\"color: #856404;\"></i> Ödenmesi gereken tutar\r\n-\t\t\t\t\t\t\t\t</small>\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td class=\"text-center\">\r\n \t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" id=\"kalanTutar\" value=\"0 ₺\" readonly style=\"background-color: #fff3cd; font-weight: bold; width: 120px; color: #856404; border: 1px solid #ffc107;\">\r\n \t\t\t\t\t\t\t</td>\r\n"
                },
                {
                    "date": 1759746143971,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2665,14 +2665,15 @@\n \t\t\t\t\t   value=\"${data.satisStok_miktar || 1}\" min=\"1\" step=\"0.01\" \r\n \t\t\t\t\t   onchange=\"hesaplaToplamTutar()\">\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n-\t\t\t\t<input type=\"number\" class=\"form-control birimFiyat\" name=\"birimFiyat[]\" \r\n-\t\t\t\t\t   value=\"${data.satisStok_fiyatMiktar || 0}\" min=\"0\" step=\"0.01\" \r\n+\t\t\t\t<input type=\"text\" class=\"form-control birimFiyat\" name=\"birimFiyat[]\" \r\n+\t\t\t\t\t   value=\"${formatTurkishNumber(data.satisStok_fiyatMiktar || 0)}\" \r\n \t\t\t\t\t   placeholder=\"KDV dahil fiyat\"\r\n-\t\t\t\t\t   title=\"KDV dahil birim fiyat giriniz\"\r\n+\t\t\t\t\t   title=\"KDV dahil birim fiyat giriniz (123.456,78 formatında)\"\r\n \t\t\t\t\t   onchange=\"hesaplaToplamTutar(); updateKdvBreakdown(this);\"\r\n-\t\t\t\t\t   onkeyup=\"updateKdvBreakdown(this);\">\r\n+\t\t\t\t\t   onkeyup=\"formatBirimFiyatInput(this); updateKdvBreakdown(this);\"\r\n+\t\t\t\t\t   onblur=\"validateAndFormatBirimFiyat(this);\">\r\n \t\t\t\t<small class=\"text-muted kdv-breakdown\" style=\"font-size: 0.75em;\"></small>\r\n \t\t\t</td>\r\n \t\t\t<td style=\"display: none;\">\r\n \t\t\t\t<select class=\"form-control kdvOrani\" name=\"kdvOrani[]\" onchange=\"hesaplaToplamTutar(); updateKdvBreakdown(this.closest('tr').querySelector('.birimFiyat'));\">\r\n@@ -2742,9 +2743,10 @@\n \t\tconst kdvOraniInput = row.querySelector('.kdvOrani');\r\n \t\t\r\n \t\tif (miktarInput && birimFiyatInput && kdvOraniInput) {\r\n \t\t\tconst miktar = parseFloat(miktarInput.value) || 0;\r\n-\t\t\tconst birimFiyatKdvDahil = parseFloat(birimFiyatInput.value) || 0;\r\n+\t\t\t// Birim fiyatı Türkçe formatdan parse et\r\n+\t\t\tconst birimFiyatKdvDahil = parseTurkishNumber(birimFiyatInput.value) || 0;\r\n \t\t\t\r\n \t\t\tconsole.log(`Satır ${index + 1}: miktar=${miktar}, birimFiyat=${birimFiyatKdvDahil}`);\r\n \t\t\t\r\n \t\t\t// Birim fiyat KDV dahil olduğu için direkt çarpım yapıyoruz\r\n@@ -2816,21 +2818,80 @@\n \t\t}\r\n \t}\r\n }\r\n \r\n+// Türkçe sayı formatından sayıya çevirme (123.456,78 -> 123456.78)\r\n+function parseTurkishNumber(str) {\r\n+\tif (!str) return 0;\r\n+\t\r\n+\t// String'e çevir ve temizle\r\n+\tstr = str.toString().trim();\r\n+\t\r\n+\t// Sadece rakam, nokta ve virgül bırak\r\n+\tstr = str.replace(/[^\\d.,]/g, '');\r\n+\t\r\n+\tif (str === '') return 0;\r\n+\t\r\n+\t// Eğer virgül varsa, Türkçe format kabul et\r\n+\tif (str.includes(',')) {\r\n+\t\t// Son virgülden sonra en fazla 2 karakter varsa, ondalık ayırıcı\r\n+\t\tconst parts = str.split(',');\r\n+\t\tif (parts.length === 2 && parts[1].length <= 2) {\r\n+\t\t\t// Türkçe format: 123.456,78\r\n+\t\t\tstr = str.replace(/\\./g, '').replace(',', '.');\r\n+\t\t} else {\r\n+\t\t\t// Birden fazla virgül varsa sadece sayıları al\r\n+\t\t\tstr = str.replace(/[^0-9]/g, '');\r\n+\t\t}\r\n+\t}\r\n+\t\r\n+\treturn parseFloat(str) || 0;\r\n+}\r\n+\r\n+// Sayıyı Türkçe formata çevirme (123456.78 -> 123.456,78)\r\n+function formatTurkishNumber(num) {\r\n+\tif (!num || num == 0) return '0,00';\r\n+\t\r\n+\tnum = parseFloat(num);\r\n+\tif (isNaN(num)) return '0,00';\r\n+\t\r\n+\t// 2 ondalık basamakla formatla\r\n+\treturn num.toLocaleString('tr-TR', {\r\n+\t\tminimumFractionDigits: 2,\r\n+\t\tmaximumFractionDigits: 2\r\n+\t});\r\n+}\r\n+\r\n+// Birim fiyat input formatla (kullanıcı yazarken)\r\n+function formatBirimFiyatInput(input) {\r\n+\t// Sadece rakam, nokta ve virgüle izin ver\r\n+\tlet value = input.value.replace(/[^\\d.,]/g, '');\r\n+\tinput.value = value;\r\n+}\r\n+\r\n+// Birim fiyat validasyon ve format (kullanıcı alanı terk ettiğinde)\r\n+function validateAndFormatBirimFiyat(input) {\r\n+\tconst parsed = parseTurkishNumber(input.value);\r\n+\tinput.value = formatTurkishNumber(parsed);\r\n+\t\r\n+\t// Hesaplamayı tetikle\r\n+\thesaplaToplamTutar();\r\n+\tupdateKdvBreakdown(input);\r\n+}\r\n+\r\n // KDV ayrıştırmasını göster\r\n function updateKdvBreakdown(input) {\r\n \tconst row = input.closest('tr');\r\n-\tconst kdvDahilFiyat = parseFloat(input.value) || 0;\r\n+\tconst kdvDahilFiyat = parseTurkishNumber(input.value) || 0;\r\n \tconst kdvOrani = parseFloat(row.querySelector('.kdvOrani').value) || 0;\r\n \tconst breakdownElement = row.querySelector('.kdv-breakdown');\r\n \t\r\n \tif (kdvDahilFiyat > 0 && kdvOrani > 0) {\r\n \t\tconst kdvHaricFiyat = kdvDahilFiyat / (1 + (kdvOrani / 100));\r\n \t\tconst kdvTutari = kdvDahilFiyat - kdvHaricFiyat;\r\n \t\t\r\n \t\tbreakdownElement.innerHTML = \r\n-\t\t\t`KDV Hariç: ${kdvHaricFiyat.toFixed(2)} ₺ + KDV(${kdvOrani}%): ${kdvTutari.toFixed(2)} ₺`;\r\n+\t\t\t`KDV Hariç: ${formatTurkishNumber(kdvHaricFiyat)} ₺ + KDV(${kdvOrani}%): ${formatTurkishNumber(kdvTutari)} ₺`;\r\n \t} else {\r\n \t\tbreakdownElement.innerHTML = '';\r\n \t}\r\n }\r\n"
                },
                {
                    "date": 1759751400707,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3042,18 +3042,44 @@\n \t\r\n \tconsole.log('Kaydet clicked with:', { satisId, cariId });\r\n \t\r\n \tdocument.querySelectorAll('#stokTableBody tr').forEach(function(row) {\r\n+\t\t// Toplam satırını atla\r\n+\t\tif (row.classList.contains('toplam-satir')) {\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n \t\tconst stokDropdown = row.querySelector('.stokDropdown');\r\n \t\tconst selectedOption = stokDropdown ? stokDropdown.options[stokDropdown.selectedIndex] : null;\r\n+\t\t\r\n+\t\t// Element kontrolü ekle\r\n+\t\tconst satisStokIdEl = row.querySelector('.satisStokId');\r\n+\t\tconst stokIdEl = row.querySelector('.stokId');\r\n+\t\tconst miktarEl = row.querySelector('.miktar');\r\n+\t\tconst birimFiyatEl = row.querySelector('.birimFiyat');\r\n+\t\tconst kdvOraniEl = row.querySelector('.kdvOrani');\r\n+\t\tconst kullaniciSayisiEl = row.querySelector('.kullaniciSayisi');\r\n+\t\t\r\n+\t\tif (!satisStokIdEl || !stokIdEl || !miktarEl || !birimFiyatEl || !kdvOraniEl || !kullaniciSayisiEl) {\r\n+\t\t\tconsole.warn('Bazı form elementleri bulunamadı:', {\r\n+\t\t\t\tsatisStokId: !!satisStokIdEl,\r\n+\t\t\t\tstokId: !!stokIdEl,\r\n+\t\t\t\tmiktar: !!miktarEl,\r\n+\t\t\t\tbirimFiyat: !!birimFiyatEl,\r\n+\t\t\t\tkdvOrani: !!kdvOraniEl,\r\n+\t\t\t\tkullaniciSayisi: !!kullaniciSayisiEl\r\n+\t\t\t});\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n \t\tconst stokData = {\r\n-\t\t\tsatisStok_id: row.querySelector('.satisStokId').value,\r\n-\t\t\tstok_id: row.querySelector('.stokId').value,\r\n+\t\t\tsatisStok_id: satisStokIdEl.value,\r\n+\t\t\tstok_id: stokIdEl.value,\r\n \t\t\tstok_adi: selectedOption ? selectedOption.text.split(' (')[0] : '', // Sadece stok adını al, kodu çıkar\r\n-\t\t\tmiktar: row.querySelector('.miktar').value,\r\n-\t\t\tbirim_fiyat: row.querySelector('.birimFiyat').value,\r\n-\t\t\tkdv_orani: row.querySelector('.kdvOrani').value,\r\n-\t\t\tkullanici_sayisi: row.querySelector('.kullaniciSayisi').value\r\n+\t\t\tmiktar: miktarEl.value,\r\n+\t\t\tbirim_fiyat: birimFiyatEl.value,\r\n+\t\t\tkdv_orani: kdvOraniEl.value,\r\n+\t\t\tkullanici_sayisi: kullaniciSayisiEl.value\r\n \t\t};\r\n \t\t\r\n \t\tif (stokData.stok_id && stokData.miktar && stokData.birim_fiyat) {\r\n \t\t\tformData.push(stokData);\r\n"
                },
                {
                    "date": 1759751588187,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3070,18 +3070,66 @@\n \t\t\t});\r\n \t\t\treturn;\r\n \t\t}\r\n \t\t\r\n+\t\t// Türkçe sayı formatını parse et\r\n+\t\tfunction parseTurkishNumber(value) {\r\n+\t\t\tif (!value) return 0;\r\n+\t\t\t\r\n+\t\t\t// String'e çevir\r\n+\t\t\tlet numStr = value.toString().trim();\r\n+\t\t\t\r\n+\t\t\t// Sadece rakam, nokta ve virgül bırak\r\n+\t\t\tnumStr = numStr.replace(/[^\\d.,]/g, '');\r\n+\t\t\t\r\n+\t\t\t// Eğer boşsa 0 döndür\r\n+\t\t\tif (!numStr) return 0;\r\n+\t\t\t\r\n+\t\t\t// Türkçe format kontrolü (414.000,50 formatında)\r\n+\t\t\tif (numStr.includes('.') && numStr.includes(',')) {\r\n+\t\t\t\t// Hem nokta hem virgül var - Türkçe format\r\n+\t\t\t\t// Noktaları kaldır (binlik ayırıcı), virgülü ondalık ayırıcı yap\r\n+\t\t\t\tnumStr = numStr.replace(/\\./g, '').replace(',', '.');\r\n+\t\t\t} else if (numStr.includes(',')) {\r\n+\t\t\t\t// Sadece virgül var\r\n+\t\t\t\tconst parts = numStr.split(',');\r\n+\t\t\t\tif (parts.length === 2 && parts[1].length <= 2) {\r\n+\t\t\t\t\t// Ondalık ayırıcı olarak virgül kullanılmış\r\n+\t\t\t\t\tnumStr = numStr.replace(',', '.');\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\t// Binlik ayırıcı olarak virgül kullanılmış\r\n+\t\t\t\t\tnumStr = numStr.replace(/,/g, '');\r\n+\t\t\t\t}\r\n+\t\t\t} else if (numStr.includes('.')) {\r\n+\t\t\t\t// Sadece nokta var\r\n+\t\t\t\tconst parts = numStr.split('.');\r\n+\t\t\t\tif (parts.length === 2 && parts[1].length <= 2) {\r\n+\t\t\t\t\t// Ondalık ayırıcı olarak nokta kullanılmış - değiştirme\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\t// Binlik ayırıcı olarak nokta kullanılmış\r\n+\t\t\t\t\tnumStr = numStr.replace(/\\./g, '');\r\n+\t\t\t\t}\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\treturn parseFloat(numStr) || 0;\r\n+\t\t}\r\n+\t\t\r\n \t\tconst stokData = {\r\n \t\t\tsatisStok_id: satisStokIdEl.value,\r\n \t\t\tstok_id: stokIdEl.value,\r\n \t\t\tstok_adi: selectedOption ? selectedOption.text.split(' (')[0] : '', // Sadece stok adını al, kodu çıkar\r\n-\t\t\tmiktar: miktarEl.value,\r\n-\t\t\tbirim_fiyat: birimFiyatEl.value,\r\n+\t\t\tmiktar: parseTurkishNumber(miktarEl.value),\r\n+\t\t\tbirim_fiyat: parseTurkishNumber(birimFiyatEl.value),\r\n \t\t\tkdv_orani: kdvOraniEl.value,\r\n \t\t\tkullanici_sayisi: kullaniciSayisiEl.value\r\n \t\t};\r\n \t\t\r\n+\t\tconsole.log('Stok data prepared:', {\r\n+\t\t\toriginal_birim_fiyat: birimFiyatEl.value,\r\n+\t\t\tparsed_birim_fiyat: stokData.birim_fiyat,\r\n+\t\t\tmiktar: stokData.miktar\r\n+\t\t});\r\n+\t\t\r\n \t\tif (stokData.stok_id && stokData.miktar && stokData.birim_fiyat) {\r\n \t\t\tformData.push(stokData);\r\n \t\t}\r\n \t});\r\n"
                },
                {
                    "date": 1759839514604,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2499,12 +2499,12 @@\n \t\t\t\t\t\t<table class=\"table table-bordered table-sm table-hover\" id=\"tahsilatDetayTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">ID</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"65%\">Tahsilat Türü / Detay</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"60%\">Tahsilat Türü / Detay</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\" class=\"text-center\">Toplam</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" class=\"text-center\">—</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">—</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"10%\" class=\"text-center\">Onay</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"tahsilatDetayTableBody\">\r\n \t\t\t\t`;\r\n@@ -2543,10 +2543,31 @@\n \t\t\t\t\t\tconst tutarValue = parseFloat(tutarStr) || 0;\r\n \t\t\t\t\t\tconsole.log('Item:', item.Kalem, 'Toplam:', item.Toplam, 'Parsed:', tutarValue);\r\n \t\t\t\t\t\ttahsilatToplam += tutarValue;\r\n \t\t\t\t\t\t\r\n+\t\t\t\t\t\t// Veri kontrolü - daha esnek kontrol\r\n+\t\t\t\t\t\t// Görseldeğinde Banka & Pos için: item.Kalem=\"Banka & Pos\", item.Toplam=\"2,200,000.00 ₺\", item.Detay=\"2025-08-08 / 2,200,000.00\"\r\n+\t\t\t\t\t\tconst tutarCheck = item.Toplam && item.Toplam !== '0.00 ₺' && item.Toplam !== '0 ₺' && parseFloat(item.Toplam.toString().replace(/[^\\d.,]/g, '').replace(',', '.')) > 0;\r\n+\t\t\t\t\t\tconst kalemCheck = item.Kalem && item.Kalem !== '—' && item.Kalem.trim().length > 0;\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\t// Geçerli tahsilat türleri\r\n+\t\t\t\t\t\tconst validTahsilatTypes = ['Banka & Pos', 'Çek', 'Senet', 'Nakit (Kasa)', 'Banka/Pos', 'Kasa/Nakit'];\r\n+\t\t\t\t\t\tconst isValidType = validTahsilatTypes.includes(item.Kalem);\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\tconst hasValidData = tutarCheck && kalemCheck && isValidType;\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\tconsole.log('Tahsilat kontrol:', {\r\n+\t\t\t\t\t\t\tkalem: item.Kalem,\r\n+\t\t\t\t\t\t\ttoplam: item.Toplam,\r\n+\t\t\t\t\t\t\tdetay: item.Detay,\r\n+\t\t\t\t\t\t\ttutarCheck: tutarCheck,\r\n+\t\t\t\t\t\t\tkalemCheck: kalemCheck,\r\n+\t\t\t\t\t\t\tisValidType: isValidType,\r\n+\t\t\t\t\t\t\thasValidData: hasValidData\r\n+\t\t\t\t\t\t});\r\n+\t\t\t\t\t\t\r\n \t\t\t\t\t\thtml += `\r\n-\t\t\t\t\t\t\t<tr>\r\n+\t\t\t\t\t\t\t<tr data-tahsilat-id=\"${item.unique_id || ''}\" data-tip-kod=\"${item.tip_kod || ''}\">\r\n \t\t\t\t\t\t\t\t<td class=\"text-center\">${tahsilatIndex}</td>\r\n \t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t<strong>${item.Kalem}</strong><br>\r\n \t\t\t\t\t\t\t\t\t<small class=\"text-muted\" style=\"word-break: break-all;\">${detayText}</small>\r\n@@ -2555,9 +2576,19 @@\n \t\t\t\t\t\t\t\t<td class=\"text-center\">\r\n \t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" value=\"${item.Toplam} ₺\" readonly style=\"background-color: #f8f9fa; width: 120px;\">\r\n \t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n-\t\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t\t${hasValidData ? `\r\n+\t\t\t\t\t\t\t\t\t\t<div class=\"custom-control custom-checkbox\">\r\n+\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"custom-control-input tahsilat-onay-checkbox\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t   id=\"onay_${item.unique_id || tahsilatIndex}\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t   data-tahsilat-id=\"${item.unique_id || ''}\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t   ${item.onay_durumu == 1 ? 'checked' : ''}>\r\n+\t\t\t\t\t\t\t\t\t\t\t<label class=\"custom-control-label\" for=\"onay_${item.unique_id || tahsilatIndex}\"></label>\r\n+\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t` : '—'}\r\n+\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t`;\r\n \t\t\t\t\t\ttahsilatIndex++;\r\n \t\t\t\t\t});\r\n@@ -2592,9 +2623,15 @@\n \t\t\t\t\t\t\t<td class=\"text-center\">\r\n \t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control text-center\" id=\"kalanTutar\" value=\"0 ₺\" readonly style=\"background-color: #fff3cd; font-weight: bold; width: 120px; color: #856404; border: 1px solid #ffc107;\">\r\n \t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n-\t\t\t\t\t\t\t<td class=\"text-center\">—</td>\r\n+\t\t\t\t\t\t\t<td class=\"text-center\">\r\n+\t\t\t\t\t\t\t\t<div class=\"custom-control custom-checkbox\">\r\n+\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"custom-control-input\" id=\"tumunuOnaylaCheckbox\" title=\"Tümünü Onayla/İptal Et\">\r\n+\t\t\t\t\t\t\t\t\t<label class=\"custom-control-label\" for=\"tumunuOnaylaCheckbox\" style=\"color: #856404; font-weight: bold;\"></label>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t<small class=\"text-muted d-block mt-1\" style=\"font-size: 0.7rem;\">Tümünü Onayla</small>\r\n+\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</tbody>\r\n \t\t\t\t\t\t</table>\r\n \t\t\t\t\t</div>\r\n@@ -2611,8 +2648,13 @@\n \t\t\t\t// Mevcut veriler için KDV ayrıştırmasını göster\r\n \t\t\t\tdocument.querySelectorAll('.birimFiyat').forEach(function(input) {\r\n \t\t\t\t\tupdateKdvBreakdown(input);\r\n \t\t\t\t});\r\n+\t\t\t\t\r\n+\t\t\t\t// Tümünü onayla checkbox durumunu güncelle\r\n+\t\t\t\tsetTimeout(function() {\r\n+\t\t\t\t\tupdateTumunuOnaylaCheckbox();\r\n+\t\t\t\t}, 100);\r\n \t\t\t} else {\r\n \t\t\t\tconsole.log('AJAX Response not success:', response);\r\n \t\t\t\t$('#stokBilgisiContent').html(`\r\n \t\t\t\t\t<div class=\"alert alert-danger text-center\">\r\n@@ -4789,10 +4831,119 @@\n \t// Modal gösterildiğinde Select2'yi başlat\r\n \t$('#satisSozlesmeModal').on('shown.bs.modal', function() {\r\n \t\tinitializeSelect2ForModal();\r\n \t});\r\n+\t\r\n+\t// Tahsilat onay checkbox değişiklik event'i\r\n+\t$(document).on('change', '.tahsilat-onay-checkbox', function() {\r\n+\t\tconst checkbox = $(this);\r\n+\t\tconst tahsilatId = checkbox.data('tahsilat-id');\r\n+\t\tconst isChecked = checkbox.is(':checked');\r\n+\t\t\r\n+\t\tif (!tahsilatId) {\r\n+\t\t\tconsole.warn('Tahsilat ID bulunamadı');\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\t// AJAX ile onay durumunu güncelle\r\n+\t\t$.ajax({\r\n+\t\t\turl: '<?= base_url(\"muhasebe/updateTahsilatOnay\") ?>',\r\n+\t\t\ttype: 'POST',\r\n+\t\t\tdata: {\r\n+\t\t\t\ttahsilat_id: tahsilatId,\r\n+\t\t\t\tonay_durumu: isChecked ? 1 : 0\r\n+\t\t\t},\r\n+\t\t\tsuccess: function(response) {\r\n+\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t// Başarılı mesaj göster\r\n+\t\t\t\t\ttoastr.success('Onay durumu güncellendi');\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t// Tümünü onayla checkbox durumunu kontrol et\r\n+\t\t\t\t\tupdateTumunuOnaylaCheckbox();\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\t// Hata durumunda checkbox'ı eski haline döndür\r\n+\t\t\t\t\tcheckbox.prop('checked', !isChecked);\r\n+\t\t\t\t\ttoastr.error(response.message || 'Güncelleme sırasında hata oluştu');\r\n+\t\t\t\t}\r\n+\t\t\t},\r\n+\t\t\terror: function(xhr, status, error) {\r\n+\t\t\t\t// Hata durumunda checkbox'ı eski haline döndür\r\n+\t\t\t\tcheckbox.prop('checked', !isChecked);\r\n+\t\t\t\ttoastr.error('İşlem sırasında hata oluştu');\r\n+\t\t\t\tconsole.error('AJAX Error:', error);\r\n+\t\t\t}\r\n+\t\t});\r\n+\t});\r\n+\t\r\n+\t// Tümünü Onayla checkbox event'i\r\n+\t$(document).on('change', '#tumunuOnaylaCheckbox', function() {\r\n+\t\tconst isChecked = $(this).is(':checked');\r\n+\t\tconst tahsilatCheckboxes = $('.tahsilat-onay-checkbox');\r\n+\t\t\r\n+\t\t// Tüm tahsilat checkbox'larını aynı duruma getir\r\n+\t\ttahsilatCheckboxes.each(function() {\r\n+\t\t\tconst checkbox = $(this);\r\n+\t\t\tconst tahsilatId = checkbox.data('tahsilat-id');\r\n+\t\t\t\r\n+\t\t\tif (tahsilatId && checkbox.is(':checked') !== isChecked) {\r\n+\t\t\t\t// Checkbox durumunu değiştir\r\n+\t\t\t\tcheckbox.prop('checked', isChecked);\r\n+\t\t\t\t\r\n+\t\t\t\t// AJAX ile güncelle\r\n+\t\t\t\t$.ajax({\r\n+\t\t\t\t\turl: '<?= base_url(\"muhasebe/updateTahsilatOnay\") ?>',\r\n+\t\t\t\t\ttype: 'POST',\r\n+\t\t\t\t\tdata: {\r\n+\t\t\t\t\t\ttahsilat_id: tahsilatId,\r\n+\t\t\t\t\t\tonay_durumu: isChecked ? 1 : 0\r\n+\t\t\t\t\t},\r\n+\t\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\t\tif (!response.success) {\r\n+\t\t\t\t\t\t\t// Hata durumunda checkbox'ı eski haline döndür\r\n+\t\t\t\t\t\t\tcheckbox.prop('checked', !isChecked);\r\n+\t\t\t\t\t\t\ttoastr.error(response.message || 'Güncelleme sırasında hata oluştu');\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t},\r\n+\t\t\t\t\terror: function() {\r\n+\t\t\t\t\t\t// Hata durumunda checkbox'ı eski haline döndür\r\n+\t\t\t\t\t\tcheckbox.prop('checked', !isChecked);\r\n+\t\t\t\t\t\ttoastr.error('İşlem sırasında hata oluştu');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t});\r\n+\t\t\t}\r\n+\t\t});\r\n+\t\t\r\n+\t\t// Başarı mesajı göster\r\n+\t\ttoastr.success(isChecked ? 'Tüm tahsilatlar onaylandı' : 'Tüm tahsilat onayları kaldırıldı');\r\n+\t});\r\n });\r\n \r\n+// Tümünü onayla checkbox durumunu güncelle\r\n+function updateTumunuOnaylaCheckbox() {\r\n+\tconst tahsilatCheckboxes = $('.tahsilat-onay-checkbox');\r\n+\tconst tumunuOnaylaCheckbox = $('#tumunuOnaylaCheckbox');\r\n+\t\r\n+\tif (tahsilatCheckboxes.length === 0) {\r\n+\t\t// Hiç tahsilat yoksa tümünü onayla checkbox'ını gizle\r\n+\t\ttumunuOnaylaCheckbox.prop('checked', false).prop('disabled', true);\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\t// Aktif checkbox'ları kontrol et\r\n+\tconst checkedCount = tahsilatCheckboxes.filter(':checked').length;\r\n+\tconst totalCount = tahsilatCheckboxes.length;\r\n+\t\r\n+\t// Tümü işaretliyse tümünü onayla checkbox'ını işaretle\r\n+\tif (checkedCount === totalCount) {\r\n+\t\ttumunuOnaylaCheckbox.prop('checked', true);\r\n+\t} else {\r\n+\t\ttumunuOnaylaCheckbox.prop('checked', false);\r\n+\t}\r\n+\t\r\n+\t// Checkbox'ı aktif et\r\n+\ttumunuOnaylaCheckbox.prop('disabled', false);\r\n+}\r\n+\r\n // Cari detay fonksiyonları kaldırıldı - sadece stok bilgileri gösterilecek\r\n \r\n </script>\r\n \r\n"
                },
                {
                    "date": 1759843133840,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4849,9 +4849,10 @@\n \t\t\turl: '<?= base_url(\"muhasebe/updateTahsilatOnay\") ?>',\r\n \t\t\ttype: 'POST',\r\n \t\t\tdata: {\r\n \t\t\t\ttahsilat_id: tahsilatId,\r\n-\t\t\t\tonay_durumu: isChecked ? 1 : 0\r\n+\t\t\t\tonay_durumu: isChecked ? 1 : 0,\r\n+\t\t\t\tcari_id: $('#stokBilgisiModal').data('cariId')\r\n \t\t\t},\r\n \t\t\tsuccess: function(response) {\r\n \t\t\t\tif (response.success) {\r\n \t\t\t\t\t// Başarılı mesaj göster\r\n@@ -4893,9 +4894,10 @@\n \t\t\t\t\turl: '<?= base_url(\"muhasebe/updateTahsilatOnay\") ?>',\r\n \t\t\t\t\ttype: 'POST',\r\n \t\t\t\t\tdata: {\r\n \t\t\t\t\t\ttahsilat_id: tahsilatId,\r\n-\t\t\t\t\t\tonay_durumu: isChecked ? 1 : 0\r\n+\t\t\t\t\t\tonay_durumu: isChecked ? 1 : 0,\r\n+\t\t\t\t\t\tcari_id: $('#stokBilgisiModal').data('cariId')\r\n \t\t\t\t\t},\r\n \t\t\t\t\tsuccess: function(response) {\r\n \t\t\t\t\t\tif (!response.success) {\r\n \t\t\t\t\t\t\t// Hata durumunda checkbox'ı eski haline döndür\r\n"
                },
                {
                    "date": 1759912331384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -701,9 +701,9 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br><small class=\"text-success\">✓ Otomatik tamamlama aktif (2+ karakter yazın)</small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</small>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-2\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"aktivasyon_durum\">Aktivasyon Durum</label>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control\" id=\"aktivasyon_durum\" name=\"aktivasyon_durum\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Tümü</option>\r\n@@ -715,10 +715,20 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"Reddedildi\" <?= ($this->input->get('aktivasyon_durum') == 'Reddedildi') ? 'selected' : '' ?>>Reddedildi</option>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-2\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"hizmet_onay_durumu\">Hizmet Onay Durumu</label>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<select class=\"form-control\" id=\"hizmet_onay_durumu\" name=\"hizmet_onay_durumu\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"\">Tümü</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"onaylanan\" <?= ($this->input->get('hizmet_onay_durumu') == 'onaylanan') ? 'selected' : '' ?>>Onaylananlar</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"onaylanmayan\" <?= ($this->input->get('hizmet_onay_durumu') == 'onaylanmayan') ? 'selected' : '' ?>>Onaylanmayanlar</option>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</select>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-2\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label>&nbsp;</label>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"d-flex\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"btn btn-primary mr-2\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-search\"></i> Ara\r\n"
                },
                {
                    "date": 1759913463214,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -629,8 +629,20 @@\n \t\t\t\t\t\t\t\t\t</h4>\r\n \t\t\t\t\t\t\t\t\t<p class=\"text-muted mb-0\">\r\n \t\t\t\t\t\t\t\t\t\t<small>Cari, Satış Sözleşmesi, Tahsilat ve Aktivasyon bilgileri</small>\r\n \t\t\t\t\t\t\t\t\t</p>\r\n+\t\t\t\t\t\t\t\t\t<?php if (isset($debug_filtreleme)): ?>\r\n+\t\t\t\t\t\t\t\t\t\t<div class=\"alert alert-info mt-2 p-2\">\r\n+\t\t\t\t\t\t\t\t\t\t\t<small>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<strong>Debug Filtreleme:</strong>\r\n+\t\t\t\t\t\t\t\t\t\t\t\tToplam: <?= $debug_filtreleme['toplam_kayit'] ?> |\r\n+\t\t\t\t\t\t\t\t\t\t\t\tOnaylanan: <?= $debug_filtreleme['onaylanan_sayisi'] ?> |\r\n+\t\t\t\t\t\t\t\t\t\t\t\tOnaylanmayan: <?= $debug_filtreleme['onaylanmayan_sayisi'] ?> |\r\n+\t\t\t\t\t\t\t\t\t\t\t\tGörünen: <?= $debug_filtreleme['filtrelenmis_sayisi'] ?> |\r\n+\t\t\t\t\t\t\t\t\t\t\t\tFiltre: <?= $debug_filtreleme['filtre_tipi'] ?>\r\n+\t\t\t\t\t\t\t\t\t\t\t</small>\r\n+\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t<div class=\"col-auto\">\r\n \t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"location.reload()\">\r\n \t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-refresh\"></i> Yenile\r\n"
                },
                {
                    "date": 1759913731463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -629,20 +629,8 @@\n \t\t\t\t\t\t\t\t\t</h4>\r\n \t\t\t\t\t\t\t\t\t<p class=\"text-muted mb-0\">\r\n \t\t\t\t\t\t\t\t\t\t<small>Cari, Satış Sözleşmesi, Tahsilat ve Aktivasyon bilgileri</small>\r\n \t\t\t\t\t\t\t\t\t</p>\r\n-\t\t\t\t\t\t\t\t\t<?php if (isset($debug_filtreleme)): ?>\r\n-\t\t\t\t\t\t\t\t\t\t<div class=\"alert alert-info mt-2 p-2\">\r\n-\t\t\t\t\t\t\t\t\t\t\t<small>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t<strong>Debug Filtreleme:</strong>\r\n-\t\t\t\t\t\t\t\t\t\t\t\tToplam: <?= $debug_filtreleme['toplam_kayit'] ?> |\r\n-\t\t\t\t\t\t\t\t\t\t\t\tOnaylanan: <?= $debug_filtreleme['onaylanan_sayisi'] ?> |\r\n-\t\t\t\t\t\t\t\t\t\t\t\tOnaylanmayan: <?= $debug_filtreleme['onaylanmayan_sayisi'] ?> |\r\n-\t\t\t\t\t\t\t\t\t\t\t\tGörünen: <?= $debug_filtreleme['filtrelenmis_sayisi'] ?> |\r\n-\t\t\t\t\t\t\t\t\t\t\t\tFiltre: <?= $debug_filtreleme['filtre_tipi'] ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t</small>\r\n-\t\t\t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n \t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t<div class=\"col-auto\">\r\n \t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"location.reload()\">\r\n \t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-refresh\"></i> Yenile\r\n"
                },
                {
                    "date": 1760448245542,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -445,8 +445,60 @@\n \t\t\tpadding: 0.25rem 0.5rem;\r\n \t\t\tfont-size: 0.8rem;\r\n \t\t}\r\n \t\t\r\n+\t\t/* Hizmet Adı ve Tahsilat Türü sütunlarının genişliklerini eşitle ve tüm sütunları hizala */\r\n+\t\t#stokBilgisiModal #stokTable th:nth-child(1),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable th:nth-child(1) {\r\n+\t\t\twidth: 5% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable th:nth-child(2),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable th:nth-child(2) {\r\n+\t\t\twidth: 60% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable th:nth-child(4),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable th:nth-child(3) {\r\n+\t\t\twidth: 15% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable th:nth-child(6),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable th:nth-child(4) {\r\n+\t\t\twidth: 15% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable th:nth-child(7),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable th:nth-child(5) {\r\n+\t\t\twidth: 5% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t/* TD'ler için de aynı kurallar */\r\n+\t\t#stokBilgisiModal #stokTable td:nth-child(1),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable td:nth-child(1) {\r\n+\t\t\twidth: 5% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable td:nth-child(2),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable td:nth-child(2) {\r\n+\t\t\twidth: 60% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable td:nth-child(4),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable td:nth-child(3) {\r\n+\t\t\twidth: 15% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable td:nth-child(6),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable td:nth-child(4) {\r\n+\t\t\twidth: 15% !important;\r\n+\t\t}\r\n+\t\t\r\n+\t\t#stokBilgisiModal #stokTable td:nth-child(7),\r\n+\t\t#stokBilgisiModal #tahsilatDetayTable td:nth-child(5) {\r\n+\t\t\twidth: 5% !important;\r\n+\t\t}\r\n+\t\t\r\n \t\t/* Satış Sözleşmesi Modal Styles */\r\n \t\t#satisSozlesmeModal .modal-body {\r\n \t\t\tmax-height: 70vh;\r\n \t\t\toverflow-y: auto;\r\n@@ -2464,13 +2516,13 @@\n \t\t\t\t\t\t<table class=\"table table-bordered table-hover mb-0\" id=\"stokTable\">\r\n \t\t\t\t\t\t\t<thead class=\"thead-light\">\r\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">ID</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"65%\">Hizmet Adı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"60%\">Hizmet Adı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">Miktar</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"10%\">Kullanıcı Sayısı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\">Kullanıcı Sayısı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n@@ -2511,10 +2563,10 @@\n \t\t\t\t\t\t\t\t<tr>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">ID</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"60%\">Tahsilat Türü / Detay</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\" class=\"text-center\">Toplam</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"10%\" class=\"text-center\">—</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"10%\" class=\"text-center\">Onay</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\" class=\"text-center\">—</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"5%\" class=\"text-center\">Onay</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"tahsilatDetayTableBody\">\r\n \t\t\t\t`;\r\n"
                },
                {
                    "date": 1760449971972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2478,9 +2478,9 @@\n // Stok Bilgisi modal fonksiyonu\r\n window.openStokBilgisiModal = function(satisId, cariId, cariIsletme) {\r\n \tconsole.log('openStokBilgisiModal called with:', { satisId, cariId, cariIsletme });\r\n \t\r\n-\t$('#stokBilgisiModalLabel').html('<i class=\"fa fa-boxes mr-2\"></i>Hizmet Bilgileri - ' + cariIsletme);\r\n+\t$('#stokBilgisiModalLabel').html('<i class=\"fa fa-boxes mr-2\"></i>Hizmet Bilgileri - ' + cariIsletme + ' <small class=\"text-muted\">(Cari ID: ' + cariId + ')</small>');\r\n \t\r\n \t// Modal'da satis_id ve cari_id'yi sakla\r\n \t$('#stokBilgisiModal').data('satisId', satisId);\r\n \t$('#stokBilgisiModal').data('cariId', cariId);\r\n@@ -2520,9 +2520,9 @@\n \t\t\t\t\t\t\t\t\t<th width=\"60%\">Hizmet Adı</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">Miktar</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"15%\">Birim Fiyat (KDV Dahil)</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"10%\" style=\"display: none;\">KDV (%)</th>\r\n-\t\t\t\t\t\t\t\t\t<th width=\"15%\">Kullanıcı Sayısı</th>\r\n+\t\t\t\t\t\t\t\t\t<th width=\"15%\">Abonelik Bitiş Tarihi</th>\r\n \t\t\t\t\t\t\t\t\t<th width=\"5%\">İşlem</th>\r\n \t\t\t\t\t\t\t\t</tr>\r\n \t\t\t\t\t\t\t</thead>\r\n \t\t\t\t\t\t\t<tbody id=\"stokTableBody\">\r\n@@ -2788,11 +2788,11 @@\n \t\t\t\t\t<option value=\"20\" ${(data.satisStok_kdv || 0) == 20 ? 'selected' : ''}>%20</option>\r\n \t\t\t\t</select>\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n-\t\t\t\t<input type=\"number\" class=\"form-control kullaniciSayisi\" name=\"kullaniciSayisi[]\" \r\n-\t\t\t\t\t   value=\"${data.satisStok_kullanici_sayisi || ''}\" min=\"0\" \r\n-\t\t\t\t\t   placeholder=\"Kullanıcı sayısı\">\r\n+\t\t\t\t<input type=\"date\" class=\"form-control abonelikBitisTarihi\" name=\"abonelikBitisTarihi[]\" \r\n+\t\t\t\t\t   value=\"${data.satisStok_abonelikBitisTarihi || ''}\" \r\n+\t\t\t\t\t   placeholder=\"Abonelik Bitiş Tarihi\">\r\n \t\t\t</td>\r\n \t\t\t<td>\r\n \t\t\t\t<button type=\"button\" class=\"btn btn-danger btn-sm\" onclick=\"stokSatiriSil(this)\" \r\n \t\t\t\t\t\ttitle=\"Satırı sil\">\r\n@@ -3160,9 +3160,9 @@\n \t\tconst stokIdEl = row.querySelector('.stokId');\r\n \t\tconst miktarEl = row.querySelector('.miktar');\r\n \t\tconst birimFiyatEl = row.querySelector('.birimFiyat');\r\n \t\tconst kdvOraniEl = row.querySelector('.kdvOrani');\r\n-\t\tconst kullaniciSayisiEl = row.querySelector('.kullaniciSayisi');\r\n+\t\tconst abonelikBitisTarihiEl = row.querySelector('.abonelikBitisTarihi');\r\n \t\t\r\n \t\tif (!satisStokIdEl || !stokIdEl || !miktarEl || !birimFiyatEl || !kdvOraniEl || !kullaniciSayisiEl) {\r\n \t\t\tconsole.warn('Bazı form elementleri bulunamadı:', {\r\n \t\t\t\tsatisStokId: !!satisStokIdEl,\r\n@@ -3223,9 +3223,9 @@\n \t\t\tstok_adi: selectedOption ? selectedOption.text.split(' (')[0] : '', // Sadece stok adını al, kodu çıkar\r\n \t\t\tmiktar: parseTurkishNumber(miktarEl.value),\r\n \t\t\tbirim_fiyat: parseTurkishNumber(birimFiyatEl.value),\r\n \t\t\tkdv_orani: kdvOraniEl.value,\r\n-\t\t\tkullanici_sayisi: kullaniciSayisiEl.value\r\n+\t\t\tabonelik_bitis_tarihi: abonelikBitisTarihiEl.value\r\n \t\t};\r\n \t\t\r\n \t\tconsole.log('Stok data prepared:', {\r\n \t\t\toriginal_birim_fiyat: birimFiyatEl.value,\r\n"
                },
                {
                    "date": 1760450260468,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2504,8 +2504,41 @@\n \t\t\t$('#stokBilgisiContent').show();\r\n \t\t\t\r\n \t\t\tif (response && response.success) {\r\n \t\t\t\tlet html = `\r\n+\t\t\t\t\t<!-- Sözleşme Bilgileri -->\r\n+\t\t\t\t\t<div class=\"card mb-3\">\r\n+\t\t\t\t\t\t<div class=\"card-header bg-light\">\r\n+\t\t\t\t\t\t\t<h6 class=\"mb-0\"><i class=\"fa fa-file-contract mr-2\"></i>Sözleşme Bilgileri</h6>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t<div class=\"card-body\">\r\n+\t\t\t\t\t\t\t<div class=\"row\">\r\n+\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t<label>Sözleşme Tarihi <span class=\"text-danger\">*</span></label>\r\n+\t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"form-control\" id=\"sozlesmeTarihi\" \r\n+\t\t\t\t\t\t\t\t\t\t\t   value=\"${response.satis_info?.satis_faturaTarihi || ''}\" required>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t<label>Sözleşme No</label>\r\n+\t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"sozlesmeNo\" \r\n+\t\t\t\t\t\t\t\t\t\t\t   value=\"${response.satis_info?.satis_faturaNo || ''}\" \r\n+\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"Sözleşme numarası\">\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t<label>Açıklama</label>\r\n+\t\t\t\t\t\t\t\t\t\t<textarea class=\"form-control\" id=\"sozlesmeAciklama\" rows=\"1\" \r\n+\t\t\t\t\t\t\t\t\t\t\t\t  placeholder=\"Sözleşme açıklaması\">${response.satis_info?.satis_aciklama || ''}</textarea>\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t\t\r\n \t\t\t\t\t<div class=\"row mb-3\">\r\n \t\t\t\t\t\t<div class=\"col-md-12\">\r\n \t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"stokSatiriEkle()\">\r\n \t\t\t\t\t\t\t\t<i class=\"fa fa-plus mr-1\"></i>Yeni Satır Ekle\r\n@@ -3242,16 +3275,31 @@\n \t\talert('En az bir stok seçip, miktar ve birim fiyat girmeniz gereklidir.');\r\n \t\treturn;\r\n \t}\r\n \t\r\n+\t// Sözleşme bilgilerini al\r\n+\tconst sozlesmeTarihi = document.getElementById('sozlesmeTarihi').value;\r\n+\tconst sozlesmeNo = document.getElementById('sozlesmeNo').value;\r\n+\tconst sozlesmeAciklama = document.getElementById('sozlesmeAciklama').value;\r\n+\t\r\n+\t// Sözleşme tarihi zorunlu\r\n+\tif (!sozlesmeTarihi) {\r\n+\t\talert('Sözleşme tarihi zorunludur.');\r\n+\t\tdocument.getElementById('sozlesmeTarihi').focus();\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n \t// AJAX ile kaydet\r\n \t$.ajax({\r\n \t\turl: '<?= base_url(\"stok_kaydet_endpoint.php\") ?>',\r\n \t\tmethod: 'POST',\r\n \t\tdata: {\r\n \t\t\tsatis_id: satisId,\r\n \t\t\tcari_id: cariId,\r\n-\t\t\tstok_bilgileri: formData\r\n+\t\t\tstok_bilgileri: formData,\r\n+\t\t\tsozlesme_tarihi: sozlesmeTarihi,\r\n+\t\t\tsozlesme_no: sozlesmeNo,\r\n+\t\t\tsozlesme_aciklama: sozlesmeAciklama\r\n \t\t},\r\n \t\tdataType: 'json',\r\n \t\tbeforeSend: function() {\r\n \t\t\t$('#stokBilgisiKaydetBtn').prop('disabled', true).html('<i class=\"fa fa-spinner fa-spin mr-1\"></i>Kaydediliyor...');\r\n"
                },
                {
                    "date": 1760450274797,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1346,11 +1346,8 @@\n \t\t\t\t\t\t\t\t<label>Müşteri Adı</label>\r\n \t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"modalCariAdi\" readonly>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t<div class=\"col-md-6\">\r\n-\t\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">Sözleşme Bilgileri</h6>\r\n-\t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t<label>Sözleşme No <span class=\"text-danger\">*</span></label>\r\n \t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"satis_faturaNo\" required>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n"
                },
                {
                    "date": 1760450311508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1346,8 +1346,11 @@\n \t\t\t\t\t\t\t\t<label>Müşteri Adı</label>\r\n \t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"modalCariAdi\" readonly>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t<div class=\"col-md-6\">\r\n+\t\t\t\t\t\t\t<h6 class=\"border-bottom pb-2 mb-3\">Sözleşme Bilgileri</h6>\r\n+\t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t<label>Sözleşme No <span class=\"text-danger\">*</span></label>\r\n \t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"satis_faturaNo\" required>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n@@ -2504,9 +2507,9 @@\n \t\t\t\tlet html = `\r\n \t\t\t\t\t<!-- Sözleşme Bilgileri -->\r\n \t\t\t\t\t<div class=\"card mb-3\">\r\n \t\t\t\t\t\t<div class=\"card-header bg-light\">\r\n-\t\t\t\t\t\t\t<h6 class=\"mb-0\"><i class=\"fa fa-file-contract mr-2\"></i>Sözleşme Bilgileri</h6>\r\n+\t\t\t\t\t\t\t<h6 class=\"mb-0\"><i class=\"fa fa-file-contract mr-2\"></i>Sözleşme Bilgilerii</h6>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t<div class=\"card-body\">\r\n \t\t\t\t\t\t\t<div class=\"row\">\r\n \t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n"
                },
                {
                    "date": 1760450321953,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2505,12 +2505,8 @@\n \t\t\t\r\n \t\t\tif (response && response.success) {\r\n \t\t\t\tlet html = `\r\n \t\t\t\t\t<!-- Sözleşme Bilgileri -->\r\n-\t\t\t\t\t<div class=\"card mb-3\">\r\n-\t\t\t\t\t\t<div class=\"card-header bg-light\">\r\n-\t\t\t\t\t\t\t<h6 class=\"mb-0\"><i class=\"fa fa-file-contract mr-2\"></i>Sözleşme Bilgilerii</h6>\r\n-\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t<div class=\"card-body\">\r\n \t\t\t\t\t\t\t<div class=\"row\">\r\n \t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n \t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n"
                },
                {
                    "date": 1760450555917,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3191,16 +3191,16 @@\n \t\tconst birimFiyatEl = row.querySelector('.birimFiyat');\r\n \t\tconst kdvOraniEl = row.querySelector('.kdvOrani');\r\n \t\tconst abonelikBitisTarihiEl = row.querySelector('.abonelikBitisTarihi');\r\n \t\t\r\n-\t\tif (!satisStokIdEl || !stokIdEl || !miktarEl || !birimFiyatEl || !kdvOraniEl || !kullaniciSayisiEl) {\r\n+\t\tif (!satisStokIdEl || !stokIdEl || !miktarEl || !birimFiyatEl || !kdvOraniEl || !abonelikBitisTarihiEl) {\r\n \t\t\tconsole.warn('Bazı form elementleri bulunamadı:', {\r\n \t\t\t\tsatisStokId: !!satisStokIdEl,\r\n \t\t\t\tstokId: !!stokIdEl,\r\n \t\t\t\tmiktar: !!miktarEl,\r\n \t\t\t\tbirimFiyat: !!birimFiyatEl,\r\n \t\t\t\tkdvOrani: !!kdvOraniEl,\r\n-\t\t\t\tkullaniciSayisi: !!kullaniciSayisiEl\r\n+\t\t\t\tabonelikBitisTarihi: !!abonelikBitisTarihiEl\r\n \t\t\t});\r\n \t\t\treturn;\r\n \t\t}\r\n \t\t\r\n"
                },
                {
                    "date": 1760450969349,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2507,30 +2507,44 @@\n \t\t\t\tlet html = `\r\n \t\t\t\t\t<!-- Sözleşme Bilgileri -->\r\n \t\t\t\t\t\t<div class=\"card-body\">\r\n \t\t\t\t\t\t\t<div class=\"row\">\r\n-\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n \t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t\t\t<label>Sözleşme Tarihi <span class=\"text-danger\">*</span></label>\r\n \t\t\t\t\t\t\t\t\t\t<input type=\"date\" class=\"form-control\" id=\"sozlesmeTarihi\" \r\n \t\t\t\t\t\t\t\t\t\t\t   value=\"${response.satis_info?.satis_faturaTarihi || ''}\" required>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n \t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t\t\t<label>Sözleşme No</label>\r\n \t\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"sozlesmeNo\" \r\n \t\t\t\t\t\t\t\t\t\t\t   value=\"${response.satis_info?.satis_faturaNo || ''}\" \r\n \t\t\t\t\t\t\t\t\t\t\t   placeholder=\"Sözleşme numarası\">\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t</div>\r\n-\t\t\t\t\t\t\t\t<div class=\"col-md-4\">\r\n+\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n \t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n \t\t\t\t\t\t\t\t\t\t<label>Açıklama</label>\r\n \t\t\t\t\t\t\t\t\t\t<textarea class=\"form-control\" id=\"sozlesmeAciklama\" rows=\"1\" \r\n \t\t\t\t\t\t\t\t\t\t\t\t  placeholder=\"Sözleşme açıklaması\">${response.satis_info?.satis_aciklama || ''}</textarea>\r\n \t\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t<div class=\"col-md-3\">\r\n+\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t\t\t\t\t\t\t<label>Satış Sözleşmesi Görsel</label>\r\n+\t\t\t\t\t\t\t\t\t\t<div class=\"d-flex gap-2\">\r\n+\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-primary\" onclick=\"satirGorselYukle(${satisId})\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-upload\"></i> Yükle\r\n+\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-sm btn-info\" onclick=\"satirGorselleriGoruntule('${response.satis_info?.satis_dosya || ''}')\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-eye\"></i> Görüntüle\r\n+\t\t\t\t\t\t\t\t\t\t\t</button>\r\n+\t\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" id=\"satisDosya\" value=\"${response.satis_info?.satis_dosya || ''}\">\r\n+\t\t\t\t\t\t\t\t\t</div>\r\n+\t\t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t\t</div>\r\n \t\t\t\t\t\t</div>\r\n \t\t\t\t\t</div>\r\n \t\t\t\t\t\r\n@@ -4424,8 +4438,170 @@\n };\r\n \r\n });\r\n \r\n+// Satış Sözleşmesi Görsel Yükleme Fonksiyonu\r\n+window.satirGorselYukle = function(satisId) {\r\n+\tif (!satisId) {\r\n+\t\tSwal.fire('Hata!', 'Satış ID bulunamadı.', 'error');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Satış Sözleşmesi Görsel Yükle',\r\n+\t\thtml: `\r\n+\t\t\t<div class=\"form-group\">\r\n+\t\t\t\t<label>Görsel/Dosya Seçin:</label>\r\n+\t\t\t\t<div class=\"custom-file\">\r\n+\t\t\t\t\t<input type=\"file\" class=\"custom-file-input\" id=\"satirGorselFile\" multiple accept=\"image/*,.pdf\">\r\n+\t\t\t\t\t<label class=\"custom-file-label\">Dosya(lar) seçin...</label>\r\n+\t\t\t\t</div>\r\n+\t\t\t\t<small class=\"text-muted\">JPG, PNG veya PDF formatında dosyalar yükleyebilirsiniz.</small>\r\n+\t\t\t</div>\r\n+\t\t\t<div id=\"satirSelectedFiles\" style=\"display: none;\">\r\n+\t\t\t\t<h6>Seçilen Dosyalar:</h6>\r\n+\t\t\t\t<ul id=\"satirFileList\" class=\"list-unstyled\"></ul>\r\n+\t\t\t</div>\r\n+\t\t`,\r\n+\t\tshowCancelButton: true,\r\n+\t\tconfirmButtonText: 'Yükle',\r\n+\t\tcancelButtonText: 'İptal',\r\n+\t\tpreConfirm: () => {\r\n+\t\t\tconst files = document.getElementById('satirGorselFile').files;\r\n+\t\t\tif (files.length === 0) {\r\n+\t\t\t\tSwal.showValidationMessage('Lütfen en az bir dosya seçin');\r\n+\t\t\t\treturn false;\r\n+\t\t\t}\r\n+\t\t\treturn files;\r\n+\t\t}\r\n+\t}).then((result) => {\r\n+\t\tif (result.isConfirmed) {\r\n+\t\t\tconst files = result.value;\r\n+\t\t\tconst formData = new FormData();\r\n+\t\t\t\r\n+\t\t\tformData.append('satis_id', satisId);\r\n+\t\t\t\r\n+\t\t\tfor (let i = 0; i < files.length; i++) {\r\n+\t\t\t\tformData.append('satis_gorseller[]', files[i]);\r\n+\t\t\t}\r\n+\t\t\t\r\n+\t\t\t$.ajax({\r\n+\t\t\t\turl: '<?= base_url(\"satis_gorsel_yukle_endpoint.php\") ?>',\r\n+\t\t\t\tmethod: 'POST',\r\n+\t\t\t\tdata: formData,\r\n+\t\t\t\tprocessData: false,\r\n+\t\t\t\tcontentType: false,\r\n+\t\t\t\tbeforeSend: function() {\r\n+\t\t\t\t\tSwal.fire({\r\n+\t\t\t\t\t\ttitle: 'Yükleniyor...',\r\n+\t\t\t\t\t\thtml: 'Dosyalar yükleniyor, lütfen bekleyin...',\r\n+\t\t\t\t\t\tallowOutsideClick: false,\r\n+\t\t\t\t\t\tdidOpen: () => {\r\n+\t\t\t\t\t\t\tSwal.showLoading();\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t});\r\n+\t\t\t\t},\r\n+\t\t\t\tsuccess: function(response) {\r\n+\t\t\t\t\tif (response.success) {\r\n+\t\t\t\t\t\tSwal.fire('Başarılı!', 'Görseller başarıyla yüklendi.', 'success');\r\n+\t\t\t\t\t\t$('#satisDosya').val(response.satis_dosya);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tSwal.fire('Hata!', response.message || 'Görsel yüklenirken hata oluştu.', 'error');\r\n+\t\t\t\t\t}\r\n+\t\t\t\t},\r\n+\t\t\t\terror: function() {\r\n+\t\t\t\t\tSwal.fire('Hata!', 'Görsel yüklenirken beklenmeyen bir hata oluştu.', 'error');\r\n+\t\t\t\t}\r\n+\t\t\t});\r\n+\t\t}\r\n+\t});\r\n+\t\r\n+\t$(document).off('change', '#satirGorselFile').on('change', '#satirGorselFile', function() {\r\n+\t\tconst files = this.files;\r\n+\t\tconst label = $(this).next('.custom-file-label');\r\n+\t\tconst selectedFiles = $('#satirSelectedFiles');\r\n+\t\tconst fileList = $('#satirFileList');\r\n+\t\t\r\n+\t\tif (files.length === 0) {\r\n+\t\t\tselectedFiles.hide();\r\n+\t\t\tlabel.text('Dosya(lar) seçin...');\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tif (files.length === 1) {\r\n+\t\t\tlabel.text(files[0].name);\r\n+\t\t} else {\r\n+\t\t\tlabel.text(files.length + ' dosya seçildi');\r\n+\t\t}\r\n+\t\t\r\n+\t\tfileList.empty();\r\n+\t\tfor (let i = 0; i < files.length; i++) {\r\n+\t\t\tconst file = files[i];\r\n+\t\t\tconst fileSize = (file.size / 1024 / 1024).toFixed(2);\r\n+\t\t\tconst fileType = file.type.startsWith('image/') ? 'Resim' : (file.type === 'application/pdf' ? 'PDF' : 'Dosya');\r\n+\t\t\t\r\n+\t\t\tfileList.append(`\r\n+\t\t\t\t<li class=\"border rounded p-2 mb-1 bg-light\">\r\n+\t\t\t\t\t<i class=\"fa fa-${file.type.startsWith('image/') ? 'image' : 'file-pdf'} text-${file.type.startsWith('image/') ? 'success' : 'danger'} mr-2\"></i>\r\n+\t\t\t\t\t<strong>${file.name}</strong>\r\n+\t\t\t\t\t<small class=\"text-muted ml-2\">(${fileType}, ${fileSize} MB)</small>\r\n+\t\t\t\t</li>\r\n+\t\t\t`);\r\n+\t\t}\r\n+\t\t\r\n+\t\tselectedFiles.show();\r\n+\t});\r\n+};\r\n+\r\n+// Satış Sözleşmesi Görsellerini Görüntüleme Fonksiyonu\r\n+window.satirGorselleriGoruntule = function(satisDosya) {\r\n+\tif (!satisDosya || satisDosya.trim() === '') {\r\n+\t\tSwal.fire('Bilgi', 'Henüz yüklenmiş görsel bulunmuyor.', 'info');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\tconst dosyalar = satisDosya.split(',').map(d => d.trim()).filter(d => d);\r\n+\t\r\n+\tif (dosyalar.length === 0) {\r\n+\t\tSwal.fire('Bilgi', 'Henüz yüklenmiş görsel bulunmuyor.', 'info');\r\n+\t\treturn;\r\n+\t}\r\n+\t\r\n+\tconst baseUrl = '<?= base_url(\"assets/uploads/\") ?>';\r\n+\t\r\n+\tlet gorsellerHTML = '<div class=\"row\">';\r\n+\tdosyalar.forEach((dosya, index) => {\r\n+\t\tconst dosyaUrl = baseUrl + dosya;\r\n+\t\tconst isPDF = dosya.toLowerCase().endsWith('.pdf');\r\n+\t\t\r\n+\t\tgorsellerHTML += `\r\n+\t\t\t<div class=\"col-md-4 mb-3\">\r\n+\t\t\t\t<div class=\"card\">\r\n+\t\t\t\t\t<div class=\"card-body text-center\">\r\n+\t\t\t\t\t\t${isPDF ? \r\n+\t\t\t\t\t\t\t`<i class=\"fa fa-file-pdf fa-5x text-danger mb-2\"></i>\r\n+\t\t\t\t\t\t\t <p class=\"mb-2\"><small>${dosya.split('/').pop()}</small></p>` :\r\n+\t\t\t\t\t\t\t`<img src=\"${dosyaUrl}\" class=\"img-fluid mb-2\" style=\"max-height: 200px; object-fit: contain;\">`\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t<a href=\"${dosyaUrl}\" target=\"_blank\" class=\"btn btn-sm btn-primary btn-block\">\r\n+\t\t\t\t\t\t\t<i class=\"fa fa-external-link-alt\"></i> Yeni Sekmede Aç\r\n+\t\t\t\t\t\t</a>\r\n+\t\t\t\t\t</div>\r\n+\t\t\t\t</div>\r\n+\t\t\t</div>\r\n+\t\t`;\r\n+\t});\r\n+\tgorsellerHTML += '</div>';\r\n+\t\r\n+\tSwal.fire({\r\n+\t\ttitle: 'Satış Sözleşmesi Görselleri',\r\n+\t\thtml: gorsellerHTML,\r\n+\t\twidth: '80%',\r\n+\t\tshowCloseButton: true,\r\n+\t\tshowConfirmButton: false\r\n+\t});\r\n+};\r\n+\r\n // Tek veri türü silme fonksiyonu\r\n window.tekVeriSil = function(tabloKodu, cariId, tabloAdi) {\r\n \tSwal.fire({\r\n \t\ttitle: 'Veri Silme Onayı',\r\n"
                },
                {
                    "date": 1760451302313,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2019,28 +2019,10 @@\n // Satış Sözleşmesi Modal fonksiyonu\r\n window.openSatisSozlesmeModal = function(cariId, cariIsletme) {\r\n \tconsole.log('openSatisSozlesmeModal called with:', { cariId, cariIsletme });\r\n \t\r\n-\t// Modal başlığını güncelle\r\n-\t$('#satisSozlesmeModalLabel').html('<i class=\"fa fa-file-contract mr-2\"></i>Satış Sözleşmesi Oluştur - ' + cariIsletme);\r\n-\t\r\n-\t// Müşteri bilgilerini doldur\r\n-\t$('#modalCariID').val(cariId);\r\n-\t$('#modalCariAdi').val(cariIsletme);\r\n-\t\r\n-\t// Form'u sıfırla\r\n-\t$('#satisSozlesmeForm')[0].reset();\r\n-\t$('#modalCariID').val(cariId);\r\n-\t$('#modalCariAdi').val(cariIsletme);\r\n-\t$('input[name=\"satis_faturaTarihi\"]').val('<?= date('Y-m-d') ?>');\r\n-\t\r\n-\t// Tablo hesaplamalarını sıfırla\r\n-\tupdateModalTotals();\r\n-\t\r\n-\t// Event'leri başlat\r\n-\tinitializeModalEvents();\r\n-\t\r\n-\t$('#satisSozlesmeModal').modal('show');\r\n+\t// Yeni Hizmet Bilgileri modalını aç (satis_id = 0 yeni kayıt için)\r\n+\topenStokBilgisiModal(0, cariId, cariIsletme);\r\n }\r\n \r\n // Modal tablo hesaplamaları\r\n function updateModalTotals() {\r\n"
                },
                {
                    "date": 1760452015295,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -926,20 +926,18 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_id) && !empty($veri->satis_sozlesme_id)): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"satis-hizmet-container\">\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-link text-decoration-none p-1 border-0\"\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-success\"\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"openStokBilgisiModal(<?= $veri->satis_sozlesme_id ?>, <?= $veri->cari_id ?>, '<?= htmlspecialchars($veri->cari_isletme, ENT_QUOTES) ?>')\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Stok bilgilerini görüntüle ve düzenle (ID: <?= $veri->satis_sozlesme_id ?>)\"\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"cursor: pointer; color: #28a745; background: none;\">\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Stok bilgilerini görüntüle ve düzenle (ID: <?= $veri->satis_sozlesme_id ?>)\">\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->satis_sozlesme_hizmeti) && !empty($veri->satis_sozlesme_hizmeti)): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-box mr-1\"></i>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= htmlspecialchars($veri->satis_sozlesme_hizmeti) ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-boxes mr-1\"></i>\r\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-plus mr-1\"></i>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tStok Bilgileri\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-edit ml-1\" style=\"font-size: 0.8em;\"></i>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (isset($veri->toplam_satis_sayisi) && $veri->toplam_satis_sayisi > 1): ?>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br>\r\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-sm btn-outline-info mt-1\"\r\n"
                }
            ],
            "date": 1755256998985,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"tr\">\r\n<head>\r\n\t<?php $this->load->view(\"include/head-tags\"); ?>\r\n\t<title>Tam Ana Rapor | İlekaSoft CRM</title>\r\n\t<link rel=\"icon\" type=\"image/x-icon\" href=\"<?= base_url('assets/favicon.ico'); ?>\" />\r\n\t<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/css/dataTables.bootstrap4.min.css\"/>\r\n\t\r\n\t<style>\r\n\t\t.rapor-onay-bekliyor {\r\n\t\t\tbackground-color: #fff3cd;\r\n\t\t\tborder-left: 4px solid #ffc107;\r\n\t\t}\r\n\t\t\r\n\t\t.rapor-onaylanan {\r\n\t\t\tbackground-color: #d4edda;\r\n\t\t\tborder-left: 4px solid #28a745;\r\n\t\t}\r\n\t\t\r\n\t\t.rapor-reddedilen {\r\n\t\t\tbackground-color: #f8d7da;\r\n\t\t\tborder-left: 4px solid #dc3545;\r\n\t\t}\r\n\t\t\r\n\t\t.tutar-buyuk {\r\n\t\t\tfont-size: 1.2em;\r\n\t\t\tfont-weight: bold;\r\n\t\t\tcolor: #28a745;\r\n\t\t}\r\n\t\t\r\n\t\t.card-stats {\r\n\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\t\t\tcolor: white;\r\n\t\t}\r\n\t\t\r\n\t\t.card-stats.card-warning {\r\n\t\t\tbackground: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\r\n\t\t}\r\n\t\t\r\n\t\t.card-stats.card-success {\r\n\t\t\tbackground: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);\r\n\t\t}\r\n\t\t\r\n\t\t.card-stats.card-danger {\r\n\t\t\tbackground: linear-gradient(135deg, #fa709a 0%, #fee140 100%);\r\n\t\t}\r\n\t\t\r\n\t\t.card-stats .card-body {\r\n\t\t\tpadding: 1.5rem;\r\n\t\t}\r\n\t\t\r\n\t\t.stats-number {\r\n\t\t\tfont-size: 2rem;\r\n\t\t\tfont-weight: bold;\r\n\t\t\tmargin-bottom: 0.5rem;\r\n\t\t}\r\n\t\t\r\n\t\t.stats-label {\r\n\t\t\tfont-size: 0.9rem;\r\n\t\t\topacity: 0.9;\r\n\t\t}\r\n\t\t\r\n\t\t.gorsel-thumb {\r\n\t\t\twidth: 60px;\r\n\t\t\theight: 60px;\r\n\t\t\tobject-fit: cover;\r\n\t\t\tborder-radius: 4px;\r\n\t\t\tcursor: pointer;\r\n\t\t\tmargin: 2px;\r\n\t\t}\r\n\t\t\r\n\t\t.gorsel-container {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-wrap: wrap;\r\n\t\t\tgap: 5px;\r\n\t\t}\r\n\t\t\r\n\t\t.btn-gorsel {\r\n\t\t\tbackground: none;\r\n\t\t\tborder: none;\r\n\t\t\tpadding: 0;\r\n\t\t}\r\n\t\t\r\n\t\t.btn-gorsel:hover .gorsel-thumb {\r\n\t\t\topacity: 0.8;\r\n\t\t\ttransform: scale(1.05);\r\n\t\t\ttransition: all 0.3s;\r\n\t\t}\r\n\t\t\r\n\t\t.modal-body img {\r\n\t\t\tmax-width: 100%;\r\n\t\t\theight: auto;\r\n\t\t}\r\n\t\t\r\n\t\t.status-badge {\r\n\t\t\tfont-size: 0.85em;\r\n\t\t\tpadding: 5px 10px;\r\n\t\t}\r\n\t\t\r\n\t\t@media (max-width: 768px) {\r\n\t\t\t.table-responsive {\r\n\t\t\t\tfont-size: 0.875rem;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.gorsel-thumb {\r\n\t\t\t\twidth: 40px;\r\n\t\t\t\theight: 40px;\r\n\t\t\t}\r\n\t\t}\r\n\t</style>\r\n</head>\r\n<body>\r\n<div class=\"main-wrapper\">\r\n\t<?php $this->load->view(\"include/header\"); ?>\r\n\t<?php $this->load->view(\"include/sidebar\"); ?>\r\n\t<div class=\"page-wrapper\">\r\n\t\t<div class=\"content container-fluid\">\r\n\t\t\t<!-- Page Header -->\r\n\t\t\t<div class=\"page-header\">\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<div class=\"col-sm-10\">\r\n\t\t\t\t\t\t<h3 class=\"page-title\">Tam Ana Rapor</h3>\r\n\t\t\t\t\t\t<ul class=\"breadcrumb\">\r\n\t\t\t\t\t\t\t<li class=\"breadcrumb-item\"><a href=\"<?= base_url(); ?>\">Anasayfa</a></li>\r\n\t\t\t\t\t\t\t<li class=\"breadcrumb-item\">Muhasebe</li>\r\n\t\t\t\t\t\t\t<li class=\"breadcrumb-item active\">Tam Ana Rapor</li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"d-flex justify-content-end text-align-center col-sm-2\">\r\n\t\t\t\t\t\t<a class=\"btn btn-outline-light\" href=\"javascript:history.back()\">\r\n\t\t\t\t\t\t\t<i class=\"fa fa-history\"></i> <br>Önceki Sayfa\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<!-- /Page Header -->\r\n\r\n\t\t\t<!-- İstatistikler -->\r\n\t\t\t<div class=\"row mb-4\">\r\n\t\t\t\t<div class=\"col-xl-3 col-sm-6 col-12\">\r\n\t\t\t\t\t<div class=\"card card-stats\">\r\n\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t<div class=\"stats-number\">\r\n\t\t\t\t\t\t\t\t<?= isset($toplam_kayit) ? $toplam_kayit : 0 ?>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"stats-label\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-list mr-2\"></i>Toplam Kayıt Sayısı\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-xl-3 col-sm-6 col-12\">\r\n\t\t\t\t\t<div class=\"card card-stats card-warning\">\r\n\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t<div class=\"stats-number\">\r\n\t\t\t\t\t\t\t\t<?= isset($onay_bekleyen_sayisi) ? $onay_bekleyen_sayisi : 0 ?>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"stats-label\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-clock-o mr-2\"></i>Onay Bekleyen\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-xl-3 col-sm-6 col-12\">\r\n\t\t\t\t\t<div class=\"card card-stats card-success\">\r\n\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t<div class=\"stats-number\">\r\n\t\t\t\t\t\t\t\t<?= isset($onaylanan_sayisi) ? $onaylanan_sayisi : 0 ?>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"stats-label\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-check mr-2\"></i>Onaylanan\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-xl-3 col-sm-6 col-12\">\r\n\t\t\t\t\t<div class=\"card card-stats card-danger\">\r\n\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t<div class=\"stats-number\">\r\n\t\t\t\t\t\t\t\t<?= number_format($toplam_satis_tutar ?? 0, 2, ',', '.') ?> ₺\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"stats-label\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-money mr-2\"></i>Toplam Satış\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<!-- Toplam Tutarlar -->\r\n\t\t\t<div class=\"row mb-4\">\r\n\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t<div class=\"card\">\r\n\t\t\t\t\t\t<div class=\"card-body text-center\">\r\n\t\t\t\t\t\t\t<h5 class=\"card-title\">Toplam Satış Tutarı (KDV Dahil)</h5>\r\n\t\t\t\t\t\t\t<h3 class=\"text-primary\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-shopping-cart mr-2\"></i>\r\n\t\t\t\t\t\t\t\t<?= number_format($toplam_satis_tutar ?? 0, 2, ',', '.') ?> ₺\r\n\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t<div class=\"card\">\r\n\t\t\t\t\t\t<div class=\"card-body text-center\">\r\n\t\t\t\t\t\t\t<h5 class=\"card-title\">Toplam Tahsilat Tutarı</h5>\r\n\t\t\t\t\t\t\t<h3 class=\"text-success\">\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-money mr-2\"></i>\r\n\t\t\t\t\t\t\t\t<?= number_format($toplam_tahsilat_tutar ?? 0, 2, ',', '.') ?> ₺\r\n\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<!-- Rapor Listesi -->\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"col-xl-12 col-md-12\">\r\n\t\t\t\t\t<div class=\"card card-table\">\r\n\t\t\t\t\t\t<div class=\"card-header\">\r\n\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t<div class=\"col\">\r\n\t\t\t\t\t\t\t\t\t<h4 class=\"card-title\">\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-chart-line text-primary mr-2\"></i>\r\n\t\t\t\t\t\t\t\t\t\tTam Ana Rapor\r\n\t\t\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t\t\t<p class=\"text-muted mb-0\">\r\n\t\t\t\t\t\t\t\t\t\t<small>Cari, Satış Sözleşmesi, Tahsilat ve Aktivasyon bilgileri</small>\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"col-auto\">\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary btn-sm\" onclick=\"location.reload()\">\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-refresh\"></i> Yenile\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-success btn-sm\" onclick=\"exportToExcel()\">\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-file-excel-o\"></i> Excel\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<?php if (isset($error_message)): ?>\r\n\t\t\t\t\t\t\t<div class=\"alert alert-warning m-3\">\r\n\t\t\t\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-database\" style=\"font-size: 3rem; color: #ffc107;\"></i>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-10\">\r\n\t\t\t\t\t\t\t\t\t\t<h5><i class=\"fa fa-exclamation-triangle mr-2\"></i>Hata Oluştu</h5>\r\n\t\t\t\t\t\t\t\t\t\t<p><?= $error_message ?></p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<?php elseif (!empty($rapor_verileri)): ?>\r\n\t\t\t\t\t\t\t<div class=\"card-body\">\r\n\t\t\t\t\t\t\t\t<div class=\"table-responsive\">\r\n\t\t\t\t\t\t\t\t\t<table class=\"table table-hover table-center mb-0\" id=\"raporTable\">\r\n\t\t\t\t\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Cari Ad</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>İşletme</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Evrak Görselleri</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Tutarı</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Sözleşme Hizmeti</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Satış Tutarı (KDV Dahil)</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Sözleşme Görselleri</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Tutar</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Görselleri</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Tahsilat Durum</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Aktivasyon Tarihi</th>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<th>Personel</th>\r\n\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php foreach ($rapor_verileri as $veri): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n\t\t\t\t\t\t\t\t\t\t\t\t$row_class = '';\r\n\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->tahsilat_durum) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onay Bekliyor': $row_class = 'rapor-onay-bekliyor'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onaylandı': $row_class = 'rapor-onaylanan'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedilen Var': $row_class = 'rapor-reddedilen'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr class=\"<?= $row_class ?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<strong><?= htmlspecialchars($veri->cari_ad . ' ' . $veri->cari_soyad) ?></strong>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->cari_isletme ?? '-') ?></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->evrak_gorselleri)): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$evrak_gorseller = explode('|', $veri->evrak_gorselleri);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach (array_slice($evrak_gorseller, 0, 3) as $index => $gorsel): \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-gorsel\" onclick=\"showImageModal('<?= base_url($gorsel) ?>', 'Evrak Görseli')\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?= base_url($gorsel) ?>\" class=\"gorsel-thumb\" alt=\"Evrak\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (count($evrak_gorseller) > 3): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-info\">+<?= count($evrak_gorseller) - 3 ?></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk\"><?= number_format($veri->satis_sozlesme_tutar, 2, ',', '.') ?> ₺</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->satis_sozlesme_hizmeti ?? '-') ?></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->satis_sozlesme_tutar_kdv_dahil): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk text-primary\"><?= number_format($veri->satis_sozlesme_tutar_kdv_dahil, 2, ',', '.') ?> ₺</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->sozlesme_gorselleri)): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$sozlesme_gorseller = explode('|', $veri->sozlesme_gorselleri);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach (array_slice($sozlesme_gorseller, 0, 3) as $index => $gorsel): \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-gorsel\" onclick=\"showImageModal('<?= base_url($gorsel) ?>', 'Sözleşme Görseli')\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?= base_url($gorsel) ?>\" class=\"gorsel-thumb\" alt=\"Sözleşme\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (count($sozlesme_gorseller) > 3): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-info\">+<?= count($sozlesme_gorseller) - 3 ?></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->tahsilat_tutar): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"tutar-buyuk text-success\"><?= number_format($veri->tahsilat_tutar, 2, ',', '.') ?> ₺</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (!empty($veri->tahsilat_gorselleri)): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"gorsel-container\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$tahsilat_gorseller = explode('|', $veri->tahsilat_gorselleri);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tforeach (array_slice($tahsilat_gorseller, 0, 3) as $index => $gorsel): \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-gorsel\" onclick=\"showImageModal('<?= base_url($gorsel) ?>', 'Tahsilat Görseli')\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"<?= base_url($gorsel) ?>\" class=\"gorsel-thumb\" alt=\"Tahsilat\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if (count($tahsilat_gorseller) > 3): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge badge-info\">+<?= count($tahsilat_gorseller) - 3 ?></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$badge_class = 'badge-secondary';\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tswitch($veri->tahsilat_durum) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onay Bekliyor': $badge_class = 'badge-warning'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Onaylandı': $badge_class = 'badge-success'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Reddedilen Var': $badge_class = 'badge-danger'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Tahsilat Yok': $badge_class = 'badge-secondary'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: $badge_class = 'badge-info'; break;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"badge <?= $badge_class ?> status-badge\"><?= $veri->tahsilat_durum ?></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php if ($veri->aktivasyon_tarihi): ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?= date('d.m.Y', strtotime($veri->aktivasyon_tarihi)) ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted\">-</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td><?= htmlspecialchars($veri->personel ?? '-') ?></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<?php endforeach; ?>\r\n\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<?php else: ?>\r\n\t\t\t\t\t\t\t<div class=\"alert alert-info m-3\">\r\n\t\t\t\t\t\t\t\t<div class=\"text-center\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-info-circle\" style=\"font-size: 3rem; color: #17a2b8;\"></i>\r\n\t\t\t\t\t\t\t\t\t<h5 class=\"mt-3\">Henüz Veri Bulunamadı</h5>\r\n\t\t\t\t\t\t\t\t\t<p>Tam Ana Rapor için henüz uygun veri bulunmuyor.</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<?php endif; ?>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n<!-- Görsel Modal -->\r\n<div class=\"modal fade\" id=\"imageModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"imageModalLabel\" aria-hidden=\"true\">\r\n\t<div class=\"modal-dialog modal-lg\" role=\"document\">\r\n\t\t<div class=\"modal-content\">\r\n\t\t\t<div class=\"modal-header\">\r\n\t\t\t\t<h5 class=\"modal-title\" id=\"imageModalLabel\">Görsel</h5>\r\n\t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n\t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"modal-body text-center\">\r\n\t\t\t\t<img id=\"modalImage\" src=\"\" alt=\"Görsel\" class=\"img-fluid\">\r\n\t\t\t</div>\r\n\t\t\t<div class=\"modal-footer\">\r\n\t\t\t\t<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Kapat</button>\r\n\t\t\t\t<a id=\"downloadLink\" href=\"\" class=\"btn btn-primary\" target=\"_blank\">\r\n\t\t\t\t\t<i class=\"fa fa-download\"></i> İndir\r\n\t\t\t\t</a>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n<script src=\"https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js\"></script>\r\n<script src=\"https://cdn.jsdelivr.net/npm/datatables.net-bs4@1.13.6/js/dataTables.bootstrap4.min.js\"></script>\r\n\r\n<script>\r\n$(document).ready(function() {\r\n\t// DataTable başlat\r\n\t$('#raporTable').DataTable({\r\n\t\t\"language\": {\r\n\t\t\t\"url\": \"https://cdn.datatables.net/plug-ins/1.13.6/i18n/tr.json\"\r\n\t\t},\r\n\t\t\"order\": [[ 0, \"asc\" ]],\r\n\t\t\"pageLength\": 25,\r\n\t\t\"responsive\": true,\r\n\t\t\"scrollX\": true\r\n\t});\r\n});\r\n\r\n// Görsel modal fonksiyonu\r\nfunction showImageModal(imageSrc, title) {\r\n\t$('#imageModalLabel').text(title);\r\n\t$('#modalImage').attr('src', imageSrc);\r\n\t$('#downloadLink').attr('href', imageSrc);\r\n\t$('#imageModal').modal('show');\r\n}\r\n\r\n// Excel export fonksiyonu\r\nfunction exportToExcel() {\r\n\t// Excel export işlemi için AJAX çağrısı veya form submit\r\n\twindow.open('<?= base_url(\"muhasebe/tam-ana-rapor-excel\") ?>', '_blank');\r\n}\r\n\r\n// Tooltip'leri aktifleştir\r\n$(function () {\r\n\t$('[data-toggle=\"tooltip\"]').tooltip()\r\n});\r\n</script>\r\n\r\n</body>\r\n</html>\r\n"
        }
    ]
}