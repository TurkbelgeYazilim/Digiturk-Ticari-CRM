{
    "sourceFile": "setup_aktivasyon_durum.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1755325437377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1755325437377,
            "name": "Commit-0",
            "content": "<?php\r\n// Aktivasyon durum tablosuna örnek veriler ekleyen script\r\n\r\n$servername = \"localhost\";\r\n$username = \"root\";\r\n$password = \"\";\r\n$dbname = \"ilekasoft_crmdb\";\r\n\r\ntry {\r\n    $pdo = new PDO(\"mysql:host=$servername;dbname=$dbname;charset=utf8\", $username, $password);\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n    \r\n    echo \"<h2>Aktivasyon Durum Tablosu Örnek Veri Ekleme</h2>\";\r\n    \r\n    // Önce mevcut durum kayıtlarını kontrol et\r\n    $check = $pdo->query(\"SELECT COUNT(*) as count FROM aktivasyon_durum WHERE durum = 1\")->fetch();\r\n    \r\n    if ($check['count'] == 0) {\r\n        echo \"<p>Aktivasyon durum tablosuna örnek veriler ekleniyor...</p>\";\r\n        \r\n        $durumlar = [\r\n            ['adi' => 'Aktif', 'renk' => '#28a745'],\r\n            ['adi' => 'Beklemede', 'renk' => '#ffc107'], \r\n            ['adi' => 'İptal', 'renk' => '#dc3545'],\r\n            ['adi' => 'Tamamlandı', 'renk' => '#17a2b8'],\r\n            ['adi' => 'İşlemde', 'renk' => '#fd7e14'],\r\n            ['adi' => 'Denemede', 'renk' => '#6f42c1'],\r\n            ['adi' => 'Onay Bekliyor', 'renk' => '#e83e8c']\r\n        ];\r\n        \r\n        foreach ($durumlar as $durum) {\r\n            $stmt = $pdo->prepare(\"INSERT INTO aktivasyon_durum (aktivasyon_durum_adi, aktivasyon_durum_renk, durum) VALUES (?, ?, 1)\");\r\n            $stmt->execute([$durum['adi'], $durum['renk']]);\r\n            echo \"<div style='display: inline-block; margin: 5px; padding: 5px 10px; background-color: \" . $durum['renk'] . \"; color: white; border-radius: 3px;'>\" . $durum['adi'] . \"</div>\";\r\n        }\r\n        \r\n        echo \"<br><br><strong>✅ Örnek aktivasyon durum verileri başarıyla eklendi!</strong>\";\r\n        \r\n    } else {\r\n        echo \"<p>Aktivasyon durum tablosunda zaten \" . $check['count'] . \" aktif kayıt mevcut.</p>\";\r\n        \r\n        // Mevcut durumları göster\r\n        $stmt = $pdo->query(\"SELECT * FROM aktivasyon_durum WHERE durum = 1 ORDER BY aktivasyon_durum_id\");\r\n        echo \"<h3>Mevcut Aktivasyon Durumları:</h3>\";\r\n        while($row = $stmt->fetch()) {\r\n            echo \"<div style='display: inline-block; margin: 5px; padding: 5px 10px; background-color: \" . $row['aktivasyon_durum_renk'] . \"; color: white; border-radius: 3px;'>\";\r\n            echo $row['aktivasyon_durum_adi'] . \" (ID: \" . $row['aktivasyon_durum_id'] . \")\";\r\n            echo \"</div>\";\r\n        }\r\n    }\r\n    \r\n    // Eğer aktivasyon kayıtlarında durum_id yoksa rastgele atama yap\r\n    echo \"<h3>Aktivasyon Kayıtlarına Durum Ataması:</h3>\";\r\n    $aktivasyonlar = $pdo->query(\"SELECT COUNT(*) as count FROM aktivasyon WHERE aktivasyon_durum_id IS NULL OR aktivasyon_durum_id = 0\")->fetch();\r\n    \r\n    if ($aktivasyonlar['count'] > 0) {\r\n        echo \"<p>\" . $aktivasyonlar['count'] . \" aktivasyon kaydında durum bilgisi eksik. Rastgele durum ataması yapılıyor...</p>\";\r\n        \r\n        // Aktif durum ID'lerini al\r\n        $durumIds = $pdo->query(\"SELECT aktivasyon_durum_id FROM aktivasyon_durum WHERE durum = 1\")->fetchAll(PDO::FETCH_COLUMN);\r\n        \r\n        if (count($durumIds) > 0) {\r\n            $stmt = $pdo->prepare(\"UPDATE aktivasyon SET aktivasyon_durum_id = ? WHERE aktivasyon_durum_id IS NULL OR aktivasyon_durum_id = 0\");\r\n            \r\n            $updated = 0;\r\n            $aktivasyonKayitlari = $pdo->query(\"SELECT aktivasyon_id FROM aktivasyon WHERE aktivasyon_durum_id IS NULL OR aktivasyon_durum_id = 0 LIMIT 20\")->fetchAll();\r\n            \r\n            foreach ($aktivasyonKayitlari as $aktivasyon) {\r\n                $randomDurumId = $durumIds[array_rand($durumIds)];\r\n                $updateStmt = $pdo->prepare(\"UPDATE aktivasyon SET aktivasyon_durum_id = ? WHERE aktivasyon_id = ?\");\r\n                $updateStmt->execute([$randomDurumId, $aktivasyon['aktivasyon_id']]);\r\n                $updated++;\r\n            }\r\n            \r\n            echo \"<strong>✅ \" . $updated . \" aktivasyon kaydına rastgele durum ataması yapıldı!</strong>\";\r\n        }\r\n    } else {\r\n        echo \"<p>✅ Tüm aktivasyon kayıtlarında durum bilgisi mevcut.</p>\";\r\n    }\r\n    \r\n    echo \"<br><br><a href='muhasebe/tam_ana_rapor' style='padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px;'>Tam Ana Raporu Görüntüle</a>\";\r\n    \r\n} catch(PDOException $e) {\r\n    echo \"Hata: \" . $e->getMessage();\r\n}\r\n?>\r\n"
        }
    ]
}