{
    "sourceFile": "fix_table_structure.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754746292704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754746292704,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * VoIP İris Rapor Tablosu - Eksik Sütunları Ekleme\r\n */\r\n\r\ntry {\r\n    // Database bağlantısı\r\n    $dsn = \"mysql:host=localhost;dbname=ilekasoft_crmdb;charset=utf8mb4\";\r\n    $pdo = new PDO($dsn, 'ilekasoft_crmuser', 'KaleW356!');\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n\r\n    echo \"<h2>VoIP İris Rapor Tablosu - Eksik Sütun Kontrolü ve Ekleme</h2>\";\r\n\r\n    // Mevcut tablo yapısını kontrol et\r\n    $checkTable = \"DESCRIBE voip_iris_rapor\";\r\n    $stmt = $pdo->query($checkTable);\r\n    $existingColumns = $stmt->fetchAll();\r\n    \r\n    $existingColumnNames = [];\r\n    foreach($existingColumns as $col) {\r\n        $existingColumnNames[] = $col['Field'];\r\n    }\r\n    \r\n    echo \"<h3>Mevcut Sütunlar:</h3>\";\r\n    echo \"<p>\" . implode(', ', $existingColumnNames) . \"</p>\";\r\n\r\n    // Gerekli sütunlar (CSV'den)\r\n    $requiredColumns = [\r\n        'talep_id' => \"varchar(20) DEFAULT NULL\",\r\n        'talep_turu' => \"varchar(100) DEFAULT NULL\", \r\n        'uydu_basvuru_potansiyel_no' => \"varchar(20) DEFAULT NULL\",\r\n        'uydu_basvuru_uye_no' => \"varchar(20) DEFAULT NULL\",\r\n        'dt_musteri_no' => \"varchar(20) DEFAULT NULL\",\r\n        'memo_id' => \"varchar(20) DEFAULT NULL\",\r\n        'memo_kayit_tipi' => \"varchar(20) DEFAULT NULL\",\r\n        'memo_id_tip' => \"varchar(10) DEFAULT NULL\",\r\n        'memo_kodu' => \"varchar(100) DEFAULT NULL\",\r\n        'memo_kapanis_tarihi' => \"datetime DEFAULT NULL\",\r\n        'memo_yonlenen_bayi_kodu' => \"varchar(20) DEFAULT NULL\",\r\n        'memo_yonlenen_bayi_adi' => \"varchar(255) DEFAULT NULL\",\r\n        'memo_yonlenen_bayi_yoneticisi' => \"varchar(255) DEFAULT NULL\",\r\n        'memo_yonlenen_bayi_bolge' => \"varchar(100) DEFAULT NULL\",\r\n        'memo_yonlenen_bayi_teknik_yntc' => \"varchar(255) DEFAULT NULL\",\r\n        'talep_giris_tarihi' => \"datetime DEFAULT NULL\",\r\n        'talebi_giren_bayi_kodu' => \"varchar(20) DEFAULT NULL\",\r\n        'talebi_giren_bayi_adi' => \"varchar(255) DEFAULT NULL\",\r\n        'talebi_giren_personel' => \"varchar(255) DEFAULT NULL\",\r\n        'talebi_giren_personelno' => \"varchar(20) DEFAULT NULL\",\r\n        'talebi_giren_personelkodu' => \"varchar(50) DEFAULT NULL\",\r\n        'talebi_giren_personel_altbayi' => \"varchar(255) DEFAULT NULL\",\r\n        'talep_kaynak' => \"varchar(50) DEFAULT NULL\",\r\n        'satis_durumu' => \"varchar(100) DEFAULT NULL\",\r\n        'internet_surec_durumu' => \"varchar(100) DEFAULT NULL\",\r\n        'aktive_edilen_uyeno' => \"varchar(20) DEFAULT NULL\",\r\n        'aktive_edilen_outletno' => \"varchar(20) DEFAULT NULL\",\r\n        'aktive_edilen_sozlesmeno' => \"varchar(50) DEFAULT NULL\",\r\n        'aktive_edilen_sozlesmekmp' => \"varchar(20) DEFAULT NULL\",\r\n        'aktive_edilen_sozlesmedurum' => \"varchar(50) DEFAULT NULL\",\r\n        'talep_takip_notu' => \"text DEFAULT NULL\",\r\n        'guncel_outlet_durum' => \"varchar(100) DEFAULT NULL\",\r\n        'teyit_durum' => \"varchar(50) DEFAULT NULL\",\r\n        'teyit_arama_durum' => \"varchar(50) DEFAULT NULL\",\r\n        'randevu_tarihi' => \"datetime DEFAULT NULL\",\r\n        'memo_son_durum' => \"varchar(100) DEFAULT NULL\",\r\n        'memo_son_cevap' => \"varchar(255) DEFAULT NULL\",\r\n        'memo_son_aciklama' => \"text DEFAULT NULL\",\r\n        'kayit_tarihi' => \"timestamp DEFAULT current_timestamp()\"\r\n    ];\r\n\r\n    echo \"<h3>Eksik Sütunları Ekleme İşlemi:</h3>\";\r\n    $addedColumns = 0;\r\n    \r\n    foreach($requiredColumns as $columnName => $columnDef) {\r\n        if (!in_array($columnName, $existingColumnNames)) {\r\n            try {\r\n                $alterSQL = \"ALTER TABLE voip_iris_rapor ADD COLUMN `$columnName` $columnDef\";\r\n                $pdo->exec($alterSQL);\r\n                echo \"<p style='color: green;'>✓ Eklendi: $columnName</p>\";\r\n                $addedColumns++;\r\n            } catch (Exception $e) {\r\n                echo \"<p style='color: red;'>❌ Hata ($columnName): \" . $e->getMessage() . \"</p>\";\r\n            }\r\n        } else {\r\n            echo \"<p style='color: blue;'>- Mevcut: $columnName</p>\";\r\n        }\r\n    }\r\n    \r\n    echo \"<h3>Özet:</h3>\";\r\n    echo \"<p><strong>Toplam $addedColumns sütun eklendi.</strong></p>\";\r\n    \r\n    // Güncellenmiş tablo yapısını göster\r\n    echo \"<h3>Güncellenmiş Tablo Yapısı:</h3>\";\r\n    $finalCheck = \"DESCRIBE voip_iris_rapor\";\r\n    $stmt = $pdo->query($finalCheck);\r\n    $finalColumns = $stmt->fetchAll();\r\n    \r\n    echo \"<table border='1' style='border-collapse: collapse; margin: 10px 0;'>\";\r\n    echo \"<tr><th>Sütun</th><th>Tip</th><th>Null</th><th>Key</th><th>Default</th></tr>\";\r\n    foreach($finalColumns as $col) {\r\n        echo \"<tr>\";\r\n        echo \"<td>{$col['Field']}</td>\";\r\n        echo \"<td>{$col['Type']}</td>\";\r\n        echo \"<td>{$col['Null']}</td>\";\r\n        echo \"<td>{$col['Key']}</td>\";\r\n        echo \"<td>{$col['Default']}</td>\";\r\n        echo \"</tr>\";\r\n    }\r\n    echo \"</table>\";\r\n\r\n} catch (PDOException $e) {\r\n    echo \"<p style='color: red;'>Veritabanı hatası: \" . $e->getMessage() . \"</p>\";\r\n}\r\n?>\r\n"
        }
    ]
}