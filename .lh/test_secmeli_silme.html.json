{
    "sourceFile": "test_secmeli_silme.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1758628430260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1758628430260,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"tr\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Seçmeli Silme Test</title>\r\n    <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/sweetalert2@11\"></script>\r\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" rel=\"stylesheet\">\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n</head>\r\n<body>\r\n    <div class=\"container mt-5\">\r\n        <h2>Seçmeli Silme Test</h2>\r\n        <p>Bu sayfa seçmeli silme özelliğini test etmek için oluşturulmuştur.</p>\r\n        \r\n        <div class=\"card\">\r\n            <div class=\"card-header\">\r\n                <h5>Test Cari: TEST TEST (ID: 20436)</h5>\r\n            </div>\r\n            <div class=\"card-body\">\r\n                <h6>Satış Faturaları: 2 adet</h6>\r\n                <div class=\"btn-group mb-3\">\r\n                    <button class=\"btn btn-sm btn-outline-info\" onclick=\"secmeliVeriSil('satis_faturalari', 20436, 'Satış Faturaları', 2)\">\r\n                        <i class=\"fa fa-list-ul\"></i> Seçerek Sil\r\n                    </button>\r\n                    <button class=\"btn btn-sm btn-outline-danger\" onclick=\"tekVeriSil('satis_faturalari', 20436, 'Satış Faturaları')\">\r\n                        <i class=\"fa fa-trash\"></i> Tümünü Sil\r\n                    </button>\r\n                </div>\r\n                \r\n                <h6>Test Butonu - Veri Listesi Getir</h6>\r\n                <button class=\"btn btn-info\" onclick=\"testVeriListesi()\">\r\n                    <i class=\"fa fa-list\"></i> Veri Listesini Test Et\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        // Seçmeli veri silme fonksiyonu\r\n        window.secmeliVeriSil = function(tabloKodu, cariId, tabloAdi, toplamAdet) {\r\n            console.log('Seçmeli veri sil - Cari ID:', cariId, 'Tablo:', tabloKodu);\r\n            \r\n            // Loading göster\r\n            Swal.fire({\r\n                title: 'Yükleniyor...',\r\n                text: `${tabloAdi} verileri getiriliyor...`,\r\n                icon: 'info',\r\n                allowOutsideClick: false,\r\n                allowEscapeKey: false,\r\n                showConfirmButton: false,\r\n                didOpen: () => {\r\n                    Swal.showLoading();\r\n                }\r\n            });\r\n            \r\n            // AJAX ile veri listesini getir\r\n            $.ajax({\r\n                url: 'muhasebe/veri_listesi_getir',\r\n                method: 'POST',\r\n                data: {\r\n                    cari_id: cariId,\r\n                    tablo_kodu: tabloKodu,\r\n                    tablo_adi: tabloAdi\r\n                },\r\n                dataType: 'json',\r\n                success: function(response) {\r\n                    console.log('Veri listesi yanıtı:', response);\r\n                    \r\n                    if (response.status === 'success' && response.data && response.data.length > 0) {\r\n                        // Seçim modalı oluştur\r\n                        let secimHtml = '<div class=\"text-left\">';\r\n                        secimHtml += '<p><strong>Silmek istediğiniz kayıtları seçin:</strong></p>';\r\n                        secimHtml += '<div class=\"mb-3\">';\r\n                        secimHtml += '<button type=\"button\" class=\"btn btn-sm btn-outline-primary\" onclick=\"tumunuSec(true)\">Tümünü Seç</button> ';\r\n                        secimHtml += '<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" onclick=\"tumunuSec(false)\">Tümünü Kaldır</button>';\r\n                        secimHtml += '</div>';\r\n                        secimHtml += '<div style=\"max-height: 400px; overflow-y: auto;\">';\r\n                        secimHtml += '<table class=\"table table-sm table-hover\">';\r\n                        secimHtml += '<thead><tr>';\r\n                        \r\n                        // Tablo başlıklarını oluştur\r\n                        if (response.columns && response.columns.length > 0) {\r\n                            secimHtml += '<th width=\"50\"><input type=\"checkbox\" id=\"selectAll\" onchange=\"tumunuSec(this.checked)\"></th>';\r\n                            response.columns.forEach(function(column) {\r\n                                secimHtml += '<th>' + column + '</th>';\r\n                            });\r\n                        }\r\n                        \r\n                        secimHtml += '</tr></thead><tbody>';\r\n                        \r\n                        // Veri satırlarını oluştur\r\n                        response.data.forEach(function(row, index) {\r\n                            secimHtml += '<tr>';\r\n                            secimHtml += '<td><input type=\"checkbox\" class=\"kayit-checkbox\" value=\"' + row.id + '\" data-index=\"' + index + '\"></td>';\r\n                            \r\n                            // Sütun verilerini göster\r\n                            if (response.columns && response.columns.length > 0) {\r\n                                response.columns.forEach(function(column) {\r\n                                    let value = row[column.toLowerCase()] || row[column] || '-';\r\n                                    // Tarih formatlaması\r\n                                    if (typeof value === 'string' && value.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\r\n                                        value = new Date(value).toLocaleDateString('tr-TR');\r\n                                    }\r\n                                    // Para formatlaması\r\n                                    if (column.toLowerCase().includes('tutar') || column.toLowerCase().includes('fiyat')) {\r\n                                        if (!isNaN(value) && value !== '-') {\r\n                                            value = parseFloat(value).toLocaleString('tr-TR', {minimumFractionDigits: 2}) + ' ₺';\r\n                                        }\r\n                                    }\r\n                                    secimHtml += '<td>' + value + '</td>';\r\n                                });\r\n                            }\r\n                            \r\n                            secimHtml += '</tr>';\r\n                        });\r\n                        \r\n                        secimHtml += '</tbody></table>';\r\n                        secimHtml += '</div>';\r\n                        secimHtml += '<div class=\"mt-3 text-muted\">';\r\n                        secimHtml += '<small>Toplam ' + response.data.length + ' kayıt bulundu. Seçilen kayıtlar silinecektir.</small>';\r\n                        secimHtml += '</div>';\r\n                        secimHtml += '</div>';\r\n                        \r\n                        Swal.fire({\r\n                            title: tabloAdi + ' - Kayıt Seçimi',\r\n                            html: secimHtml,\r\n                            icon: 'question',\r\n                            showCancelButton: true,\r\n                            confirmButtonColor: '#dc3545',\r\n                            cancelButtonColor: '#6c757d',\r\n                            confirmButtonText: '<i class=\"fa fa-trash\"></i> Seçilenleri Sil',\r\n                            cancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n                            customClass: {\r\n                                confirmButton: 'btn btn-danger',\r\n                                cancelButton: 'btn btn-secondary'\r\n                            },\r\n                            buttonsStyling: false,\r\n                            width: '80%',\r\n                            preConfirm: () => {\r\n                                // Seçilen kayıtları al\r\n                                const secilenler = [];\r\n                                $('.kayit-checkbox:checked').each(function() {\r\n                                    secilenler.push($(this).val());\r\n                                });\r\n                                \r\n                                if (secilenler.length === 0) {\r\n                                    Swal.showValidationMessage('Lütfen en az bir kayıt seçin.');\r\n                                    return false;\r\n                                }\r\n                                \r\n                                return secilenler;\r\n                            }\r\n                        }).then((result) => {\r\n                            if (result.isConfirmed && result.value) {\r\n                                // Seçilen kayıtları sil\r\n                                seciliKayitlariSil(tabloKodu, cariId, tabloAdi, result.value);\r\n                            }\r\n                        });\r\n                        \r\n                    } else {\r\n                        Swal.fire({\r\n                            icon: 'info',\r\n                            title: 'Bilgi',\r\n                            text: response.message || 'Bu veri türünde kayıt bulunamadı.'\r\n                        });\r\n                    }\r\n                },\r\n                error: function(xhr, status, error) {\r\n                    console.error('Veri listesi getirme hatası:', {xhr, status, error});\r\n                    console.log('Response Text:', xhr.responseText);\r\n                    Swal.fire({\r\n                        icon: 'error',\r\n                        title: 'Hata',\r\n                        text: 'Veri listesi getirilirken bir hata oluştu: ' + error + '\\n\\nDetaylar: ' + xhr.responseText\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        // Test fonksiyonu\r\n        window.testVeriListesi = function() {\r\n            $.ajax({\r\n                url: 'muhasebe/veri_listesi_getir',\r\n                method: 'POST',\r\n                data: {\r\n                    cari_id: 20436,\r\n                    tablo_kodu: 'satis_faturalari',\r\n                    tablo_adi: 'Satış Faturaları'\r\n                },\r\n                dataType: 'json',\r\n                success: function(response) {\r\n                    console.log('Test Yanıt:', response);\r\n                    alert('Test başarılı! Console\\'u kontrol edin.');\r\n                },\r\n                error: function(xhr, status, error) {\r\n                    console.error('Test hatası:', {xhr, status, error});\r\n                    console.log('Response Text:', xhr.responseText);\r\n                    alert('Test başarısız! Console\\'u kontrol edin.');\r\n                }\r\n            });\r\n        }\r\n\r\n        // Tümünü seç/kaldır fonksiyonu\r\n        window.tumunuSec = function(secilsin) {\r\n            $('.kayit-checkbox').prop('checked', secilsin);\r\n            $('#selectAll').prop('checked', secilsin);\r\n        }\r\n\r\n        // Seçili kayıtları sil\r\n        window.seciliKayitlariSil = function(tabloKodu, cariId, tabloAdi, secilenIdler) {\r\n            console.log('Seçili kayıtları sil - Cari ID:', cariId, 'Tablo:', tabloKodu, 'Seçilen IDler:', secilenIdler);\r\n            \r\n            Swal.fire({\r\n                title: 'Silme Onayı',\r\n                text: `${secilenIdler.length} adet ${tabloAdi} kaydı silinecek. Emin misiniz?`,\r\n                icon: 'warning',\r\n                showCancelButton: true,\r\n                confirmButtonColor: '#dc3545',\r\n                cancelButtonColor: '#6c757d',\r\n                confirmButtonText: '<i class=\"fa fa-trash\"></i> Sil',\r\n                cancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n                customClass: {\r\n                    confirmButton: 'btn btn-danger',\r\n                    cancelButton: 'btn btn-secondary'\r\n                },\r\n                buttonsStyling: false\r\n            }).then((result) => {\r\n                if (result.isConfirmed) {\r\n                    // Loading göster\r\n                    Swal.fire({\r\n                        title: 'Siliniyor...',\r\n                        text: `${secilenIdler.length} kayıt siliniyor...`,\r\n                        icon: 'info',\r\n                        allowOutsideClick: false,\r\n                        allowEscapeKey: false,\r\n                        showConfirmButton: false,\r\n                        didOpen: () => {\r\n                            Swal.showLoading();\r\n                        }\r\n                    });\r\n                    \r\n                    // AJAX ile seçili kayıtları sil\r\n                    $.ajax({\r\n                        url: 'muhasebe/secili_kayitlari_sil',\r\n                        method: 'POST',\r\n                        data: {\r\n                            cari_id: cariId,\r\n                            tablo_kodu: tabloKodu,\r\n                            tablo_adi: tabloAdi,\r\n                            secilen_idler: secilenIdler\r\n                        },\r\n                        dataType: 'json',\r\n                        success: function(response) {\r\n                            console.log('Silme yanıtı:', response);\r\n                            if (response.status === 'success') {\r\n                                Swal.fire({\r\n                                    icon: 'success',\r\n                                    title: 'Başarılı',\r\n                                    text: response.message,\r\n                                    confirmButtonText: 'Tamam'\r\n                                }).then(() => {\r\n                                    // Sayfayı yenile\r\n                                    location.reload();\r\n                                });\r\n                            } else {\r\n                                Swal.fire({\r\n                                    icon: 'error',\r\n                                    title: 'Hata',\r\n                                    text: response.message || 'Silme işlemi başarısız oldu'\r\n                                });\r\n                            }\r\n                        },\r\n                        error: function(xhr, status, error) {\r\n                            console.error('Seçili kayıtları silme hatası:', {xhr, status, error});\r\n                            console.log('Response Text:', xhr.responseText);\r\n                            Swal.fire({\r\n                                icon: 'error',\r\n                                title: 'Hata',\r\n                                text: 'Silme işlemi sırasında bir hata oluştu: ' + error + '\\n\\nDetaylar: ' + xhr.responseText\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        // Tek veri türü silme fonksiyonu\r\n        window.tekVeriSil = function(tabloKodu, cariId, tabloAdi) {\r\n            Swal.fire({\r\n                title: 'Veri Silme Onayı',\r\n                html: `<div class=\"text-left\">\r\n                    <p><strong>Tablo:</strong> ${tabloAdi}</p>\r\n                    <p><strong>Cari ID:</strong> ${cariId}</p>\r\n                    <div class=\"alert alert-warning\">\r\n                        <i class=\"fa fa-exclamation-triangle\"></i>\r\n                        Bu işlem sadece <strong>${tabloAdi}</strong> verilerini silecektir.\r\n                        Diğer veriler etkilenmeyecektir.\r\n                    </div>\r\n                </div>`,\r\n                icon: 'warning',\r\n                showCancelButton: true,\r\n                confirmButtonColor: '#dc3545',\r\n                cancelButtonColor: '#6c757d',\r\n                confirmButtonText: '<i class=\"fa fa-trash\"></i> Sil',\r\n                cancelButtonText: '<i class=\"fa fa-times\"></i> İptal',\r\n                customClass: {\r\n                    confirmButton: 'btn btn-danger',\r\n                    cancelButton: 'btn btn-secondary'\r\n                },\r\n                buttonsStyling: false\r\n            }).then((result) => {\r\n                if (result.isConfirmed) {\r\n                    // Loading göster\r\n                    Swal.fire({\r\n                        title: 'Siliniyor...',\r\n                        text: `${tabloAdi} verileri siliniyor...`,\r\n                        icon: 'info',\r\n                        allowOutsideClick: false,\r\n                        allowEscapeKey: false,\r\n                        showConfirmButton: false,\r\n                        didOpen: () => {\r\n                            Swal.showLoading();\r\n                        }\r\n                    });\r\n                    \r\n                    // AJAX ile silme işlemi\r\n                    $.ajax({\r\n                        url: 'muhasebe/tek_veri_sil',\r\n                        method: 'POST',\r\n                        data: {\r\n                            cari_id: cariId,\r\n                            tablo_kodu: tabloKodu,\r\n                            tablo_adi: tabloAdi\r\n                        },\r\n                        dataType: 'json',\r\n                        success: function(response) {\r\n                            console.log('Tek veri silme yanıtı:', response);\r\n                            if (response.status === 'success') {\r\n                                Swal.fire({\r\n                                    icon: 'success',\r\n                                    title: 'Başarılı',\r\n                                    text: response.message,\r\n                                    confirmButtonText: 'Tamam'\r\n                                }).then(() => {\r\n                                    // Sayfayı yenile\r\n                                    location.reload();\r\n                                });\r\n                            } else {\r\n                                Swal.fire({\r\n                                    icon: 'error',\r\n                                    title: 'Hata',\r\n                                    text: response.message || 'Silme işlemi başarısız oldu'\r\n                                });\r\n                            }\r\n                        },\r\n                        error: function(xhr, status, error) {\r\n                            console.error('Tek veri silme hatası:', {xhr, status, error});\r\n                            console.log('Response Text:', xhr.responseText);\r\n                            Swal.fire({\r\n                                icon: 'error',\r\n                                title: 'Hata',\r\n                                text: 'Silme işlemi sırasında bir hata oluştu: ' + error + '\\n\\nDetaylar: ' + xhr.responseText\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    </script>\r\n</body>\r\n</html>\r\n"
        }
    ]
}