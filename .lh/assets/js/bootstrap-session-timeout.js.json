{
    "sourceFile": "assets/js/bootstrap-session-timeout.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1755877774819,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1755877774819,
            "name": "Commit-0",
            "content": "/*\r\n\r\n * bootstrap-session-timeout\r\n\r\n * www.orangehilldev.com\r\n\r\n *\r\n\r\n * Copyright (c) 2014 Vedran Opacic\r\n\r\n * Licensed under the MIT license.\r\n\r\n */\r\n\r\n\r\n\r\n(function($) {\r\n\r\n    /*jshint multistr: true */\r\n\r\n    'use strict';\r\n\r\n    $.sessionTimeout = function(options) {\r\n\r\n        var defaults = {\r\n\r\n            title: 'Sistemden çıkış yapmak üzeresiniz!',\r\n\r\n            message: 'Hareketsiz kaldığınız için güvenliğiniz için sizin yerinize çıkış yapıyoruz.',\r\n\r\n            logoutButton: 'Güvenli Çıkış',\r\n\r\n            keepAliveButton: 'Devam Et',\r\n\r\n            keepAliveUrl: '/keep-alive',\r\n\r\n            ajaxType: 'POST',\r\n\r\n            ajaxData: '',\r\n\r\n            redirUrl: '/timed-out',\r\n\r\n            logoutUrl: '/log-out',\r\n\r\n            warnAfter: 900000, // 15 minutes\r\n\r\n            redirAfter: 1200000, // 20 minutes\r\n\r\n            keepAliveInterval: 5000,\r\n\r\n            keepAlive: true,\r\n\r\n            ignoreUserActivity: false,\r\n\r\n            onStart: false,\r\n\r\n            onWarn: false,\r\n\r\n            onRedir: false,\r\n\r\n            countdownMessage: false,\r\n\r\n            countdownBar: false,\r\n\r\n            countdownSmart: false\r\n\r\n        };\r\n\r\n\r\n\r\n        var opt = defaults,\r\n\r\n            timer,\r\n\r\n            countdown = {};\r\n\r\n\r\n\r\n        // Extend user-set options over defaults\r\n\r\n        if (options) {\r\n\r\n            opt = $.extend(defaults, options);\r\n\r\n        }\r\n\r\n\r\n\r\n        // Some error handling if options are miss-configured\r\n\r\n        if (opt.warnAfter >= opt.redirAfter) {\r\n\r\n            console.error('Bootstrap-session-timeout plugin is miss-configured. Option \"redirAfter\" must be equal or greater than \"warnAfter\".');\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n\r\n\r\n        // Unless user set his own callback function, prepare bootstrap modal elements and events\r\n\r\n        if (typeof opt.onWarn !== 'function') {\r\n\r\n            // If opt.countdownMessage is defined add a coundown timer message to the modal dialog\r\n\r\n            var countdownMessage = opt.countdownMessage ?\r\n\r\n                '<p>' + opt.countdownMessage.replace(/{timer}/g, '<span class=\"countdown-holder\"></span>') + '</p>' : '';\r\n\r\n            var coundownBarHtml = opt.countdownBar ?\r\n\r\n                '<div class=\"progress\">' +\r\n\r\n                  '<div class=\"progress-bar progress-bar-striped countdown-bar active\" role=\"progressbar\" style=\"min-width: 15px; width: 100%;\">' +\r\n\r\n                    '<span class=\"countdown-holder\"></span>' +\r\n\r\n                  '</div>' +\r\n\r\n                '</div>' : '';\r\n\r\n\r\n\r\n            // Create timeout warning dialog\r\n\r\n            $('body').append('<div class=\"modal fade\" id=\"session-timeout-dialog\">' +\r\n\r\n              '<div class=\"modal-dialog\">' +\r\n\r\n                '<div class=\"modal-content\">' +\r\n\r\n                  '<div class=\"modal-header\">' +\r\n\r\n                     '' +\r\n\r\n                    '<h4 class=\"modal-title\">' + opt.title + '</h4>' +\r\n\r\n                  '</div>' +\r\n\r\n                  '<div class=\"modal-body\">' +\r\n\r\n                    '<p>' + opt.message + '</p>' +\r\n\r\n                    ' ' + countdownMessage + ' ' +\r\n\r\n                    ' ' + coundownBarHtml + ' ' +\r\n\r\n                  '</div>' +\r\n\r\n                  '<div class=\"modal-footer\">' +\r\n\r\n                    '<button id=\"session-timeout-dialog-logout\" type=\"button\" class=\"btn btn-default\">' + opt.logoutButton + '</button>' +\r\n\r\n                    '<button id=\"session-timeout-dialog-keepalive\" type=\"button\" class=\"btn btn-primary\" data-dismiss=\"modal\">' + opt.keepAliveButton + '</button>' +\r\n\r\n                  '</div>' +\r\n\r\n                '</div>' +\r\n\r\n              '</div>' +\r\n\r\n             '</div>');\r\n\r\n\r\n\r\n            // \"Logout\" button click\r\n\r\n            $('#session-timeout-dialog-logout').on('click', function() {\r\n\r\n                window.location = opt.logoutUrl;\r\n\r\n            });\r\n\r\n            // \"Stay Connected\" button click\r\n\r\n            $('#session-timeout-dialog').on('hide.bs.modal', function() {\r\n\r\n                // Restart session timer\r\n\r\n                startSessionTimer();\r\n\r\n            });\r\n\r\n        }\r\n\r\n\r\n\r\n        // Reset timer on any of these events\r\n\r\n        if (!opt.ignoreUserActivity) {\r\n\r\n            var mousePosition = [-1, -1];\r\n\r\n            $(document).on('keyup mouseup mousemove touchend touchmove', function(e) {\r\n\r\n                if (e.type === 'mousemove') {\r\n\r\n                    // Solves mousemove even when mouse not moving issue on Chrome:\r\n\r\n                    // https://code.google.com/p/chromium/issues/detail?id=241476\r\n\r\n                    if (e.clientX === mousePosition[0] && e.clientY === mousePosition[1]) {\r\n\r\n                        return;\r\n\r\n                    }\r\n\r\n                    mousePosition[0] = e.clientX;\r\n\r\n                    mousePosition[1] = e.clientY;\r\n\r\n                }\r\n\r\n                startSessionTimer();\r\n\r\n\r\n\r\n                // If they moved the mouse not only reset the counter\r\n\r\n                // but remove the modal too!\r\n\r\n                if ($('#session-timeout-dialog').length > 0 &&\r\n\r\n                    $('#session-timeout-dialog').data('bs.modal') &&\r\n\r\n                    $('#session-timeout-dialog').data('bs.modal').isShown) {\r\n\r\n                    // http://stackoverflow.com/questions/11519660/twitter-bootstrap-modal-backdrop-doesnt-disappear\r\n\r\n                    $('#session-timeout-dialog').modal('hide');\r\n\r\n                    $('body').removeClass('modal-open');\r\n\r\n                    $('div.modal-backdrop').remove();\r\n\r\n\r\n\r\n                }\r\n\r\n            });\r\n\r\n        }\r\n\r\n\r\n\r\n        // Keeps the server side connection live, by pingin url set in keepAliveUrl option.\r\n\r\n        // KeepAlivePinged is a helper var to ensure the functionality of the keepAliveInterval option\r\n\r\n        var keepAlivePinged = false;\r\n\r\n\r\n\r\n        function keepAlive() {\r\n\r\n            if (!keepAlivePinged) {\r\n\r\n                // Ping keepalive URL using (if provided) data and type from options\r\n\r\n                $.ajax({\r\n\r\n                    type: opt.ajaxType,\r\n\r\n                    url: opt.keepAliveUrl,\r\n\r\n                    data: opt.ajaxData\r\n\r\n                });\r\n\r\n                keepAlivePinged = true;\r\n\r\n                setTimeout(function() {\r\n\r\n                    keepAlivePinged = false;\r\n\r\n                }, opt.keepAliveInterval);\r\n\r\n            }\r\n\r\n        }\r\n\r\n\r\n\r\n        function startSessionTimer() {\r\n\r\n            // Clear session timer\r\n\r\n            clearTimeout(timer);\r\n\r\n            if (opt.countdownMessage || opt.countdownBar) {\r\n\r\n                startCountdownTimer('session', true);\r\n\r\n            }\r\n\r\n\r\n\r\n            if (typeof opt.onStart === 'function') {\r\n\r\n                opt.onStart(opt);\r\n\r\n            }\r\n\r\n\r\n\r\n            // If keepAlive option is set to \"true\", ping the \"keepAliveUrl\" url\r\n\r\n            if (opt.keepAlive) {\r\n\r\n                keepAlive();\r\n\r\n            }\r\n\r\n\r\n\r\n            // Set session timer\r\n\r\n            timer = setTimeout(function() {\r\n\r\n                // Check for onWarn callback function and if there is none, launch dialog\r\n\r\n                if (typeof opt.onWarn !== 'function') {\r\n\r\n                    $('#session-timeout-dialog').modal('show');\r\n\r\n                } else {\r\n\r\n                    opt.onWarn(opt);\r\n\r\n                }\r\n\r\n                // Start dialog timer\r\n\r\n                startDialogTimer();\r\n\r\n            }, opt.warnAfter);\r\n\r\n        }\r\n\r\n\r\n\r\n        function startDialogTimer() {\r\n\r\n            // Clear session timer\r\n\r\n            clearTimeout(timer);\r\n\r\n            if (!$('#session-timeout-dialog').hasClass('in') && (opt.countdownMessage || opt.countdownBar)) {\r\n\r\n                // If warning dialog is not already open and either opt.countdownMessage\r\n\r\n                // or opt.countdownBar are set start countdown\r\n\r\n                startCountdownTimer('dialog', true);\r\n\r\n            }\r\n\r\n            // Set dialog timer\r\n\r\n            timer = setTimeout(function() {\r\n\r\n                // Check for onRedir callback function and if there is none, launch redirect\r\n\r\n                if (typeof opt.onRedir !== 'function') {\r\n\r\n                    window.location = opt.redirUrl;\r\n\r\n                } else {\r\n\r\n                    opt.onRedir(opt);\r\n\r\n                }\r\n\r\n            }, (opt.redirAfter - opt.warnAfter));\r\n\r\n        }\r\n\r\n\r\n\r\n        function startCountdownTimer(type, reset) {\r\n\r\n            // Clear countdown timer\r\n\r\n            clearTimeout(countdown.timer);\r\n\r\n\r\n\r\n            if (type === 'dialog' && reset) {\r\n\r\n                // If triggered by startDialogTimer start warning countdown\r\n\r\n                countdown.timeLeft = Math.floor((opt.redirAfter - opt.warnAfter) / 1000);\r\n\r\n            } else if (type === 'session' && reset) {\r\n\r\n                // If triggered by startSessionTimer start full countdown\r\n\r\n                // (this is needed if user doesn't close the warning dialog)\r\n\r\n                countdown.timeLeft = Math.floor(opt.redirAfter / 1000);\r\n\r\n            }\r\n\r\n            // If opt.countdownBar is true, calculate remaining time percentage\r\n\r\n            if (opt.countdownBar && type === 'dialog') {\r\n\r\n                countdown.percentLeft = Math.floor(countdown.timeLeft / ((opt.redirAfter - opt.warnAfter) / 1000) * 100);\r\n\r\n            } else if (opt.countdownBar && type === 'session') {\r\n\r\n                countdown.percentLeft = Math.floor(countdown.timeLeft / (opt.redirAfter / 1000) * 100);\r\n\r\n            }\r\n\r\n            // Set countdown message time value\r\n\r\n            var countdownEl = $('.countdown-holder');\r\n\r\n            var secondsLeft = countdown.timeLeft >= 0 ? countdown.timeLeft : 0;\r\n\r\n            if (opt.countdownSmart) {\r\n\r\n                var minLeft = Math.floor(secondsLeft / 60);\r\n\r\n                var secRemain = secondsLeft % 60;\r\n\r\n                var countTxt = minLeft > 0 ? minLeft + 'm' : '';\r\n\r\n                if (countTxt.length > 0) {\r\n\r\n                    countTxt += ' ';\r\n\r\n                }\r\n\r\n                countTxt += secRemain + 's';\r\n\r\n                countdownEl.text(countTxt);\r\n\r\n            } else {\r\n\r\n                countdownEl.text(secondsLeft + \"s\");\r\n\r\n            }\r\n\r\n\r\n\r\n            // Set countdown message time value\r\n\r\n            if (opt.countdownBar) {\r\n\r\n                $('.countdown-bar').css('width', countdown.percentLeft + '%');\r\n\r\n            }\r\n\r\n\r\n\r\n            // Countdown by one second\r\n\r\n            countdown.timeLeft = countdown.timeLeft - 1;\r\n\r\n            countdown.timer = setTimeout(function() {\r\n\r\n                // Call self after one second\r\n\r\n                startCountdownTimer(type);\r\n\r\n            }, 1000);\r\n\r\n        }\r\n\r\n\r\n\r\n        // Start session timer\r\n\r\n        startSessionTimer();\r\n\r\n\r\n\r\n    };\r\n\r\n})(jQuery);"
        }
    ]
}