{
    "sourceFile": "test_stok_simple_response.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1757159372562,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1757159372562,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * Basit test endpoint - hiç database bağlantısı olmadan\r\n */\r\n\r\n// CORS headers\r\nheader('Content-Type: application/json; charset=utf-8');\r\nheader('Access-Control-Allow-Origin: *');\r\nheader('Access-Control-Allow-Methods: GET, POST, OPTIONS');\r\nheader('Access-Control-Allow-Headers: Content-Type');\r\n\r\n// OPTIONS request handling\r\nif ($_SERVER['REQUEST_METHOD'] == 'OPTIONS') {\r\n    http_response_code(200);\r\n    exit();\r\n}\r\n\r\n// Debug log\r\nfile_put_contents(__DIR__ . '/debug_test_simple.log', \r\n    date('Y-m-d H:i:s') . \" - Simple test called - GET: \" . print_r($_GET, true) . \" POST: \" . print_r($_POST, true) . \"\\n\", \r\n    FILE_APPEND | LOCK_EX);\r\n\r\n// Arama terimi al\r\n$search_term = isset($_GET['q']) ? trim($_GET['q']) : '';\r\n\r\n// Test stok verileri\r\n$test_stocks = [\r\n    [\r\n        'stok_id' => 1,\r\n        'stok_ad' => 'Test Stok 1',\r\n        'stok_kodu' => 'TST001',\r\n        'stok_satisFiyati' => 100.00,\r\n        'stok_satisKDV' => 20\r\n    ],\r\n    [\r\n        'stok_id' => 2,\r\n        'stok_ad' => 'Test Stok 2',\r\n        'stok_kodu' => 'TST002',\r\n        'stok_satisFiyati' => 200.00,\r\n        'stok_satisKDV' => 18\r\n    ],\r\n    [\r\n        'stok_id' => 3,\r\n        'stok_ad' => 'Sample Product',\r\n        'stok_kodu' => 'SMP001',\r\n        'stok_satisFiyati' => 150.00,\r\n        'stok_satisKDV' => 20\r\n    ]\r\n];\r\n\r\n// Arama varsa filtrele\r\nif (!empty($search_term)) {\r\n    $test_stocks = array_filter($test_stocks, function($stock) use ($search_term) {\r\n        return stripos($stock['stok_ad'], $search_term) !== false || \r\n               stripos($stock['stok_kodu'], $search_term) !== false;\r\n    });\r\n}\r\n\r\n// Select2 formatına uygun sonuçları hazırla\r\n$formatted_results = [];\r\n\r\n// Boş seçenek ekle (sadece arama terimi yoksa)\r\nif (empty($search_term)) {\r\n    $formatted_results[] = [\r\n        'id' => '',\r\n        'text' => 'Stok seçiniz...',\r\n        'stok_data' => null\r\n    ];\r\n}\r\n\r\nforeach ($test_stocks as $row) {\r\n    $display_text = $row['stok_ad'];\r\n    if (!empty($row['stok_kodu'])) {\r\n        $display_text .= \" (Kod: {$row['stok_kodu']})\";\r\n    }\r\n    if (!empty($row['stok_satisFiyati']) && $row['stok_satisFiyati'] > 0) {\r\n        $display_text .= \" - \" . number_format($row['stok_satisFiyati'], 2) . \" ₺\";\r\n    }\r\n    \r\n    $formatted_results[] = [\r\n        'id' => $row['stok_id'],\r\n        'text' => $display_text,\r\n        'stok_data' => [\r\n            'stok_id' => $row['stok_id'],\r\n            'stok_kodu' => $row['stok_kodu'],\r\n            'stok_ad' => $row['stok_ad'],\r\n            'stok_satisFiyati' => floatval($row['stok_satisFiyati']),\r\n            'stok_satisKDV' => floatval($row['stok_satisKDV'])\r\n        ]\r\n    ];\r\n}\r\n\r\n// Hiç sonuç yoksa mesaj göster\r\nif (count($formatted_results) <= 1 && !empty($search_term)) {\r\n    $formatted_results = [\r\n        [\r\n            'id' => '',\r\n            'text' => \"'{$search_term}' için sonuç bulunamadı\",\r\n            'disabled' => true\r\n        ]\r\n    ];\r\n}\r\n\r\n// Log response\r\nfile_put_contents(__DIR__ . '/debug_test_simple.log', \r\n    date('Y-m-d H:i:s') . \" - Response: \" . json_encode($formatted_results) . \"\\n\", \r\n    FILE_APPEND | LOCK_EX);\r\n\r\n// Select2 yanıt formatı\r\necho json_encode([\r\n    'results' => $formatted_results,\r\n    'pagination' => [\r\n        'more' => false\r\n    ]\r\n], JSON_UNESCAPED_UNICODE);\r\n?>\r\n"
        }
    ]
}