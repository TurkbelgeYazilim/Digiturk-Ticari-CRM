{
    "sourceFile": "debug_stok_dropdown.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1756810205233,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1756810205233,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * Simple test to debug stok dropdown issue\r\n */\r\n\r\n// CodeIgniter framework yükle\r\nrequire_once('index.php');\r\n\r\n// Enable error reporting for debugging\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\n\r\necho \"<h1>Stok Dropdown Debug</h1>\";\r\n\r\ntry {\r\n    // Get CodeIgniter instance\r\n    $CI =& get_instance();\r\n    $CI->load->database();\r\n    \r\n    echo \"<p>✓ CodeIgniter loaded successfully</p>\";\r\n    \r\n    // Ana hesap bilgisini al\r\n    $anaHesap = anaHesapBilgisi();\r\n    echo \"<p>Ana Hesap: \" . ($anaHesap ? $anaHesap : 'NULL') . \"</p>\";\r\n    \r\n    if (!$anaHesap) {\r\n        echo \"<p style='color:red'>❌ Ana hesap bulunamadı</p>\";\r\n        exit;\r\n    }\r\n    \r\n    // Test sorgusu - tüm stokları getir\r\n    $query = \"SELECT COUNT(*) as total FROM stok WHERE stok_olusturanAnaHesap = ? AND stok_durum = 1\";\r\n    $result = $CI->db->query($query, [$anaHesap]);\r\n    $total = $result->row()->total;\r\n    \r\n    echo \"<p>Toplam stok sayısı: {$total}</p>\";\r\n    \r\n    if ($total == 0) {\r\n        echo \"<p style='color:orange'>⚠️ Bu ana hesap için aktif stok bulunamadı</p>\";\r\n        \r\n        // Tüm stokları kontrol et\r\n        $query2 = \"SELECT COUNT(*) as total FROM stok\";\r\n        $result2 = $CI->db->query($query2);\r\n        $total2 = $result2->row()->total;\r\n        echo \"<p>Sistemde toplam stok sayısı: {$total2}</p>\";\r\n        \r\n        // Örnek birkaç stok göster\r\n        $query3 = \"SELECT * FROM stok LIMIT 5\";\r\n        $result3 = $CI->db->query($query3);\r\n        $samples = $result3->result();\r\n        \r\n        echo \"<h3>Örnek stok kayıtları:</h3>\";\r\n        echo \"<pre>\";\r\n        foreach($samples as $sample) {\r\n            print_r($sample);\r\n        }\r\n        echo \"</pre>\";\r\n    } else {\r\n        // İlk 10 stoğu göster\r\n        $query4 = \"SELECT * FROM stok WHERE stok_olusturanAnaHesap = ? AND stok_durum = 1 LIMIT 10\";\r\n        $result4 = $CI->db->query($query4, [$anaHesap]);\r\n        $stocks = $result4->result();\r\n        \r\n        echo \"<h3>İlk 10 stok:</h3>\";\r\n        echo \"<ul>\";\r\n        foreach($stocks as $stock) {\r\n            echo \"<li>ID: {$stock->stok_id}, Ad: {$stock->stok_ad}, Kod: {$stock->stok_kodu}</li>\";\r\n        }\r\n        echo \"</ul>\";\r\n        \r\n        // JSON formatında da göster\r\n        $formatted_results = [];\r\n        foreach ($stocks as $row) {\r\n            $display_text = $row->stok_ad;\r\n            if (!empty($row->stok_kodu)) {\r\n                $display_text .= \" (Kod: {$row->stok_kodu})\";\r\n            }\r\n            if (!empty($row->stok_satisFiyati)) {\r\n                $display_text .= \" - \" . number_format($row->stok_satisFiyati, 2) . \" ₺\";\r\n            }\r\n            \r\n            $formatted_results[] = [\r\n                'id' => $row->stok_id,\r\n                'text' => $display_text,\r\n                'stok_data' => [\r\n                    'stok_id' => $row->stok_id,\r\n                    'stok_kodu' => $row->stok_kodu,\r\n                    'stok_ad' => $row->stok_ad,\r\n                    'stok_satisFiyati' => $row->stok_satisFiyati,\r\n                    'stok_satisKDV' => $row->stok_satisKDV\r\n                ]\r\n            ];\r\n        }\r\n        \r\n        echo \"<h3>JSON Response Formatı:</h3>\";\r\n        echo \"<pre>\" . json_encode([\r\n            'results' => $formatted_results,\r\n            'pagination' => ['more' => false]\r\n        ], JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . \"</pre>\";\r\n    }\r\n    \r\n} catch (Exception $e) {\r\n    echo \"<p style='color:red'>❌ Hata: \" . $e->getMessage() . \"</p>\";\r\n    echo \"<pre>\" . $e->getTraceAsString() . \"</pre>\";\r\n}\r\n?>\r\n"
        }
    ]
}