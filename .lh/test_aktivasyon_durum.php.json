{
    "sourceFile": "test_aktivasyon_durum.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1755275157136,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755324928497,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,21 +25,23 @@\n     }\r\n     echo \"</table>\";\r\n     \r\n     echo \"<h2>Aktivasyon Kayıtları (İlk 10):</h2>\";\r\n-    $stmt = $pdo->query(\"SELECT a.*, ad.aktivasyon_durum_adi, c.cari_ad FROM aktivasyon a \r\n+    $stmt = $pdo->query(\"SELECT a.*, ad.aktivasyon_durum_adi, ad.aktivasyon_durum_renk, c.cari_ad FROM aktivasyon a \r\n                          LEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id \r\n                          LEFT JOIN cari c ON a.aktivasyon_cari_id = c.cari_id \r\n                          LIMIT 10\");\r\n     echo \"<table border='1'>\";\r\n-    echo \"<tr><th>Aktivasyon ID</th><th>Cari</th><th>Durum ID</th><th>Durum Adı</th><th>Tarih</th></tr>\";\r\n+    echo \"<tr><th>Aktivasyon ID</th><th>Cari</th><th>Durum ID</th><th>Durum Adı</th><th>Aktivasyon Tarihi</th><th>Üye No</th><th>Kutu No</th></tr>\";\r\n     while($row = $stmt->fetch()) {\r\n         echo \"<tr>\";\r\n         echo \"<td>\" . $row['aktivasyon_id'] . \"</td>\";\r\n         echo \"<td>\" . $row['cari_ad'] . \"</td>\";\r\n         echo \"<td>\" . $row['aktivasyon_durum_id'] . \"</td>\";\r\n-        echo \"<td>\" . ($row['aktivasyon_durum_adi'] ?? 'NULL') . \"</td>\";\r\n-        echo \"<td>\" . $row['aktivasyon_tarihi'] . \"</td>\";\r\n+        echo \"<td style='background-color:\" . ($row['aktivasyon_durum_renk'] ?? '#ccc') . \"; color: white;'>\" . ($row['aktivasyon_durum_adi'] ?? 'NULL') . \"</td>\";\r\n+        echo \"<td>\" . ($row['aktivasyon_tarihi'] ? date('d.m.Y H:i', strtotime($row['aktivasyon_tarihi'])) : 'NULL') . \"</td>\";\r\n+        echo \"<td>\" . ($row['aktivasyon_uye_no'] ?? '-') . \"</td>\";\r\n+        echo \"<td>\" . ($row['aktivasyon_kutu_no'] ?? '-') . \"</td>\";\r\n         echo \"</tr>\";\r\n     }\r\n     echo \"</table>\";\r\n     \r\n"
                },
                {
                    "date": 1755325437651,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,17 +11,18 @@\n     $pdo = new PDO(\"mysql:host=$servername;dbname=$dbname;charset=utf8\", $username, $password);\r\n     $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n     \r\n     echo \"<h2>Aktivasyon Durum Tablosu:</h2>\";\r\n-    $stmt = $pdo->query(\"SELECT * FROM aktivasyon_durum\");\r\n-    echo \"<table border='1'>\";\r\n-    echo \"<tr><th>ID</th><th>Durum Adı</th><th>Renk</th><th>Durum</th></tr>\";\r\n+    $stmt = $pdo->query(\"SELECT * FROM aktivasyon_durum WHERE durum = 1 ORDER BY aktivasyon_durum_id\");\r\n+    echo \"<table border='1' style='border-collapse: collapse; width: 100%;'>\";\r\n+    echo \"<tr style='background-color: #f8f9fa;'><th>ID</th><th>Durum Adı</th><th>Renk</th><th>Aktif</th><th>Oluşturma</th></tr>\";\r\n     while($row = $stmt->fetch()) {\r\n         echo \"<tr>\";\r\n         echo \"<td>\" . $row['aktivasyon_durum_id'] . \"</td>\";\r\n-        echo \"<td>\" . $row['aktivasyon_durum_adi'] . \"</td>\";\r\n-        echo \"<td style='background-color:\" . $row['aktivasyon_durum_renk'] . \"'>\" . $row['aktivasyon_durum_renk'] . \"</td>\";\r\n-        echo \"<td>\" . $row['durum'] . \"</td>\";\r\n+        echo \"<td><strong>\" . $row['aktivasyon_durum_adi'] . \"</strong></td>\";\r\n+        echo \"<td style='background-color:\" . $row['aktivasyon_durum_renk'] . \"; color: white; text-align: center; font-weight: bold;'>\" . $row['aktivasyon_durum_renk'] . \"</td>\";\r\n+        echo \"<td>\" . ($row['durum'] ? '✓ Aktif' : '✗ Pasif') . \"</td>\";\r\n+        echo \"<td>\" . date('d.m.Y H:i', strtotime($row['olusturma_tarihi'])) . \"</td>\";\r\n         echo \"</tr>\";\r\n     }\r\n     echo \"</table>\";\r\n     \r\n"
                },
                {
                    "date": 1755325801203,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,43 +25,109 @@\n         echo \"</tr>\";\r\n     }\r\n     echo \"</table>\";\r\n     \r\n-    echo \"<h2>Aktivasyon Kayıtları (İlk 10):</h2>\";\r\n-    $stmt = $pdo->query(\"SELECT a.*, ad.aktivasyon_durum_adi, ad.aktivasyon_durum_renk, c.cari_ad FROM aktivasyon a \r\n+    echo \"<h2>Aktivasyon → Aktivasyon Durum İlişkisi (İlk 10 Kayıt):</h2>\";\r\n+    $stmt = $pdo->query(\"SELECT \r\n+                            a.aktivasyon_id,\r\n+                            a.aktivasyon_cari_id,\r\n+                            a.aktivasyon_durum_id,\r\n+                            a.aktivasyon_tarihi,\r\n+                            a.aktivasyon_uye_no,\r\n+                            ad.aktivasyon_durum_adi,\r\n+                            ad.aktivasyon_durum_renk,\r\n+                            ad.durum as durum_aktif,\r\n+                            c.cari_ad\r\n+                         FROM aktivasyon a \r\n                          LEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id \r\n                          LEFT JOIN cari c ON a.aktivasyon_cari_id = c.cari_id \r\n+                         ORDER BY a.aktivasyon_id DESC\r\n                          LIMIT 10\");\r\n-    echo \"<table border='1'>\";\r\n-    echo \"<tr><th>Aktivasyon ID</th><th>Cari</th><th>Durum ID</th><th>Durum Adı</th><th>Aktivasyon Tarihi</th><th>Üye No</th><th>Kutu No</th></tr>\";\r\n+    \r\n+    echo \"<table border='1' style='border-collapse: collapse; width: 100%; font-size: 12px;'>\";\r\n+    echo \"<tr style='background-color: #f8f9fa;'>\r\n+            <th>Aktivasyon ID</th>\r\n+            <th>Cari</th>\r\n+            <th>Durum ID</th>\r\n+            <th>Durum Adı</th>\r\n+            <th>Durum Renk</th>\r\n+            <th>Aktif?</th>\r\n+            <th>Tarih</th>\r\n+            <th>Üye No</th>\r\n+          </tr>\";\r\n+          \r\n     while($row = $stmt->fetch()) {\r\n+        $durumRenk = $row['aktivasyon_durum_renk'] ?? '#cccccc';\r\n+        $durumAdi = $row['aktivasyon_durum_adi'] ?? 'Tanımlanmamış';\r\n+        \r\n         echo \"<tr>\";\r\n         echo \"<td>\" . $row['aktivasyon_id'] . \"</td>\";\r\n-        echo \"<td>\" . $row['cari_ad'] . \"</td>\";\r\n-        echo \"<td>\" . $row['aktivasyon_durum_id'] . \"</td>\";\r\n-        echo \"<td style='background-color:\" . ($row['aktivasyon_durum_renk'] ?? '#ccc') . \"; color: white;'>\" . ($row['aktivasyon_durum_adi'] ?? 'NULL') . \"</td>\";\r\n+        echo \"<td><strong>\" . ($row['cari_ad'] ?? 'Bilinmeyen') . \"</strong></td>\";\r\n+        echo \"<td>\" . ($row['aktivasyon_durum_id'] ?? 'NULL') . \"</td>\";\r\n+        echo \"<td style='background-color:\" . $durumRenk . \"; color: white; font-weight: bold; text-align: center;'>\" . $durumAdi . \"</td>\";\r\n+        echo \"<td>\" . $durumRenk . \"</td>\";\r\n+        echo \"<td>\" . (($row['durum_aktif'] == 1) ? '✓' : '✗') . \"</td>\";\r\n         echo \"<td>\" . ($row['aktivasyon_tarihi'] ? date('d.m.Y H:i', strtotime($row['aktivasyon_tarihi'])) : 'NULL') . \"</td>\";\r\n         echo \"<td>\" . ($row['aktivasyon_uye_no'] ?? '-') . \"</td>\";\r\n-        echo \"<td>\" . ($row['aktivasyon_kutu_no'] ?? '-') . \"</td>\";\r\n         echo \"</tr>\";\r\n     }\r\n     echo \"</table>\";\r\n     \r\n-    echo \"<h2>Aktivasyon Durum Sayıları:</h2>\";\r\n-    $stmt = $pdo->query(\"SELECT ad.aktivasyon_durum_adi, COUNT(*) as sayi \r\n-                         FROM aktivasyon a \r\n-                         LEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id \r\n-                         GROUP BY a.aktivasyon_durum_id, ad.aktivasyon_durum_adi\");\r\n-    echo \"<table border='1'>\";\r\n-    echo \"<tr><th>Durum</th><th>Sayı</th></tr>\";\r\n+    echo \"<h2>Aktivasyon Durum İstatistikleri:</h2>\";\r\n+    $stmt = $pdo->query(\"SELECT \r\n+                            ad.aktivasyon_durum_id,\r\n+                            ad.aktivasyon_durum_adi, \r\n+                            ad.aktivasyon_durum_renk,\r\n+                            ad.durum as durum_aktif,\r\n+                            COUNT(a.aktivasyon_id) as aktivasyon_sayisi,\r\n+                            COUNT(CASE WHEN a.aktivasyon_tarihi IS NOT NULL THEN 1 END) as tarihli_aktivasyon_sayisi\r\n+                         FROM aktivasyon_durum ad\r\n+                         LEFT JOIN aktivasyon a ON ad.aktivasyon_durum_id = a.aktivasyon_durum_id \r\n+                         WHERE ad.durum = 1\r\n+                         GROUP BY ad.aktivasyon_durum_id, ad.aktivasyon_durum_adi, ad.aktivasyon_durum_renk, ad.durum\r\n+                         ORDER BY aktivasyon_sayisi DESC\");\r\n+                         \r\n+    echo \"<table border='1' style='border-collapse: collapse; width: 100%;'>\";\r\n+    echo \"<tr style='background-color: #f8f9fa;'>\r\n+            <th>Durum ID</th>\r\n+            <th>Durum Adı</th>\r\n+            <th>Renk</th>\r\n+            <th>Toplam Aktivasyon</th>\r\n+            <th>Tarihli Aktivasyon</th>\r\n+            <th>Aktif?</th>\r\n+          </tr>\";\r\n+          \r\n+    $toplamAktivasyon = 0;\r\n     while($row = $stmt->fetch()) {\r\n+        $toplamAktivasyon += $row['aktivasyon_sayisi'];\r\n+        \r\n         echo \"<tr>\";\r\n-        echo \"<td>\" . ($row['aktivasyon_durum_adi'] ?? 'Belirsiz') . \"</td>\";\r\n-        echo \"<td>\" . $row['sayi'] . \"</td>\";\r\n+        echo \"<td>\" . $row['aktivasyon_durum_id'] . \"</td>\";\r\n+        echo \"<td style='background-color:\" . $row['aktivasyon_durum_renk'] . \"; color: white; font-weight: bold; text-align: center; padding: 8px;'>\";\r\n+        echo $row['aktivasyon_durum_adi'];\r\n+        echo \"</td>\";\r\n+        echo \"<td style='text-align: center;'>\" . $row['aktivasyon_durum_renk'] . \"</td>\";\r\n+        echo \"<td style='text-align: center; font-weight: bold;'>\" . $row['aktivasyon_sayisi'] . \"</td>\";\r\n+        echo \"<td style='text-align: center;'>\" . $row['tarihli_aktivasyon_sayisi'] . \"</td>\";\r\n+        echo \"<td style='text-align: center;'>\" . (($row['durum_aktif'] == 1) ? '✓ Aktif' : '✗ Pasif') . \"</td>\";\r\n         echo \"</tr>\";\r\n     }\r\n+    \r\n+    echo \"<tr style='background-color: #e9ecef; font-weight: bold;'>\";\r\n+    echo \"<td colspan='3'>TOPLAM</td>\";\r\n+    echo \"<td style='text-align: center;'>\" . $toplamAktivasyon . \"</td>\";\r\n+    echo \"<td colspan='2'>-</td>\";\r\n+    echo \"</tr>\";\r\n     echo \"</table>\";\r\n     \r\n+    // Durum ID'si NULL olan aktivasyonlar\r\n+    $nullDurum = $pdo->query(\"SELECT COUNT(*) as sayi FROM aktivasyon WHERE aktivasyon_durum_id IS NULL\")->fetch();\r\n+    if ($nullDurum['sayi'] > 0) {\r\n+        echo \"<div style='background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 5px;'>\";\r\n+        echo \"<strong>⚠️ Uyarı:</strong> \" . $nullDurum['sayi'] . \" aktivasyon kaydında durum_id NULL. Bu kayıtlar raporlarda 'Tanımlanmamış' olarak görünecek.\";\r\n+        echo \"</div>\";\r\n+    }\r\n+    \r\n } catch(PDOException $e) {\r\n     echo \"Bağlantı hatası: \" . $e->getMessage();\r\n }\r\n ?>\r\n"
                }
            ],
            "date": 1755275157136,
            "name": "Commit-0",
            "content": "<?php\r\n// Basit test dosyası - aktivasyon durum verilerini kontrol etmek için\r\n\r\n// Database connection\r\n$servername = \"localhost\";\r\n$username = \"root\"; // Veritabanı kullanıcı adınızı buraya yazın\r\n$password = \"\"; // Veritabanı şifrenizi buraya yazın\r\n$dbname = \"ilekasoft_crmdb\";\r\n\r\ntry {\r\n    $pdo = new PDO(\"mysql:host=$servername;dbname=$dbname;charset=utf8\", $username, $password);\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n    \r\n    echo \"<h2>Aktivasyon Durum Tablosu:</h2>\";\r\n    $stmt = $pdo->query(\"SELECT * FROM aktivasyon_durum\");\r\n    echo \"<table border='1'>\";\r\n    echo \"<tr><th>ID</th><th>Durum Adı</th><th>Renk</th><th>Durum</th></tr>\";\r\n    while($row = $stmt->fetch()) {\r\n        echo \"<tr>\";\r\n        echo \"<td>\" . $row['aktivasyon_durum_id'] . \"</td>\";\r\n        echo \"<td>\" . $row['aktivasyon_durum_adi'] . \"</td>\";\r\n        echo \"<td style='background-color:\" . $row['aktivasyon_durum_renk'] . \"'>\" . $row['aktivasyon_durum_renk'] . \"</td>\";\r\n        echo \"<td>\" . $row['durum'] . \"</td>\";\r\n        echo \"</tr>\";\r\n    }\r\n    echo \"</table>\";\r\n    \r\n    echo \"<h2>Aktivasyon Kayıtları (İlk 10):</h2>\";\r\n    $stmt = $pdo->query(\"SELECT a.*, ad.aktivasyon_durum_adi, c.cari_ad FROM aktivasyon a \r\n                         LEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id \r\n                         LEFT JOIN cari c ON a.aktivasyon_cari_id = c.cari_id \r\n                         LIMIT 10\");\r\n    echo \"<table border='1'>\";\r\n    echo \"<tr><th>Aktivasyon ID</th><th>Cari</th><th>Durum ID</th><th>Durum Adı</th><th>Tarih</th></tr>\";\r\n    while($row = $stmt->fetch()) {\r\n        echo \"<tr>\";\r\n        echo \"<td>\" . $row['aktivasyon_id'] . \"</td>\";\r\n        echo \"<td>\" . $row['cari_ad'] . \"</td>\";\r\n        echo \"<td>\" . $row['aktivasyon_durum_id'] . \"</td>\";\r\n        echo \"<td>\" . ($row['aktivasyon_durum_adi'] ?? 'NULL') . \"</td>\";\r\n        echo \"<td>\" . $row['aktivasyon_tarihi'] . \"</td>\";\r\n        echo \"</tr>\";\r\n    }\r\n    echo \"</table>\";\r\n    \r\n    echo \"<h2>Aktivasyon Durum Sayıları:</h2>\";\r\n    $stmt = $pdo->query(\"SELECT ad.aktivasyon_durum_adi, COUNT(*) as sayi \r\n                         FROM aktivasyon a \r\n                         LEFT JOIN aktivasyon_durum ad ON a.aktivasyon_durum_id = ad.aktivasyon_durum_id \r\n                         GROUP BY a.aktivasyon_durum_id, ad.aktivasyon_durum_adi\");\r\n    echo \"<table border='1'>\";\r\n    echo \"<tr><th>Durum</th><th>Sayı</th></tr>\";\r\n    while($row = $stmt->fetch()) {\r\n        echo \"<tr>\";\r\n        echo \"<td>\" . ($row['aktivasyon_durum_adi'] ?? 'Belirsiz') . \"</td>\";\r\n        echo \"<td>\" . $row['sayi'] . \"</td>\";\r\n        echo \"</tr>\";\r\n    }\r\n    echo \"</table>\";\r\n    \r\n} catch(PDOException $e) {\r\n    echo \"Bağlantı hatası: \" . $e->getMessage();\r\n}\r\n?>\r\n"
        }
    ]
}