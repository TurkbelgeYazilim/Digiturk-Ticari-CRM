{
    "sourceFile": "check_voip_iris_table.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1754741006026,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1754741006026,
            "name": "Commit-0",
            "content": "<?php\r\n/**\r\n * VoIP İris Rapor Tablo Kontrolü ve Oluşturma Script'i\r\n * Bu script tabloların var olup olmadığını kontrol eder ve gerekirse oluşturur\r\n */\r\n\r\ntry {\r\n    // Database bağlantısı\r\n    $dsn = \"mysql:host=localhost;dbname=ilekasoft_crmdb;charset=utf8mb4\";\r\n    $pdo = new PDO($dsn, 'ilekasoft_crmuser', 'KaleW356!');\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n\r\n    echo \"<h2>VoIP İris Rapor Tablo Kontrolü</h2>\";\r\n\r\n    // Tablo var mı kontrol et\r\n    $checkTable = \"SHOW TABLES LIKE 'voip_iris_rapor'\";\r\n    $stmt = $pdo->query($checkTable);\r\n    $tableExists = $stmt->rowCount() > 0;\r\n\r\n    if ($tableExists) {\r\n        echo \"<p style='color: green;'>✓ voip_iris_rapor tablosu mevcut</p>\";\r\n        \r\n        // Tablo yapısını göster\r\n        $describe = \"DESCRIBE voip_iris_rapor\";\r\n        $stmt = $pdo->query($describe);\r\n        $columns = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n        \r\n        echo \"<h3>Tablo Yapısı:</h3>\";\r\n        echo \"<table border='1' style='border-collapse: collapse; width: 100%;'>\";\r\n        echo \"<tr><th>Sütun</th><th>Tip</th><th>Null</th><th>Key</th><th>Default</th><th>Extra</th></tr>\";\r\n        foreach ($columns as $column) {\r\n            echo \"<tr>\";\r\n            echo \"<td>\" . htmlspecialchars($column['Field']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($column['Type']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($column['Null']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($column['Key']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($column['Default']) . \"</td>\";\r\n            echo \"<td>\" . htmlspecialchars($column['Extra']) . \"</td>\";\r\n            echo \"</tr>\";\r\n        }\r\n        echo \"</table>\";\r\n\r\n        // Kayıt sayısını göster\r\n        $countQuery = \"SELECT COUNT(*) as total FROM voip_iris_rapor\";\r\n        $stmt = $pdo->query($countQuery);\r\n        $count = $stmt->fetch(PDO::FETCH_ASSOC);\r\n        echo \"<p><strong>Toplam Kayıt:</strong> \" . number_format($count['total']) . \"</p>\";\r\n\r\n    } else {\r\n        echo \"<p style='color: red;'>✗ voip_iris_rapor tablosu mevcut değil</p>\";\r\n        echo \"<p>Tablo oluşturuluyor...</p>\";\r\n\r\n        // Tablo oluşturma SQL'i\r\n        $createTableSQL = \"\r\n        CREATE TABLE `voip_iris_rapor` (\r\n          `id` int(11) NOT NULL AUTO_INCREMENT,\r\n          `talep_id` varchar(20) NOT NULL,\r\n          `talep_turu` varchar(100) DEFAULT NULL,\r\n          `uydu_basvuru_potansiyel_no` varchar(20) DEFAULT NULL,\r\n          `uydu_basvuru_uye_no` varchar(20) DEFAULT NULL,\r\n          `dt_musteri_no` varchar(20) DEFAULT NULL,\r\n          `memo_id` varchar(20) DEFAULT NULL,\r\n          `memo_kayit_tipi` varchar(20) DEFAULT NULL,\r\n          `memo_id_tip` varchar(10) DEFAULT NULL,\r\n          `memo_kodu` varchar(100) DEFAULT NULL,\r\n          `memo_kapanis_tarihi` datetime DEFAULT NULL,\r\n          `memo_yonlenen_bayi_kodu` varchar(20) DEFAULT NULL,\r\n          `memo_yonlenen_bayi_adi` varchar(255) DEFAULT NULL,\r\n          `memo_yonlenen_bayi_yoneticisi` varchar(100) DEFAULT NULL,\r\n          `memo_yonlenen_bayi_bolge` varchar(100) DEFAULT NULL,\r\n          `memo_yonlenen_bayi_teknik_yntc` varchar(100) DEFAULT NULL,\r\n          `talep_giris_tarihi` datetime DEFAULT NULL,\r\n          `talebi_giren_bayi_kodu` varchar(20) DEFAULT NULL,\r\n          `talebi_giren_bayi_adi` varchar(255) DEFAULT NULL,\r\n          `talebi_giren_personel` varchar(100) DEFAULT NULL,\r\n          `talebi_giren_personelno` varchar(20) DEFAULT NULL,\r\n          `talebi_giren_personelkodu` varchar(50) DEFAULT NULL,\r\n          `talebi_giren_personel_altbayi` varchar(100) DEFAULT NULL,\r\n          `talep_kaynak` varchar(100) DEFAULT NULL,\r\n          `satis_durumu` varchar(100) DEFAULT NULL,\r\n          `internet_surec_durumu` varchar(100) DEFAULT NULL,\r\n          `aktive_edilen_uyeno` varchar(20) DEFAULT NULL,\r\n          `aktive_edilen_outletno` varchar(10) DEFAULT NULL,\r\n          `aktive_edilen_sozlesmeno` varchar(50) DEFAULT NULL,\r\n          `aktive_edilen_sozlesmekmp` varchar(10) DEFAULT NULL,\r\n          `aktive_edilen_sozlesmedurum` varchar(50) DEFAULT NULL,\r\n          `talep_takip_notu` text DEFAULT NULL,\r\n          `guncel_outlet_durum` varchar(50) DEFAULT NULL,\r\n          `teyit_durum` varchar(50) DEFAULT NULL,\r\n          `teyit_arama_durum` varchar(50) DEFAULT NULL,\r\n          `randevu_tarihi` datetime DEFAULT NULL,\r\n          `memo_son_durum` varchar(100) DEFAULT NULL,\r\n          `memo_son_cevap` varchar(100) DEFAULT NULL,\r\n          `memo_son_aciklama` text DEFAULT NULL,\r\n          `kayit_tarihi` timestamp NOT NULL DEFAULT current_timestamp(),\r\n          `guncelleme_tarihi` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),\r\n          PRIMARY KEY (`id`),\r\n          UNIQUE KEY `unique_talep_id` (`talep_id`),\r\n          KEY `idx_dt_musteri_no` (`dt_musteri_no`),\r\n          KEY `idx_memo_id` (`memo_id`),\r\n          KEY `idx_memo_kayit_tipi` (`memo_kayit_tipi`),\r\n          KEY `idx_memo_yonlenen_bayi_kodu` (`memo_yonlenen_bayi_kodu`),\r\n          KEY `idx_talep_giris_tarihi` (`talep_giris_tarihi`),\r\n          KEY `idx_talebi_giren_bayi_kodu` (`talebi_giren_bayi_kodu`),\r\n          KEY `idx_satis_durumu` (`satis_durumu`)\r\n        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\r\n        \";\r\n\r\n        $pdo->exec($createTableSQL);\r\n        echo \"<p style='color: green;'>✓ voip_iris_rapor tablosu başarıyla oluşturuldu</p>\";\r\n    }\r\n\r\n    echo \"<h3>Test Verisi Ekleme</h3>\";\r\n    \r\n    // Test verisi var mı kontrol et\r\n    $testQuery = \"SELECT COUNT(*) as count FROM voip_iris_rapor WHERE talep_id = 'TEST_001'\";\r\n    $stmt = $pdo->query($testQuery);\r\n    $testCount = $stmt->fetch(PDO::FETCH_ASSOC);\r\n    \r\n    if ($testCount['count'] == 0) {\r\n        // Test verisi ekle\r\n        $insertTestData = \"\r\n        INSERT INTO voip_iris_rapor (\r\n            talep_id, talep_turu, dt_musteri_no, memo_id, \r\n            memo_yonlenen_bayi_adi, satis_durumu, \r\n            talep_giris_tarihi, memo_son_durum\r\n        ) VALUES (\r\n            'TEST_001', 'Test Talep', '1234567890', 'MEMO_001',\r\n            'Test Bayi', 'Test Durumu', NOW(), 'Test Son Durum'\r\n        )\";\r\n        \r\n        $pdo->exec($insertTestData);\r\n        echo \"<p style='color: green;'>✓ Test verisi eklendi</p>\";\r\n    } else {\r\n        echo \"<p style='color: blue;'>ℹ Test verisi zaten mevcut</p>\";\r\n    }\r\n\r\n    echo \"<h3>Sistem Bilgileri</h3>\";\r\n    echo \"<p><strong>PHP Version:</strong> \" . PHP_VERSION . \"</p>\";\r\n    echo \"<p><strong>MySQL Version:</strong> \" . $pdo->getAttribute(PDO::ATTR_SERVER_VERSION) . \"</p>\";\r\n    echo \"<p><strong>Tarih:</strong> \" . date('Y-m-d H:i:s') . \"</p>\";\r\n\r\n} catch (PDOException $e) {\r\n    echo \"<p style='color: red;'>Database Hatası: \" . $e->getMessage() . \"</p>\";\r\n} catch (Exception $e) {\r\n    echo \"<p style='color: red;'>Genel Hata: \" . $e->getMessage() . \"</p>\";\r\n}\r\n?>\r\n"
        }
    ]
}